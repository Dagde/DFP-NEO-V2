<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- Favicon removed to prevent 403 error -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flight School Scheduler - v2024-12-08-2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              // Remove purple colors by overriding them with gray
              purple: {
                50: '#f9fafb',
                100: '#f3f4f6', 
                200: '#e5e7eb',
                300: '#d1d5db',
                400: '#9ca3af',
                500: '#6b7280',
                600: '#4b5563',
                700: '#374151',
                800: '#1f2937',
                900: '#111827',
                950: '#030712',
              }
            }
          }
        }
      }
    </script>
    <style>
      /* DO NOT hide buttons globally - only target sidebar buttons specifically */
      /* This ensures Save buttons in Flight Details modal still work */
      
      /* Hide ALL purple buttons everywhere - Edit and Save buttons serve no purpose */
      button[style*="rgb(118, 75, 162)"],
      button[style*="#764ba2"] {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
        height: 0 !important;
        width: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
      }
    </style>
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <style>
  @keyframes fade-in {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  .animate-fade-in {
    animation: fade-in 0.2s ease-out forwards;
  }
  @keyframes slide-in-right {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }
  .animate-slide-in-right {
    animation: slide-in-right 0.2s ease-out forwards;
  }
  .no-select {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }
  .btn-shape-fill {
    background-color: #9ca3af; /* gray-400 fallback */
    background-image: linear-gradient(to bottom, #e5e7eb, #b8bec7); /* light gray to mid gray */
    border: 1px solid #6b7280; /* gray-500 */
    color: #1f2937; /* gray-800 */
    text-shadow: 0 1px 0 rgba(255,255,255,0.4);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.3), 0 1px 2px rgba(0,0,0,0.15);
    transition: all 0.1s ease-in-out;
  }
  .btn-shape-fill:hover {
    background-color: #e5e7eb;
    background-image: linear-gradient(to bottom, #f3f4f6, #cdd2d9);
  }
  .btn-shape-fill.active, .btn-shape-fill:active {
    background-color: #b8bec7;
    background-image: linear-gradient(to top, #e5e7eb, #b8bec7);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    border-color: #4b5563; /* gray-600 */
    color: #111827; /* gray-900 */
    transform: translateY(1px);
  }
  .btn-gold-brushed {
    background-color: #eab308; /* yellow-500 fallback */
    background-image: linear-gradient(to bottom, #fde047, #ca8a04); /* yellow-300 to yellow-600 */
    border: 1px solid #a16207; /* yellow-700 */
    color: #422006; /* yellow-950 */
    text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);
    transition: all 0.1s ease-in-out;
  }
  .btn-gold-brushed:hover {
    background-image: linear-gradient(to bottom, #fef08a, #facc15); /* lighter yellow gradient */
  }
  .btn-gold-brushed.active, .btn-gold-brushed:active {
    background-image: linear-gradient(to top, #fde047, #ca8a04);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    border-color: #854d0e; /* yellow-800 */
    transform: translateY(1px);
  }
  .btn-green-brushed {
    background-color: #166534; /* green-800 fallback */
    background-image: linear-gradient(to bottom, #4ade80, #16a34a); /* green-400 to green-600 */
    border: 1px solid #14532d; /* green-900 */
    color: #1f2937; /* gray-800 */
    text-shadow: 0 1px 1px rgba(255,255,255,0.4);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.3), 0 1px 2px rgba(0,0,0,0.2);
    transition: all 0.1s ease-in-out;
  }
  .btn-green-brushed:hover {
    background-image: linear-gradient(to bottom, #86efac, #22c55e); /* lighter green gradient */
  }
  .btn-green-brushed:active {
    background-image: linear-gradient(to top, #4ade80, #16a34a);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    border-color: #14532d;
    transform: translateY(1px);
  }
  .btn-orange-brushed {
    background-color: #d97706; /* amber-600 fallback */
    background-image: linear-gradient(to bottom, #fbbf24, #f59e0b); /* amber-400 to amber-500 */
    border: 1px solid #92400e; /* amber-800 */
    color: #ffffff;
    text-shadow: 0 1px 1px rgba(0,0,0,0.4);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.3), 0 1px 2px rgba(0,0,0,0.2);
    transition: all 0.1s ease-in-out;
  }
  .btn-orange-brushed:hover {
    background-image: linear-gradient(to bottom, #fcd34d, #fbbf24); /* lighter amber gradient */
  }
  .btn-orange-brushed:active {
    background-image: linear-gradient(to top, #fbbf24, #f59e0b);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    border-color: #92400e;
    transform: translateY(1px);
  }
  .btn-red-brushed {
    background-color: #dc2626; /* red-600 fallback */
    background-image: linear-gradient(to bottom, #f87171, #ef4444); /* red-400 to red-500 */
    border: 1px solid #991b1b; /* red-800 */
    color: #ffffff;
    text-shadow: 0 1px 1px rgba(0,0,0,0.4);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.3), 0 1px 2px rgba(0,0,0,0.2);
    transition: all 0.1s ease-in-out;
  }
  .btn-red-brushed:hover {
    background-image: linear-gradient(to bottom, #fca5a5, #f87171); /* lighter red gradient */
  }
  .btn-red-brushed:active {
    background-image: linear-gradient(to top, #f87171, #ef4444);
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    border-color: #991b1b;
    transform: translateY(1px);
  }
  .btn-gunmetal-brushed {
    background-color: #374151; /* gray-700 fallback */
    background-image: linear-gradient(to right, #1f2937, #4b5563, #1f2937); /* gray-800, gray-600, gray-800 */
    border: 1px solid #000; /* black */
    color: #f9fafb; /* gray-50, white text for contrast */
    text-shadow: 0 1px 1px rgba(0,0,0,0.5);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 1px 2px rgba(0,0,0,0.3);
    transition: all 0.1s ease-in-out;
  }
  .btn-gunmetal-brushed:hover {
    background-image: linear-gradient(to right, #374151, #6b7280, #374151); /* gray-700, gray-500, gray-700 */
  }
  .btn-gunmetal-brushed.active, .btn-gunmetal-brushed:active {
    background-image: linear-gradient(to right, #111827, #374151, #111827); /* gray-900, gray-700, gray-900 */
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
    border-color: #000;
    transform: translateY(1px);
  }
  .btn-aluminium-brushed {
    background-color: #9ca3af; /* gray-400 fallback */
    background-image: linear-gradient(to right, #d1d5db, #f9fafb, #d1d5db);
    border-top: 1px solid #e5e7eb;
    border-bottom: 1px solid #9ca3af;
    border-left: 1px solid #9ca3af;
    border-right: 1px solid #9ca3af;
    color: #1f2937; /* gray-800 */
    text-shadow: 0 1px 0 rgba(255,255,255,0.2);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 1px 1px rgba(0,0,0,0.1);
    transition: all 0.1s ease-in-out;
  }
  .btn-aluminium-brushed:hover {
    background-image: linear-gradient(to right, #e5e7eb, #ffffff, #e5e7eb);
  }
  .btn-aluminium-brushed.active, .btn-aluminium-brushed:active {
    background-image: linear-gradient(to right, #9ca3af, #d1d5db, #9ca3af);
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);
    border-top-color: #9ca3af;
    border-bottom-color: #d1d5db;
    border-left-color: #9ca3af;
    border-right-color: #9ca3af;
    transform: translateY(1px);
  }
  .changed-bar-stripes {
    background: repeating-linear-gradient(
      135deg,
      #eab308,
      #eab308 4px,
      #ef4444 4px,
      #ef4444 8px
    );
  }
  </style>
  <script>
  <script>
    // ========================================
    // DFP-NEO COMPREHENSIVE FIXES
    // ========================================
    
    // FIX 1: Remove purple Edit/Save buttons from sidebar
    (function() {
      function killPurpleButtons() {
        document.querySelectorAll('button').forEach(btn => {
          const style = btn.getAttribute('style') || '';
          const text = btn.textContent.trim();
          
          // Purple button with Edit or Save emoji
          if ((style.includes('rgb(118, 75, 162)') || style.includes('#764ba2')) &&
              (text.includes('‚úèÔ∏è') || text.includes('üíæ'))) {
            btn.remove();
            console.log('üí• Removed:', text);
          }
        });
      }
      
      killPurpleButtons();
      setInterval(killPurpleButtons, 500);
      new MutationObserver(killPurpleButtons).observe(document.body, {childList: true, subtree: true});
    })();
    
    // FIX 2: Solo flights - show SOLO instead of duplicate name
    (function() {
      function fixSolo() {
        document.querySelectorAll('*').forEach(el => {
          if (el.dataset.soloFixed) return;
          
          const txt = el.textContent;
          const html = el.innerHTML;
          
          if (/(SCT|TWR\s+DI)/i.test(txt)) {
            const names = [...txt.matchAll(/([A-Z][a-z]+,\s*[A-Z][a-z]+)/g)];
            if (names.length >= 2 && names[0][1] === names[1][1]) {
              let c = 0;
              const n = names[0][1].replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
              el.innerHTML = html.replace(new RegExp(n, 'g'), m => ++c === 1 ? m : '<b style="color:#fbbf24">SOLO</b>');
              el.dataset.soloFixed = '1';
              console.log('‚úÖ SOLO:', names[0][1]);
            }
          }
        });
      }
      
      for(let i=0; i<10; i++) setTimeout(fixSolo, i*300);
      setInterval(fixSolo, 2000);
      new MutationObserver(() => setTimeout(fixSolo, 100)).observe(document.body, {childList:true, subtree:true, characterData:true});
    })();
    
    // FIX 3: Grey color only for SCT courses
    (function() {
      function fixColors() {
        document.querySelectorAll('[class*="ADF"],[class*="FIC"],[class*="course"]').forEach(el => {
          const bg = getComputedStyle(el).backgroundColor;
          const txt = el.textContent;
          
          if ((bg.includes('128') || bg.includes('169')) && !txt.includes('SCT')) {
            el.style.setProperty('background-color', '#3b82f6', 'important');
            el.style.setProperty('color', '#fff', 'important');
            console.log('üé® Fixed:', txt);
          }
        });
      }
      
      fixColors();
      setInterval(fixColors, 3000);
      new MutationObserver(fixColors).observe(document.body, {childList:true, subtree:true, attributes:true});
    })();
    
    console.log('‚úÖ All fixes loaded');
  </script>
  <script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
  <script type="module" crossorigin src="./assets/index-uPhlgI5U.js"></script>
  <script>
    // DFP-NEO Event Handling Fixes
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DFP-NEO: Initializing event handling fixes...');
      
      // Apply fixes after app loads
      setTimeout(applyEventHandlingFixes, 2000);
      
      // Also try periodically in case app loads slowly
      const applyInterval = setInterval(function() {
        if (document.querySelector('#root').children.length > 0) {
          clearInterval(applyInterval);
          applyEventHandlingFixes();
        }
      }, 3000);
    });

    function applyEventHandlingFixes() {
      console.log('DFP-NEO: Applying event handling fixes...');
      
      // Hook into any global schedule processing functions
      hookIntoScheduleFunctions();
      
      // Apply UI fixes
      applyUIFixes();
      
      // Set up continuous monitoring
      setupEventMonitoring();
      
      console.log('DFP-NEO: Event handling fixes applied');
    }

    function hookIntoScheduleFunctions() {
      // Hook into window object functions if they exist
      const originalFunctions = {};
      
      // Look for and hook schedule validation functions
      ['validateSchedule', 'checkConflicts', 'calculateDutyHours', 'processEvents'].forEach(funcName => {
        if (window[funcName]) {
          originalFunctions[funcName] = window[funcName];
          window[funcName] = createFilteredFunction(window[funcName]);
          console.log(`DFP-NEO: Hooked into ${funcName}`);
        }
      });

      // Create a filtered version that excludes cancelled events and STBY
      function createFilteredFunction(originalFunc) {
        return function(...args) {
          // Filter out cancelled and STBY events from any event arrays
          const filteredArgs = args.map(arg => {
            if (Array.isArray(arg)) {
              return arg.filter(event => {
                // Filter conditions:
                // 1. Remove cancelled/deleted events from processing
                // 2. Remove STBY events from schedule displays/processing
                const isCancelled = event.status === 'CANCELLED' || 
                                  event.isCancelled === true || 
                                  event.isDeleted === true ||
                                  event.cancelled === true;
                
                const isSTBY = event.type === 'STBY' || 
                             event.eventType === 'STBY' ||
                             event.category === 'STBY';
                
                // For validation/duty calculation: exclude cancelled events
                // For schedule display: exclude STBY events
                if (funcName.includes('validate') || funcName.includes('Duty') || funcName.includes('Conflict')) {
                  return !isCancelled; // Exclude cancelled from calculations
                } else {
                  return !isSTBY; // Exclude STBY from schedules
                }
              });
            }
            return arg;
          });
          
          return originalFunc.apply(this, filteredArgs);
        };
      }
    }

    function applyUIFixes() {
      // Hide STBY events from trainee and staff schedules
      hideSTBYFromSchedules();
      
      // Ensure cancelled events show red X and remain visible
      ensureCancelledEventsDisplay();
    }

    function hideSTBYFromSchedules() {
      const stbySelectors = [
        '[data-event-type="STBY"]',
        '[data-category="STBY"]', 
        '.event-stby',
        '.stby-event',
        '[data-event*="STBY"]'
      ];
      
      stbySelectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
          // Hide STBY from schedule views but keep them in editing views
          const isScheduleView = element.closest('.schedule-view, .trainee-schedule, .staff-schedule, .daily-schedule, .weekly-schedule');
          const isEditingView = element.closest('.editing-view, .admin-view, .scheduler-view');
          
          if (isScheduleView && !isEditingView) {
            element.style.display = 'none';
            element.setAttribute('data-stby-hidden', 'true');
            console.log('DFP-NEO: Hidden STBY event from schedule');
          }
        });
      });
    }

    function ensureCancelledEventsDisplay() {
      const cancelledSelectors = [
        '[data-status="CANCELLED"]',
        '[data-cancelled="true"]',
        '.cancelled-event',
        '.event-cancelled',
        '[data-event*="CANCELLED"]'
      ];
      
      cancelledSelectors.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
          // Ensure cancelled events are visible with proper styling
          element.style.display = '';
          element.style.opacity = '0.6';
          
          // Add or ensure red X indicator
          if (!element.querySelector('.dfp-cancel-x')) {
            const redX = document.createElement('div');
            redX.className = 'dfp-cancel-x';
            redX.innerHTML = '‚ùå';
            redX.title = 'Cancelled Event';
            redX.style.cssText = `
              position: absolute;
              top: 2px;
              right: 2px;
              font-size: 14px;
              z-index: 100;
              pointer-events: none;
              text-shadow: 0 0 2px rgba(0,0,0,0.8);
            `;
            
            if (element.style.position !== 'absolute' && element.style.position !== 'relative') {
              element.style.position = 'relative';
            }
            
            element.appendChild(redX);
            console.log('DFP-NEO: Added red X to cancelled event');
          }
        });
      });
    }

    function setupEventMonitoring() {
      // Monitor for DOM changes to apply fixes dynamically
      const observer = new MutationObserver(function(mutations) {
        let shouldReapply = false;
        
        mutations.forEach(function(mutation) {
          if (mutation.type === 'childList') {
            // Check if any schedule or event elements were added
            mutation.addedNodes.forEach(function(node) {
              if (node.nodeType === 1) { // Element node
                if (node.querySelector && (
                  node.querySelector('[data-event-type]') ||
                  node.querySelector('.event') ||
                  node.querySelector('.schedule-item')
                )) {
                  shouldReapply = true;
                }
              }
            });
          }
        });
        
        if (shouldReapply) {
          setTimeout(applyUIFixes, 100);
        }
      });

      observer.observe(document.body, {
        childList: true,
        subtree: true
      });

      // Also reapply fixes periodically
      setInterval(applyUIFixes, 5000);
    }

    // Add global function to manually trigger fixes
    window.applyDFPFixes = applyEventHandlingFixes;
    
    console.log('DFP-NEO: Event handling system ready');
  </script>

  <script>
    // NUCLEAR OPTION: Strip ALL inline background styles from buttons with emojis
    
    function nukeInlineStyles() {
      // Get ALL buttons
      const buttons = document.querySelectorAll('button');
      
      buttons.forEach(btn => {
        const style = window.getComputedStyle(btn);
        const bg = style.backgroundColor;
        const text = btn.textContent || '';
        const hasEditEmoji = text.includes('‚úèÔ∏è');
        const hasSaveEmoji = text.includes('üíæ');
        
        // Check if purple background
        const isPurple = bg === 'rgb(118, 75, 162)' || bg === 'rgba(118, 75, 162, 1)';
        
        // If it has Edit/Save emoji OR purple background, HIDE IT COMPLETELY
        if (hasEditEmoji || hasSaveEmoji || isPurple) {
          btn.style.setProperty('display', 'none', 'important');
          btn.style.setProperty('visibility', 'hidden', 'important');
          btn.style.setProperty('opacity', '0', 'important');
          btn.style.setProperty('pointer-events', 'none', 'important');
          btn.style.setProperty('height', '0', 'important');
          btn.style.setProperty('width', '0', 'important');
          btn.style.setProperty('margin', '0', 'important');
          btn.style.setProperty('padding', '0', 'important');
          
          console.log('DFP-NEO: HIDDEN useless button:', text.trim());
        }
      });
    }

    // 2. FIX SOLO FLIGHTS - Replace duplicate names with SOLO
    function fixSoloFlights() {
      // Find all text nodes in the document
      const walker = document.createTreeWalker(
        document.body,
        NodeFilter.SHOW_TEXT,
        null
      );
      
      const textNodes = [];
      let node;
      while (node = walker.nextNode()) {
        if (node.textContent?.trim()) {
          textNodes.push(node);
        }
      }
      
      // Look for pilot names that appear twice (indicating SOLO flight)
      const namePattern = /([A-Z][a-z]+,\s*[A-Z][a-z]+)/g;
      const nameCounts = new Map();
      const nameNodes = new Map();
      
      // First pass: count occurrences of each name
      textNodes.forEach(node => {
        const text = node.textContent || '';
        const matches = text.match(namePattern);
        if (matches) {
          matches.forEach(name => {
            nameCounts.set(name, (nameCounts.get(name) || 0) + 1);
            if (!nameNodes.has(name)) {
              nameNodes.set(name, []);
            }
            nameNodes.get(name).push(node);
          });
        }
      });
      
      // Second pass: replace second occurrence with SOLO
      nameCounts.forEach((count, name) => {
        if (count >= 2) {
          const nodes = nameNodes.get(name);
          if (nodes &amp;&amp; nodes.length >= 2) {
            // Replace the second occurrence
            const secondNode = nodes[1];
            const parent = secondNode.parentElement;
            
            if (parent &amp;&amp; !parent.dataset.soloFixed) {
              // Create a SOLO span
              const soloSpan = document.createElement('span');
              soloSpan.textContent = 'SOLO';
              soloSpan.style.color = '#fbbf24';
              soloSpan.style.fontWeight = 'bold';
              
              // Replace the text node with the SOLO span
              parent.replaceChild(soloSpan, secondNode);
              parent.dataset.soloFixed = 'true';
              
              console.log('DFP-NEO: Fixed SOLO flight for', name);
            }
          }
        }
      });
    }

    // 3. FIX GREY COURSES - Change non-SCT grey to blue
    function fixGreyCourses() {
      const tiles = document.querySelectorAll('[data-tile-id]');
      tiles.forEach(tile => {
        const style = window.getComputedStyle(tile);
        const bg = style.backgroundColor;
        const text = tile.textContent || '';
        
        // If grey but NOT SCT, make it blue
        if ((bg === 'rgb(156, 163, 175)' || bg === 'rgba(156, 163, 175, 1)') &amp;&amp; !text.includes('SCT')) {
          tile.style.backgroundColor = '#3b82f6';
        }
      });
    }

    // Run immediately on load
    setTimeout(() => {
      nukeInlineStyles();
      fixSoloFlights();
      fixGreyCourses();
      console.log('DFP-NEO: Initial fixes applied');
    }, 100);

    // Run solo fix 10 times in first 3 seconds (rapid fire)
    for (let i = 1; i <= 10; i++) {
      setTimeout(() => {
        fixSoloFlights();
      }, i * 300);
    }

    // Then continue every 2 seconds
    setInterval(() => {
      fixSoloFlights();
      fixGreyCourses();
    }, 2000);

    // CRITICAL: Nuke inline styles every 100ms (10 times per second)
    setInterval(nukeInlineStyles, 100);

    // MutationObserver for dynamic content
    const styleObserver = new MutationObserver(() => {
      nukeInlineStyles();
      fixSoloFlights();
      fixGreyCourses();
    });

    styleObserver.observe(document.body, {
      childList: true,
      subtree: true,
      attributes: true,
      attributeFilter: ['style']
    });

    console.log('DFP-NEO: Nuclear style fix active - running every 100ms');
  </script>
</head>
    <body class="bg-gray-800 text-white">
      <div id="root"></div>
    </body>
  </html>