
import { v4 as uuidv4 } from 'uuid';
import { Instructor, Trainee, ScheduleEvent, SyllabusItemDetail, Score, TraineeRank, InstructorRank, InstructorCategory, Course, Pt051Assessment, PhraseBank } from './types';

// ===================================================================================
// --- SHARED DATA ---
// ===================================================================================

const createSyllabusItem = (
    code: string,
    description: string,
    courses: string[] = ['BPC+IPC'] // Default to the standard pilot course
): SyllabusItemDetail => {
    // Safety checks for undefined parameters with error tracking
    if (!code) {
        console.error('❌ ERROR: createSyllabusItem called with undefined/null code parameter');
        console.trace();
    }
    if (!description) {
        console.error('❌ ERROR: createSyllabusItem called with undefined/null description parameter');
        console.trace();
    }
    code = code || '';
    description = description || '';
    
    let phase = 'BGF';
    if (code.startsWith('BIF')) phase = 'BIF';
    else if (code.startsWith('BNF')) phase = 'BNF';
    else if (code.startsWith('BNAV')) phase = 'BNAV';
    else if (code.startsWith('FIC')) phase = 'FIC';
    else if (code.startsWith('WSO')) phase = 'WSO';
    else if (code.startsWith('OFI')) phase = 'OFI';

--
           cctOnly: (code === 'BGF10') ? 'YES' : 'NO',
        location,
        methodOfDelivery,
        methodOfAssessment: ['Practical Assessment', 'Debrief'],
        resourcesPhysical: methodOfDelivery.includes('Aircraft') ? ['PC-21 Aircraft'] : methodOfDelivery.includes('FTD') ? ['PC-21 FTD'] : ['Classroom'],
        resourcesHuman: ['Qualified Flying Instructor', 'Trainee'],
        courses,
    };
};

const syllabusItems: SyllabusItemDetail[] = [
    // BPC + IPC Items
    createSyllabusItem('BGF MB1', 'Preparation and Pre / Post Flight Admin'),
    createSyllabusItem('BGF MB2', 'Ground Operations and Checklist'),
    createSyllabusItem('BGF CPT1', 'Checklist Procedures - Ground'),
    createSyllabusItem('BGF TUT1A', 'Ejection Seat Strap-in'),
    createSyllabusItem('BGF TUT1B', 'FTD Safety Brief'),
    createSyllabusItem('BGF TUT2', 'Flight Preparation, Checklist and Walkaround'),
    createSyllabusItem('BGF MB3', 'Effects of Controls; Attitude Flying; Straight and Level; Turning'),
    createSyllabusItem('BGF MB4', 'Climbing and Descending and Climbing and Descending Turns'),
    createSyllabusItem('BGF MB5', 'Re-join; Landing; Local Circuit Procedures'),
    createSyllabusItem('BGF MB6', 'Emergency Handling and Procedures'),
    createSyllabusItem('BGF CPT2', 'Airborne Procedures'),
    createSyllabusItem('BGF FTD1', 'Strap in and Ground Procedures'),
    createSyllabusItem('BGF MB7', 'Normal Circuits'),
    createSyllabusItem('BGF1', 'Effects of Controls; Attitude Flying; Straight and Level; Turning; Steep Turn'),
    createSyllabusItem('BGF FTD2', 'Climbing; Descending; Climbing, Turning and Descending'),
    createSyllabusItem('BGF2', 'Basic AP Operation; Climbing; Descending; Climbing, Turning and Descending; Re-join; Landing'),
    createSyllabusItem('BGF MB8', 'Ground and Airborne Emergency Procedures'),
    createSyllabusItem('BGF CPT3', 'Emergency Procedures'),
    createSyllabusItem('BGF MB9', 'Wingover and Stalling'),
    createSyllabusItem('BGF TUT3', 'Stalling; Circuits'),
    createSyllabusItem('BGF FTD3', 'Normal Circuits - Base & Final; Go Around; Wingovers; Clean Stalls; Accelerated Stall'),
    createSyllabusItem('BGF3', 'Normal Circuit - Base and Final Technique; Go Around; Wingovers; Clean Stalls; Accelerated Stall'),
    createSyllabusItem('BGF FTD4', 'Emergency Procedures; Normal Circuit'),
    createSyllabusItem('BGF4', 'Configured Stalls; Normal Circuit'),
--
  } while (usedIdNumbers.has(id));
  usedIdNumbers.add(id);
  return id;
};

const generateTraineesForCourse = (courseName: string, rankDistribution: { rank: TraineeRank; count: number }[], unit: '1FTS' | 'CFS' | '2FTS'): Trainee[] => {
  const location = (unit === '2FTS') ? 'Pearce' : 'East Sale';
  const trainees: Trainee[] = [];
  rankDistribution.forEach(({ rank, count: numToGenerate }) => {
