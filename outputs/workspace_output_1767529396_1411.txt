fixed inset-0 bg-black/60 z-[999999] flex items-center justify-center",style:{zIndex:999999},onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-2xl w-full max-w-6xl border border-gray-700 flex flex-col max-h-[90vh] relative",style:{zIndex:999999},onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900 rounded-t-lg",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Audit Log"}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Page: ",n]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:v,className:"px-3 py-1.5 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded transition-colors",title:"Export to CSV",children:"Export CSV"}),e.jsx("button",{onClick:m,className:"px-3 py-1.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded transition-colors",title:"Print Audit Log",children:"Print"}),e.jsx("button",{onClick:t,className:"px-3 py-1.5 text-sm font-medium text-white bg-gray-600 hover:bg-gray-700 rounded transition-colors",children:"Close"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-lg font-medium",children:"No audit logs found"}),e.jsx("p",{className:"text-sm mt-2",children:"Activity on this page will be recorded here"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-700 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600",onClick:()=>f("timestamp"),children:e.jsxs("div",{className:"flex items-center",children:["Date/Time",o==="timestamp"&&e.jsx("span",{className:"ml-1",children:d==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600",onClick:()=>f("user"),children:e.jsxs("div",{className:"flex items-center",children:["User",o==="user"&&e.jsx("span",{className:"ml-1",children:d==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-600",onClick:()=>f("action"),children:e.jsxs("div",{className:"flex items-center",children:["Action",o==="action"&&e.jsx("span",{className:"ml-1",children:d==="asc"?"↑":"↓"})]})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Changes"})]})}),e.jsx("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:h.map(x=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-gray-300",children:[e.jsx("div",{children:x.timestamp.toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-500",children:x.timestamp.toLocaleTimeString()})]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-gray-300",children:x.user}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${x.action==="View"?"bg-blue-900/50 text-blue-300":x.action==="Edit"?"bg-yellow-900/50 text-yellow-300":x.action==="Add"?"bg-green-900/50 text-green-300":x.action==="Delete"?"bg-red-900/50 text-red-300":x.action==="Archive"?"bg-purple-900/50 text-purple-300":x.action==="Restore"?"bg-cyan-900/50 text-cyan-300":"bg-gray-900/50 text-gray-300"}`,children:x.action})}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:x.description}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:x.changes||"-"})]},x.id))})]})})}),e.jsxs("div",{className:"p-3 border-t border-gray-700 bg-gray-900 rounded-b-lg flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Total entries: ",e.jsx("span",{className:"font-medium text-white",children:h.length})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last updated: ",new Date().toLocaleString()]})]})]})}),document.body)},Qa=({pageName:n,className:t=""})=>{const[s,i]=C.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>i(!0),className:`inline-flex items-center px-2 py-1 text-xs font-medium text-gray-400 hover:text-gray-200 bg-gray-700/50 hover:bg-gray-600/50 rounded border border-gray-600 hover:border-gray-500 transition-colors ${t}`,title:"View Audit Log",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Audit"]}),s&&e.jsx(F5,{pageName:n,onClose:()=>i(!1)})]})},P5=()=>({id:_r(),name:"New Primitive Currency",description:"",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"}),R5=()=>({id:_r(),name:"New Composite Currency",description:"",type:"composite",isVisible:!0,expiryCalculation:"EARLIEST_CHILD",logicTree:{operator:"AND",children:[]}}),U5=({onBack:n,masterCurrencies:t,currencyRequirements:s,onSave:i,onDelete:o})=>{const[l,d]=C.useState([]),[u,f]=C.useState(null),[h,m]=C.useState(""),[v,x]=C.useState(!1);C.useEffect(()=>{const H=[...t,...s];d(H),u&&!H.some(O=>O.id===u)&&f(null)},[t,s,u]);const y=C.useMemo(()=>l.filter(H=>H.name.toLowerCase().includes(h.toLowerCase())).sort((H,O)=>H.name.localeCompare(O.name)),[l,h]),T=C.useMemo(()=>l.find(H=>H.id===u)||null,[u,l]),E=H=>{d(O=>O.map(W=>W.id===H.id?H:W)),x(!0)},A=H=>{const O=H==="primitive"?P5():R5();d(W=>[...W,O]),f(O.id),x(!0)},_=()=>{if(!u)return;if(l.some(O=>{if(O.type==="composite"){const W=ne=>ne.children.some(V=>typeof V=="string"?V===u:W(V));return W(O.logicTree)}return!1})){alert("This currency cannot be deleted because it is used as a dependency in another composite currency.");return}window.confirm(`Are you sure you want to delete "${T==null?void 0:T.name}"? This action cannot be undone.`)&&(o(u),f(null))},R=()=>{i(l),x(!1)};return e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-hidden h-full",children:[e.jsxs("header",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Currency Builder"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Define primitive and composite currency rules."})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[v&&e.jsxs("button",{onClick:R,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold shadow-md flex items-center space-x-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6a1 1 0 10-2 0v5.586L7.707 10.293z"}),e.jsx("path",{d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"})]}),e.jsx("span",{children:"Save Changes"})]}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold shadow-md",children:"← Back to Settings"}),e.jsx(Qa,{pageName:"Currency Builder"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsx("input",{type:"text",placeholder:"Search currencies...",value:h,onChange:H=>m(H.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500"}),e.jsxs("div",{className:"flex mt-2 space-x-2",children:[e.jsx("button",{onClick:()=>A("primitive"),className:"flex-1 text-center py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-xs font-semibold",children:"+ Primitive"}),e.jsx("button",{onClick:()=>A("composite"),className:"flex-1 text-center py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 text-xs font-semibold",children:"+ Composite"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:y.map(H=>e.jsxs("div",{draggable:!0,onDragStart:O=>{O.dataTransfer.setData("application/currency-id",H.id),O.dataTransfer.effectAllowed="copy"},onClick:()=>f(H.id),className:`p-3 cursor-pointer border-l-4 ${u===H.id?"bg-sky-700 border-sky-400":"border-transparent hover:bg-gray-700/50"}`,children:[e.jsx("p",{className:`font-semibold ${H.type==="composite"?"text-purple-300":"text-green-300"}`,children:H.name}),e.jsx("p",{className:"text-xs text-gray-400",children:H.description||"No description"})]},H.id))})]}),e.jsx("div",{className:"w-2/3 overflow-y-auto p-6",children:T?e.jsxs("div",{className:"space-y-6",children:[T.type==="primitive"?e.jsx(B5,{currency:T,onUpdate:E}):e.jsx(O5,{currency:T,onUpdate:E,allCurrencies:l}),e.jsx($5,{currencyId:T.id,allCurrencies:l}),e.jsx("div",{className:"pt-6 border-t border-gray-700",children:e.jsx("button",{onClick:_,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold",children:"Delete Currency"})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 italic",children:"Select a currency to edit, or add a new one."})})]})]})},B5=({currency:n,onUpdate:t})=>{const s=(i,o)=>{t({...n,[i]:o})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-green-400",children:"Edit Primitive Currency"}),e.jsx(ad,{label:"Name",value:n.name,onChange:i=>s("name",i)}),e.jsx(ad,{label:"Description",value:n.description,onChange:i=>s("description",i)}),e.jsx(jv,{label:"Visible in Main List",checked:n.isVisible,onChange:i=>s("isVisible",i)}),e.jsx(ad,{label:"Validity (Days)",type:"number",value:n.validityDays,onChange:i=>s("validityDays",Number(i))}),e.jsx(ad,{label:"Required Count",type:"number",value:n.requiredCount,onChange:i=>s("requiredCount",Number(i))}),e.jsxs(Ev,{label:"Expiry Rule",value:n.expiryRule,onChange:i=>s("expiryRule",i),children:[e.jsx("option",{value:"LAST_EVENT_PLUS_PERIOD",children:"Last Event + Period"}),e.jsx("option",{value:"ROLLING_WINDOW",children:"Rolling Window"})]}),e.jsx(ad,{label:"Event Codes (comma-separated)",value:n.eventCodes.join(", "),onChange:i=>s("eventCodes",i.split(",").map(o=>o.trim()).filter(Boolean))})]})},O5=({currency:n,onUpdate:t,allCurrencies:s})=>{const i=(l,d)=>{t({...n,[l]:d})},o=l=>{i("logicTree",l)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-purple-400",children:"Edit Composite Currency"}),e.jsx(ad,{label:"Name",value:n.name,onChange:l=>i("name",l)}),e.jsx(ad,{label:"Description",value:n.description,onChange:l=>i("description",l)}),e.jsx(jv,{label:"Visible in Main List",checked:n.isVisible,onChange:l=>i("isVisible",l)}),e.jsxs(Ev,{label:"Expiry Calculation",value:n.expiryCalculation,onChange:l=>i("expiryCalculation",l),children:[e.jsx("option",{value:"EARLIEST_CHILD",children:"Use Earliest Expiry"}),e.jsx("option",{value:"LATEST_CHILD",children:"Use Latest Expiry"})]}),e.jsx(Tv,{node:n.logicTree,path:[],onUpdate:o,allCurrencies:s})]})},Tv=({node:n,path:t,onUpdate:s,allCurrencies:i})=>{const o=v=>{v.preventDefault(),v.dataTransfer.dropEffect="copy"},l=v=>{v.preventDefault();const x=v.dataTransfer.getData("application/currency-id");if(x&&!n.children.includes(x)){const y=[...n.children,x];s({...n,children:y},t)}},d=(v,x)=>{const y=[...n.children];y[x]=v,s({...n,children:y},t)},u=v=>{const x=n.children.filter((y,T)=>T!==v);s({...n,children:x},t)},f=()=>{const v=[...n.children,"new_condition_placeholder"];s({...n,children:v},t)},h=()=>{const v={operator:"AND",children:[]},x=[...n.children,v];s({...n,children:x},t)},m=v=>{s({...n,operator:v},t)};return e.jsxs("div",{className:"p-4 border border-gray-600 rounded-lg bg-gray-700/30 space-y-3",onDragOver:o,onDrop:l,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>m("AND"),className:`px-3 py-1 text-xs font-bold rounded ${n.operator==="AND"?"bg-sky-600 text-white":"bg-gray-600 text-gray-300"}`,children:"ALL of these (AND)"}),e.jsx("button",{onClick:()=>m("OR"),className:`px-3 py-1 text-xs font-bold rounded ${n.operator==="OR"?"bg-purple-600 text-white":"bg-gray-600 text-gray-300"}`,children:"ANY of these (OR)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:f,className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 rounded",children:"+ Condition"}),e.jsx("button",{onClick:h,className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 rounded",children:"+ Group"})]})]}),e.jsx("div",{className:"space-y-2 pl-4 border-l-2 border-gray-500",children:n.children.length>0?n.children.map((v,x)=>{var y;return e.jsxs("div",{className:"flex items-center group",children:[typeof v=="string"?e.jsx("div",{className:"flex-1 p-2 bg-gray-800 rounded text-sm text-gray-300",children:((y=i.find(T=>T.id===v))==null?void 0:y.name)||"Unlinked Condition"}):e.jsx(Tv,{node:v,path:[...t,"children",x],onUpdate:(T,E)=>d(T,x),allCurrencies:i}),e.jsx("button",{onClick:()=>u(x),className:"ml-2 p-1 text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},x)}):e.jsx("div",{className:"text-xs text-gray-500 italic p-4 text-center",children:"Drag currencies here or add conditions/groups."})})]})},$5=({currencyId:n,allCurrencies:t})=>{const s=C.useMemo(()=>{const i=[],o=t.filter(l=>l.type==="composite");for(const l of o){const d=u=>u.children.some(f=>typeof f=="string"?f===n:d(f));d(l.logicTree)&&i.push(l.name)}return i},[n,t]);return s.length===0?null:e.jsxs("div",{className:"p-4 border border-gray-600 rounded-lg bg-gray-700/30",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Used In:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(i=>e.jsx("span",{className:"px-2 py-1 bg-purple-800 text-purple-200 text-xs font-medium rounded-full",children:i},i))})]})},ad=({label:n,value:t,onChange:s,type:i="text"})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("input",{type:i,value:t,onChange:o=>s(o.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500"})]}),jv=({label:n,checked:t,onChange:s})=>e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:i=>s(i.target.checked),className:"h-4 w-4 bg-gray-600 border-gray-500 rounded accent-sky-500"}),e.jsx("span",{className:"text-white",children:n})]}),Ev=({label:n,value:t,onChange:s,children:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("select",{value:t,onChange:o=>s(o.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500",children:i})]}),H5=()=>{Pn("Program Schedule","Add","Added new flight event BGF5 for PLTOFF Smith","Event: BGF5, Time: 0800, Duration: 1.2hrs, Instructor: SQNLDR Jones"),Pn("Program Schedule","Edit","Modified flight event BGF3 start time","Changed start time from 0900 to 1000"),Pn("Program Schedule","Delete","Removed ground event for Course 301","Event: Ground School, Time: 1400"),Pn("Next Day Build","View","Viewed Next Day Build schedule for 2024-12-30",null),Pn("Next Day Build","Add","Added SCT event for FLTLT Brown","Event: SCT GF, Time: 0730, Type: Solo"),Pn("Priorities","Edit","Updated course priority order","Moved Course 302 above Course 301"),Pn("Priorities","Edit","Changed flying window times","Start: 0700 → 0730, End: 1700 → 1730"),console.log("✅ Test audit logs seeded successfully")},od=new Map,jo=(n,t,s)=>{const i=od.get(n);if(i){clearTimeout(i.timer);const o=t,l={...o,originalValues:i.originalParams.originalValues||o.originalValues,newValues:o.newValues},d=setTimeout(()=>{let u=t.changes;if(l.originalValues&&l.newValues){const f=[];if(l.originalValues.startTime!==void 0&&l.newValues.startTime!==void 0){const h=m=>{const v=Math.floor(m),x=Math.round((m-v)*60);return`${v.toString().padStart(2,"0")}${x.toString().padStart(2,"0")}`};f.push(`Start time: ${h(l.originalValues.startTime)} → ${h(l.newValues.startTime)}`)}l.originalValues.resourceId!==void 0&&l.newValues.resourceId!==void 0&&f.push(`Resource: ${l.originalValues.resourceId} → ${l.newValues.resourceId}`),u=f.join(", ")}s(l.page,l.action,l.description,u),od.delete(n)},3e3);od.set(n,{timer:d,originalParams:i.originalParams,latestParams:l})}else{const o=setTimeout(()=>{s(t.page,t.action,t.description,t.changes),od.delete(n)},3e3),l=t;od.set(n,{timer:o,originalParams:l,latestParams:l})}},og=()=>{od.forEach(({timer:n})=>{clearTimeout(n)}),od.clear()},q5="modulepreload",G5=function(n,t){return new URL(n,t).href},Jx={},oh=function(t,s,i){let o=Promise.resolve();if(s&&s.length>0){let d=function(m){return Promise.all(m.map(v=>Promise.resolve(v).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};const u=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),h=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=d(s.map(m=>{if(m=G5(m,i),m in Jx)return;Jx[m]=!0;const v=m.endsWith(".css"),x=v?'[rel="stylesheet"]':"";if(!!i)for(let E=u.length-1;E>=0;E--){const A=u[E];if(A.href===m&&(!v||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${x}`))return;const T=document.createElement("link");if(T.rel=v?"stylesheet":q5,v||(T.as="script"),T.crossOrigin="",T.href=m,h&&T.setAttribute("nonce",h),document.head.appendChild(T),v)return new Promise((E,A)=>{T.addEventListener("load",E),T.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${m}`)))})}))}function l(d){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=d,window.dispatchEvent(u),!u.defaultPrevented)throw d}return o.then(d=>{for(const u of d||[])u.status==="rejected"&&l(u.reason);return t().catch(l)})},Av=({type:n,title:t,message:s,onConfirm:i,onCancel:o,confirmText:l="OK",cancelText:d="Cancel",variant:u="info"})=>{const h=(()=>{switch(u){case"error":return{borderColor:"border-red-500/50",headerBg:"bg-red-900/20",titleColor:"text-red-400",iconColor:"text-red-400",confirmBg:"bg-red-600 hover:bg-red-700"};case"warning":return{borderColor:"border-amber-500/50",headerBg:"bg-amber-900/20",titleColor:"text-amber-400",iconColor:"text-amber-400",confirmBg:"bg-amber-600 hover:bg-amber-700"};case"success":return{borderColor:"border-green-500/50",headerBg:"bg-green-900/20",titleColor:"text-green-400",iconColor:"text-green-400",confirmBg:"bg-green-600 hover:bg-green-700"};default:return{borderColor:"border-sky-500/50",headerBg:"bg-sky-900/20",titleColor:"text-sky-400",iconColor:"text-sky-400",confirmBg:"bg-sky-600 hover:bg-sky-700"}}})(),m=()=>{switch(u){case"error":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"warning":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})});case"success":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});default:return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},v=()=>{i==null||i()},x=()=>{o==null||o()};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center animate-fade-in",onClick:x,children:e.jsxs("div",{className:`bg-gray-800 rounded-lg shadow-xl w-full max-w-md border ${h.borderColor}`,onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:`p-4 border-b border-gray-700 ${h.headerBg} flex items-center space-x-3`,children:[e.jsx("span",{className:h.iconColor,children:m()}),e.jsx("h2",{className:`text-xl font-bold ${h.titleColor}`,children:t})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:s})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end space-x-3",children:[n==="confirm"&&e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:d}),e.jsx("button",{onClick:v,className:`px-4 py-2 text-white rounded-md transition-colors text-sm font-semibold ${h.confirmBg}`,children:l})]})]})})};let Gu=null;const Xx=()=>(Gu||(Gu=document.createElement("div"),Gu.id="dark-modal-root",document.body.appendChild(Gu)),Gu),nf=(n,t="Confirm Action",s="info")=>new Promise(i=>{const o=()=>{const[d,u]=C.useState(!0),f=()=>{u(!1),setTimeout(()=>i(!0),300)},h=()=>{u(!1),setTimeout(()=>i(!1),300)};return d?wv.createPortal(e.jsx(Av,{type:"confirm",title:t,message:n,onConfirm:f,onCancel:h,variant:s}),Xx()):null},l=Ua.createElement(o);oh(async()=>{const{createRoot:d}=await Promise.resolve().then(()=>N5);return{createRoot:d}},void 0,import.meta.url).then(({createRoot:d})=>{d(Xx()).render(l)})}),z5=["bg-sky-400/50","bg-purple-400/50","bg-yellow-400/50","bg-pink-400/50","bg-teal-400/50","bg-indigo-400/50","bg-cyan-400/50","bg-fuchsia-400/50","bg-blue-400/50"],V5=["ADF","FIC","WSO","IFIC","OFI","Pilot Conversion"],W5=["","GS"],Hd=({label:n,value:t,onChange:s,children:i,id:o})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("select",{id:o,value:t,onChange:s,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",children:i})]}),kv=({onClose:n,onSave:t,existingCourses:s})=>{const[i,o]=C.useState("ADF"),[l,d]=C.useState(""),[u,f]=C.useState(""),[h,m]=C.useState(""),[v,x]=C.useState(""),[y,T]=C.useState(""),[E,A]=C.useState(0),[_,R]=C.useState(0),[H,O]=C.useState(0),W=C.useMemo(()=>{const $=new Set(Object.values(s));return z5.find(M=>!$.has(M))||"bg-gray-400/50"},[s]),ne=C.useMemo(()=>E+_+H,[E,_,H]),V=C.useMemo(()=>{const $=[],M=Object.keys(s).filter(P=>P.startsWith("CSE ")||P.startsWith("ADF")).map(P=>P.replace(/^(CSE|ADF)\s*/i,""));for(let P=290;P<=500;P++)M.includes(String(P))||$.push(P);return $},[s]),U=C.useMemo(()=>Array.from({length:41},($,M)=>M),[]);C.useEffect(()=>{i==="ADF"&&V.length>0?d(String(V[0])):d("")},[i,V]);const D=()=>{let $;if(i==="ADF"){if(!l){alert("Please select an ADF course number.");return}$=`ADF${l}${h}`}else{const M=u.trim();if(!M){alert("Please enter a course number.");return}$=`${i} ${M}${h}`}if(Object.keys(s).includes($)){alert(`Course "${$}" already exists.`);return}if(!v||!y){alert("Please fill in all required date fields.");return}if(new Date(y)<=new Date(v)){alert("Graduation date must be after the start date.");return}t({number:$,color:W,startDate:v,gradDate:y,raafStart:E,navyStart:_,armyStart:H})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:$=>$.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"text-xl font-bold text-sky-400",children:"Add New Course"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(Hd,{label:"Course Type",id:"course-type",value:i,onChange:$=>o($.target.value),children:V5.map($=>e.jsx("option",{value:$,children:$},$))}),i==="ADF"?e.jsx(Hd,{label:"Course Number",id:"course-number",value:l,onChange:$=>d($.target.value),children:V.length>0?V.map($=>e.jsx("option",{value:$,children:$},$)):e.jsx("option",{disabled:!0,children:"No courses available"})}):e.jsxs("div",{children:[e.jsx("label",{htmlFor:"manual-course-number",className:"block text-sm font-medium text-gray-400",children:"Course Number"}),e.jsx("input",{type:"text",id:"manual-course-number",value:u,onChange:$=>f($.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",placeholder:"e.g., 210"})]}),e.jsx(Hd,{label:"Suffix",id:"suffix",value:h,onChange:$=>m($.target.value),children:W5.map($=>e.jsx("option",{value:$,children:$||"None"},$))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Allocated Colour"}),e.jsxs("div",{className:"mt-1 flex items-center space-x-2 p-2 bg-gray-700/50 rounded-md h-[38px]",children:[e.jsx("div",{className:`w-5 h-5 rounded-full ${W}`}),e.jsx("span",{className:"text-white font-mono text-sm",children:W})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start-date",className:"block text-sm font-medium text-gray-400",children:"Start Date"}),e.jsx("input",{type:"date",id:"start-date",value:v,onChange:$=>x($.target.value),style:{colorScheme:"dark"},className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"grad-date",className:"block text-sm font-medium text-gray-400",children:"Graduation Date"}),e.jsx("input",{type:"date",id:"grad-date",value:y,onChange:$=>T($.target.value),style:{colorScheme:"dark"},className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Initial Student Numbers"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:[e.jsx(Hd,{label:"RAAF",id:"raaf-start",value:E,onChange:$=>A(parseInt($.target.value)),children:U.map($=>e.jsx("option",{value:$,children:$},$))}),e.jsx(Hd,{label:"Navy",id:"navy-start",value:_,onChange:$=>R(parseInt($.target.value)),children:U.map($=>e.jsx("option",{value:$,children:$},$))}),e.jsx(Hd,{label:"Army",id:"army-start",value:H,onChange:$=>O(parseInt($.target.value)),children:U.map($=>e.jsx("option",{value:$,children:$},$))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Total"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700/50 rounded-md text-white h-[38px] flex items-center justify-center font-semibold",children:ne})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Total Remaining on Course"}),e.jsx("p",{className:"mt-1 p-2 bg-gray-700/50 rounded-md text-white h-[38px] flex items-center font-semibold",children:ne}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This will be updated from Trainee profiles once they are assigned to this course."})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Save Course"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Cancel"})]})]})})},Y5=({onClose:n,onArchive:t,activeCourses:s})=>{const i=C.useMemo(()=>Object.keys(s),[s]),[o,l]=C.useState(i[0]||""),d=()=>{o&&t(o)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-400",children:"Archive a Course"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"Which course would you like to move to the archive?"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"course-to-archive",className:"block text-sm font-medium text-gray-400",children:"Active Courses"}),e.jsx("select",{id:"course-to-archive",value:o,onChange:u=>l(u.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",children:i.length>0?i.map(u=>e.jsx("option",{value:u,children:u},u)):e.jsx("option",{disabled:!0,children:"No active courses"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Archived courses are removed from the main list but are not deleted from the system."})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:d,disabled:!o,className:"px-4 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-700 transition-colors text-sm font-semibold disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Archive Course"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Cancel"})]})]})})},Kx=n=>n.startsWith("Course ")?n.replace("Course ","ADF"):n.replace(/^CSE\s*/i,"ADF").replace(" ",""),J5=({activeView:n,onNavigate:t,courseColors:s,onAddCourse:i,onArchiveCourse:o,onNextDayBuildClick:l,onBuildDfpClick:d,isSupervisor:u,onPublish:f,currentUserName:h,currentUserRank:m,instructorsList:v,onUserChange:x})=>{const[y,T]=C.useState(!1),[E,A]=C.useState(!1),[_,R]=C.useState(!1),[H,O]=C.useState(""),[W,ne]=C.useState(null),[V,U]=C.useState(!1),[D,$]=C.useState(""),[M,P]=C.useState(""),[ae,Q]=C.useState(!1),[Te,Y]=C.useState(!1),fe=C.useRef(null),[ge,Ne]=C.useState(!1),[Oe,se]=C.useState(!1),F=C.useRef(null),X=["NextDayBuild","Priorities","ProgramData","BuildAnalysis","NextDayInstructorSchedule","NextDayTraineeSchedule"].includes(n),[ee,K]=C.useState(X);C.useEffect(()=>{const Re=be=>{fe.current&&!fe.current.contains(be.target)&&(Y(!1),Q(!1)),F.current&&!F.current.contains(be.target)&&(se(!1),Ne(!1))};return document.addEventListener("mousedown",Re),()=>{document.removeEventListener("mousedown",Re)}},[]),C.useEffect(()=>{X&&K(!0)},[X]);const ue=()=>{K(Re=>!Re)},ye=[{id:"Syllabus",label:"Syllabus"},{id:"CourseProgress",label:"Course Progress"},{id:"TrainingRecords",label:"Training Records"}],Le=Re=>{i(Re),T(!1)},xe=Re=>{o(Re),A(!1)},pe=Re=>{if(Re.name===h){R(!1);return}ne(Re),U(!0),$(""),P("")},ce=()=>{W&&D===W.pin?(x(W.name),U(!1),R(!1),ne(null),$(""),P("")):P("Invalid PIN")},_e=v.filter(Re=>Re.name.toLowerCase().includes(H.toLowerCase())||Re.rank.toLowerCase().includes(H.toLowerCase())||Re.unit&&Re.unit.toLowerCase().includes(H.toLowerCase())).reduce((Re,be)=>{const Ze=be.unit||"Unassigned";return Re[Ze]||(Re[Ze]=[]),Re[Ze].push(be),Re},{}),Z=["1FTS","CFS","2FTS"],Fe=Object.keys(_e).sort((Re,be)=>{const Ze=Z.indexOf(Re),ot=Z.indexOf(be);return Ze!==-1&&ot!==-1?Ze-ot:Ze!==-1?-1:ot!==-1?1:Re.localeCompare(be)}),Xe=Object.entries(s),ft=5,tt=Xe.slice(0,ft),Ve=Xe.slice(ft,ft*2),nt=["MyDashboard","SupervisorDashboard"].includes(n),Ct=["Instructors","InstructorSchedule"].includes(n),xt=()=>Q(!0),dn=()=>{Te||Q(!1)},on=()=>{const Re=!Te;Y(Re),Re&&Q(!0)},st=Re=>{t(Re),Y(!1),Q(!1)},kt=ae||Te,Ge=["CourseRoster","TraineeSchedule"].includes(n),ht=()=>Ne(!0),vt=()=>{Oe||Ne(!1)},Ht=()=>{const Re=!Oe;se(Re),Re&&Ne(!0)},We=Re=>{t(Re),se(!1),Ne(!1)},we=ge||Oe;return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"w-[12.71rem] bg-gray-900 flex-shrink-0 flex flex-col border-r border-gray-700",children:[e.jsx("div",{className:"h-16 flex items-center justify-center flex-shrink-0 px-4 border-b border-gray-800",children:e.jsxs("div",{className:"flex w-full space-x-2 mt-2",children:[e.jsx("button",{onClick:()=>t("MyDashboard"),className:`w-1/2 flex items-center justify-center text-center px-1 py-1 text-sm font-semibold rounded-md btn-aluminium-brushed ${n==="MyDashboard"?"active":""}`,children:e.jsx("span",{className:"leading-tight",children:"My Dashboard"})}),e.jsx("button",{onClick:()=>u&&t("SupervisorDashboard"),disabled:!u,title:u?"View Supervisor Dashboard":"Access denied: Requires Flying Supervisor role.",className:`w-1/2 flex items-center justify-center text-center px-1 py-1 text-sm font-semibold rounded-md btn-aluminium-brushed ${n==="SupervisorDashboard"?"active":""} ${u?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx("span",{className:"leading-tight",children:"Supervisor Dashboard"})})]})}),e.jsxs("nav",{className:"flex-1 overflow-y-auto py-4 px-2 space-y-1",children:[e.jsx("button",{onClick:()=>t("Program Schedule"),className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center space-x-3 btn-green-brushed rounded-md ${n==="Program Schedule"&&!nt?"active":""}`,children:e.jsx("span",{children:"DFP"})}),e.jsxs("div",{ref:fe,onMouseLeave:dn,children:[e.jsxs("button",{onClick:on,onMouseEnter:xt,className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center justify-between btn-aluminium-brushed rounded-md ${(Ct||kt)&&!nt?"active":""}`,children:[e.jsx("span",{children:"Staff"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transform transition-transform duration-200 ${kt?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),e.jsx("div",{className:`overflow-hidden transition-[max-height] duration-300 ease-in-out ${kt?"max-h-40":"max-h-0"}`,children:e.jsxs("div",{className:"pl-4 pr-2 pt-1 space-y-1 bg-black/10",children:[e.jsx("button",{onClick:()=>st("Instructors"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="Instructors"?"active":""}`,children:"Staff Profile"}),e.jsx("button",{onClick:()=>st("InstructorSchedule"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="InstructorSchedule"?"active":""}`,children:"Staff Schedule"})]})})]}),e.jsxs("div",{ref:F,onMouseLeave:vt,children:[e.jsxs("button",{onClick:Ht,onMouseEnter:ht,className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center justify-between btn-aluminium-brushed rounded-md ${(Ge||we)&&!nt?"active":""}`,children:[e.jsx("span",{children:"Trainee"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transform transition-transform duration-200 ${we?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),e.jsx("div",{className:`overflow-hidden transition-[max-height] duration-300 ease-in-out ${we?"max-h-40":"max-h-0"}`,children:e.jsxs("div",{className:"pl-4 pr-2 pt-1 space-y-1 bg-black/10",children:[e.jsx("button",{onClick:()=>We("CourseRoster"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="CourseRoster"?"active":""}`,children:"Trainee Profile"}),e.jsx("button",{onClick:()=>We("TraineeSchedule"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="TraineeSchedule"?"active":""}`,children:"Trainee Schedule"})]})})]}),ye.map(Re=>e.jsx("button",{onClick:()=>t(Re.id),className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center space-x-3 btn-aluminium-brushed rounded-md ${n===Re.id&&!nt?"active":""}`,children:e.jsx("span",{className:Re.id==="TrainingRecords"?"text-xs":"",children:Re.label})},Re.id)),e.jsxs("div",{className:"pt-12",children:[e.jsxs("button",{onClick:ue,className:`w-full text-left px-4 py-1 text-sm font-semibold flex items-center justify-between btn-aluminium-brushed rounded-md ${X?"active":""}`,children:[e.jsx("span",{children:"Next Day Build"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transform transition-transform duration-200 ${ee?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),e.jsx("div",{className:`overflow-hidden transition-[max-height] duration-300 ease-in-out ${ee?"max-h-96":"max-h-0"}`,children:e.jsxs("div",{className:"pl-4 pr-2 pt-1 space-y-1 bg-black/10",children:[e.jsx("button",{onClick:()=>t("NextDayBuild"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="NextDayBuild"?"active":""}`,children:e.jsx("span",{children:"Program Schedule"})}),e.jsx("button",{onClick:()=>t("NextDayInstructorSchedule"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="NextDayInstructorSchedule"?"active":""}`,children:e.jsx("span",{children:"Staff Schedule"})}),e.jsx("button",{onClick:()=>t("NextDayTraineeSchedule"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="NextDayTraineeSchedule"?"active":""}`,children:e.jsx("span",{children:"Trainee Schedule"})}),e.jsx("button",{onClick:()=>t("Priorities"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="Priorities"?"active":""}`,children:e.jsx("span",{children:"Priorities"})}),e.jsx("button",{onClick:()=>t("ProgramData"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="ProgramData"?"active":""}`,children:e.jsx("span",{children:"Program Data"})}),e.jsx("button",{onClick:()=>t("BuildAnalysis"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="BuildAnalysis"?"active":""}`,children:e.jsx("span",{children:"Build Analysis"})}),e.jsx("button",{onClick:d,className:"w-full text-left px-4 py-1 text-sm font-semibold btn-orange-brushed rounded-md",children:e.jsx("span",{children:"NEO - Build"})}),e.jsx("button",{onClick:f,className:"w-full text-left px-4 py-1 text-sm font-semibold btn-green-brushed rounded-md",children:e.jsx("span",{children:"Publish"})})]})})]})]}),e.jsxs("div",{className:"flex-shrink-0 border-t border-gray-700",children:[e.jsx("div",{className:"px-2 py-2 space-y-2",children:e.jsx("div",{children:e.jsx("button",{onClick:()=>t("Settings"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="Settings"?"active":""}`,children:e.jsx("span",{children:"Settings"})},"Settings")})}),e.jsxs("div",{className:"border-t border-gray-700 flex-shrink-0",children:[e.jsxs("div",{className:"px-4 pt-4 mb-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Courses"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>T(!0),className:"p-1 rounded bg-gray-700 hover:bg-gray-600 transition-colors","aria-label":"Add course",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:()=>A(!0),className:"p-1 rounded bg-gray-700 hover:bg-gray-600 transition-colors","aria-label":"Archive course",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"px-4 pb-2 flex space-x-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:tt.map(([Re,be])=>e.jsxs("div",{className:"py-1 flex items-center",children:[e.jsx("span",{className:`h-3 w-3 rounded-full ${be} mr-3 flex-shrink-0`}),e.jsx("span",{className:"text-xs text-gray-300 truncate",children:Kx(Re)})]},Re))}),Ve.length>0&&e.jsx("div",{className:"flex-1 min-w-0",children:Ve.map(([Re,be])=>e.jsxs("div",{className:"py-1 flex items-center",children:[e.jsx("span",{className:`h-3 w-3 rounded-full ${be} mr-3 flex-shrink-0`}),e.jsx("span",{className:"text-xs text-gray-300 truncate",children:Kx(Re)})]},Re))})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 flex-shrink-0 flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>R(!_),className:"flex items-center space-x-1 text-gray-500 hover:text-gray-300 transition-colors",children:[e.jsxs("span",{className:"truncate",children:[m," ",h]}),e.jsx("svg",{className:`h-3 w-3 transform transition-transform ${_?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-80 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-50",children:[e.jsxs("div",{className:"p-3 border-b border-gray-700",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:H,onChange:Re=>O(Re.target.value),className:"w-full pl-8 pr-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm text-white focus:outline-none focus:ring-1 focus:ring-sky-500"}),e.jsx("svg",{className:"absolute left-5 top-5 h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:Fe.map(Re=>e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 bg-gray-900 border-b border-gray-700 sticky top-0",children:e.jsx("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:Re})}),_e[Re].map(be=>e.jsxs("button",{onClick:()=>pe(be),className:`w-full px-3 py-2 text-left text-sm hover:bg-gray-700 transition-colors flex items-center justify-between ${be.name===h?"bg-gray-700 text-sky-400":"text-gray-300"}`,children:[e.jsxs("span",{children:[be.rank," ",be.name]}),be.name===h&&e.jsx("svg",{className:"h-4 w-4 text-sky-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},be.name))]},Re))}),e.jsx("div",{className:"p-2 border-t border-gray-700",children:e.jsx("button",{onClick:()=>R(!1),className:"w-full px-3 py-1 text-sm text-gray-400 hover:text-gray-300",children:"Cancel"})})]})]}),e.jsx("span",{children:"v1.0.0"})]})]})]}),y&&e.jsx(kv,{onClose:()=>T(!1),onSave:Le,existingCourses:s}),E&&e.jsx(Y5,{onClose:()=>A(!1),onArchive:xe,activeCourses:s}),V&&W&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center",onClick:()=>U(!1),children:e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:Re=>Re.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Confirm User Switch"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-gray-300 mb-2",children:["Switch from ",e.jsxs("span",{className:"font-semibold text-sky-400",children:[m," ",h]})," to:"]}),e.jsxs("p",{className:"font-semibold text-white text-lg",children:[W.rank," ",W.name]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:["Enter PIN for ",W.name,":"]}),e.jsx("input",{type:"password",value:D,onChange:Re=>$(Re.target.value),onKeyPress:Re=>Re.key==="Enter"&&ce(),placeholder:"Enter PIN",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-1 focus:ring-sky-500",autoFocus:!0}),M&&e.jsx("p",{className:"mt-2 text-sm text-red-400",children:M})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{U(!1),ne(null),$(""),P("")},className:"px-4 py-2 text-gray-400 hover:text-gray-300",children:"Cancel"}),e.jsx("button",{onClick:ce,className:"px-4 py-2 bg-sky-600 text-white rounded hover:bg-sky-700",children:"Switch User"})]})]})})})]})},X5=({onAddTile:n,onAddGroundEvent:t,showValidation:s,setShowValidation:i,locations:o,activeLocation:l,onLocationChange:d,isMagnifierEnabled:u,setIsMagnifierEnabled:f,isMultiSelectMode:h,setIsMultiSelectMode:m,isOracleMode:v,onToggleOracleMode:x,showAircraftAvailability:y,onToggleAircraftAvailability:T,showDepartureDensityOverlay:E,onToggleDepartureDensityOverlay:A})=>e.jsx(e.Fragment,{children:e.jsxs("header",{className:"bg-gray-800 h-16 flex-shrink-0 flex items-center justify-between px-4 z-20",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-32",children:e.jsx("select",{value:l,onChange:_=>d(_.target.value),className:"bg-gray-700 border-gray-600 rounded-md text-white py-1 px-2 text-sm focus:ring-sky-500 focus:border-sky-500 focus:outline-none w-full text-center",children:o.map(_=>e.jsx("option",{value:_,children:_},_))})}),e.jsx("div",{className:"flex items-center",children:e.jsx(Qa,{pageName:"Program Schedule",className:""})}),e.jsx("button",{onClick:()=>m(!h),className:`p-1.5 rounded-md transition-colors text-xs font-semibold shadow-sm ${h?"bg-sky-600 text-white":"bg-gray-600 text-white hover:bg-gray-500"}`,title:"Toggle multi-select mode",children:e.jsx("img",{src:"./multi-select-icon.png",alt:"Multi-select mode",style:{height:"20px",width:"20px",display:"block"}})}),e.jsx("button",{onClick:()=>f(!u),className:`p-1.5 rounded-md transition-colors text-xs font-semibold shadow-sm ${u?"bg-sky-600 text-white":"bg-gray-600 text-white hover:bg-gray-500"}`,"aria-label":"Toggle Magnifier",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8zm6-3a1 1 0 011 1v2h2a1 1 0 110 2H9v2a1 1 0 11-2 0V9H5a1 1 0 110-2h2V6a1 1 0 011-1z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:()=>i(!s),className:`p-1.5 rounded-md transition-colors text-xs font-semibold shadow-sm ${s?"bg-orange-600 text-white":"bg-gray-600 text-white hover:bg-gray-500"}`,title:"Toggle validation",children:e.jsx("img",{src:"./warning-icon.png",alt:"Validation mode",style:{height:"20px",width:"20px",display:"block"}})}),e.jsx("button",{onClick:A,className:`p-1.5 rounded-md transition-colors text-xs font-semibold shadow-sm ${E?"bg-purple-600 text-white":"bg-gray-600 text-white hover:bg-gray-500"}`,title:"When enabled, shows a translucent overlay in Validate mode that counts flight start times within a 1-hour window (30 minutes before/after mouse position).",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12,6 12,12 16,14"})]})}),T&&e.jsx("button",{onClick:T,className:`p-1.5 rounded-md transition-colors text-xs font-semibold shadow-sm ${y?"bg-pink-600":"bg-gray-600 hover:bg-gray-500"}`,title:"Toggle aircraft availability",children:e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2 L12 8 M12 8 L4 10 L4 12 L12 10 M12 8 L20 10 L20 12 L12 10 M12 10 L12 18 M10 18 L10 20 L14 20 L14 18",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:x,className:`w-36 text-center py-1 rounded-md text-sm font-semibold transition-all duration-200 shadow-lg flex items-center justify-center space-x-2 ${v?"btn-gold-brushed active animate-pulse":"btn-gold-brushed"}`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V5a1 1 0 00-1.447-.894l-4 2A1 1 0 0011 7v10zM4 17a1 1 0 001.447.894l4-2A1 1 0 0010 15V5a1 1 0 00-1.447-.894l-4 2A1 1 0 004 7v10z"})}),e.jsx("span",{children:"Oracle"})]}),e.jsx("button",{onClick:t,className:"w-36 text-center py-1 rounded-md text-sm font-semibold btn-aluminium-brushed",children:"Add Ground Event"}),e.jsx("button",{onClick:n,className:"w-36 text-center py-1 rounded-md text-sm font-semibold btn-aluminium-brushed",children:"Add Tile"})]})})]})}),Yf=n=>{const t=Math.floor(n),s=Math.round(n%1*60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`},K5=(n,t)=>{if(n.type!=="flight")return"";const s=new Date().toISOString().split("T")[0];if(n.date!==s)return"";const i=!!(n.authoSignedBy&&n.captainSignedBy),o=!!(n.authoSignedBy||n.isVerbalAuth),l=!o&&!n.captainSignedBy;if(i)return"text-green-400";const d=t.getHours()+t.getMinutes()/60,u=n.startTime+n.duration;if(d>=u)return"";if(o&&!n.captainSignedBy)return"text-sky-400";if(l){const f=n.startTime-d;if(f<=.25)return"text-red-500";if(f<=2)return"text-amber-400"}return""},Gc=({event:n,traineesData:t,onSelectEvent:s,onMouseDown:i,onMouseEnter:o,onMouseLeave:l,pixelsPerHour:d,rowHeight:u,startHour:f,row:h,isDragging:m,isConflicting:v,conflictedPersonnelName:x,personnelData:y,seatConfigs:T,isDraggable:E=!0,currentTime:A,isUnavailabilityConflict:_,unavailablePersonnel:R,isSelected:H=!1,isChanged:O=!1,isPreview:W=!1})=>{try{const Ge=T}catch{}const ne=n,V=ne.segmentStartTime!==void 0?ne.segmentStartTime:n.startTime,U=ne.segmentDuration!==void 0?ne.segmentDuration:n.duration,D=(U||0)*d,$=n.resourceId==="Duty Sup",M=D<60,ae=ne.segmentType==="start"||V+U>22,Q={left:`${(V-f)*d}px`,top:`${h*u}px`,width:`${D}px`,height:`${u-4}px`,marginTop:"2px"},Te=()=>{if(v||_)return"ring-red-400";const Ge=new Date().toISOString().split("T")[0];if(n.date!==Ge)return"ring-transparent";if(!!(n.authoSignedBy&&n.captainSignedBy))return"ring-green-400";const vt=A.getHours()+A.getMinutes()/60,Ht=n.startTime+n.duration;if(vt>=Ht||!!(n.authoSignedBy||n.isVerbalAuth))return"ring-transparent";const we=n.startTime-vt;return we<=.25?"ring-red-500":we<=2?"ring-amber-400":"ring-transparent"},Y=7,fe=13;let Ne=11;D<120?Ne=Y:D<160?Ne=9:(D<220||D<239)&&(Ne=10),Ne=Math.max(Y,Math.min(fe,Ne));const X=n.eventCategory==="sct",ee=X||n.flightType==="Solo"?n.pilot:n.instructor,K=n.flightType==="Solo"?"":X?n.student:n.student||"";let ue="font-semibold truncate",ye="truncate";if(W)ee!=null&&ee.includes("✓")?ue="font-bold truncate text-green-400":ee!=null&&ee.includes("✕")&&(ue="font-bold truncate text-red-500"),K!=null&&K.includes("✓")?ye="font-bold truncate text-green-400":K!=null&&K.includes("✕")&&(ye="font-bold truncate text-red-500");else{const Ge=K5(n,A),ht=R&&R.includes(ee||""),vt=R&&R.includes(K||""),Ht=A.getHours()+A.getMinutes()/60,We=n.startTime+n.duration,we=Ht>=We&&n.date===new Date().toISOString().split("T")[0];x===ee||ht&&!we?ue="font-bold truncate text-red-500":Ge&&(ue+=` ${Ge}`),x===K||vt&&!we?ye="font-bold truncate text-red-500":ye+=" text-white/80"}const xe=(()=>{if(W)return K;if(n.flightType==="Solo")return e.jsx("span",{className:"bg-yellow-500/20 text-yellow-100 px-1.5 py-0.5 rounded-sm font-bold",style:{fontSize:M?"10px":`${Ne*.85}px`},children:"SOLO"});if(X&&!n.student&&n.pilot)return e.jsx("span",{className:"bg-yellow-500/20 text-yellow-100 px-1.5 py-0.5 rounded-sm font-bold",style:{fontSize:M?"10px":`${Ne*.85}px`},children:"SOLO"});if(X&&n.flightType==="Dual"&&n.student)return n.student.split(" – ")[0];if(n.pilot&&n.student&&n.pilot===n.student)return e.jsx("span",{className:"bg-yellow-500/20 text-yellow-100 px-1.5 py-0.5 rounded-sm font-bold",style:{fontSize:M?"10px":`${Ne*.85}px`},children:"SOLO"});if(n.groupTraineeIds&&n.groupTraineeIds.length>1||n.attendees&&n.attendees.length>1||n.student==="Multiple")return"Group";if(n.student&&n.student!=="Multiple")return n.student.split(" – ")[0];if(n.attendees&&n.attendees.length===1)return n.attendees[0].split(" – ")[0];if(n.groupTraineeIds&&n.groupTraineeIds.length===1){const Ge=t.find(ht=>ht.idNumber===n.groupTraineeIds[0]);return Ge?Ge.name.split(",")[0]:"Group"}return""})(),pe=Ge=>{if(!Ge)return"";const ht=T.get(Ge);if(!ht)return"";switch(ht){case"Normal":return" (N)";case"FWD/SHORT":return" (F/S)";case"FWD/LONG":return" (F/L)";case"REAR/SHORT":return" (R/S)";default:return""}},ce=pe(ee),He=pe(typeof xe=="string"?xe:""),_e=n.callsign||"",Z=ee?y.get(ee):void 0,Fe=Z&&Z.callsignNumber>0?`${Z.callsignPrefix} ${String(Z.callsignNumber).padStart(3,"0")}`:"",Xe=n.flightType==="Solo";let ft=_e||Fe;if(Xe&&n.pilot){const Ge=t.find(ht=>ht.fullName===n.pilot);Ge!=null&&Ge.traineeCallsign&&(ft=Ge.traineeCallsign)}const tt=()=>{var Re,be;if(M)return null;const Ge={fontSize:`${Ne}px`,lineHeight:"1.3"},ht=U<=1.1,vt=Ze=>{if(!Ze)return Ze;const ot=Ze.split(", ");if(ot.length!==2)return Ze;const Vt=ot[0],yn=ot[1].charAt(0);return`${Vt}, ${yn}`},Ht=ht?vt(ee||""):ee,We=ht?vt(K||""):K,we=n.flightNumber.includes("CPT")||n.flightNumber.includes("MB")||n.flightNumber.includes("TUT")||n.flightNumber.includes("QUIZ");return n.type==="deployment"?e.jsx("div",{className:"flex justify-center items-center h-full w-full px-2",style:Ge,children:e.jsxs("div",{className:"overflow-hidden text-center",children:[e.jsx("div",{className:"text-white/80 font-medium text-sm",children:"DEPLOYMENT"}),e.jsx("div",{className:"font-mono text-white/60 truncate",children:"deployed"}),e.jsxs("div",{className:"text-xs text-white/50 mt-1",children:[(Re=n.deploymentStartTime)==null?void 0:Re.replace(/:/g,"")," - ",(be=n.deploymentEndTime)==null?void 0:be.replace(/:/g,"")]})]})}):n.type==="unavailability"?e.jsx("div",{className:"flex justify-center items-center h-full w-full px-2",style:Ge,children:e.jsxs("div",{className:"overflow-hidden text-center",children:[e.jsx("div",{className:"text-red-300 font-medium text-sm",children:"UNAVAILABLE"}),e.jsx("div",{className:"font-mono text-red-400 truncate",children:(n.reason||"Other").toUpperCase()}),n.notes&&e.jsx("div",{className:"text-xs text-red-500 mt-1 truncate",children:n.notes})]})}):n.type==="ftd"||n.type==="ground"||we?$?e.jsx("div",{className:"flex justify-center items-center h-full w-full px-2",style:Ge,children:e.jsxs("div",{className:"overflow-hidden text-center",children:[e.jsxs("div",{className:ue,children:[ee==null?void 0:ee.split(" – ")[0],ce&&e.jsx("span",{style:{fontWeight:"normal",color:"rgba(255, 255, 255, 0.8)"},children:ce})]}),e.jsxs("div",{className:"font-mono text-white/80 truncate",children:[e.jsxs("span",{style:{fontSize:`${Ne-2}px`},children:["[",(n.duration||0).toFixed(1),"]"]})," ",n.flightNumber]})]})}):e.jsxs("div",{className:"flex justify-between items-center h-full w-full px-2",style:Ge,children:[e.jsxs("div",{className:"flex-1 overflow-hidden pr-1",style:{paddingLeft:"10%",minWidth:0},children:[e.jsxs("div",{className:ue.replace("truncate","overflow-hidden text-ellipsis whitespace-nowrap"),children:[Ht==null?void 0:Ht.split(" – ")[0],ce&&e.jsx("span",{style:{fontWeight:"normal",color:"rgba(255, 255, 255, 0.8)"},children:ce})]}),e.jsx("div",{className:ye.replace("truncate","overflow-hidden text-ellipsis whitespace-nowrap"),children:typeof xe=="string"?e.jsxs(e.Fragment,{children:[We==null?void 0:We.split(" – ")[0],He&&e.jsx("span",{style:{fontWeight:"normal",color:"rgba(255, 255, 255, 0.8)"},children:He})]}):xe})]}),e.jsxs("div",{className:"flex flex-col items-end justify-between h-full pl-1 flex-shrink-0",style:{minWidth:"fit-content"},children:[e.jsx("div",{children:e.jsxs("div",{className:"font-mono text-white/80 text-right whitespace-nowrap",children:[e.jsxs("span",{style:{fontSize:`${Ne-2}px`},children:["[",(n.duration||0).toFixed(1),"]"]})," ",n.flightNumber]})}),e.jsx("div",{})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between h-full w-full px-2",style:Ge,children:[e.jsxs("div",{className:"flex-1 overflow-hidden pr-1",style:{paddingLeft:"10%",minWidth:0},children:[e.jsxs("div",{className:ue.replace("truncate","overflow-hidden text-ellipsis whitespace-nowrap"),children:[Ht==null?void 0:Ht.split(" – ")[0],ce&&e.jsx("span",{style:{fontWeight:"normal",color:"rgba(255, 255, 255, 0.8)"},children:ce})]}),e.jsx("div",{className:ye.replace("truncate","overflow-hidden text-ellipsis whitespace-nowrap"),children:typeof xe=="string"?e.jsxs(e.Fragment,{children:[We==null?void 0:We.split(" – ")[0],He&&e.jsx("span",{style:{fontWeight:"normal",color:"rgba(255, 255, 255, 0.8)"},children:He})]}):xe})]}),e.jsx("div",{className:"flex flex-col items-end justify-between h-full pl-1 flex-shrink-0",style:{minWidth:"fit-content"},children:e.jsx("div",{children:e.jsxs("div",{className:"font-mono text-white/80 text-right whitespace-nowrap",children:[e.jsxs("span",{style:{fontSize:`${Ne-2}px`},children:["[",(n.duration||0).toFixed(1),"]"]})," ",n.flightNumber]})})})]}),n.aircraftNumber&&e.jsxs("div",{className:"absolute bottom-0.5 left-1 font-mono text-white/80",style:{fontSize:`${Ne-2}px`,lineHeight:"1",opacity:.8},children:["#",n.aircraftNumber]}),e.jsxs("div",{className:"absolute bottom-0.5 right-3 flex items-center gap-1",children:[n.area&&e.jsx("div",{className:`font-sans font-light ${["A","B","C","D","E","F","G","H"].includes(n.area)?"text-white":"text-yellow-300"}`,style:{fontSize:`${Ne}px`,lineHeight:"1",opacity:.7},children:n.area}),ft&&e.jsx("div",{className:"font-mono text-white/80",style:{fontSize:`${Ne-2}px`,lineHeight:"1",opacity:.8},children:ft})]})]})},Ke=`absolute rounded-sm ${E?"cursor-grab":"cursor-pointer"} transition-all duration-200 ${m?"opacity-80 z-50":"z-10"} ${m?"shadow-xl":"shadow-md"}`,nt=n.resourceId&&(n.resourceId.startsWith("STBY")||n.resourceId.startsWith("BNF-STBY")),Ct=n.type==="deployment"?"bg-gray-600/30 border border-white/60":n.type==="unavailability"?"bg-red-900/80 border border-red-600/60":_?"bg-red-800/90":v?"bg-red-600/70":n.color,xt=Te(),dn=$?"border border-black":"",on=H?"ring-2 ring-cyan-400 ring-offset-2 ring-offset-gray-900":"",st=[Ke];W?(st.push(n.color),st.push("border-2 border-dashed border-sky-300")):(st.push(Ct),st.push(`ring-[0.92px] ${xt}`),st.push(dn),st.push(on)),M||st.push("overflow-hidden");const kt=()=>{if(!M)return null;const Ge={position:"absolute",top:0,[ae?"right":"left"]:"100%",marginLeft:ae?0:"4px",marginRight:ae?"4px":0,whiteSpace:"nowrap",zIndex:60};return e.jsx("div",{style:Ge,className:"flex items-center",children:e.jsxs("div",{className:"bg-gray-800 border border-gray-600 rounded px-2 py-1 shadow-lg flex items-center space-x-3 text-xs",children:[e.jsxs("div",{children:[e.jsxs("div",{className:`font-bold ${ue.replace("truncate","")}`,children:[ee==null?void 0:ee.split(" – ")[0],ce&&e.jsx("span",{style:{fontWeight:"normal",color:"rgba(255, 255, 255, 0.8)"},children:ce})]}),e.jsx("div",{className:ye.replace("truncate",""),children:typeof xe=="string"?e.jsxs(e.Fragment,{children:[xe,He&&e.jsx("span",{style:{fontWeight:"normal",color:"rgba(255, 255, 255, 0.8)"},children:He})]}):xe})]}),e.jsx("div",{className:"h-6 w-px bg-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-mono font-semibold text-sky-400",children:n.flightNumber}),e.jsx("div",{className:"font-mono text-gray-400",children:Yf(V)})]}),ft&&e.jsx("div",{className:"font-mono text-gray-500 text-[10px]",children:ft})]})})};return e.jsxs("div",{"data-is-flight-tile":"true",style:Q,className:st.join(" "),onClick:s,onMouseDown:Ge=>{Ge.stopPropagation(),i(Ge)},onMouseEnter:o,onMouseLeave:l,children:[O&&!W&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-1.5 changed-bar-stripes z-20 pointer-events-none"}),nt&&!W&&e.jsx("div",{className:"absolute inset-0 pointer-events-none z-10",style:{backgroundImage:"repeating-linear-gradient(45deg, rgba(209, 213, 219, 0.4) 0px, rgba(209, 213, 219, 0.4) 3px, transparent 3px, transparent 8px)"}}),n.isCancelled&&!W&&e.jsxs("svg",{className:"absolute inset-0 pointer-events-none z-20",style:{width:"100%",height:"100%"},children:[e.jsx("line",{x1:"0",y1:"0",x2:"100%",y2:"100%",stroke:"rgb(239, 68, 68)",strokeWidth:"2"}),e.jsx("line",{x1:"100%",y1:"0",x2:"0",y2:"100%",stroke:"rgb(239, 68, 68)",strokeWidth:"2"})]}),e.jsxs("div",{className:"relative w-full h-full text-white",children:[$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-1 left-1 font-mono text-white/60 pointer-events-none",style:{fontSize:`${Ne*.825}px`},children:Yf(V)}),e.jsx("div",{className:"absolute top-1 right-1 font-mono text-white/60 pointer-events-none",style:{fontSize:`${Ne*.825}px`},children:Yf(V+U)})]}):!M&&e.jsx("div",{className:"absolute -top-px left-1 font-mono text-white/60 pointer-events-none",style:{fontSize:`${Ne*.75}px`},children:Yf(V)}),tt(),kt()]})]})},Zx=n=>!n||typeof n!="string"?"Other":n.startsWith("PC-21")||n.startsWith("Deployed")?"PC-21":n.startsWith("STBY")?"STBY":n==="Duty Sup"?"Duty Sup":n==="TWR DI"?"TWR DI":n.startsWith("FTD")?"FTD":n.startsWith("CPT")?"CPT":n.startsWith("Ground")?"Ground":"Other",Dv=({resources:n,onReorder:t,rowHeight:s,airframeCount:i,standbyCount:o,ftdCount:l,cptCount:d,events:u=[]})=>{const[f,h]=C.useState(null),m=E=>{h(E)},v=E=>{E.preventDefault()},x=E=>{if(f===null||f===E){h(null);return}const A=[...n],_=A.splice(f,1)[0];A.splice(E,0,_),t(A),h(null)},y=[];for(let E=1;E<=24;E++)y.push(`PC-21 ${E}`);y.push("Duty Sup"),y.push("TWR DI");let T=4;if(u.length>0){const E=u.filter(_=>(_==null?void 0:_.resourceId)&&(_.resourceId.startsWith("STBY")||_.resourceId.startsWith("BNF-STBY"))),A=new Set(E.map(_=>_.resourceId));T=Math.max(A.size,4)}for(let E=0;E<T;E++)y.push("STBY");for(let E=0;E<5;E++)y.push("FTD");for(let E=0;E<4;E++)y.push("CPT");if(u.length>0){const E=u.filter(_=>(_==null?void 0:_.resourceId)&&_.resourceId.startsWith("Ground"));new Set(E.map(_=>_.resourceId)).forEach(()=>y.push("Ground"))}return e.jsx("div",{className:"w-36 bg-gray-800 flex-shrink-0 h-full",children:e.jsx("ul",{children:y.map((E,A)=>{var P;let _=E,R="text-gray-400",H=!0;E==="Duty Sup"?(R="text-amber-300 font-semibold",H=!1):E==="TWR DI"?(R="text-green-300 font-semibold",H=!1):E.startsWith("Deployed")?(R="text-purple
bg-purple-500/20 pointer-events-none",style:{left:`${O}px`,width:`${W-O}px`}})]})},sr=200,zi=32,ur=0,El=24,tw=El-ur,ey=144,ty=40,nw=(n,t)=>{if(!n||!t||n.duration<=0||t.duration<=0)return!1;const s=n.startTime+n.duration,i=t.startTime+t.duration;return n.startTime<i&&s>t.startTime},Y0=n=>{const t=[];return n.flightType==="Solo"?n.pilot&&t.push(n.pilot):(n.instructor&&t.push(n.instructor),n.student&&t.push(n.student)),n.attendees&&t.push(...n.attendees),t},sw=(n,t)=>{if(!t)return!1;const s=t.find(o=>o.id===n.id);if(!s)return!0;const i=.001;return Math.abs(n.startTime-s.startTime)>i||Math.abs(n.duration-s.duration)>i?!0:n.resourceId!==s.resourceId||n.instructor!==s.instructor||n.student!==s.student||n.pilot!==s.pilot||(n.area||"")!==(s.area||"")},ny=n=>n.startsWith("PC-21")||n.startsWith("Deployed")?"PC-21":n.startsWith("STBY")?"STBY":n==="Duty Sup"?"Duty Sup":n==="TWR DI"?"TWR DI":n.startsWith("FTD")?"FTD":n.startsWith("CPT")?"CPT":n.startsWith("Ground")?"Ground":"Other",rw=({date:n,onDateChange:t,events:s,resources:i,instructors:o,traineesData:l,airframeCount:d,standbyCount:u,ftdCount:f,cptCount:h,onUpdateEvent:m,onSelectEvent:v,onReorderResources:x,zoomLevel:y,showValidation:T,showPrePost:E,syllabusDetails:A,personnelData:_,seatConfigs:R,daylightTimes:H,personnelConflicts:O,personnelConflictIds:W,unavailabilityConflicts:ne,onCptConflict:V,isMultiSelectMode:U,selectedEventIds:D,setSelectedEventIds:$,baselineEvents:M,isVisualAdjustMode:P=!1,visualAdjustEvent:ae=null,onVisualAdjustTimeChange:Q,isOracleMode:Te,oraclePreviewEvent:Y,onOracleMouseDown:fe,onOracleMouseMove:ge,onOracleMouseUp:Ne,detectConflictsForEvent:Oe,showDepartureDensityOverlay:se,showAircraftAvailability:F,plannedAvailability:J,dayFlyingStart:X,dayFlyingEnd:ee,onAvailabilityChange:K,timezoneOffset:ue=11})=>{const ye=C.useRef(null),Le=C.useRef(null),[xe,pe]=C.useState(()=>{const Tt=new Date,lt=ue*60*60*1e3;return new Date(Tt.getTime()+lt)}),ce=C.useRef(!0),He=C.useRef(y);C.useEffect(()=>{const Tt=()=>{const Et=new Date,Bt=ue*60*60*1e3,Kt=new Date(Et.getTime()+Bt);pe(Kt)};Tt();const lt=setInterval(Tt,1e3);return()=>clearInterval(lt)},[ue]);const[_e,Z]=C.useState(null),[Fe,Xe]=C.useState(null),[ft,tt]=C.useState(null),[Ve,Ke]=C.useState(null),nt=C.useRef(!1),Ct=C.useRef(null),[xt,dn]=C.useState(null),[on,st]=C.useState(null);C.useEffect(()=>{const Tt=setInterval(()=>{const Bt=new Date,Kt=ue*60*60*1e3,Mt=new Date(Bt.getTime()+Kt);pe(Mt)},1e3),lt=Bt=>{_e&&(console.log("Global mouse move - drag state active"),vt(Bt))},Et=Bt=>{console.log("Global mouse up called, draggingState exists:",!!_e),_e&&(console.log("Global mouse up - ending drag"),document.body.classList.remove("no-select"),Z(null),Xe(null),tt(null),Ke(null))};return document.addEventListener("mousemove",lt),document.addEventListener("mouseup",Et),()=>{clearInterval(Tt),document.removeEventListener("mousemove",lt),document.removeEventListener("mouseup",Et)}},[_e]);const kt=C.useMemo(()=>{const[Tt,lt,Et]=n.split("-").map(Number);return new Date(Date.UTC(Tt,lt-1,Et)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[n]);C.useEffect(()=>{const Tt=ye.current;if(Tt){if(ce.current){const Et=(8-ur)*sr*y;Tt.scrollLeft=Et,ce.current=!1}else{const lt=He.current;if(lt===y)return;const{scrollLeft:Et,clientWidth:Bt}=Tt,Mt=(Et+Bt/2)/(sr*lt)*sr*y-Bt/2;Tt.scrollLeft=Mt}He.current=y}},[y]);const Ge=C.useCallback((Tt,lt)=>{for(const Et of Tt){const Bt=A.find(ze=>ze.id===Et.flightNumber);if(!Bt)continue;const Kt=Et.startTime-(Bt.preFlightTime||0),Mt=Et.startTime+Et.duration+(Bt.postFlightTime||0);for(const ze of lt){const qt=A.find(je=>je.id===ze.flightNumber);if(!qt)continue;const Mn=ze.startTime-(qt.preFlightTime||0),jn=ze.startTime+ze.duration+(qt.postFlightTime||0);if(Kt<jn&&Mt>Mn){const je=Y0(Et),$e=Y0(ze),Ye=je.find(Dt=>$e.includes(Dt));if(Ye)return{conflictingEvent:ze,personName:Ye}}}}return null},[A]),ht=(Tt,lt)=>{if(console.log("handleMouseDown called, event:",lt==null?void 0:lt.id,"isMultiSelectMode:",U),console.log("Event target:",Tt.target),console.log("Current target:",Tt.currentTarget),Tt.button===0){if(nt.current=!1,document.body.classList.add("no-select"),Te&&!lt){if(!Le.current)return;const Et=Le.current.getBoundingClientRect(),Kt=(Tt.clientX-Et.left)/(sr*y)+ur,Mt=Tt.clientY-Et.top,ze=Math.floor(Mt/zi),qt=i[ze]||i[0];fe(Kt,qt);return}if(lt){const Bt=Tt.currentTarget.getBoundingClientRect(),Kt=new Map,Mt=new Map,ze=qt=>{console.log("🐍 Processing event for drag:",qt.id,"resourceId:",qt.resourceId),console.log("🐍 Available resources:",i);const Mn=i.indexOf(qt.resourceId);console.log("🐍 Found row index:",Mn),Mn!==-1?(Kt.set(qt.id,{startTime:qt.startTime,rowIndex:Mn}),Mt.set(qt.id,qt.resourceId),console.log("🐍 Event added to initialPositions")):console.log("🐍 Event NOT added - resourceId not found in resources")};U&&D.has(lt.id)?D.forEach(qt=>{const Mn=s.find(jn=>jn.id===qt);Mn&&ze(Mn)}):ze(lt),Kt.size>0?(console.log("Setting dragging state with",Kt.size,"events for event:",lt.id),console.log("initialPositions:",Kt),Z({mainEventId:lt.id,xOffset:(Tt.clientX-Bt.left)/y,yOffset:Tt.clientY-Bt.top,initialPositions:Kt,originalResourceIds:Mt}),console.log("setDraggingState called with:",_e)):console.log("No initial positions - drag state not set")}else{if(!U||!Le.current)return;const Et=Le.current.getBoundingClientRect(),Bt=Tt.clientX-Et.left,Kt=Tt.clientY-Et.top;Ct.current={x:Bt,y:Kt},dn({x:Bt,y:Kt,width:0,height:0})}}},vt=Tt=>{if(console.log("handleMouseMove called, draggingState exists:",!!_e),!Le.current){console.log("Early return: no scheduleGridRef");return}nt.current=!0;const lt=Le.current.getBoundingClientRect(),Et=Tt.clientX-lt.left,Bt=Tt.clientY-lt.top;if(T){const Kt=Et/(sr*y)+ur;st(Kt)}if(Te&&Y){console.log("Early return: Oracle mode with preview event");const Kt=Et/(sr*y)+ur,Mt=i[Math.floor(Bt/zi)]||i[0];ge(Kt,Mt)}else{if(Ct.current){console.log("Early return: selectionStartPoint active (marquee selection)");const Ye=Tt.clientX-lt.left,Dt=Tt.clientY-lt.top,St=Math.min(Ct.current.x,Ye),hn=Math.min(Ct.current.y,Dt),Ce=Math.abs(Ye-Ct.current.x),At=Math.abs(Dt-Ct.current.y);dn({x:St,y:hn,width:Ce,height:At});const B=St,Ae=St+Ce,rt=hn,yt=hn+At,et=new Set;s.forEach($t=>{const pn=i.indexOf($t.resourceId);if(pn===-1)return;const kn=pn*zi,ts=kn+zi,un=($t.startTime-ur)*sr*y,Nn=un+$t.duration*sr*y;B<Nn&&Ae>un&&rt<ts&&yt>kn&&et.add($t.id)}),$(et);return}if(!_e){console.log("Early return: no draggingState");return}const Kt=_e.initialPositions.get(_e.mainEventId);if(!Kt)return;const Mt=(Et/y-_e.xOffset)/sr-Kt.startTime,ze=Math.floor((Bt-_e.yOffset+zi/2)/zi)-Kt.rowIndex;console.log("Drag calculation - timeShift:",Mt,"rowShift:",ze,"xInGrid:",Et,"yInGrid:",Bt);const qt=[],Mn=[...s];let jn=null,je=null;for(const[Ye,Dt]of _e.initialPositions.entries()){const St=s.find(yt=>yt.id===Ye);if(!St)continue;let hn=Dt.startTime+Mt,Ce=Dt.rowIndex+ze;Ce<0&&(Ce=0),Ce>=i.length&&(Ce=i.length-1),hn<ur&&(hn=ur),hn+St.duration>El&&(hn=El-St.duration);const At=Math.round(hn*12)/12,B=i[Ce];qt.push({eventId:Ye,newStartTime:At,newResourceId:B});const Ae=Mn.findIndex(yt=>yt.id===Ye);Ae!==-1&&(Mn[Ae]={...Mn[Ae],startTime:At,resourceId:B});const rt=s.find(yt=>yt.id!==Ye&&!_e.initialPositions.has(yt.id)&&yt.resourceId===B&&nw({...St,startTime:At},yt));rt&&(jn=rt.id)}if(qt.find(Ye=>Ye.eventId===_e.mainEventId)){const Ye=Mn.find(hn=>hn.id===_e.mainEventId),Dt=Mn.filter(hn=>!_e.initialPositions.has(hn.id));let St=null;if(Oe)if(St=Oe(Ye,Dt),console.log("🔍 Drag conflict check:",{eventId:Ye.id,hasConflict:St.hasConflict,conflictType:St.conflictType}),St.hasConflict){if(Xe({conflictingEventId:St.conflictingEventId,conflictedPersonName:St.conflictedPersonnel||""}),Ye.flightNumber.includes("CPT")&&St.conflictType==="personnel"){const hn=Dt.find(Ce=>Ce.id===St.conflictingEventId);hn&&(je={conflictingEvent:hn,newEvent:Ye,conflictedPerson:"trainee"})}}else Xe(null);else{const hn=Ge([Ye],Dt);hn?(Xe({conflictingEventId:hn.conflictingEvent.id,conflictedPersonName:hn.personName}),Ye.flightNumber.includes("CPT")&&(je={conflictingEvent:hn.conflictingEvent,newEvent:Ye,conflictedPerson:"trainee",personName:hn.personName})):Xe(null)}}tt(jn),Ke(je),console.log("🐍 DRAG COMPLETE - Calling onUpdateEvent with",qt.length,"updates:"),console.log("🐍 Updates:",qt),m(qt)}},Ht=Tt=>{if(console.log("Local handleMouseUp called - ignoring when dragState exists:",!!_e),_e){console.log("Ignoring local mouse up - global handler will manage");return}document.body.classList.remove("no-select"),Te&&Ne(),Ve&&V(Ve),console.log("Clearing drag state in local handleMouseUp"),Z(null),Xe(null),tt(null),Ke(null),st(null),Ct.current&&U&&(Ct.current=null,dn(null),!nt.current&&!Tt.shiftKey&&(Tt.target.closest('[data-is-flight-tile="true"]')||$(new Set))),setTimeout(()=>{nt.current=!1},0)},We=C.useCallback(Tt=>{if(!Tt||!/^\d{2}:\d{2}$/.test(Tt))return null;const[lt,Et]=Tt.split(":").map(Number);return lt+Et/60},[]),we=()=>{const Tt=[];for(let Bt=ur;Bt<=El;Bt++)Tt.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-gray-500 flex items-center",style:{left:(Bt-ur)*sr*y},children:e.jsx("span",{className:"-translate-x-1/2",children:`${String(Bt).padStart(2,"0")}:00`})},Bt));const lt=We(H.firstLight),Et=We(H.lastLight);if(lt!==null){const Bt=(lt-ur)*sr*y;Tt.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:Bt},children:e.jsx("span",{className:"-translate-x-1/2",children:`FL ${H.firstLight}`})},"fl-label"))}if(Et!==null){const Bt=(Et-ur)*sr*y;Tt.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:Bt},children:e.jsx("span",{className:"-translate-x-1/2",children:`LL ${H.lastLight}`})},"ll-label"))}return Tt},Re=()=>{const Tt=[];for(let lt=ur;lt<=El;lt++)Tt.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(lt-ur)*sr*y},children:e.jsx("div",{className:"w-px h-full bg-gray-700/50"})},`v-${lt}`)),lt<El&&Tt.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(lt-ur+.5)*sr*y},children:e.jsx("div",{className:"w-px h-full bg-gray-700/25"})},`v-${lt}-30`));for(let lt=1;lt<=i.length;lt++)Tt.push(e.jsx("div",{className:"absolute left-0 w-full bg-gray-700/25",style:{top:lt*zi,height:"1px"}},`h-${lt}`));return Tt},be=()=>{const Tt=[];let lt=ny(i[0]);for(let Et=1;Et<i.length;Et++){const Bt=ny(i[Et]);Bt!==lt&&(Tt.push(e.jsx("div",{className:"absolute left-0 w-full border-t-2 border-gray-500 z-10",style:{top:Et*zi}},`sep-${Et}`)),lt=Bt)}return Tt},Ze=()=>{const Tt=We(H.firstLight),lt=We(H.lastLight);return e.jsxs(e.Fragment,{children:[Tt!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(Tt-ur)*sr*y}px`}}),lt!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(lt-ur)*sr*y}px`}})]})},ot=()=>{const Tt=We(H.firstLight),lt=We(H.lastLight),Et=[];if(Tt!==null&&Tt>ur){const Bt=(Tt-ur)*sr*y;Et.push(e.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/5 pointer-events-none z-[1]",style:{width:`${Bt}px`}},"night-shade-morning"))}if(lt!==null&&lt<El){const Bt=(lt-ur)*sr*y,Kt=(El-lt)*sr*y;Et.push(e.jsx("div",{className:"absolute top-0 h-full bg-white/5 pointer-events-none z-[1]",style:{left:`${Bt}px`,width:`${Kt}px`}},"night-shade-evening"))}return e.jsx(e.Fragment,{children:Et})},Vt=()=>{const lt=(Mt=>{const ze=Mt.getUTCFullYear(),qt=String(Mt.getUTCMonth()+1).padStart(2,"0"),Mn=String(Mt.getUTCDate()).padStart(2,"0");return`${ze}-${qt}-${Mn}`})(xe);if(n!==lt)return null;const Et=xe,Bt=Et.getUTCHours()+Et.getUTCMinutes()/60+Et.getUTCSeconds()/3600;if(Bt<ur||Bt>El)return null;const Kt=(Bt-ur)*sr*y;return e.jsxs("div",{className:"absolute top-0 h-full z-[30] pointer-events-none",style:{left:`${Kt}px`},children:[e.jsx("div",{className:"w-0.5 h-full bg-white animate-pulse"}),e.jsx("div",{className:"absolute -top-2.5 -translate-x-1/2 w-0 h-0",style:{borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"7px solid white"}})]})},Pt=()=>{if(!T||on===null||!se)return null;const Tt=on-.5,lt=on+.5,Et=s.filter(ze=>ze.type!=="flight"?!1:ze.startTime>=Tt&&ze.startTime<lt).length,Bt=(Tt-ur)*sr*y,Kt=(lt-ur)*sr*y,Mt=Kt-Bt;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 h-full bg-white/10 pointer-events-none z-[25]",style:{left:`${Bt}px`,width:`${Mt}px`}}),e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-white/40 pointer-events-none z-[26]",style:{left:`${Bt}px`}}),e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-white/40 pointer-events-none z-[26]",style:{left:`${Kt}px`}}),e.jsx("div",{className:"absolute top-2 bg-gray-800/95 border border-white/30 rounded px-3 py-1.5 shadow-lg pointer-events-none z-[27]",style:{left:`${Bt+Mt/2}px`,transform:"translateX(-50%)"},children:e.jsxs("div",{className:"text-white text-xs font-semibold whitespace-nowrap",children:["Flights starting in this hour: ",e.jsx("span",{className:"text-sky-400",children:Et})]})})]})},yn=()=>i.flatMap((Tt,lt)=>s.filter(Bt=>Bt.resourceId===Tt).map(Bt=>{const Kt=!!(_e&&_e.initialPositions.has(Bt.id)),Mt=Bt.id===(Fe==null?void 0:Fe.conflictingEventId)||Bt.id===ft,ze=T&&W.has(Bt.id)||Mt||Kt&&!!(Fe||ft),qt=ne.get(Bt.id),Mn=!!qt,jn=qt||[];let je=null;if(Fe){const Dt=Y0(Bt);(Kt||Mt)&&Dt.includes(Fe.conflictedPersonName)&&(je=Fe.conflictedPersonName)}const $e=D.has(Bt.id),Ye=sw(Bt,M);return e.jsx(Gc,{event:Bt,traineesData:l,onSelectEvent:()=>{if(!nt.current)if(U){const Dt=new Set(D);Dt.has(Bt.id)?Dt.delete(Bt.id):Dt.add(Bt.id),$(Dt)}else v(Bt)},onMouseDown:Dt=>ht(Dt,Bt),onMouseEnter:()=>{},onMouseLeave:()=>{},pixelsPerHour:sr*y,rowHeight:zi,startHour:ur,row:lt,isDragging:Kt,isConflicting:ze,isUnavailabilityConflict:Mn,unavailablePersonnel:jn,conflictedPersonnelName:je,personnelData:_,seatConfigs:R,isDraggable:!0,currentTime:xe,isSelected:$e,isChanged:Ye},Bt.id)}));return e.jsx("div",{ref:ye,className:"flex-1 overflow-auto relative bg-gray-900 select-none",children:e.jsxs("div",{style:{width:`${ey+tw*sr*y}px`,height:`${ty+i.length*zi}px`,display:"grid",gridTemplateColumns:`${ey}px 1fr`,gridTemplateRows:`${ty}px 1fr`},children:[e.jsx("div",{className:"sticky top-0 left-0 z-40 bg-gray-800 border-r border-b border-gray-700 p-1",children:e.jsxs("div",{className:"bg-gray-700 rounded-md w-full h-full flex items-center justify-center px-2 space-x-2",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:"<"}),e.jsx("span",{className:"flex-grow min-w-0 text-center font-semibold text-white cursor-default truncate text-xs",children:kt}),e.jsx("button",{onClick:()=>t(1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:">"})]})}),e.jsx("div",{className:"sticky top-0 z-20 bg-gray-800 border-b border-gray-700 relative",children:we()}),e.jsx("div",{className:"sticky left-0 z-30 bg-gray-800 border-r border-gray-700",children:e.jsx(Dv,{resources:i,onReorder:x,rowHeight:zi,airframeCount:d,standbyCount:u,ftdCount:f,cptCount:h,events:s})}),e.jsxs("div",{ref:Le,className:"relative bg-gray-900",onMouseDown:Tt=>ht(Tt),onMouseMove:vt,onMouseUp:Ht,onMouseLeave:Ht,children:[Re(),ot(),Ze(),be(),Vt(),Pt(),F&&J!==void 0&&X&&ee&&K&&e.jsx(ew,{currentDate:new Date(n),totalAircraft:d,plannedAvailability:J,dayFlyingStart:X,dayFlyingEnd:ee,gridHeight:i.length*zi,rowHeight:zi,pixelsPerHour:sr*y,startHour:ur,onAvailabilityChange:K}),yn(),P&&ae&&Q&&e.jsx(_v,{event:ae,onTimeChange:Q,scheduleStartHour:ur,scheduleEndHour:El,pixelsPerHour:sr*y}),Te&&Y&&e.jsxs(e.Fragment,{children:[e.jsx(Gc,{isPreview:!0,event:Y,onSelectEvent:()=>{},onMouseDown:()=>{},onMouseEnter:()=>{},onMouseLeave:()=>{},pixelsPerHour:sr*y,rowHeight:zi,startHour:ur,row:i.indexOf(Y.resourceId),isDragging:!1,traineesData:l,personnelData:_,seatConfigs:new Map,currentTime:new Date}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1 bg-sky-300/40 pointer-events-none z-50",style:{left:`${(Y.startTime-(Y.preStart||1)-ur)*sr*y}px`,width:`${(Y.preStart||1)*sr*y}px`,top:`${i.indexOf(Y.resourceId)*zi+zi/2}px`}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1 bg-sky-300/40 pointer-events-none z-50",style:{left:`${(Y.startTime+Y.duration-ur)*sr*y}px`,width:`${(Y.postEnd||.5)*sr*y}px`,top:`${i.indexOf(Y.resourceId)*zi+zi/2}px`}})]}),xt&&e.jsx("div",{className:"absolute bg-sky-500/20 border border-sky-400 z-50 pointer-events-none",style:{left:xt.x,top:xt.y,width:xt.width,height:xt.height}})]})]})})},sy=n=>{const t={"1FTS":"text-blue-300","2FTS":"text-green-300",CFS:"text-purple-300",CFTS:"text-orange-300",RMC:"text-red-300",ARFTU:"text-yellow-300",AWMU:"text-teal-300","No. 1 Squadron":"text-indigo-300","No. 2 Squadron":"text-pink-300","No. 3 Squadron":"text-cyan-300","No. 75 Squadron":"text-amber-300","No. 76 Squadron":"text-lime-300","No. 77 Squadron":"text-emerald-300"};return console.log("🎨 UNIT COLOR DEBUG - Unit:",n,"Color:",t[n||""]||"text-gray-300"),t[n||""]||"text-gray-300"},iw=n=>({"1FTS":"bg-blue-500/20 border-blue-500/50 text-blue-300","2FTS":"bg-green-500/20 border-green-500/50 text-green-300",CFS:"bg-purple-500/20 border-purple-500/50 text-purple-300",CFTS:"bg-orange-500/20 border-orange-500/50 text-orange-300",RMC:"bg-red-500/20 border-red-500/50 text-red-300",ARFTU:"bg-yellow-500/20 border-yellow-500/50 text-yellow-300",AWMU:"bg-teal-500/20 border-teal-500/50 text-teal-300","No. 1 Squadron":"bg-indigo-500/20 border-indigo-500/50 text-indigo-300","No. 2 Squadron":"bg-pink-500/20 border-pink-500/50 text-pink-300","No. 3 Squadron":"bg-cyan-500/20 border-cyan-500/50 text-cyan-300","No. 75 Squadron":"bg-amber-500/20 border-amber-500/50 text-amber-300","No. 76 Squadron":"bg-lime-500/20 border-lime-500/50 text-lime-300","No. 77 Squadron":"bg-emerald-500/20 border-emerald-500/50 text-emerald-300"})[n||""]||"bg-gray-600/20 border-gray-500/50 text-gray-300",Iv=({personnel:n,rowHeight:t,onRowEnter:s,onRowLeave:i,onPersonClick:o,onRowRef:l,showUnits:d=!1,useUnitColors:u=!1})=>{console.log("🔍 PERSONNEL COLUMN DEBUG - Props:",{personnelCount:n.length,showUnits:d,useUnitColors:u,samplePersonnel:n.slice(0,3).map(h=>({name:h.name,unit:h.unit}))});const f=Ua.useMemo(()=>{if(!d)return n;const h={};return h.Unassigned=n.filter(m=>!m.unit),n.forEach(m=>{m.unit&&(h[m.unit]||(h[m.unit]=[]),h[m.unit].push(m))}),h},[n,d]);return d?e.jsx("div",{className:"w-48 bg-gray-800 flex-shrink-0 h-full",children:e.jsx("ul",{children:Object.entries(f).map(([h,m])=>e.jsxs(Ua.Fragment,{children:[e.jsx("li",{className:"bg-gray-900/80 border-b border-gray-600 px-3 py-1",children:e.jsxs("span",{className:`text-xs font-semibold ${u&&iw(h).split(" ").find(v=>v.startsWith("text-"))||"text-gray-400"}`,children:[h," (",m.length,")"]})}),m.map(({name:v,rank:x,unit:y},T)=>e.jsxs("li",{ref:E=>l==null?void 0:l(v,E),className:`flex items-center justify-start pl-3 pr-2 py-1 text-xs transition-colors duration-150 border-b border-gray-700/50 bg-gray-800 ${o?"cursor-pointer hover:bg-gray-700":""}`,style:{height:t,minHeight:t},onMouseEnter:()=>s==null?void 0:s(T),onMouseLeave:()=>i==null?void 0:i(),onClick:()=>o==null?void 0:o(v),children:[e.jsx("span",{className:"font-mono text-gray-500 w-10 text-xs",children:x}),e.jsx("span",{className:`truncate font-medium flex-1 ${u?sy(y):"text-gray-300"}`,children:v})]},`${h}-${v}`))]},h))})}):e.jsx("div",{className:"w-40 bg-gray-800 flex-shrink-0 h-full",children:e.jsx("ul",{children:n.map(({name:h,rank:m,unit:v},x)=>e.jsxs("li",{ref:y=>l==null?void 0:l(h,y),className:`flex items-center justify-start pl-3 text-xs transition-colors duration-150 border-b border-gray-700/50 ${o?"cursor-pointer hover:bg-gray-700":""}`,style:{height:t},onMouseEnter:()=>s==null?void 0:s(x),onMouseLeave:()=>i==null?void 0:i(),onClick:()=>o==null?void 0:o(h),children:[e.jsx("span",{className:"font-mono text-gray-500 w-12 flex-shrink-0",children:m}),e.jsx("span",{className:`truncate font-medium ${u?sy(v):"text-gray-300"}`,children:h})]},h))})})},Si=200,Cl=32,fi=0,ac=24,ry=ac-fi,iy=160,J0=40,X0=n=>{const t=[];return n.flightType==="Solo"?n.pilot&&t.push(n.pilot):(n.instructor&&t.push(n.instructor),n.student&&t.push(n.student)),t},aw=(n,t,s=!0)=>{const i=[];return t.forEach(o=>{(o.unavailability||[]).forEach(d=>{const u=new Date(n+"T00:00:00Z"),f=new Date(d.startDate+"T00:00:00Z"),h=new Date(d.endDate+"T00:00:00Z"),m=new Date(h);if(d.allDay&&m.setDate(m.getDate()-1),u>=f&&u<=m){let v=d.allDay?.0167:parseFloat(d.startTime)/100,x=d.allDay?23.983:parseFloat(d.endTime)/100;d.allDay||(u.getTime()===f.getTime()&&u.getTime()===m.getTime()?(v=d.startTime?parseFloat(d.startTime)/100:.0167,x=d.endTime?parseFloat(d.endTime)/100:23.983):u.getTime()===f.getTime()&&d.startTime?(v=parseFloat(d.startTime)/100,x=23.983):u.getTime()===m.getTime()&&d.endTime?(v=.0167,x=parseFloat(d.endTime)/100):u>f&&u<m&&(v=.0167,x=23.983));const y=x-v,T={id:`unavailability-${o.name||o.fullName}-${d.id}`,date:n,startTime:v,duration:y,type:"unavailability",instructor:s?o.name:void 0,student:s?void 0:o.fullName,pilot:s?void 0:o.fullName,flightNumber:"UNAVAIL",resourceName:s?o.name:o.fullName,resourceId:s?`INST-${o.name}`:`TRAINEE-${o.fullName}`,eventType:"UNAVAILABILITY",allDay:d.allDay,reason:d.reason,notes:d.notes};i.push(T)}})}),i},ow=({date:n,onDateChange:t,events:s,instructors:i,instructorsData:o,onSelectEvent:l,onUpdateEvent:d,zoomLevel:u,daylightTimes:f,personnelData:h,seatConfigs:m,syllabusDetails:v,conflictingEventIds:x,showValidation:y,unavailabilityConflicts:T,onSelectInstructor:E,traineesData:A})=>{console.log("🔍 INSTRUCTOR SCHEDULE ERROR TRACKING - Props received:"),console.log("  - date:",n),console.log("  - events count:",s==null?void 0:s.length),console.log("  - instructors count:",i==null?void 0:i.length),console.log("  - instructorsData count:",o==null?void 0:o.length),console.log("  - traineesData count:",A==null?void 0:A.length),console.log("  - zoomLevel:",u),console.log("  - daylightTimes:",f),console.log("  - personnelData size:",h==null?void 0:h.size),console.log("  - seatConfigs type:",typeof m),console.log("  - seatConfigs value:",m),console.log("  - seatConfigs === undefined:",m===void 0),console.log("  - seatConfigs === null:",m===null),console.log("  - syllabusDetails count:",v==null?void 0:v.length),console.log("  - conflictingEventIds size:",x==null?void 0:x.size),console.log("  - showValidation:",y),console.log("  - unavailabilityConflicts size:",T==null?void 0:T.size),console.log("  - Function props:"),console.log("    - onDateChange type:",typeof t),console.log("    - onSelectEvent type:",typeof l),console.log("    - onUpdateEvent type:",typeof d),console.log("    - onSelectInstructor type:",typeof E);try{const pe=m;console.log("✅ seatConfigs access successful in InstructorScheduleView")}catch(pe){console.error("❌ seatConfigs access failed in InstructorScheduleView:",pe),console.error("❌ Error stack:",pe.stack)}n||console.error("❌ CRITICAL: date is undefined"),s||console.error("❌ CRITICAL: events is undefined"),i||console.error("❌ CRITICAL: instructors is undefined"),f||console.error("❌ CRITICAL: daylightTimes is undefined"),(s==null?void 0:s.length)>0&&console.log("🔍 Sample event structure:",s[0]),(i==null?void 0:i.length)>0&&console.log("🔍 Sample instructor structure:",i[0]);const _=C.useRef(null),[R,H]=C.useState(new Date),[O,W]=C.useState(null),[ne,V]=C.useState(null),[U,D]=C.useState(null),[$,M]=C.useState(null),P=C.useRef(null),ae=C.useRef(!0),Q=C.useRef(u),Te=C.useRef(!1);C.useEffect(()=>{const pe=setInterval(()=>H(new Date),1e3);return()=>clearInterval(pe)},[]);const Y=C.useMemo(()=>{const[pe,ce,He]=n.split("-").map(Number);return new Date(Date.UTC(pe,ce-1,He)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[n]),fe=C.useMemo(()=>{const pe=aw(n,o,!0);return[...s,...pe]},[n,s,o]);C.useEffect(()=>{const pe=_.current;if(pe){if(ae.current){const He=(8-fi)*Si*u;pe.scrollLeft=He,ae.current=!1}else{const ce=Q.current;if(ce===u)return;const{scrollLeft:He,clientWidth:_e}=pe,Fe=(He+_e/2)/(Si*ce)*Si*u-_e/2;pe.scrollLeft=Fe}Q.current=u}},[u]);const ge=C.useCallback((pe,ce)=>{for(const He of pe){const _e=v.find(Xe=>Xe.id===He.flightNumber);if(!_e)continue;const Z=He.startTime-_e.preFlightTime,Fe=He.startTime+He.duration+_e.postFlightTime;for(const Xe of ce){const ft=v.find(Ke=>Ke.id===Xe.flightNumber);if(!ft)continue;const tt=Xe.startTime-ft.preFlightTime,Ve=Xe.startTime+Xe.duration+ft.postFlightTime;if(Z<Ve&&Fe>tt){const Ke=X0(He),nt=X0(Xe),Ct=Ke.find(xt=>nt.includes(xt));if(Ct)return{conflictingEvent:Xe,personName:Ct}}}}return null},[v]),Ne=(pe,ce)=>{if(pe.button!==0)return;Te.current=!1,document.body.classList.add("no-select");const _e=pe.currentTarget.getBoundingClientRect(),Z=new Map,Fe=ce.instructor||"",Xe=i.findIndex(ft=>ft.name===Fe);Xe!==-1&&Z.set(ce.id,{startTime:ce.startTime,rowIndex:Xe}),Z.size>0&&W({mainEventId:ce.id,xOffset:(pe.clientX-_e.left)/u,initialPositions:Z})},Oe=pe=>{if(!O||!P.current)return;Te.current=!0;const ce=P.current.getBoundingClientRect(),_e=((pe.clientX-ce.left)/u-O.xOffset)/Si+fi,Z=fe.find(nt=>nt.id===O.mainEventId);if(!Z)return;let Fe=_e;Fe<fi&&(Fe=fi),Fe+Z.duration>ac&&(Fe=ac-Z.duration);const Xe=Math.round(Fe*12)/12,ft={...Z,startTime:Xe},tt=fe.filter(nt=>nt.id!==O.mainEventId),Ve=ge([ft],tt);V(Ve?{conflictingEventId:Ve.conflictingEvent.id,conflictedPersonName:Ve.personName}:null),Xe!==Z.startTime&&d([{eventId:O.mainEventId,newStartTime:Xe}])},se=()=>{document.body.classList.remove("no-select"),W(null),V(null),setTimeout(()=>{Te.current=!1},0)},F=i.length;console.log("📏 CALCULATING DIMENSIONS:"),console.log("  - TOTAL_HOURS:",ry),console.log("  - PIXELS_PER_HOUR:",Si),console.log("  - zoomLevel:",u),console.log("  - ROW_HEIGHT:",Cl),console.log("  - totalRows (instructors.length):",F);const J=ry*Si*u,X=F*Cl;console.log("📏 CALCULATED VALUES:"),console.log("  - timelineWidth:",J),console.log("  - containerHeight:",X);const ee=C.useCallback(pe=>{if(!pe||!/^\d{2}:\d{2}$/.test(pe))return null;const[ce,He]=pe.split(":").map(Number);return ce+He/60},[]),K=()=>{const pe=[];for(let _e=fi;_e<=ac;_e++)pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-gray-500 flex items-center",style:{left:(_e-fi)*Si*u},children:e.jsx("span",{className:"-translate-x-1/2",children:`${String(_e).padStart(2,"0")}:00`})},_e));const ce=ee(f.firstLight),He=ee(f.lastLight);if(ce!==null){const _e=(ce-fi)*Si*u;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`FL ${f.firstLight}`})},"fl-label"))}if(He!==null){const _e=(He-fi)*Si*u;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`LL ${f.lastLight}`})},"ll-label"))}return pe},ue=()=>{const pe=[];for(let ce=fi;ce<=ac;ce++)pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-fi)*Si*u},children:e.jsx("div",{className:"w-px h-full bg-gray-700/50"})},`v-${ce}`)),ce<ac&&pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-fi+.5)*Si*u},children:e.jsx("div",{className:"w-px h-full bg-gray-700/25"})},`v-${ce}-30`));for(let ce=1;ce<=F;ce++)pe.push(e.jsx("div",{className:"absolute left-0 w-full bg-gray-700/25",style:{top:ce*Cl,height:"1px"}},`h-${ce}`));return pe},ye=()=>{const pe=ee(f.firstLight),ce=ee(f.lastLight);return e.jsxs(e.Fragment,{children:[pe!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(pe-fi)*Si*u}px`}}),ce!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(ce-fi)*Si*u}px`}})]})},Le=()=>{const pe=ee(f.firstLight),ce=ee(f.lastLight),He=[];if(pe!==null&&pe>fi){const _e=(pe-fi)*Si*u;He.push(e.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/5 pointer-events-none z-[1]",style:{width:`${_e}px`}},"night-shade-morning"))}if(ce!==null&&ce<ac){const _e=(ce-fi)*Si*u,Z=(ac-ce)*Si*u;He.push(e.jsx("div",{className:"absolute top-0 h-full bg-white/5 pointer-events-none z-[1]",style:{left:`${_e}px`,width:`${Z}px`}},"night-shade-evening"))}return e.jsx(e.Fragment,{children:He})},xe=()=>{const ce=parseFloat(localStorage.getItem("timezoneOffset")||"0")*60*60*1e3,He=new Date(Date.now()+ce),_e=`${He.getUTCFullYear()}-${String(He.getUTCMonth()+1).padStart(2,"0")}-${String(He.getUTCDate()).padStart(2,"0")}`;if(n!==_e)return null;const Z=R,Fe=Z.getHours()+Z.getMinutes()/60+Z.getSeconds()/3600;if(Fe<fi||Fe>ac)return null;const Xe=(Fe-fi)*Si*u;return e.jsxs("div",{className:"absolute top-0 h-full z-[30] pointer-events-none",style:{left:`${Xe}px`},children:[e.jsx("div",{className:"w-0.5 h-full bg-white animate-pulse"}),e.jsx("div",{className:"absolute -top-2.5 -translate-x-1/2 w-0 h-0",style:{borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"7px solid white"}})]})};return console.log("🎯 INSTRUCTOR SCHEDULE VIEW - About to render"),console.log("🎯 Final calculations:"),console.log("  - totalRows:",i==null?void 0:i.length),console.log("  - timelineWidth:",typeof J<"u"?J:"NOT_CALCULATED"),console.log("  - containerHeight:",typeof X<"u"?X:"NOT_CALCULATED"),typeof J>"u"&&console.error("❌ CRITICAL: timelineWidth is undefined - this will cause rendering failure"),typeof X>"u"&&console.error("❌ CRITICAL: containerHeight is undefined - this will cause rendering failure"),console.log("🎯 Returning JSX..."),e.jsx("div",{ref:_,className:"flex-1 overflow-auto relative bg-gray-900",children:e.jsxs("div",{style:{width:`${iy+J}px`,height:`${J0+X}px`,display:"grid",gridTemplateColumns:`${iy}px 1fr`,gridTemplateRows:`${J0}px 1fr`},children:[e.jsx("div",{className:"sticky top-0 left-0 z-40 bg-gray-800 border-r border-b border-gray-700 p-1",children:e.jsxs("div",{className:"bg-gray-700 rounded-md w-full h-full flex items-center justify-center px-2 space-x-2",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"flex-grow min-w-0 text-center font-semibold text-white cursor-default truncate",children:Y}),e.jsx("button",{onClick:()=>t(1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})}),e.jsxs("div",{className:"sticky top-0 z-20 bg-gray-800 border-b border-gray-700",children:[" ",e.jsx("div",{className:"relative",style:{width:J,height:J0},children:K()})]}),e.jsxs("div",{className:"sticky left-0 z-30 bg-gray-800 border-r border-gray-700",children:[" ",e.jsx(Iv,{personnel:i,rowHeight:Cl,onPersonClick:E,onRowEnter:M,onRowLeave:()=>M(null),showUnits:!1,useUnitColors:!0})]}),e.jsxs("div",{ref:P,className:"relative",onMouseMove:Oe,onMouseUp:se,onMouseLeave:se,children:[ue(),Le(),ye(),xe(),i.flatMap((pe,ce)=>{const He=$===ce?e.jsx("div",{className:"absolute top-0 left-0 right-0 pointer-events-none z-10",style:{height:Cl,top:ce*Cl,backgroundColor:"rgba(255, 255, 255, 0.05)"}},`row-highlight-${ce}`):null,_e=[];if(y){const Xe=fe.filter(ft=>ft.instructor===pe.name).sort((ft,tt)=>ft.startTime-tt.startTime);for(let ft=0;ft<Xe.length;ft++){const tt=Xe[ft],Ve=Xe[ft-1],Ke=Xe[ft+1],nt=v.find(kt=>kt.id===tt.flightNumber);if(!nt)continue;const Ct=Ve&&(()=>{const kt=v.find(vt=>vt.id===Ve.flightNumber);if(!kt)return!1;const Ge=Ve.startTime+Ve.duration+kt.postFlightTime,ht=tt.startTime-nt.preFlightTime;return Ge>ht})(),xt=Ke&&(()=>{const kt=v.find(vt=>vt.id===Ke.flightNumber);if(!kt)return!1;const Ge=tt.startTime+tt.duration+nt.postFlightTime,ht=Ke.startTime-kt.preFlightTime;return Ge>ht})();if(!(U===tt.id)&&!(Ct||xt))continue;const st=(kt,Ge,ht,vt)=>{const Ht=kt*Si*u,We=Cl*.25,we=ce*Cl+(Cl-We)/2,Re=(Ge-fi)*Si*u,Ze=`absolute pointer-events-none z-20 rounded-full border shadow-lg backdrop-blur-sm transition-colors duration-200 ${ht?"bg-red-500/50 border-red-400/30":"bg-white/50 border-white/30"}`,ot={left:`${Re}px`,top:`${we}px`,width:`${Ht}px`,height:`${We}px`};_e.push(e.jsx("div",{style:ot,className:Ze},vt))};if(nt.preFlightTime>0){const kt=tt.startTime-nt.preFlightTime;st(nt.preFlightTime,kt,Ct||!1,`${tt.id}-pre-${ce}`)}if(nt.postFlightTime>0){const kt=tt.startTime+tt.duration;st(nt.postFlightTime,kt,xt||!1,`${tt.id}-post-${ce}`)}}}const Fe=fe.filter(Xe=>Xe.instructor===pe.name||Xe.flightType==="Dual"&&Xe.student===pe.name).sort((Xe,ft)=>Xe.startTime-ft.startTime).map(Xe=>{const ft=!!(O&&O.mainEventId===Xe.id),tt=Xe.id===(ne==null?void 0:ne.conflictingEventId),Ve=y&&x.has(Xe.id)||tt||ft&&!!ne,Ke=T.get(Xe.id),nt=!!Ke,Ct=Ke||[];let xt=null;if(ne){const dn=X0(Xe);(ft||tt)&&dn.includes(ne.conflictedPersonName)&&(xt=ne.conflictedPersonName)}return e.jsx(Gc,{event:Xe,traineesData:A,onSelectEvent:()=>{Te.current||l(Xe)},onMouseDown:dn=>Ne(dn,Xe),onMouseEnter:()=>D(Xe.id),onMouseLeave:()=>D(null),pixelsPerHour:Si*u,rowHeight:Cl,startHour:fi,row:ce,isDragging:ft,isConflicting:Ve,isUnavailabilityConflict:nt,unavailablePersonnel:Ct,conflictedPersonnelName:xt,personnelData:h,seatConfigs:m,isDraggable:!0,currentTime:R},`${Xe.id}-${pe.name}`)});return[He,..._e,...Fe]})]})]})})},Lv=({trainees:n,rowHeight:t,onRowEnter:s,onRowLeave:i,onTraineeClick:o,onRowRef:l,courseColors:d={}})=>{const u=h=>{const m=h.split(" – ");return{name:m[0]||h,course:m[1]||""}},f=h=>({"bg-sky-400/50":"#38BDF8","bg-purple-400/50":"#C084FC","bg-yellow-400/50":"#FACC15","bg-pink-400/50":"#F472B6","bg-teal-400/50":"#2DD4BF","bg-indigo-400/50":"#818CF8","bg-cyan-400/50":"#22D3EE","bg-blue-400/50":"#60A5FA","bg-green-400/50":"#4ADE80","bg-orange-400/50":"#FB923C","bg-red-400/50":"#F87171","bg-gray-400/50":"#9CA3AF"})[h]||"#9CA3AF";return e.jsx("div",{className:"w-40 bg-gray-800 flex-shrink-0 h-full",children:e.jsx("ul",{children:n.map((h,m)=>{const{name:v,course:x}=u(h);return e.jsx("li",{ref:y=>l==null?void 0:l(h,y),className:`flex items-center justify-start pl-3 text-xs transition-colors duration-150 text-gray-300 border-b border-gray-700/50 ${o?"cursor-pointer hover:bg-gray-700":""}`,style:{height:t},onMouseEnter:()=>s==null?void 0:s(m),onMouseLeave:()=>i==null?void 0:i(),onClick:()=>o==null?void 0:o(h),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"truncate font-medium leading-tight",children:v}),x&&e.jsx("span",{className:"font-mono leading-tight",style:{color:f(d[x]||"bg-gray-400/50")},children:x})]})})})})})},Di=200,ec=32,hi=0,oc=24,lw=oc-hi,ay=160,K0=40,Z0=n=>{const t=[];return n.flightType==="Solo"?n.pilot&&t.push(n.pilot):(n.instructor&&t.push(n.instructor),n.student&&t.push(n.student)),t},cw=(n,t)=>{const s=[];return t.forEach(i=>{(i.unavailability||[]).forEach(l=>{const d=new Date(n+"T00:00:00Z"),u=new Date(l.startDate+"T00:00:00Z"),f=new Date(l.endDate+"T00:00:00Z"),h=new Date(f);if(l.allDay&&h.setDate(h.getDate()-1),d>=u&&d<=h){let m=l.allDay?.0167:parseFloat(l.startTime)/100,v=l.allDay?23.983:parseFloat(l.endTime)/100;l.allDay||(d.getTime()===u.getTime()&&d.getTime()===h.getTime()?(m=l.startTime?parseFloat(l.startTime)/100:.0167,v=l.endTime?parseFloat(l.endTime)/100:23.983):d.getTime()===u.getTime()&&l.startTime?(m=parseFloat(l.startTime)/100,v=23.983):d.getTime()===h.getTime()&&l.endTime?(m=.0167,v=parseFloat(l.endTime)/100):d>u&&d<h&&(m=.0167,v=23.983));const x=v-m,y={id:`unavailability-${i.fullName}-${l.id}`,date:n,startTime:m,duration:x,type:"unavailability",student:i.fullName,pilot:i.fullName,flightNumber:"UNAVAIL",resourceName:i.fullName,resourceId:`TRAINEE-${i.fullName}`,eventType:"UNAVAILABILITY",allDay:l.allDay,reason:l.reason,notes:l.notes};s.push(y)}})}),s},dw=({date:n,onDateChange:t,events:s,trainees:i,onSelectEvent:o,onUpdateEvent:l,zoomLevel:d,daylightTimes:u,personnelData:f,seatConfigs:h,syllabusDetails:m,conflictingEventIds:v,showValidation:x,unavailabilityConflicts:y,onSelectTrainee:T,traineesData:E,courseColors:A})=>{const _=C.useRef(null),[R,H]=C.useState(new Date),[O,W]=C.useState(null),[ne,V]=C.useState(null),[U,D]=C.useState(null),[$,M]=C.useState(null),P=C.useRef(null),ae=C.useRef(!0),Q=C.useRef(d),Te=C.useRef(!1);C.useEffect(()=>{const pe=setInterval(()=>H(new Date),1e3);return()=>clearInterval(pe)},[]);const Y=C.useMemo(()=>{const[pe,ce,He]=n.split("-").map(Number);return new Date(Date.UTC(pe,ce-1,He)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[n]),fe=C.useMemo(()=>{const pe=cw(n,E);return[...s,...pe]},[n,s,E]);C.useEffect(()=>{const pe=_.current;if(pe){if(ae.current){const He=(8-hi)*Di*d;pe.scrollLeft=He,ae.current=!1}else{const ce=Q.current;if(ce===d)return;const{scrollLeft:He,clientWidth:_e}=pe,Fe=(He+_e/2)/(Di*ce)*Di*d-_e/2;pe.scrollLeft=Fe}Q.current=d}},[d]);const ge=C.useCallback((pe,ce)=>{for(const He of pe){const _e=m.find(Xe=>Xe.id===He.flightNumber);if(!_e)continue;const Z=He.startTime-_e.preFlightTime,Fe=He.startTime+He.duration+_e.postFlightTime;for(const Xe of ce){const ft=m.find(Ke=>Ke.id===Xe.flightNumber);if(!ft)continue;const tt=Xe.startTime-ft.preFlightTime,Ve=Xe.startTime+Xe.duration+ft.postFlightTime;if(Z<Ve&&Fe>tt){const Ke=Z0(He),nt=Z0(Xe),Ct=Ke.find(xt=>nt.includes(xt));if(Ct)return{conflictingEvent:Xe,personName:Ct}}}}return null},[m]),Ne=(pe,ce)=>{if(pe.button!==0)return;Te.current=!1,document.body.classList.add("no-select");const _e=pe.currentTarget.getBoundingClientRect(),Z=new Map,Fe=ce.student||ce.pilot||"",Xe=i.findIndex(ft=>ft===Fe);Xe!==-1&&Z.set(ce.id,{startTime:ce.startTime,rowIndex:Xe}),Z.size>0&&W({mainEventId:ce.id,xOffset:(pe.clientX-_e.left)/d,initialPositions:Z})},Oe=pe=>{if(!O||!P.current)return;Te.current=!0;const ce=P.current.getBoundingClientRect(),_e=((pe.clientX-ce.left)/d-O.xOffset)/Di+hi,Z=fe.find(nt=>nt.id===O.mainEventId);if(!Z)return;let Fe=_e;Fe<hi&&(Fe=hi),Fe+Z.duration>oc&&(Fe=oc-Z.duration);const Xe=Math.round(Fe*12)/12,ft={...Z,startTime:Xe},tt=fe.filter(nt=>nt.id!==O.mainEventId),Ve=ge([ft],tt);V(Ve?{conflictingEventId:Ve.conflictingEvent.id,conflictedPersonName:Ve.personName}:null),Xe!==Z.startTime&&l([{eventId:O.mainEventId,newStartTime:Xe}])},se=()=>{document.body.classList.remove("no-select"),W(null),V(null),setTimeout(()=>{Te.current=!1},0)},F=i.length,J=lw*Di*d,X=F*ec,ee=C.useCallback(pe=>{if(!pe||!/^\d{2}:\d{2}$/.test(pe))return null;const[ce,He]=pe.split(":").map(Number);return ce+He/60},[]),K=()=>{const pe=[];for(let _e=hi;_e<=oc;_e++)pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-gray-500 flex items-center",style:{left:(_e-hi)*Di*d},children:e.jsx("span",{className:"-translate-x-1/2",children:`${String(_e).padStart(2,"0")}:00`})},_e));const ce=ee(u.firstLight),He=ee(u.lastLight);if(ce!==null){const _e=(ce-hi)*Di*d;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`FL ${u.firstLight}`})},"fl-label"))}if(He!==null){const _e=(He-hi)*Di*d;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`LL ${u.lastLight}`})},"ll-label"))}return pe},ue=()=>{const pe=[];for(let ce=hi;ce<=oc;ce++)pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-hi)*Di*d},children:e.jsx("div",{className:"w-px h-full bg-gray-700/50"})},`v-${ce}`)),ce<oc&&pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-hi+.5)*Di*d},children:e.jsx("div",{className:"w-px h-full bg-gray-700/25"})},`v-${ce}-30`));for(let ce=1;ce<=F;ce++)pe.push(e.jsx("div",{className:"absolute left-0 w-full bg-gray-700/25",style:{top:ce*ec,height:"1px"}},`h-${ce}`));return pe},ye=()=>{const pe=ee(u.firstLight),ce=ee(u.lastLight);return e.jsxs(e.Fragment,{children:[pe!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(pe-hi)*Di*d}px`}}),ce!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(ce-hi)*Di*d}px`}})]})},Le=()=>{const pe=ee(u.firstLight),ce=ee(u.lastLight),He=[];if(pe!==null&&pe>hi){const _e=(pe-hi)*Di*d;He.push(e.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/5 pointer-events-none z-[1]",style:{width:`${_e}px`}},"night-shade-morning"))}if(ce!==null&&ce<oc){const _e=(ce-hi)*Di*d,Z=(oc-ce)*Di*d;He.push(e.jsx("div",{className:"absolute top-0 h-full bg-white/5 pointer-events-none z-[1]",style:{left:`${_e}px`,width:`${Z}px`}},"night-shade-evening"))}return e.jsx(e.Fragment,{children:He})},xe=()=>{const ce=parseFloat(localStorage.getItem("timezoneOffset")||"0")*60*60*1e3,He=new Date(Date.now()+ce),_e=`${He.getUTCFullYear()}-${String(He.getUTCMonth()+1).padStart(2,"0")}-${String(He.getUTCDate()).padStart(2,"0")}`;if(n!==_e)return null;const Z=R,Fe=Z.getHours()+Z.getMinutes()/60+Z.getSeconds()/3600;if(Fe<hi||Fe>oc)return null;const Xe=(Fe-hi)*Di*d;return e.jsxs("div",{className:"absolute top-0 h-full z-[30] pointer-events-none",style:{left:`${Xe}px`},children:[e.jsx("div",{className:"w-0.5 h-full bg-white animate-pulse"}),e.jsx("div",{className:"absolute -top-2.5 -translate-x-1/2 w-0 h-0",style:{borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"7px solid white"}})]})};return e.jsx("div",{ref:_,className:"flex-1 overflow-auto relative bg-gray-900",children:e.jsxs("div",{style:{width:`${ay+J}px`,height:`${K0+X}px`,display:"grid",gridTemplateColumns:`${ay}px 1fr`,gridTemplateRows:`${K0}px 1fr`},children:[e.jsx("div",{className:"sticky top-0 left-0 z-40 bg-gray-800 border-r border-b border-gray-700 p-1",children:e.jsxs("div",{className:"bg-gray-700 rounded-md w-full h-full flex items-center justify-center px-2 space-x-2",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"flex-grow min-w-0 text-center font-semibold text-white cursor-default truncate",children:Y}),e.jsx("button
fixed inset-0 bg-black/70 z-[70] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl border border-gray-700",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Manage Unavailability"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sky-400 text-lg border-b border-gray-600 pb-2",children:"Add New"}),e.jsx("button",{onClick:t,className:"w-full px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold shadow-md",children:"Add Today Only (0001-2359)"}),e.jsxs("div",{className:"relative",children:[e.jsx("hr",{className:"border-gray-600"}),e.jsx("span",{className:"absolute left-1/2 -translate-x-1/2 -top-3 bg-gray-800 px-2 text-gray-400 text-sm",children:"OR"})]}),e.jsxs("div",{className:"space-y-4 p-4 bg-gray-700/30 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-300",children:"Add Custom Period"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start-date",className:"text-sm text-gray-400",children:"Unavailable From"}),e.jsxs("div",{className:"flex space-x-2 mt-1",children:[e.jsx("input",{id:"start-time",type:"text",placeholder:"HHMM",maxLength:4,value:h,onChange:D=>{m(D.target.value.replace(/\D/g,"")),_&&W()},className:`block w-24 bg-gray-700 border-gray-600 rounded-md py-2 px-2 text-white font-mono text-center focus:ring-sky-500 focus:border-sky-500 ${E!=null&&E.errors.some(D=>D.field==="startTime")?"border-red-500":""}`}),e.jsx("input",{id:"start-date",type:"date",value:l,onChange:D=>{d(D.target.value),_&&W()},style:{colorScheme:"dark"},className:`block w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 ${E!=null&&E.errors.some(D=>D.field==="startDate")?"border-red-500":""}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end-date",className:"text-sm text-gray-400",children:"End Unavailable"}),e.jsxs("div",{className:"flex space-x-2 mt-1",children:[e.jsx("input",{id:"end-time",type:"text",placeholder:"HHMM",maxLength:4,value:v,onChange:D=>{x(D.target.value.replace(/\D/g,"")),_&&W()},className:`block w-24 bg-gray-700 border-gray-600 rounded-md py-2 px-2 text-white font-mono text-center focus:ring-sky-500 focus:border-sky-500 ${E!=null&&E.errors.some(D=>D.field==="endTime")?"border-red-500":""}`}),e.jsx("input",{id:"end-date",type:"date",value:u,onChange:D=>{f(D.target.value),_&&W()},style:{colorScheme:"dark"},className:`block w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 ${E!=null&&E.errors.some(D=>D.field==="endDate")?"border-red-500":""}`})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"unavailability-reason",className:"block text-sm font-medium text-gray-400",children:"Reason"}),e.jsx("select",{id:"unavailability-reason",value:y,onChange:D=>{T(D.target.value),_&&W()},className:`mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm ${E!=null&&E.errors.some(D=>D.field==="general")?"border-red-500":""}`,children:H.map(D=>e.jsx("option",{value:D,children:D},D))})]}),e.jsx("button",{onClick:ne,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm font-semibold",children:"Add Custom Period"}),_&&E&&e.jsx("div",{id:"validation-errors",className:"mt-4",children:e.jsx(hw,{validation:E})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sky-400 text-lg border-b border-gray-600 pb-2",children:"Current Unavailabilities"}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto pr-2",children:i.length>0?[...i].sort((D,$)=>new Date(D.startDate).getTime()-new Date($.startDate).getTime()).map(D=>{let $="";const M=V(D.startDate);if(D.allDay){const P=new Date(`${D.endDate}T00:00:00Z`);P.setUTCDate(P.getUTCDate()-1);const ae=P.toISOString().split("T")[0],Q=V(ae);$=`${D.startDate===ae?M:`${M} to ${Q}`} @ All Day`}else{const P=V(D.endDate),ae=U(D.startTime),Q=U(D.endTime);D.startDate===D.endDate?$=`${ae} ${M} - ${Q} ${P}`:$=`${ae} ${M} to ${Q} ${P}`}return e.jsxs("div",{className:"p-2 bg-gray-700/50 rounded-md text-sm flex justify-between items-center gap-2",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("span",{className:"font-semibold text-white",children:D.reason}),e.jsx("div",{className:"text-xs text-gray-300 mt-1 font-mono",children:$})]}),e.jsx("button",{onClick:()=>o(D.id),className:"p-1.5 text-gray-400 hover:text-red-400 rounded-full hover:bg-red-500/20 flex-shrink-0","aria-label":"Remove unavailability",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},D.id)}):e.jsx("p",{className:"text-sm text-gray-500 text-center italic py-4",children:"No unavailability periods recorded."})})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end",children:e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Done"})})]})})},mw=({onConfirm:n,onCancel:t})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[70] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-sm border border-gray-700",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Confirm Action"})}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-300",children:"Are you sure you want to pause this trainee?"})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"No, Cancel"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-700 transition-colors text-sm font-semibold",children:"Yes, Pause"})]})]})}),gw=({traineeName:n,onAcknowledge:t})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[70] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-amber-500/50",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-amber-900/20 flex items-center space-x-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{className:"text-xl font-bold text-amber-400",children:"Schedule Warning"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-gray-300",children:["Warning: ",e.jsx("strong",{className:"text-white",children:n})," is scheduled for one or more events today."]}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Pausing their status will not automatically remove them from the program. Please update the schedule manually to avoid conflicts."})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end",children:e.jsx("button",{onClick:t,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"OK"})})]})}),pw=["BPC+IPC","FIC","OFI","WSO","FIC(I)","PLT CONV","QFI CONV","PLT Refresh","Staff CAT"],Ci=({label:n,value:t,className:s=""})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("div",{className:`mt-1 text-white p-2 bg-gray-700/50 rounded-md min-h-[38px] flex items-center ${s}`,children:t})]}),qd=({label:n,value:t,onChange:s,readOnly:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("input",{type:"text",value:t,onChange:s,readOnly:i,className:`mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm ${i?"bg-gray-700/50 cursor-not-allowed":""}`})]}),rd=({label:n,value:t,onChange:s,children:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("select",{value:t,onChange:s,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",children:i})]}),La=({label:n,value:t,onChange:s})=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"text-xs text-gray-400 mb-1",children:n}),e.jsx("input",{type:"number",min:"0",step:"0.1",value:t,onFocus:i=>i.target.select(),onChange:i=>s(parseFloat(i.target.value)||0),className:"w-20 bg-gray-700 border border-gray-600 rounded-md py-1 px-2 text-white text-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 text-center [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"})]}),Ma=({label:n,value:t})=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1",children:n}),e.jsx("div",{className:"w-20 bg-gray-800/50 rounded-md py-1 px-2 text-white text-sm text-center font-mono border border-gray-700",children:t.toFixed(1)})]}),ly=({event:n,title:t,onNavigate:s,onCloseFlyout:i,reason:o})=>{const l=()=>{n&&(s(n.id),i())};return e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:t}),n?e.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Event:"}),e.jsx("button",{onClick:l,className:"font-semibold text-sky-400 hover:underline focus:outline-none",children:n.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Type:"}),e.jsx("span",{className:"text-white font-medium",children:n.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Duration:"}),e.jsxs("span",{className:"text-white font-medium",children:[n.duration.toFixed(1)," hrs"]})]})]}):e.jsx("div",{className:"mt-2 flex items-center justify-center text-center italic text-gray-500 h-[80px]",children:e.jsxs("div",{children:[e.jsxs("p",{children:["No ",t.toLowerCase()," found."]}),o&&e.jsx("p",{className:"text-xs mt-1",children:o})]})})]})},lh=n=>n?new Date(`${n}T00:00:00Z`).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"}):"",cy=({title:n,date:t,daysSince:s,eventCode:i})=>e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:n}),t&&s!==null?e.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[i&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Event:"}),e.jsx("span",{className:"font-semibold text-white",children:i})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Date:"}),e.jsx("span",{className:"font-semibold text-white",children:lh(t)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Days Since:"}),e.jsx("span",{className:"text-white font-bold text-lg",children:s})]})]}):e.jsx("div",{className:"mt-2 flex items-center justify-center text-center italic text-gray-500 h-[78px]",children:e.jsx("p",{children:"No event recorded."})})]}),dy={day:{p1:0,p2:0,dual:0},night:{p1:0,p2:0,dual:0},total:0,captain:0,instructor:0,instrument:{sim:0,actual:0},simulator:{p1:0,p2:0,dual:0,total:0}},xw=({trainee:n,onClose:t,onUpdateTrainee:s,events:i,school:o,onNavigateToHateSheet:l,onViewIndividualLMP:d,onAddRemedialPackage:u,personnelData:f,courseColors:h,scores:m,syllabusDetails:v,onNavigateToSyllabus:x,onNavigateToCurrency:y,locations:T,units:E,individualLmp:A,onViewLogbook:_,isCreating:R=!1,activeCourses:H=[]})=>{const[O,W]=C.useState(R),[ne,V]=C.useState(!1),[U,D]=C.useState(!1),[$,M]=C.useState(!1),[P,ae]=C.useState(n.name),[Q,Te]=C.useState(n.idNumber),[Y,fe]=C.useState(n.rank),[ge,Ne]=C.useState(n.service||""),[Oe,se]=C.useState(n.course||H[0]||""),[F,J]=C.useState(n.lmpType||"BPC+IPC"),[X,ee]=C.useState(n.traineeCallsign||""),[K,ue]=C.useState(n.seatConfig),[ye,Le]=C.useState(n.isPaused),[xe,pe]=C.useState(n.unavailability||[]),[ce,He]=C.useState(n.location||T[0]||""),[_e,Z]=C.useState(n.unit||E[0]||""),[Fe,Xe]=C.useState(n.flight||""),[ft,tt]=C.useState(n.phoneNumber||""),[Ve,Ke]=C.useState(n.email||""),[nt,Ct]=C.useState(n.permissions||[]),[xt,dn]=C.useState(n.priorExperience||dy),on=C.useMemo(()=>["Trainee","Staff","Ops","Course Supervisor","Admin","Super Admin"],[]),st=C.useMemo(()=>f.get(n.fullName),[f,n.fullName]),{lastFlight:kt,lastEvent:Ge,daysSinceLastFlight:ht,daysSinceLastEvent:vt}=C.useMemo(()=>{const Ce=m.get(n.fullName)||[],At=new Date;At.setUTCHours(0,0,0,0);const B=et=>{if(!et)return null;const $t=new Date(et+"T00:00:00Z");return Math.round((At.getTime()-$t.getTime())/(1e3*60*60*24))};if(Ce.length===0)return{lastFlight:null,lastEvent:null,daysSinceLastFlight:null,daysSinceLastEvent:null};const Ae=[...Ce].sort((et,$t)=>new Date($t.date).getTime()-new Date(et.date).getTime()),rt=Ae[0]||null,yt=Ae.find(et=>{const $t=v.find(pn=>pn.id===et.event);return($t==null?void 0:$t.type)==="Flight"})||null;return{lastFlight:yt,lastEvent:rt,daysSinceLastFlight:B(yt==null?void 0:yt.date),daysSinceLastEvent:B(rt==null?void 0:rt.date)}},[n.fullName,m,v]),{nextEvent:Ht,subsequentEvent:We,nextEventReason:we}=C.useMemo(()=>{if(R)return{nextEvent:null,subsequentEvent:null,nextEventReason:"New Trainee"};const Ce=m.get(n.fullName)||[],At=new Set(Ce.map(et=>et.event));let B=null,Ae=null,rt="",yt=-1;for(let et=0;et<A.length;et++){const $t=A[et];if(At.has($t.id)||$t.code.includes(" MB"))continue;if($t.prerequisites.every(kn=>At.has(kn))){B=$t,yt=et;break}}if(yt!==-1)for(let et=yt+1;et<A.length;et++){const $t=A[et];if(!$t.code.includes(" MB")){Ae=$t;break}}return B||(A.filter($t=>!$t.isRemedial&&!$t.code.includes(" MB")).every($t=>At.has($t.id))?rt="Syllabus complete.":rt="Prerequisites incomplete."),{nextEvent:B,subsequentEvent:Ae,nextEventReason:rt}},[n.fullName,m,A,R]),Re=()=>{ae(n.name),Te(n.idNumber),fe(n.rank),Ne(n.service||""),se(n.course||H[0]||""),J(n.lmpType||"BPC+IPC"),ee(n.traineeCallsign||""),ue(n.seatConfig),Le(n.isPaused),pe(n.unavailability||[]),He(n.location||T[0]||""),Z(n.unit||E[0]||""),Xe(n.flight||""),tt(n.phoneNumber||""),Ke(n.email||""),Ct(n.permissions||[]),dn(n.priorExperience||dy)};C.useEffect(()=>{Re(),W(R)},[n,R]),C.useEffect(()=>{R||Pn({action:"View",description:`Viewed trainee profile for ${n.rank} ${n.name}`,changes:`Course: ${n.course}, Unit: ${n.unit}`,page:"Trainee Roster"})},[]);const be=C.useMemo(()=>i.some(Ce=>Ce.student===n.fullName||Ce.pilot===n.fullName),[i,n.fullName]),Ze=()=>{!ye&&be?M(!0):D(!0)},ot=()=>{const Ce={...n,isPaused:!n.isPaused};s(Ce),D(!1)},Vt=Ce=>{const At=P;ae(Ce),At&&Ce!==At&&jo(`trainee-${n.idNumber}-name`,"Edit","Updated trainee name")},Pt=Ce=>{const At=Y;fe(Ce),At!==Ce&&jo(`trainee-${n.idNumber}-rank`,"Edit","Updated trainee rank")},yn=Ce=>{const At=Oe;se(Ce),At!==Ce&&jo(`trainee-${n.idNumber}-course`,"Edit","Updated trainee course")},Tt=Ce=>{const At=F;J(Ce),At!==Ce&&jo(`trainee-${n.idNumber}-lmptype`,"Edit","Updated trainee LMP type")},lt=Ce=>{const At=X;ee(Ce),At!==Ce&&jo(`trainee-${n.idNumber}-callsign`,"Edit","Updated trainee callsign")},Et=Ce=>{const At=_e;Z(Ce),At!==Ce&&jo(`trainee-${n.idNumber}-unit`,"Edit","Updated trainee unit")},Bt=Ce=>{const At=ce;He(Ce),At!==Ce&&jo(`trainee-${n.idNumber}-location`,"Edit","Updated trainee location")},Kt=async()=>{if(!P||!Oe){alert("Name and Course are required.");return}const Ce=`${P} – ${Oe}`,At={...n,idNumber:Q,name:P,fullName:Ce,course:Oe,lmpType:F,traineeCallsign:X,rank:Y,seatConfig:K,isPaused:ye,unavailability:xe,location:ce,unit:_e,flight:Fe,phoneNumber:ft,email:Ve,permissions:nt,priorExperience:xt};if(og(),R)Pn({action:"Add",description:`Added new trainee ${Y} ${P}`,changes:`Course: ${Oe}, Unit: ${_e}, Location: ${ce}`,page:"Trainee Roster"});else{const B=[];n.name!==P&&B.push(`Name: ${n.name} → ${P}`),n.rank!==Y&&B.push(`Rank: ${n.rank} → ${Y}`),n.course!==Oe&&B.push(`Course: ${n.course} → ${Oe}`),n.lmpType!==F&&B.push(`LMP: ${n.lmpType||"BPC+IPC"} → ${F}`),n.traineeCallsign!==X&&B.push(`Trainee Callsign: ${n.traineeCallsign||"N/A"} → ${X}`),n.unit!==_e&&B.push(`Unit: ${n.unit} → ${_e}`),n.location!==ce&&B.push(`Location: ${n.location} → ${ce}`),n.seatConfig!==K&&B.push(`Seat Config: ${n.seatConfig} → ${K}`),n.isPaused!==ye&&B.push(`Paused: ${n.isPaused} → ${ye}`),B.length>0&&Pn({action:"Edit",description:`Updated trainee ${Y} ${P}`,changes:B.join(", "),page:"Trainee Roster"})}s(At);try{const Ae=`Logbook_${P.replace(/,\s/g,"_")}_${Q}.json`,rt=JSON.stringify(xt,null,2),yt=new File([rt],Ae,{type:"application/json"});await cd(yt,"trainee_logbook",Ae)}catch(B){console.error("Failed to save logbook data to storage:",B)}W(!1),R&&t()},Mt=()=>{R?t():(Re(),W(!1))},ze=(Ce,At)=>{Ct(B=>At?[...B,Ce]:B.filter(Ae=>Ae!==Ce))},qt=()=>{l(n),t()},Mn=()=>{d(n),t()},jn=(Ce,At,B)=>{dn(Ae=>At?{...Ae,[Ce]:{...Ae[Ce],[At]:B}}:{...Ae,[Ce]:B})},je=()=>{const B=(rt=>rt.toISOString().split("T")[0])(new Date),Ae={id:_r(),startDate:B,endDate:B,allDay:!1,startTime:"0001",endTime:"2359",reason:"Other",notes:"Today Only"};if(R)pe(rt=>[...rt,Ae]),V(!1);else{Pn({action:"Add",description:`Added unavailability for ${n.rank} ${n.name}`,changes:`Today Only - ${B}`,page:"Trainee Roster"});const rt=[...n.unavailability||[],Ae];s({...n,unavailability:rt}),V(!1)}},$e=Ce=>{console.log("handleSaveCustomUnavailability called",{periodData:Ce,isCreating:R,traineeName:n.name});const At={...Ce,id:_r(),startTime:Ce.allDay?void 0:Ce.startTime,endTime:Ce.allDay?void 0:Ce.endTime};if(console.log("Created new period",At),R)console.log("Adding to creating trainee unavailability"),pe(B=>[...B,At]);else{console.log("Updating existing trainee unavailability");const B=Ce.startDate===Ce.endDate?Ce.startDate:`${Ce.startDate} to ${Ce.endDate}`,Ae=Ce.allDay?"All Day":`${Ce.startTime} to ${Ce.endTime}`;Pn({action:"Add",description:`Added unavailability for ${n.rank} ${n.name}`,changes:`${B} @ ${Ae} - ${Ce.reason}`,page:"Trainee Roster"});const rt=[...n.unavailability||[],At];console.log("Calling onUpdateTrainee with updated unavailability",rt),s({...n,unavailability:rt})}},Ye=Ce=>{var At;if(R)pe(B=>B.filter(Ae=>Ae.id!==Ce));else{const B=(At=n.unavailability)==null?void 0:At.find(rt=>rt.id===Ce);if(B){const rt=B.startDate===B.endDate?B.startDate:`${B.startDate} to ${B.endDate}`;Pn({action:"Delete",description:`Removed unavailability for ${n.rank} ${n.name}`,changes:`${rt} - ${B.reason}`,page:"Trainee Roster"})}const Ae=(n.unavailability||[]).filter(rt=>rt.id!==Ce);s({...n,unavailability:Ae})}},Dt=Ce=>Ce?Ce.replace(":",""):"",St="w-full px-4 py-2 rounded-md transition-colors text-sm font-semibold shadow-md text-center",hn=e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Permissions"}),e.jsx("div",{className:"mt-1 min-h-[10rem] p-2",children:O?e.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:on.map(Ce=>e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:nt.includes(Ce),onChange:At=>ze(Ce,At.target.checked),className:"h-4 w-4 accent-sky-500 bg-gray-600 rounded"}),e.jsx("span",{className:"text-white",children:Ce})]},Ce))}):e.jsx("ul",{className:"space-y-2 text-white list-disc list-inside",children:n.permissions&&n.permissions.length>0?n.permissions.map(Ce=>e.jsx("li",{children:Ce},Ce)):e.jsx("li",{className:"list-none italic text-gray-500",children:"No permissions assigned."})})})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl h-[80vh] flex flex-col border border-gray-700",onClick:Ce=>Ce.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50 flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-sky-400",children:R?"New Trainee":"Trainee Profile"}),e.jsx("button",{onClick:t,className:"text-white hover:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 flex flex-row overflow-hidden",children:[e.jsxs("div",{className:"flex-1 p-6 space-y-4 overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-4",children:O?e.jsxs(e.Fragment,{children:[e.jsx(qd,{label:"Name (Surname, Firstname)",value:P,onChange:Ce=>Vt(Ce.target.value)}),e.jsx(qd,{label:"ID Number",value:Q,onChange:Ce=>Te(parseInt(Ce.target.value)||0)}),e.jsx(rd,{label:"Course",value:Oe,onChange:Ce=>yn(Ce.target.value),children:H.length>0?H.map(Ce=>e.jsx("option",{value:Ce,children:Ce},Ce)):e.jsx("option",{disabled:!0,children:"No courses"})}),e.jsx(rd,{label:"LMP",value:F,onChange:Ce=>Tt(Ce.target.value),children:pw.map(Ce=>e.jsx("option",{value:Ce,children:Ce},Ce))}),e.jsx(qd,{label:"Trainee Callsign",value:X,onChange:Ce=>lt(Ce.target.value)})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ci,{label:"Name",value:n.name}),e.jsx(Ci,{label:"ID Number",value:n.idNumber}),e.jsx(Ci,{label:"Course",value:e.jsx("span",{className:`px-2 py-1 rounded-md text-white font-semibold ${h[n.course]||"bg-gray-500"}`,children:n.course})}),e.jsx(Ci,{label:"LMP",value:e.jsx("span",{className:"px-2 py-1 rounded-md text-sky-400 font-semibold bg-sky-900/30",children:n.lmpType||"BPC+IPC"})}),e.jsx(Ci,{label:"Trainee Callsign",value:e.jsx("span",{className:"px-2 py-1 rounded-md text-green-400 font-semibold bg-green-900/30",children:n.traineeCallsign||"N/A"})})]})}),O?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(rd,{label:"Rank",value:Y,onChange:Ce=>Pt(Ce.target.value),children:[e.jsx("option",{value:"OCDT",children:"OCDT"}),e.jsx("option",{value:"MIDN",children:"MIDN"}),e.jsx("option",{value:"PLTOFF",children:"PLTOFF"}),e.jsx("option",{value:"FLGOFF",children:"FLGOFF"}),e.jsx("option",{value:"SBLT",children:"SBLT"}),e.jsx("option",{value:"2LT",children:"2LT"}),e.jsx("option",{value:"FLTLT",children:"FLTLT"})]}),!R&&e.jsx(Ci,{label:"Callsign",value:`${(st==null?void 0:st.callsignPrefix)||""}${(st==null?void 0:st.callsignNumber)||""}`}),e.jsxs(rd,{label:"Service",value:ge,onChange:Ce=>Ne(Ce.target.value),children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"Air Force",children:"Air Force"}),e.jsx("option",{value:"Navy",children:"Navy"}),e.jsx("option",{value:"Army",children:"Army"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(rd,{label:"Unit",value:_e,onChange:Ce=>Et(Ce.target.value),children:E.map(Ce=>e.jsx("option",{value:Ce,children:Ce},Ce))}),e.jsx(qd,{label:"Flight",value:Fe,onChange:Ce=>Xe(Ce.target.value)}),e.jsxs(rd,{label:"Seat Config",value:K,onChange:Ce=>ue(Ce.target.value),children:[e.jsx("option",{value:"Normal",children:"Normal"}),e.jsx("option",{value:"FWD/SHORT",children:"FWD/SHORT"}),e.jsx("option",{value:"REAR/SHORT",children:"REAR/SHORT"}),e.jsx("option",{value:"FWD/LONG",children:"FWD/LONG"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(rd,{label:"Location",value:ce,onChange:Ce=>Bt(Ce.target.value),children:T.map(Ce=>e.jsx("option",{value:Ce,children:Ce},Ce))}),e.jsx(qd,{label:"Phone Number",value:ft,onChange:Ce=>tt(Ce.target.value)}),e.jsx(qd,{label:"Email",value:Ve,onChange:Ce=>Ke(Ce.target.value)})]}),!R&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Primary Instructor"}),e.jsx("div",{className:"mt-2",children:e.jsx(Ci,{label:"Name",value:n.primaryInstructor||"Not Assigned"})})]}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Secondary Instructor"}),e.jsx("div",{className:"mt-2",children:e.jsx(Ci,{label:"Name",value:n.secondaryInstructor||"Not Assigned"})})]})]}),hn,!R&&e.jsx("div",{className:"p-3 border border-gray-600 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-gray-300",children:"Pause Trainee (NTSC)"}),e.jsx("button",{onClick:Ze,className:`relative inline-flex items-center h-6 rounded-full w-12 transition-colors ${ye?"bg-amber-500":"bg-gray-600"}`,children:e.jsx("span",{className:`transform transition-transform inline-block w-5 h-5 bg-white rounded-full ${ye?"translate-x-6":"translate-x-1"}`})})]})}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-sky-400",children:"Logbook - Prior Experience (PC-21 only)"}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 border-b border-gray-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-300 mb-2 text-center",children:"Day Flying"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(La,{label:"P1",value:xt.day.p1,onChange:Ce=>jn("day","p1",Ce)}),e.jsx(La,{label:"P2",value:xt.day.p2,onChange:Ce=>jn("day","p2",Ce)}),e.jsx(La,{label:"Dual",value:xt.day.dual,onChange:Ce=>jn("day","dual",Ce)})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-300 mb-2 text-center",children:"Night Flying"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(La,{label:"P1",value:xt.night.p1,onChange:Ce=>jn("night","p1",Ce)}),e.jsx(La,{label:"P2",value:xt.night.p2,onChange:Ce=>jn("night","p2",Ce)}),e.jsx(La,{label:"Dual",value:xt.night.dual,onChange:Ce=>jn("night","dual",Ce)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 border-b border-gray-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-300 mb-2 text-center",children:"Totals"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(La,{label:"TOTAL",value:xt.total,onChange:Ce=>jn("total",null,Ce)}),e.jsx(La,{label:"Captain",value:xt.captain,onChange:Ce=>jn("captain",null,Ce)}),e.jsx(La,{label:"Instructor",value:xt.instructor,onChange:Ce=>jn("instructor",null,Ce)})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-300 mb-2 text-center",children:"Instrument"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(La,{label:"Sim",value:xt.instrument.sim,onChange:Ce=>jn("instrument","sim",Ce)}),e.jsx(La,{label:"Actual",value:xt.instrument.actual,onChange:Ce=>jn("instrument","actual",Ce)})]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-300 mb-2 text-center",children:"Simulator"}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(La,{label:"P1",value:xt.simulator.p1,onChange:Ce=>jn("simulator","p1",Ce)}),e.jsx(La,{label:"P2",value:xt.simulator.p2,onChange:Ce=>jn("simulator","p2",Ce)}),e.jsx(La,{label:"Dual",value:xt.simulator.dual,onChange:Ce=>jn("simulator","dual",Ce)}),e.jsx(La,{label:"Total",value:xt.simulator.total,onChange:Ce=>jn("simulator","total",Ce)})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Ci,{label:"Rank",value:Y}),e.jsx(Ci,{label:"Trainee Callsign",value:e.jsx("span",{className:"px-2 py-1 rounded-md text-green-400 font-semibold bg-green-900/30",children:n.traineeCallsign||"N/A"})}),e.jsx(Ci,{label:"Service",value:ge||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Ci,{label:"Unit",value:_e}),e.jsx(Ci,{label:"Flight",value:Fe||"N/A"}),e.jsx(Ci,{label:"Seat Config",value:K})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Ci,{label:"Location",value:ce}),e.jsx(Ci,{label:"Phone Number",value:ft}),e.jsx(Ci,{label:"Email",value:Ve})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Primary Instructor"}),e.jsx("div",{className:"mt-2",children:e.jsx(Ci,{label:"Name",value:n.primaryInstructor||"Not Assigned"})})]}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Secondary Instructor"}),e.jsx("div",{className:"mt-2",children:e.jsx(Ci,{label:"Name",value:n.secondaryInstructor||"Not Assigned"})})]})]}),e.jsx(Ci,{label:"Status",value:n.isPaused?e.jsx("span",{className:"font-semibold text-amber-400",children:"Paused / NTSC"}):e.jsx("span",{className:"font-semibold text-green-400",children:"Active"})}),hn,e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-sky-400",children:"Logbook - Prior Experience (PC-21 only)"}),e.jsxs("div",{className:"space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 border-b border-gray-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-400 mb-2 text-center",children:"Day Flying"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(Ma,{label:"P1",value:xt.day.p1}),e.jsx(Ma,{label:"P2",value:xt.day.p2}),e.jsx(Ma,{label:"Dual",value:xt.day.dual})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-400 mb-2 text-center",children:"Night Flying"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(Ma,{label:"P1",value:xt.night.p1}),e.jsx(Ma,{label:"P2",value:xt.night.p2}),e.jsx(Ma,{label:"Dual",value:xt.night.dual})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 border-b border-gray-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-400 mb-2 text-center",children:"Totals"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(Ma,{label:"TOTAL",value:xt.total}),e.jsx(Ma,{label:"Captain",value:xt.captain}),e.jsx(Ma,{label:"Instructor",value:xt.instructor})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-400 mb-2 text-center",children:"Instrument"}),e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(Ma,{label:"Sim",value:xt.instrument.sim}),e.jsx(Ma,{label:"Actual",value:xt.instrument.actual})]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-bold text-gray-400 mb-2 text-center",children:"Simulator"}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(Ma,{label:"P1",value:xt.simulator.p1}),e.jsx(Ma,{label:"P2",value:xt.simulator.p2}),e.jsx(Ma,{label:"Dual",value:xt.simulator.dual}),e.jsx(Ma,{label:"Total",value:xt.simulator.total})]})]})]})]})]}),!R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(ly,{event:Ht,title:"Next Event",onNavigate:x,onCloseFlyout:t,reason:we}),e.jsx(ly,{event:We,title:"Next Event +1",onNavigate:x,onCloseFlyout:t,reason:Ht?"End of syllabus.":"Requires a valid Next Event."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(cy,{title:"Last Flight",date:kt==null?void 0:kt.date,daysSince:ht,eventCode:kt==null?void 0:kt.event}),e.jsx(cy,{title:"Last Event",date:Ge==null?void 0:Ge.date,daysSince:vt,eventCode:Ge==null?void 0:Ge.event})]})]}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Unavailability"}),e.jsx("div",{className:"mt-2 space-y-2 max-h-40 overflow-y-auto pr-2",children:xe.length>0?xe.map(Ce=>{let At="";const B=lh(Ce.startDate);if(Ce.allDay){const Ae=new Date(`${Ce.endDate}T00:00:00Z`);Ae.setUTCDate(Ae.getUTCDate()-1);const rt=Ae.toISOString().split("T")[0],yt=lh(rt);At=`${Ce.startDate===rt?B:`${B} to ${yt}`} @ All Day`}else{const Ae=lh(Ce.endDate),rt=Dt(Ce.startTime),yt=Dt(Ce.endTime);Ce.startDate===Ce.endDate?At=`${rt} ${B} - ${yt} ${Ae}`:At=`${rt} ${B} to ${yt} ${Ae}`}return e.jsx("div",{className:"p-2 bg-gray-700/50 rounded-md text-sm",children:e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-white",children:Ce.reason}),e.jsx("div",{className:"text-xs text-gray-300 mt-1 font-mono",children:At})]})})},Ce.id)}):e.jsx("p",{className:"text-sm text-gray-500 text-center italic",children:"No unavailability periods scheduled."})})]})]}),e.jsxs("div",{className:"w-56 flex-shrink-0 border-l border-gray-700 bg-gray-800/50 p-4 flex flex-col space-y-3",children:[!O&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>V(!0),className:`${St} bg-amber-600 text-white hover:bg-amber-700`,children:"Unavailability"}),e.jsx("button",{onClick:()=>{y(n),t()},className:`${St} btn-aluminium-brushed`,children:"Currency"}),e.jsx("button",{onClick:qt,className:`${St} btn-aluminium-brushed`,children:"PT-051"}),e.jsx("button",{onClick:Mn,className:`${St} btn-aluminium-brushed`,children:"View Individual LMP"}),e.jsx("button",{onClick:()=>u(n),className:`${St} btn-aluminium-brushed`,children:"Add Remedial Package"}),e.jsx("button",{onClick:()=>{_&&(_(n),t())},className:`${St} btn-aluminium-brushed`,children:"Logbook"})]}),e.jsx("div",{className:"flex-grow"})," ",O?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Kt,className:`${St} btn-aluminium-brushed`,children:"Save"}),e.jsx("button",{onClick:Mt,className:`${St} btn-aluminium-brushed`,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>W(!0),className:`${St} btn-aluminium-brushed`,children:"Edit"}),e.jsx("button",{onClick:t,className:`${St} bg-transparent border border-gray-600 text-gray-300 hover:bg-gray-700 hover:text-white`,children:"Close"})]})]})]})]})}),ne&&e.jsx(Mv,{onClose:()=>V(!1),onTodayOnly:je,onSave:$e,unavailabilityPeriods:n.unavailability||[],onRemove:Ye}),$&&e.jsx(gw,{traineeName:n.name,onAcknowledge:()=>{M(!1),D(!0)}}),U&&e.jsx(mw,{onConfirm:ot,onCancel:()=>D(!1)})]})},yw=({courseNumber:n,onConfirm:t,onClose:s})=>e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"text-xl font-bold text-green-400",children:"Restore Course"}),e.jsx("button",{onClick:s,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("p",{className:"text-gray-300",children:["Are you sure you want to restore ",e.jsxs("span",{className:"font-bold text-white",children:["ADF",n]})," to the active courses list?"]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>t(n),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm font-semibold",children:"Restore"}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Cancel"})]})]})}),lg=({events:n,position:t,personName:s,personType:i})=>{const o=l=>{const d=Math.floor(l),u=Math.round(l%1*60);return`${String(d).padStart(2,"0")}:${String(u).padStart(2,"0")}`};return e.jsxs("div",{style:{top:`${t.top}px`,left:`${t.left}px`},className:"fixed bg-gray-900 border border-sky-500 rounded-lg shadow-2xl z-[60] p-4 w-64 animate-fade-in","aria-live":"polite",children:[e.jsx("h3",{className:"text-lg font-bold text-sky-400 mb-2 border-b border-gray-700 pb-2",children:s}),n.length>0?e.jsx("ul",{className:"space-y-3",children:n.sort((l,d)=>l.startTime-d.startTime).map(l=>e.jsxs("li",{className:`p-2 rounded-md border-l-4 ${l.color.replace("bg-","border-")}`,children:[e.jsxs("div",{className:"flex justify-between items-center font-semibold text-sm",children:[e.jsxs("span",{children:[l.flightNumber,l.type==="ftd"&&e.jsx("span",{className:"text-indigo-400 font-bold",children:" (FTD)"})]}),e.jsx("span",{children:o(l.startTime)})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[e.jsxs("span",{children:[i==="Instructor"?"Student":"Instructor",": "]}),e.jsx("span",{children:i==="Instructor"?l.student:l.instructor})]})]},l.id))}):e.jsx("p",{className:"text-gray-400 text-sm",children:"No flights scheduled for today."})]})},bw=({isOpen:n,onClose:t,onConfirm:s,traineesData:i,courseColors:o})=>{const[l,d]=C.useState(""),[u,f]=C.useState(null),[h,m]=C.useState(""),[v,x]=C.useState("");if(!n)return null;const y=Object.keys(o).sort(),T=H=>{d(H),f(null),x("")},E=H=>{const O=i.find(W=>W.fullName===H);f(O||null),x("")},A=()=>{if(!l){x("Please select a course");return}if(!u){x("Please select a trainee");return}if(h!=="1111"){x("Incorrect PIN");return}s(u),d(""),f(null),m(""),x("")},_=()=>{d(""),f(null),m(""),x(""),t()},R=i.filter(H=>H.course===l);return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[70] flex items-center justify-center animate-fade-in",onClick:_,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:H=>H.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Delete Trainee"}),e.jsx("button",{onClick:_,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[v&&e.jsx("div",{className:"bg-red-900/50 border border-red-600 text-red-200 px-4 py-3 rounded-md text-sm",children:v}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Course *"}),e.jsxs("select",{value:l,onChange:H=>T(H.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"",children:"Select a course"}),y.map(H=>e.jsx("option",{value:H,children:H},H))]})]}),l&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Trainee *"}),e.jsxs("select",{value:(u==null?void 0:u.fullName)||"",onChange:H=>E(H.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"",children:"Select a trainee"}),R.map(H=>e.jsxs("option",{value:H.fullName,children:[H.rank," ",H.name]},H.fullName))]})]}),u&&e.jsxs("div",{className:"bg-red-900/30 border border-red-700 rounded-md p-3",children:[e.jsxs("p",{className:"text-red-200 text-sm",children:[e.jsx("strong",{children:"Warning:"})," You are about to delete ",e.jsxs("strong",{children:[u.rank," ",u.name]})," from ",e.jsx("strong",{children:l}),"."]}),e.jsx("p",{className:"text-red-200 text-sm mt-1",children:"This action cannot be undone."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"PIN *"}),e.jsx("input",{type:"password",value:h,onChange:H=>m(H.target.value),placeholder:"Enter PIN to confirm",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-sky-500"})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:_,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:!l||!u||!h,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Delete Trainee"})]})]})})},vw=()=>({idNumber:Math.floor(Math.random()*9e6)+1e6,fullName:"",name:"",rank:"PLTOFF",course:"",seatConfig:"Normal",isPaused:!1,unit:"1FTS",service:"RAAF",unavailability:[],permissions:["Trainee"],priorExperience:{day:{p1:0,p2:0,dual:0},night:{p1:0,p2:0,dual:0},total:0,captain:0,instructor:0,instrument:{sim:0,actual:0},simulator:{p1:0,p2:0,dual:0,total:0}}}),Nw=({events:n,traineesData:t,courseColors:s,archivedCourses:i,personnelData:o,onNavigateToHateSheet:l,onRestoreCourse:d,onUpdateTrainee:u,onAddTrainee:f,school:h,scores:m,syllabusDetails:v,onNavigateToSyllabus:x,onNavigateToCurrency:y,onViewIndividualLMP:T,onAddRemedialPackage:E,locations:A,units:_,selectedPersonForProfile:R,onProfileOpened:H,traineeLMPs:O,onViewLogbook:W,onDeleteTrainee:ne})=>{const[V,U]=C.useState("active"),[D,$]=C.useState(null),[M,P]=C.useState(!1),[ae,Q]=C.useState(null),[Te,Y]=C.useState(null),[fe,ge]=C.useState(null),[Ne,Oe]=C.useState(null),[se,F]=C.useState(""),[J,X]=C.useState(null),[ee,K]=C.useState(!1);C.useEffect(()=>{R&&($(R),P(!1),H&&H())},[R,H]);const ue=C.useMemo(()=>{const Ve={};t.forEach(Ke=>{Ve[Ke.course]||(Ve[Ke.course]=[]),Ve[Ke.course].push(Ke)});for(const Ke in Ve)Ve[Ke].sort((nt,Ct)=>nt.name.localeCompare(Ct.name));return Ve},[t]);C.useEffect(()=>{if(D&&!M){const Ve=t.find(Ke=>Ke.fullName===D.fullName);Ve&&JSON.stringify(Ve)!==JSON.stringify(D)&&$(Ve)}},[t,D,M]);const ye=Object.keys(s).sort((Ve,Ke)=>Ve.localeCompare(Ke)),Le=Object.keys(i).sort((Ve,Ke)=>Ve.localeCompare(Ke)),xe=V==="active"?ye:Le,pe=V==="active"?s:i,ce=Ve=>{d(Ve),Y(null)},He=()=>{Q(vw()),P(!0),$(null)},_e=Ve=>{ne(Ve),K(!1)},Z=(Ve,Ke)=>{const nt=Ve.currentTarget.getBoundingClientRect(),Ct=n.filter(xt=>xt.student===Ke||xt.flightType==="Solo"&&xt.pilot===Ke);ge({name:Ke.split(" – ")[0],events:Ct}),Oe({top:nt.top,left:nt.right+10})},Fe=()=>{ge(null),Oe(null)},Xe=Ve=>{if(Ve.isPaused)return"text-red-400 hover:text-red-300";const nt=(m.get(Ve.fullName)||[]).filter(Ct=>{const xt=v.find(dn=>dn.id===Ct.event);return xt&&(xt.type==="Flight"||xt.type==="FTD")&&!xt.isRemedial}).sort((Ct,xt)=>new Date(xt.date).getTime()-new Date(Ct.date).getTime());if(nt.length>0){const Ct=nt[0];if(Ct.score===0)return"text-amber-400 hover:text-amber-300";if(nt.length>=2){const xt=nt[1];if(Ct.score===1&&xt.score===1)return"text-amber-400 hover:text-amber-300"}}return"text-green-400 hover:text-green-300"},ft=({label:Ve,value:Ke})=>e.jsx("button",{onClick:()=>U(Ke),className:`px-4 py-2 text-sm font-semibold rounded-md transition-colors ${V===Ke?"bg-sky-600 text-white":"bg-gray-600 text-gray-300 hover:bg-gray-500"}`,children:Ve}),tt=D?O.get(D.fullName):void 0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Trainee Roster"}),e.jsxs("button",{onClick:He,className:"px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm font-semibold shadow-md flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Trainee"]}),e.jsxs("button",{onClick:()=>K(!0),className:"px-3 py-1.5 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold shadow-md flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Trainee"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ft,{label:"Active Courses",value:"active"}),e.jsx(ft,{label:"Archived Courses",value:"archived"}),e.jsx(Qa,{pageName:"Trainee Roster"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-4 md:p-6 max-w-7xl mx-auto",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6",children:xe.map(Ve=>{const Ke=ue[Ve]||[],nt=pe[Ve]||"bg-gray-500";return e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg flex flex-col overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:`px-4 py-2 text-white font-bold text-lg ${nt} flex justify-between items-center`,children:[e.jsxs("div",{children:[e.jsx("span",{children:Ve}),Ke.length>0&&e.jsx("span",{className:"ml-2 text-xs font-normal opacity-80",children:Ke[0].unit})]}),V==="archived"&&e.jsx("button",{onClick:()=>Y(Ve),className:"p-1 rounded-full bg-black/20 hover:bg-black/40 transition-colors","aria-label":`Restore course ${Ve}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:Ke.length>0?e.jsx("ul",{className:"space-y-2",children:Ke.map(Ct=>{const xt=Xe(Ct);return e.jsxs("li",{className:"flex items-center text-sm",onMouseEnter:dn=>Z(dn,Ct.fullName),onMouseLeave:Fe,children:[e.jsx("span",{className:"font-mono text-gray-500 w-16 flex-shrink-0",children:Ct.rank}),e.jsx("button",{onClick:()=>$(Ct),className:`truncate text-left ${xt} hover:underline focus:outline-none focus:ring-1 focus:ring-sky-500 rounded px-1`,children:Ct.name})]},Ct.fullName)})}):e.jsx("p",{className:"text-gray-500 text-sm italic text-center py-4",children:"No trainees assigned."})})]},Ve)})})})})]}),Te&&e.jsx(yw,{courseNumber:Te,onConfirm:ce,onClose:()=>Y(null)}),ee&&e.jsx(bw,{isOpen:ee,onClose:()=>K(!1),onConfirm:_e,traineesData:t,courseColors:s}),(D||M)&&e.jsx(xw,{trainee:M&&ae?ae:D,onClose:()=>{$(null),P(!1),Q(null)},onUpdateTrainee:M?f:u,events:n,school:h,onNavigateToHateSheet:l,onViewIndividualLMP:T,onAddRemedialPackage:E,personnelData:o,courseColors:s,scores:m,syllabusDetails:v,onNavigateToSyllabus:x,onNavigateToCurrency:y,locations:A,units:_,individualLmp:tt||[],onViewLogbook:W,isCreating:M,activeCourses:ye}),fe&&Ne&&e.jsx(lg,{events:fe.events,position:Ne,personName:fe.name,personType:"Trainee"})]})},ww=[{category:"Core Dimensions",elements:["Airmanship","Preparation","Technique"]},{category:"Procedural Framework",elements:["Pre-Post Flight","Walk Around","Strap-in","Ground Checks","Airborne Checks"]},{category:"Takeoff",elements:["Stationary"]},{category:"Departure",elements:["Visual"]},{category:"Core Handling Skills",elements:["Effects of Control","Trimming","Straight and Level"]},{category:"Turns",elements:["Level medium Turn","Level Steep turn"]},{category:"Recovery",elements:["Visual - Initial & Pitch"]},{category:"Landing",elements:["Landing","Crosswind"]},{category:"Domestics",elements:["Radio Comms","Situational Awareness","Lookout","Knowledge"]}],Sw=ww.flatMap(n=>n.elements),Cw=({trainee:n,lmpScores:t,assessments:s,pt051Events:i,userProfile:o,refreshEvents:l,onSelectLmpScore:d,onSelectPt051:u,onBackToRoster:f,onInsertPt051:h})=>{const[m,v]=C.useState(!1),[x,y]=C.useState(null),[T,E]=C.useState(i),A=Ua.useMemo(()=>{const U=t.map(M=>({...M,type:"LMP Score"})),D=s.map(M=>({...M,type:"PT-051"}));console.log("=== Building combinedHistory ==="),console.log("LMP Scores:",t.length,t),console.log("PT-051 Assessments:",s.length,s);const $=[...U,...D].sort((M,P)=>new Date(P.date).getTime()-new Date(M.date).getTime());return console.log("Combined History:",$.length,$),$},[t,s]),_=U=>{let D=null,$=!1;if(U.type==="LMP Score"?D=U.score:U.type==="PT-051"&&(D=U.overallGrade),D==null||D==="No Grade")return e.jsx("span",{className:"text-sm text-gray-500",children:"-"});if(D===1){console.log("Checking double marginal for:",U.type==="LMP Score"?U.event:U.flightNumber,"ID:",U.id,"on",U.date);const ae=A.findIndex(Q=>Q.id===U.id);if(ae>=0&&ae<A.length-1){const Q=A[ae+1],Te=Q.type==="LMP Score"?Q.score:Q.overallGrade;console.log("Previous item in timeline:",Q.type==="LMP Score"?Q.event:Q.flightNumber,"score:",Te,"type:",Q.type,"ID:",Q.id),Te===1&&($=!0,console.log("✅ DOUBLE MARGINAL DETECTED for",U.type==="LMP Score"?U.event:U.flightNumber,"ID:",U.id,"- consecutive with previous event"))}else console.log("No previous item found in timeline for",U.type==="LMP Score"?U.event:U.flightNumber)}if(U.type==="LMP Score"&&U.score===5)return e.jsx("span",{className:"text-green-300 text-sm font-semibold",children:"Complete"});const M=Number(D);let P="bg-gray-500/20 text-gray-300";return isNaN(M)||($?P="bg-red-500/20 text-red-300":M>=2?P="bg-green-500/20 text-green-300":M===1?P="bg-amber-500/20 text-amber-300":M===0&&(P="bg-red-500/20 text-red-300")),e.jsx("span",{className:`px-3 py-1 text-sm font-bold rounded-full ${P}`,children:D})},R=U=>{if(U.type==="LMP Score"){const D={id:`mock-${U.event}`,traineeFullName:n.fullName,eventId:`mock-event-${U.event}`,flightNumber:U.event,date:U.date,instructorName:U.instructor,overallGrade:U.score===5?"No Grade":U.score,overallResult:U.score===5?"P":null,dcoResult:U.score===5?"DCO":void 0,overallComments:U.notes,scores:Sw.map($=>({element:$,grade:null,comment:""}))};u(D)}else U.type==="PT-051"&&u(U)},H=U=>{console.log("🟢 DRAG STARTED - PT-051 drag initiated"),console.log("🟢 Drag event details:",U.type,U.currentTarget),v(!0),U.dataTransfer.effectAllowed="copy",U.dataTransfer.setData("text/plain","pt051-new"),setTimeout(()=>console.log("🟢 isDragging state:",m),100)},O=()=>{v(!1),y(null)},W=C.useCallback((U,D)=>{U.preventDefault(),U.dataTransfer.dropEffect="copy",y(D),console.log("⚡ INSTANT HIGHLIGHT - Row:",D)},[]),ne=C.useCallback(()=>{y(null),console.log("⚡ CLEARED HIGHLIGHT")},[]),V=(U,D)=>{U.preventDefault();let $="",M=D+1;if(M===0)$=new Date().toISOString().split("T")[0];else if(M>=A.length){const P=A[A.length-1];$=P?new Date(new Date(P.date).getTime()+864e5).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]}else{const P=A[D];$=P?P.date:new Date().toISOString().split("T")[0]}console.log("🎯 DROPPED PT-051 - Will insert after index:",D,"on date:",$),h(M,$),O()};return Ua.useEffect(()=>{console.log("🔍 DEBUG STATE - isDragging:",m,"highlightedIndex:",x)},[m,x]),e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Performance History"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[n.rank," ",n.name||n.fullName," - ",n.course]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold shadow-md",children:"← Back - Trainee Profile"}),e.jsx(Qa,{pageName:"Performance History"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 md:p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsxs("div",{draggable:!0,onDragStart:H,onDragEnd:O,className:`inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md cursor-move transition-all duration-200 hover:bg-green-700 hover:shadow-lg ${m?"opacity-50 scale-95":""}`,title:"Drag and drop to insert PT-051 assessment",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM2 7a2 2 0 012-2h12a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V7z"})}),e.jsx("span",{className:"font-semibold",children:"+ Insert PT-051"}),e.jsx("span",{className:"ml-2 text-xs opacity-75",children:"(drag to timeline)"})]})}),e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Event"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Overall Score"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Instructor"})]})}),e.jsx("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:A.length>0?A.map((U,D)=>e.jsxs("tr",{onClick:()=>R(U),className:`hover:bg-gray-700/50 transition-all duration-200 cursor-pointer ${x===D?"bg-yellow-500/30 border-2 border-yellow-400 shadow-lg shadow-yellow-400/50 animate-pulse":""}`,onDragOver:$=>W($,D),onDragLeave:ne,onDrop:$=>V($,D),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:U.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"font-semibold text-sky-400",children:U.type==="LMP Score"?U.event:U.flightNumber})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${U.type==="LMP Score"?"bg-blue-500/20 text-blue-300":"bg-green-500/20 text-green-300"}`,children:U.type})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:_(U)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:U.type==="LMP Score"?U.instructor:U.instructorName})]},D)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-10 text-gray-500",onDragOver:U=>{U.preventDefault(),console.log("🔶 DRAG OVER EMPTY STATE"),y(0)},onDragLeave:ne,onDrop:U=>V(U,0),children:"No performance records for this trainee."})})})]})})]})})]})},Tw=({trainee:n,scoreData:t,onBack:s})=>{const i=(o,l)=>{const d={"2-5":{text:"text-green-300",bg:"bg-green-500/20"},1:{text:"text-amber-300",bg:"bg-amber-500/20"},0:{text:"text-red-300",bg:"bg-red-500/20"}},u=o>=2?"2-5":o===1?"1":"0";return d[u][l]};return e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white",children:["Scoring Sheet: ",t.event]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[n.rank," ",n.name]})]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold shadow-md",children:"← Back to Summary"})]}),e.jsxs("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-4 border border-gray-700 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 uppercase",children:"Date"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:t.date})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 uppercase",children:"Instructor"}),e.jsx("p",{className:"text-lg font-semibold text-white truncate",children:t.instructor})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 uppercase",children:"Event"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:t.event})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 uppercase",children:"Overall Score"}),e.jsx("p",{className:`text-2xl font-bold ${i(t.score,"text")}`,children:t.score})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-4 border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-sky-400 mb-2",children:"Overall Notes"}),e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:t.notes})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden border border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-sky-400 p-4 bg-gray-700/30",children:"Detailed Breakdown"}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider w-1/3",children:"Criteria"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Score"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Comments"})]})}),e.jsx("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:t.details.map((o,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-300",children:o.criteria}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:`px-3 py-1 text-sm font-bold rounded-full ${i(o.score,"bg")} ${i(o.score,"text")}`,children:o.score})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-400",children:o.comment})]},l))})]})]})]})]})},Im=({correctPin:n,onConfirm:t,onCancel:s,title:i,message:o})=>{const[l,d]=C.useState(""),[u,f]=C.useState(""),h=m=>{m.preventDefault(),l===n?t():(f("Incorrect PIN. Please try again."),d(""))};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[80] flex items-center justify-center animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-xs border border-gray-700",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:i||"Enter PIN"})}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("label",{htmlFor:"pin-input",className:"block text-sm font-medium text-gray-400",children:o||"Please enter your PIN to continue."}),e.jsx("input",{id:"pin-input",type:"text",value:l,onChange:m=>{d(m.target.value),f("")},maxLength:4,autoFocus:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white text-center text-2xl tracking-[.5em] focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"}),u&&e.jsx("p",{className:"text-red-400 text-sm text-center",children:u})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"Submit"})]})]})]})})},jw=({eventId:n,eventType:t,onConfirm:s,onClose:i,cancellationCodes:o})=>{const[l,d]=C.useState(""),[u,f]=C.useState(""),[h,m]=C.useState(!1),[v,x]=C.useState(""),y=o.filter(O=>O.isActive&&(O.appliesTo==="Both"||t==="flight"&&O.appliesTo==="Flight"||t==="ftd"&&O.appliesTo==="FTD")),T=[{code:"",label:"-- Select Cancellation Code --"},...y.map(O=>({code:O.code,label:`${O.code} - ${O.description}`})),{code:"UNKNOWN",label:"UNKNOWN"},{code:"OTHER",label:"OTHER (Manual Entry)"}],E=O=>{d(O),x(""),O!=="OTHER"&&f("")},A=()=>{if(!l){x("Please select a cancellation code.");return}if(l==="OTHER"&&!u.trim()){x("Please enter a manual code.");return}if(l==="OTHER"&&u.trim().length>4){x("Manual code must be 4 characters or less.");return}m(!0)},_=()=>{const O=l==="OTHER"?u.toUpperCase().trim():l;s(n,l,l==="OTHER"?O:void 0)},R=()=>{m(!1)},H=l&&(l!=="OTHER"||u.trim());return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[80] flex items-center justify-center animate-fade-in",onClick:i,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-red-500/50",onClick:O=>O.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-red-900/20 flex items-center space-x-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{className:"text-xl font-bold text-red-400",children:"Cancel Event"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-gray-300",children:["You are about to cancel this ",t==="flight"?"Flight":"FTD"," event. This action will move the event to the STBY line with a red cross."]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"cancellation-code",className:"block text-sm font-medium text-gray-400 mb-2",children:["Cancellation Code ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("select",{id:"cancellation-code",value:l,onChange:O=>E(O.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-red-500 focus:border-red-500",children:T.map(O=>e.jsx("option",{value:O.code,children:O.label},O.code))})]}),l==="OTHER"&&e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"manual-code",className:"block text-sm font-medium text-gray-400 mb-2",children:["Enter Code ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{id:"manual-code",type:"text",value:u,onChange:O=>{f(O.target.value.toUpperCase()),x("")},maxLength:4,placeholder:"Enter code (max 4 chars)",className:"w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-red-500 focus:border-red-500"})]}),v&&e.jsx("div",{className:"bg-red-900/30 border border-red-500/50 rounded-md p-3",children:e.jsx("p",{className:"text-red-400 text-sm",children:v})}),e.jsx("div",{className:"bg-gray-700/30 border border-gray-600 rounded-md p-3",children:e.jsxs("p",{className:"text-gray-400 text-sm",children:[e.jsx("strong",{className:"text-white",children:"Note:"})," After selecting a cancellation code, you will be prompted to enter your PIN to complete the cancellation."]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:!H,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold disabled:bg-gray-600 disabled:cursor-not-allowed",children:"Proceed to PIN"})]})]})}),h&&e.jsx(Im,{correctPin:"1111",onConfirm:_,onCancel:R,title:"Confirm Cancellation",message:"Enter your PIN to confirm event cancellation."})]})},Ew=({isOpen:n,onClose:t,event:s,trainees:i,onConfirm:o})=>{const[l,d]=C.useState(new Set);Ua.useEffect(()=>{if(console.log("🔍 MassBriefCompleteFlyout - isOpen:",n),console.log("🔍 MassBriefCompleteFlyout - trainees:",i),console.log("🔍 MassBriefCompleteFlyout - trainees.length:",i.length),n&&i.length>0){console.log("🔍 MassBriefCompleteFlyout - Trainee details:"),i.forEach((v,x)=>{console.log(`  ${x}:`,v),console.log(`    Name: ${v.name}`),console.log(`    FullName: ${v.fullName}`),console.log(`    ID: ${v.idNumber}`),console.log(`    Rank: ${v.rank}`)});const m=i.map(v=>v.fullName);console.log("🔍 MassBriefCompleteFlyout - traineeFullNames:",m),d(new Set(m))}},[n,i]);const u=m=>{const v=new Set(l);v.has(m)?v.delete(m):v.add(m),d(v)},f=()=>{const m=i.filter(v=>l.has(v.fullName));o(m),t()},h=()=>{l.size===i.length?d(new Set):d(new Set(i.map(m=>m.fullName)))};return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4",children:["Complete Mass Brief: ",s.flightNumber]}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Confirm which trainees completed this event:"}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:h,className:"text-sky-400 hover:text-sky-300 text-sm mb-2",children:l.size===i.length?"Deselect All":"Select All"})}),e.jsx("div",{className:"space-y-2 mb-6",children:i.length===0?e.jsx("div",{className:"text-yellow-400 text-center py-4",children:"No trainees found for this event."}):i.map(m=>{console.log("🔍 Rendering trainee:",m),console.log("🔍 Trainee details:",{fullName:m.fullName,name:m.name,rank:m.rank,idNumber:m.idNumber});const v=m.fullName||(m.rank&&m.name?`${m.rank} ${m.name}`:m.name)||"Unknown Trainee";return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",id:`trainee-${m.fullName||m.idNumber||m.id}`,checked:l.has(m.fullName),onChange:()=>u(m.fullName),className:"w-4 h-4 text-sky-600 bg-gray-700 border-gray-600 rounded focus:ring-sky-500"}),e.jsx("label",{htmlFor:`trainee-${m.fullName||m.idNumber||m.id}`,className:"text-white flex-1 cursor-pointer",children:v})]},m.fullName||m.idNumber||m.id)})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:f,disabled:l.size===0,className:"flex-1 px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-sm font-semibold",children:["Confirm Complete (",l.size,")"]}),e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm font-semibold",children:"Cancel"})]})]})}):null},Aw=({isOpen:n,onClose:t,event:s,confirmedTrainees:i})=>n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4 max-h-96 overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Mass Brief Completed!"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-gray-300 mb-3",children:[e.jsx("strong",{children:s.flightNumber})," has been marked complete for:"]}),e.jsx("div",{className:"space-y-2 mb-4",children:i.map(o=>e.jsxs("div",{className:"flex items-center space-x-3 bg-gray-700/50 p-3 rounded-lg",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-white font-medium",children:[o.rank," ",o.name]}),e.jsx("p",{className:"text-green-400 text-sm",children:"DCO status set in PT-051"})]})]},o.fullName))})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-sm font-semibold",children:"OK"})})]})}):null,uy=n=>{const t=Math.floor(n),s=Math.round((n-t)*60);return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},kw=({event:n,startTime:t,endTime:s,onContinue:i,onClose:o})=>e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl border border-gray-700 transform transition-all animate-fade-in p-4 w-64",children:[e.jsx("h3",{className:"text-sm font-bold text-white mb-3",children:"Visual Adjust"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-1",children:"Start Time"}),e.jsx("div",{className:"px-2 py-1 bg-gray-700 text-white rounded text-sm",children:uy(t)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-300 mb-1",children:"End Time"}),e.jsx("div",{className:"px-2 py-1 bg-gray-700 text-white rounded text-sm",children:uy(s)})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:o,className:"px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:i,className:"px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700 transition-colors",children:"Continue"})]})]})}),Dw=(n,t)=>{const s=t.find(i=>i.id===n);return s?s.type==="FTD"?"ftd":s.type==="Ground School"?"ground":"flight":n.includes("FTD")?"ftd":n.includes("CPT")||n.includes("MB")||n.includes("TUT")||n.includes("QUIZ")?"ground":"flight"},Q0=n=>{const t=Math.floor(n),s=Math.round(n%1*60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`},_w=n=>{if(!n)return 0;const[t,s]=n.split(":").map(Number);return isNaN(t)||isNaN(s)?0:t+s/60},Iw=({event:n,onClose:t,onSave:s,onDeleteRequest:i,isEditingDefault:o=!1,instructors:l,trainees:d,syllabus:u,syllabusDetails:f,highlightedField:h,school:m,traineesData:v,instructorsData:x,courseColors:y,onNavigateToHateSheet:T,onNavigateToSyllabus:E,onOpenPt051:A,onOpenAuth:_,onOpenPostFlight:R,isConflict:H,onNeoClick:O,traineeLMPs:W,oracleContextForModal:ne,sctRequests:V=[],sctEvents:U=[],eventsForDate:D=[],onScoresCreated:$,publishedSchedules:M={},nextDayBuildEvents:P=[],activeView:ae="",isAddingTile:Q=!1,formationCallsigns:Te=[],currentLocation:Y="",onVisualAdjustStart:fe,onVisualAdjustEnd:ge,onSavePT051Assessment:Ne,cancellationCodes:Oe=[],onCancelEvent:se})=>{var Vr,li,Mi,Qr,Fi;console.log("EventDetailModal opened - isAddingTile:",Q),console.log("Event data:",{eventCategory:n.eventCategory,flightType:n.flightType,instructor:n.instructor,student:n.student,pilot:n.pilot,isSct:n.isSct});const[F,J]=C.useState(o),[X,ee]=C.useState(h),[K,ue]=C.useState(!1),[ye,Le]=C.useState(!1),[xe,pe]=C.useState(!1),[ce,He]=C.useState([]),[_e,Z]=C.useState(n.eventCategory||"lmp_event"),[Fe,Xe]=C.useState(n.flightNumber),[ft,tt]=C.useState(n.duration),[Ve,Ke]=C.useState(n.type),[nt,Ct]=C.useState(typeof n.startTime=="string"?n.startTime:Q0(n.startTime)),[xt,dn]=C.useState(n.area||"A"),[on,st]=C.useState(n.aircraftNumber||"001"),[kt,Ge]=C.useState(1),[ht,vt]=C.useState(!1),[Ht,We]=C.useState(n.startTime),[we,Re]=C.useState(n.startTime+n.duration);C.useEffect(()=>{ht&&(We(n.startTime),Re(n.startTime+n.duration))},[n.startTime,n.duration,ht]);const[be,Ze]=C.useState([{flightType:n.flightType,instructor:n.instructor||"",student:n.student||"",pilot:n.pilot||"",group:n.group||"",groupTraineeIds:n.groupTraineeIds||[]}]);console.log("Initial crew state:",be);const ot=(ke,mt)=>{if(console.log(`ud83dudcdd [getDualSoloFromIndividualLMP] Called with flightNumber: ${ke}, traineeName: ${mt}`),console.log(`ud83dudcdd [getDualSoloFromIndividualLMP] traineeLMPs available: ${!!W}, traineeLMPs size: ${(W==null?void 0:W.size)||0}`),!W||!mt)return console.log("ud83dudcdd [getDualSoloFromIndividualLMP] Returning 'Dual' - missing traineeLMPs or traineeName"),"Dual";const nn=W.get(mt);if(console.log(`ud83dudcdd [getDualSoloFromIndividualLMP] individualLMP found for ${mt}:`,!!nn,nn?nn.length:0,"items"),!nn)return console.log(`ud83dudcdd [getDualSoloFromIndividualLMP] Returning 'Dual' - no Individual LMP found for ${mt}`),"Dual";const Yt=nn.find(an=>an.id===ke||an.code===ke);return console.log(`ud83dudcdd [getDualSoloFromIndividualLMP] Searching for flightNumber: ${ke}, found item:`,!!Yt),Yt&&console.log("ud83dudcdd [getDualSoloFromIndividualLMP] Found syllabus item:",{id:Yt.id,code:Yt.code,sortieType:Yt.sortieType}),Yt&&Yt.sortieType?(console.log(`ud83cudfaf [Dual/Solo] Found ${Yt.sortieType} for ${mt} - ${ke}`),Yt.sortieType):(console.log(`ud83dudcdd [getDualSoloFromIndividualLMP] Returning 'Dual' - no sortieType found for ${ke}`),"Dual")},Vt=()=>{var ke,mt,nn;if(((ke=be[0])==null?void 0:ke.flightType)==="Solo"){const Yt=((mt=be[0])==null?void 0:mt.student)||((nn=be[0])==null?void 0:nn.pilot);Yt&&(Ze(an=>{const en=[...an];return en.length>0&&(en[0]={...en[0],pilot:Yt,instructor:""}),en}),console.log(`✈️ [Solo Logic] Applied: ${Yt} as PIC, flightType set to Solo`))}},[Pt,yn]=C.useState(n.locationType||"Local"),[Tt,lt]=C.useState(n.origin||m),[Et,Bt]=C.useState(n.destination||m),[Kt,Mt]=C.useState(n.formationType||""),[ze,qt]=C.useState(n.isDeploy||!1),[Mn,jn]=C.useState(""),[je,$e]=C.useState(n.deploymentStartDate||n.date),[Ye,Dt]=C.useState(n.deploymentStartTime||""),[St,hn]=C.useState(n.deploymentEndDate||n.date),[Ce,At]=C.useState(n.deploymentEndTime||""),[B,Ae]=C.useState(n.deploymentAircraftCount||1),[rt,yt]=C.useState(null),et=C.useRef(null),[$t,pn]=C.useState(!1),kn=!!ne,ts=(ne==null?void 0:ne.availableInstructors)||l,un=ne?ne.availableTraineesAnalysis.map(ke=>ke.trainee.fullName):d,[Nn,os]=C.useState(kn?[]:u),ss=C.useMemo(()=>{let ke=[];return _e==="sct"?ke=U:_e==="lmp_event"||_e==="lmp_currency"?ke=f.filter(mt=>mt.lmpType==="Master LMP"||!mt.lmpType).map(mt=>mt.id):_e==="staff_cat"?ke=f.filter(mt=>mt.lmpType==="Staff CAT").map(mt=>mt.id):_e==="twr_di"?ke=f.map(mt=>mt.id):ke=Nn,Q&&!ke.includes("SCT FORM")&&(ke=[...ke,"SCT FORM"]),ke},[_e,U,f,Nn,Q]),Hn=C.useMemo(()=>{const ke=new Set(v.map(Cn=>Cn.fullName)),Yt=ts.filter(Cn=>!ke.has(Cn)).map(Cn=>{const Vn=x.find(xn=>xn.name===Cn);return{name:Cn,unit:(Vn==null?void 0:Vn.unit)||"Unknown",rank:(Vn==null?void 0:Vn.rank)||"FLGOFF"}}).reduce((Cn,Vn)=>(Cn[Vn.unit]||(Cn[Vn.unit]=[]),Cn[Vn.unit].push(Vn),Cn),{}),an=["WGCDR","SQNLDR","FLTLT","FLGOFF","PLTOFF"],en=Object.keys(Yt).sort((Cn,Vn)=>{const xn=Math.min(...Yt[Cn].map(Es=>an.indexOf(Es.rank))),ls=Math.min(...Yt[Vn].map(Es=>an.indexOf(Es.rank)));return xn-ls});return{grouped:Yt,sortedUnits:en}},[ts,v,x]),Jn=C.useMemo(()=>{const mt=un.map(Yt=>{const an=v.find(en=>en.name===Yt||en.fullName===Yt);return{name:Yt,course:(an==null?void 0:an.course)||"Unknown"}}).reduce((Yt,an)=>(Yt[an.course]||(Yt[an.course]=[]),Yt[an.course].push(an),Yt),{}),nn=Object.keys(mt).sort();return{grouped:mt,sortedCourses:nn}},[un,v]),zn=C.useMemo(()=>{const ke={};return[...ts,...un].forEach(mt=>{const nn=x.find(an=>an.name===mt),Yt=v.find(an=>an.name===mt||an.fullName===mt);ke[mt]={name:mt,rank:(nn==null?void 0:nn.rank)||(Yt==null?void 0:Yt.rank)||"",flightCount:0,ftdCount:0,cptCount:0,groundCount:0,startTime:""}}),D.forEach(mt=>{var Yt,an;if((Yt=mt.resourceId)!=null&&Yt.startsWith("STBY")||(an=mt.resourceId)!=null&&an.startsWith("BNF-STBY")||mt.type==="deployment")return;const nn=new Set;mt.instructor&&nn.add(mt.instructor),mt.student&&nn.add(mt.student),mt.groupTraineeIds&&mt.groupTraineeIds.length>0&&mt.groupTraineeIds.forEach(en=>{const Cn=v.find(Vn=>Vn.idNumber===en);Cn&&nn.add(Cn.name)}),nn.forEach(en=>{if(ke[en]){mt.type==="flight"?ke[en].flightCount++:mt.type==="ftd"?ke[en].ftdCount++:mt.type==="cpt"?ke[en].cptCount++:mt.type==="ground"&&ke[en].groundCount++;const Cn=f.find(ls=>ls.id===mt.flightNumber),Vn=(Cn==null?void 0:Cn.preFlightTime)||0,xn=mt.startTime-Vn;if(!ke[en].startTime||xn<parseFloat(ke[en].startTime.replace(":","."))){const ls=Math.floor(xn),Es=Math.round(xn%1*60);ke[en].startTime=`${String(ls).padStart(2,"0")}${String(Es).padStart(2,"0")}`}}})}),ke},[D,ts,un,x,v,f]),Fn=(ke,mt,nn="Instructor",Yt=!1,an=!1)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:nn}),e.jsxs("select",{value:ke,onChange:en=>mt(en.target.value),disabled:Yt,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed appearance-none cursor-pointer z-10 ",children:[e.jsxs("option",{value:"",disabled:!0,children:["Select ",nn.toLowerCase()]}),Hn.sortedUnits.map(en=>e.jsx("optgroup",{label:`─── ${en} ───`,children:Hn.grouped[en].map(Cn=>{const xn=`${(zn[Cn.name]||{rank:""}).rank} ${Cn.name}`;return e.jsx("option",{value:Cn.name,children:xn},Cn.name)})},en)),an&&e.jsx("optgroup",{label:"─── Other ───",children:e.jsx("option",{value:"PAX",children:"PAX"})})]})]}),Rn=(ke,mt,nn=!1,Yt=!1)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Trainee"}),e.jsxs("select",{value:ke,onChange:an=>mt(an.target.value),disabled:nn,className:`mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm transition-all duration-200 disabled:bg-gray-700/50 disabled:cursor-not-allowed ${Yt?"ring-2 ring-red-500":""}`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a trainee"}),Jn.sortedCourses.map(an=>e.jsx("optgroup",{label:`─── ${an} ───`,children:Jn.grouped[an].map(en=>{const Cn=v.find(ls=>ls.name===en.name||ls.fullName===en.name),xn=`${(zn[en.name]||{rank:""}).rank} ${(Cn==null?void 0:Cn.name)||en.name}`;return e.jsx("option",{value:en.name,children:xn},en.name)})},an))]})]});C.useEffect(()=>{var ke,mt;if(Q&&Fe&&be[0]){const nn=((ke=be[0])==null?void 0:ke.student)||((mt=be[0])==null?void 0:mt.pilot);if(nn&&W){const Yt=ot(Fe,nn);be[0].flightType!==Yt&&(Ze(an=>{const en=[...an];return en.length>0&&(en[0]={...en[0],flightType:Yt}),en}),console.log(`🎯 [Auto Dual/Solo] Set to ${Yt} from Individual LMP for ${nn}`))}}},[Q,Fe,W]),C.useEffect(()=>{var ke,mt,nn;if(((ke=be[0])==null?void 0:ke.flightType)==="Solo"){const Yt=((mt=be[0])==null?void 0:mt.student)||((nn=be[0])==null?void 0:nn.pilot);Yt&&be[0].pilot!==Yt&&Vt()}},[(Vr=be[0])==null?void 0:Vr.flightType,(li=be[0])==null?void 0:li.student,(Mi=be[0])==null?void 0:Mi.pilot]),C.useEffect(()=>{_e==="sct"?(Ze(ke=>ke.map(mt=>({...mt,flightType:"Solo"}))),ft||tt(1.2)):_e==="lmp_event"||_e==="lmp_currency"||_e==="staff_cat"?ft||tt(1.2):_e==="twr_di"&&(Ze(ke=>ke.map(mt=>({...mt,flightType:"Solo"}))),ft||tt(1.2),(Q||!n.startTime||n.startTime===0)&&Ct("08:00"))},[_e]),C.useEffect(()=>{if(Fe&&(_e==="lmp_event"||_e==="lmp_currency"||_e==="staff_cat"||_e==="twr_di")){const ke=f.find(mt=>mt.id===Fe);ke&&ke.flightType&&Ze(mt=>mt.map(nn=>({...nn,flightType:ke.flightType})))}},[Fe,_e,f]),C.useEffect(()=>{var ke,mt;if((Q||o&&(!n.id||n.id.startsWith("2d1b6a22")))&&(console.log(`📝 [Flight Number Change] isAddingTile: ${Q}, isEditingDefault: ${o}, event.id: ${n.id}, flightNumber: ${Fe}`),Fe&&be[0]&&W)){const nn=((ke=be[0])==null?void 0:ke.student)||((mt=be[0])==null?void 0:mt.pilot);if(nn){console.log(`📝 [Flight Number Change] Using selected trainee: ${nn}`);const Yt=ot(Fe,nn);be[0].flightType!==Yt&&(Ze(an=>{const en=[...an];return en.length>0&&(en[0]={...en[0],flightType:Yt}),en}),console.log(`🎯 [Auto Dual/Solo] Set to ${Yt} from Individual LMP for selected trainee ${nn}`))}else{console.log(`📝 [Flight Number Change] No pilot selected - searching for default from any trainee with LMP ${Fe}`);let Yt="Dual",an="";for(const[en,Cn]of W.entries()){const Vn=Cn.find(xn=>xn.id===Fe||xn.code===Fe);if(Vn&&Vn.sortieType){Yt=Vn.sortieType,an=en,console.log(`📝 [Flight Number Change] Found default ${Yt} from ${an}'s Individual LMP`);break}}be[0].flightType!==Yt&&(Ze(en=>{const Cn=[...en];return Cn.length>0&&(Cn[0]={...Cn[0],flightType:Yt}),Cn}),console.log(`🎯 [Auto Dual/Solo] Set to ${Yt} as default from ${an||"system"} for LMP ${Fe}`))}}},[Fe,W,Q,o,n.id]),C.useEffect(()=>{var ke,mt;if((Q||o&&(!n.id||n.id.startsWith("2d1b6a22")))&&Fe&&be[0]&&W){const nn=((ke=be[0])==null?void 0:ke.student)||((mt=be[0])==null?void 0:mt.pilot);if(nn){const Yt=ot(Fe,nn);be[0].flightType!==Yt&&(Ze(an=>{const en=[...an];return en.length>0&&(en[0]={...en[0],flightType:Yt}),en}),console.log(`🎯 [Trainee Change] Updated to ${Yt} from Individual LMP for selected trainee ${nn}`))}}},[(Qr=be[0])==null?void 0:Qr.student,(Fi=be[0])==null?void 0:Fi.pilot,Fe,W,Q,o,n.id]);const Qn=C.useMemo(()=>{if(Te&&Te.length>0&&Y){const ke=Te.filter(mt=>mt.location===Y);return ke.length>0?ke:null}return null},[Te,Y]),as=C.useMemo(()=>Qn?Qn.map(ke=>ke.code):m==="ESL"?["MERL","VANG"]:["COBR","HAWK"],[Qn,m]),cs=["A","B","C","D","E","F","G","H","S","T","U","V","W","X","Y","Z"],rs=C.useMemo(()=>Object.keys(y).sort(),[y]),Ms=C.useMemo(()=>rs.map(ke=>({name:ke,trainees:v.filter(mt=>mt.course===ke).sort((mt,nn)=>mt.name.localeCompare(nn.name))})),[rs,v]),hs=C.useMemo(()=>Ve==="flight"?"Flight Details":Ve==="ftd"?"FTD Session Details":"Ground Event Details",[Ve]);C.useEffect(()=>{Xe(n.flightNumber),o&&!n.flightNumber?tt(""):tt(n.duration),Ke(n.type),Ct(typeof n.startTime=="string"?n.startTime:Q0(n.startTime)),dn(n.area||"A"),st(n.aircraftNumber||"001"),Ge(1),Ze([{flightType:n.flightType,instructor:n.instructor||"",student:n.student||"",pilot:n.pilot||"",group:n.group||"",groupTraineeIds:n.groupTraineeIds||[]}]),J(o),ee(h),yn(n.locationType||"Local"),lt(n.origin||m),Bt(n.destination||m),Mt(n.formationType||as[0]),qt(n.isDeploy||!1),$e(n.deploymentStartDate||n.date),Dt(n.deploymentStartTime||""),hn(n.deploymentEndDate||n.date),At(n.deploymentEndTime||"")},[n,o,h,m]),C.useEffect(()=>{Pt==="Local"&&(lt(m),Bt(m))},[Pt,m]),C.useEffect(()=>{const ke=Fe==="SCT FORM",mt=ke?kt:1;if(be.length!==mt){const nn=Array.from({length:mt},(Yt,an)=>{const en=ke&&_e==="sct"?"Solo":"Dual";return be[an]||{flightType:en,instructor:"",student:"",pilot:"",group:"",groupTraineeIds:[]}});Ze(nn)}},[kt,Fe,be,_e]),C.useEffect(()=>{Ke(Dw(Fe,f))},[Fe,f]);const _n=()=>{const ke=[];if(["Program Schedule","DailyFlyingProgram","InstructorSchedule","TraineeSchedule"].includes(ae))Object.values(M).forEach(nn=>{const Yt=nn.filter(an=>an.type==="deployment");ke.push(...Yt)});else if(["NextDayBuild","Priorities","ProgramData","NextDayInstructorSchedule","NextDayTraineeSchedule"].includes(ae)){const nn=P.filter(Yt=>Yt.type==="deployment");ke.push(...nn)}return ke.filter(nn=>{var Yt,an,en,Cn;return Ve==="flight"?((Yt=nn.resourceId)==null?void 0:Yt.startsWith("PC-21"))||((an=nn.resourceId)==null?void 0:an.startsWith("Deployed")):Ve==="ftd"?(en=nn.resourceId)==null?void 0:en.startsWith("FTD"):Ve==="cpt"?(Cn=nn.resourceId)==null?void 0:Cn.startsWith("CPT"):!1})},rr=ke=>{const mt=Vn=>{const xn=Math.floor(Vn),ls=Math.round((Vn-xn)*60);return`${xn.toString().padStart(2,"0")}${ls.toString().padStart(2,"0")}`},nn=ke.date||"",Yt=ke.deploymentEndDate||nn,an=Vn=>{if(!Vn)return"";const xn=new Date(Vn),ls=xn.getDate().toString().padStart(2,"0"),Es=xn.toLocaleDateString("en-US",{month:"short"}),Zs=xn.getFullYear().toString().slice(-2);return`${ls}${Es}${Zs}`},en=mt(ke.startTime||0),Cn=mt((ke.startTime||0)+(ke.duration||0));return`${en}${an(nn)}–${Cn}${an(Yt)}`};C.useEffect(()=>{var nn,Yt;const ke=(nn=be[0])==null?void 0:nn.student,mt=(Yt=be[0])==null?void 0:Yt.instructor;if(ke){if(kn&&(ne!=null&&ne.availableTraineesAnalysis)){const an=ne.availableTraineesAnalysis.find(en=>en.trainee.fullName===ke);if(an&&an.nextSyllabusEvent){const en=an.nextSyllabusEvent.id;os([en]),Xe(en),tt(an.nextSyllabusEvent.duration);return}}os(u);return}if(kn&&mt){const an=V.filter(en=>en.name===mt);if(an.length>0){const en=an.map(Vn=>Vn.event);os(en),Xe(en[0]);const Cn=f.find(Vn=>Vn.id===en[0]);Cn&&tt(Cn.duration)}else os([]),Xe("");return}os(kn?[]:u),!n.flightNumber&&kn&&Xe("")},[be,kn,ne,V,u,f,n.flightNumber]),C.useEffect(()=>{const ke=mt=>{et.current&&!et.current.contains(mt.target)&&yt(null)};return document.addEventListener("mousedown",ke),()=>document.removeEventListener("mousedown",ke)},[]),C.useMemo(()=>[...l,...d].sort(),[l,d]);const Cs=(ke,mt,nn)=>{const Yt=[...be],an={...Yt[ke]};if(mt==="flightType"){const en=nn;an.flightType=en,en==="Solo"?(an.instructor="",an.student="",an.group="",an.groupTraineeIds=[]):an.pilot=""}else an[mt]=nn;Yt[ke]=an,Ze(Yt),ee(null)},js=(ke,mt)=>{const nn=be[ke],Yt=new Set(nn.groupTraineeIds||[]);Yt.has(mt)?Yt.delete(mt):Yt.add(mt);const an=Array.from(Yt),en=an.length>0?`${an.length} Trainees Selected`:"",Cn=[...be];Cn[ke]={...nn,groupTraineeIds:an,group:en},Ze(Cn)},Cr=(ke,mt)=>{const nn=be[ke],Yt=new Set(nn.groupTraineeIds||[]),an=mt.map(ls=>ls.idNumber);an.every(ls=>Yt.has(ls))?an.forEach(ls=>Yt.delete(ls)):an.forEach(ls=>Yt.add(ls));const Cn=Array.from(Yt),Vn=Cn.length>0?`${Cn.length} Trainees Selected`:"",xn=[...be];xn[ke]={...nn,groupTraineeIds:Cn,group:Vn},Ze(xn)},Fs=ke=>{const mt=ke.target.value;Xe(mt);const nn=f.find(Yt=>Yt.id===mt);nn&&tt(nn.duration),console.log("Flight number changed to:",mt),mt==="SCT FORM"&&!Kt&&Mt(as[0]),mt==="SCT FORM"&&_e==="sct"?(Ge(2),Ze(be.map(Yt=>({...Yt,flightType:"Solo"})))):mt!=="SCT FORM"&&Ge(1)},Ds=ke=>{if(!ke)return 0;if(ke.includes(":")){const[mt,nn]=ke.split(":").map(Number);return(mt||0)+(nn||0)/60}else{const mt=parseInt(ke.substring(0,2))||0,nn=parseInt(ke.substring(2,4))||0;return mt+nn/60}},Js=()=>{console.log("Visual Adjust clicked"),fe&&fe(n),vt(!0)},sa=()=>{vt(!1);const ke={...n,startTime:Ht,duration:we-Ht};ge&&ge(ke),Ct(Q0(Ht)),tt(we-Ht)},to=()=>{const ke=be.map((mt,nn)=>{let Yt=n.color;const an=mt.student||mt.pilot;if(an){const xn=v.find(ls=>ls.fullName===an);xn&&y[xn.course]&&(Yt=y[xn.course])}let en=n.resourceId;if(Mn){const xn=_n().find(ls=>ls.id===Mn);xn&&(en=xn.resourceId,console.log(`Assigning event to deployment: ${xn.id} (${en})`))}const Cn=Fe==="SCT FORM"&&be.length>1?`${n.id}-${nn}-${Date.now()}`:n.id;Fe==="SCT FORM"&&be.length>1&&(en="");const Vn={...n,id:Cn,type:Ve,flightNumber:Fe,startTime:typeof nt=="string"?_w(nt):nt,resourceId:en,duration:typeof ft=="number"?ft:0,area:Ve==="flight"?xt:void 0,aircraftNumber:Ve==="flight"?on:void 0,color:Yt,flightType:mt.flightType,instructor:mt.instructor,student:mt.student,pilot:mt.pilot,group:mt.group,groupTraineeIds:mt.groupTraineeIds,locationType:Pt,origin:Pt==="Local"?m:Tt,destination:Pt==="Local"?m:Et,formationType:Fe==="SCT FORM"?Kt:void 0,formationPosition:Fe==="SCT FORM"?nn+1:void 0,callsign:Fe==="SCT FORM"?`${Kt}${nn+1}`:void 0,formationId:void 0,isDeploy:Ve==="flight"&&Pt==="Land Away"?ze:void 0,deploymentStartDate:Ve==="flight"&&Pt==="Land Away"&&ze?je:void 0,deploymentStartTime:Ve==="flight"&&Pt==="Land Away"&&ze?Ye:void 0,deploymentEndDate:Ve==="flight"&&Pt==="Land Away"&&ze?St:void 0,deploymentEndTime:Ve==="flight"&&Pt==="Land Away"&&ze?Ce:void 0,deploymentAircraftCount:Ve==="flight"&&Pt==="Land Away"&&ze?B:void 0,eventCategory:_e};return _e==="sct"&&console.log("💾 Saving SCT event:",{id:Vn.id,flightType:Vn.flightType,pilot:Vn.pilot,student:Vn.student,instructor:Vn.instructor,eventCategory:Vn.eventCategory,crewData:mt,allCrew:be}),Vn});if(console.log("Deployment Check:",{eventType:Ve,locationType:Pt,isDeploy:ze,deploymentStartDate:je,deploymentStartTime:Ye,deploymentEndDate:St,deploymentEndTime:Ce}),Ve==="flight"&&Pt==="Land Away"&&ze&&je&&Ye&&St&&Ce){console.log("Creating deployment tile...");const mt=Ds(Ye),nn=Ds(Ce),Yt=new Date(je),an=new Date(St);let Cn=Math.floor((an.getTime()-Yt.getTime())/(1e3*60*60*24))*24+(nn-mt);Cn<=0&&(Cn=1),console.log(`Creating ${B} deployment tiles...`);for(let Vn=0;Vn<B;Vn++){const xn={id:`deployment-${n.id}-${Vn}-${Date.now()}`,date:je,type:"deployment",startTime:mt,duration:Cn,resourceId:"Deployed",color:"bg-gray-600/30",flightNumber:"DEPLOYMENT",flightType:"Dual",locationType:"Land Away",origin:"DEPLOY",destination:"DEPLOY",instructor:"",student:"",pilot:"",isDeploy:!0,deploymentStartDate:je,deploymentStartTime:Ye,deploymentEndDate:St,deploymentEndTime:Ce,deploymentAircraftCount:B};console.log(`Deployment tile ${Vn+1} created:`,xn),ke.push(xn)}}console.log("Events to save:",ke),s(ke)},Ti=C.useMemo(()=>{const ke=[];for(let mt=0;mt<24;mt++)for(let nn=0;nn<60;nn+=5){const Yt=mt+nn/60,an=`${String(mt).padStart(2,"0")}${String(nn).padStart(2,"0")}`;ke.push({label:an,value:Yt})}return ke},[]),vs=C.useMemo(()=>{const ke=n.flightType==="Dual"?n.student:n.pilot;return ke&&v.find(mt=>mt.fullName===ke)||null},[n.flightType,n.student,n.pilot,v]),ra=()=>{var ke,mt;kn&&!((ke=be[0])!=null&&ke.student)&&!((mt=be[0])!=null&&mt.instructor)&&(pn(!0),setTimeout(()=>pn(!1),2e3))},no=()=>{vs&&(T(vs),t())},xi=()=>{E(n.flightNumber),t()},Ta=()=>{vs&&(A(vs),t())},so=()=>{_(n)},Go=()=>{R(n)},ro=()=>{n.flightNumber.includes("MB")||n.flightNumber.includes(" MB")?Le(!0):(alert(vs?`Ground event "${n.flightNumber}" marked as complete for ${vs.rank} ${vs.name}`:`Ground event "${n.flightNumber}" marked as complete`),t())},Ba=ke=>{console.log("Mass Brief completed for trainees:",ke.map(Yt=>Yt.fullName));const mt=new Date().toISOString().split("T")[0],nn=n.instructor||"System";Ne?(ke.forEach(Yt=>{const an={id:`${Yt.idNumber}_${n.id}_${mt}`,traineeName:Yt.name,traineeFullName:Yt.fullName||`${Yt.rank} ${Yt.name}`,eventId:n.id,flightNumber:n.flightNumber,date:mt,instructorName:nn,dcoResult:"DCO",overallGrade:"No Grade",overallResult:null,overallComments:`Ground event completed via Mass Brief completion on ${mt}`,scores:[],isCompleted:!0,groundSchoolAssessment:{isAssessment:!1,result:0}};console.log("Saving PT051 assessment for:",Yt.fullName,an),Ne(an)}),console.log("PT051 assessments saved successfully")):console.warn("onSavePT051Assessment callback is not defined!"),He(ke),pe(!0)},Ao=(ke,mt)=>{var Vn;const nn=Fe==="SCT FORM";Fe.startsWith("SCT");const Yt=nn&&Kt?`${Kt}${mt+1}`:`Aircraft ${mt+1}`,an=_e==="lmp_currency"||_e==="sct"||_e==="staff_cat"||_e==="twr_di",en=_e==="lmp_event"||_e==="lmp_currency",Cn=(_e==="sct"||_e==="staff_cat"||_e==="twr_di")&&ke.flightType==="Dual";return e.jsxs("div",{className:`space-y-4 ${be.length>1?"p-3 bg-gray-700/50 rounded-lg":""}`,children:[be.length>1&&e.jsx("h4",{className:"text-sm font-bold text-sky-400",children:Yt}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Dual/Solo"}),e.jsxs("select",{value:ke.flightType,onChange:xn=>Cs(mt,"flightType",xn.target.value),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"Dual",children:"Dual"}),e.jsx("option",{value:"Solo",children:"Solo"})]})]}),ke.flightType==="Dual"?e.jsxs(e.Fragment,{children:[an?Fn(_e==="sct"?ke.pilot:ke.instructor,xn=>Cs(mt,_e==="sct"?"pilot":"instructor",xn),_e==="sct"||_e==="staff_cat"||_e==="twr_di"?"Pilot":"Instructor",ze):Fn(ke.instructor,xn=>Cs(mt,"instructor",xn),"Instructor",ze),en&&e.jsxs(e.Fragment,{children:[Rn(ke.student,xn=>Cs(mt,"student",xn),ze,X==="student"),e.jsx("div",{className:"flex items-center justify-center my-3",children:e.jsx("span",{className:"text-base font-bold text-gray-500",children:"- OR -"})}),e.jsxs("div",{className:"p-4 border border-gray-600 rounded bg-gray-700/30 relative",ref:et,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Group"}),((Vn=ke.groupTraineeIds)==null?void 0:Vn.length)>0&&e.jsxs("span",{className:"text-xs text-sky-400 font-mono bg-gray-800 px-2 py-0.5 rounded-full border border-gray-600",children:[ke.groupTraineeIds.length," Selected"]})]}),e.jsxs("button",{type:"button",onClick:()=>yt(rt===mt?null:mt),disabled:ze,className:"w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 border border-gray-500 text-white rounded-md text-sm font-medium transition-colors flex items-center justify-center shadow-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 text-sky-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})}),"Add Names"]}),rt===mt&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-gray-800 border border-gray-600 rounded-md shadow-xl max-h-60 overflow-y-auto left-0",children:Ms.map(xn=>{const ls=xn.trainees.map(ir=>ir.idNumber),Es=new Set(ke.groupTraineeIds||[]),Zs=ls.length>0&&ls.every(ir=>Es.has(ir));return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center px-3 py-2 bg-gray-900/80 font-bold text-gray-300 sticky top-0 z-10 border-b border-gray-700",children:[e.jsx("input",{type:"checkbox",checked:Zs,onChange:()=>Cr(mt,xn.trainees),className:"h-4 w-4 accent-sky-500 bg-gray-600 border-gray-500 rounded mr-2 cursor-pointer"}),e.jsx("span",{className:"uppercase text-xs",children:xn.name})]}),e.jsx("div",{className:"bg-gray-800",children:xn.trainees.map(ir=>{const Pi=Es.has(ir.idNumber);return e.jsxs("div",{className:"flex items-center px-3 py-2 pl-8 hover:bg-gray-700 cursor-pointer transition-colors border-b border-gray-700/50 last:border-0",onClick:()=>js(mt,ir.idNumber),children:[e.jsx("input",{type:"checkbox",checked:Pi,readOnly:!0,className:"h-4 w-4 accent-sky-500 bg-gray-600 border-gray-500 rounded mr-3 pointer-events-none"}),e.jsx("span",{className:"text-sm text-gray-300",children:ir.name})]},ir.idNumber)})})]},xn.name)})})]})]}),Cn&&Fn(ke.student,xn=>Cs(mt,"student",xn),"Crew",ze,_e==="sct")]}):an?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Pilot"}),e.jsxs("select",{value:ke.pilot,onChange:xn=>Cs(mt,"pilot",xn.target.value),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed appearance-none cursor-pointer z-10",children:[e.jsx("option",{value:"",disabled:!0,children:"Select pilot"}),Hn.sortedUnits.map(xn=>e.jsx("optgroup",{label:`─── ${xn} ───`,children:Hn.grouped[xn].filter(ls=>be.length>1?!be.filter((Zs,ir)=>ir!==mt).map(Zs=>Zs.pilot).filter(Zs=>Zs).includes(ls.name):!0).map(ls=>{const Zs=`${(zn[ls.name]||{rank:""}).rank} ${ls.name}`;return e.jsx("option",{value:ls.name,children:Zs},ls.name)})},xn))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Pilot"}),e.jsxs("select",{value:ke.pilot,onChange:xn=>Cs(mt,"pilot",xn.target.value),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",disabled:!0,children:"Select pilot"}),un.filter(xn=>be.length>1?!be.filter((Es,Zs)=>Zs!==mt).map(Es=>Es.pilot).filter(Es=>Es).includes(xn):!0).map(xn=>e.jsx("option",{value:xn,children:xn},xn))]})]})]},mt)};return ht?e.jsx(kw,{event:n,startTime:Ht,endTime:we,onContinue:sa,onClose:()=>vt(!1)}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl border border-gray-700 transform transition-all animate-fade-in flex flex-col h-[90vh]",onClick:ke=>ke.stopPropagation(),children:[e.jsxs("div",{className:`p-4 border-b border-gray-700 flex justify-between items-center ${n.color} flex-shrink-0`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:hs}),e.jsxs("div",{className:"flex items-center space-x-4",children:[F&&Ve==="flight"&&e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 rounded-md hover:bg-black/20",children:[e.jsx("input",{type:"checkbox",checked:ze,onChange:ke=>{const mt=ke.target.checked;qt(mt),mt&&yn("Land Away")},className:"h-5 w-5 accent-sky-500 bg-gray-600 rounded border-gray-500 focus:ring-sky-500"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:"Add Deployment"})]}),e.jsx("button",{onClick:()=>ue(!0),className:"px-4 py-1 text-sm font-semibold rounded-md btn-red-brushed","aria-label":"Delete Event",children:"Delete"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-row overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-3",children:"Event Category"}),e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>Z("lmp_event"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="lmp_event"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"LMP Event"}),e.jsx("button",{type:"button",onClick:()=>Z("lmp_currency"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="lmp_currency"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"LMP Currency"}),e.jsx("button",{type:"button",onClick:()=>Z("sct"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="sct"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"SCT"}),e.jsx("button",{type:"button",onClick:()=>Z("staff_cat"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="staff_cat"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Staff CAT"}),e.jsx("button",{type:"button",onClick:()=>Z("twr_di"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="twr_di"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"TWR DI"}),"                                           "]})]}),e.jsxs("div",{className:`grid grid-cols-1 ${Ve==="flight"?"md:grid-cols-4":"md:grid-cols-3"} gap-4`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Syllabus Item"}),e.jsxs("select",{value:Fe,onChange:Fs,onFocus:ra,disabled:ze||kn&&ss.length===0,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",disabled:!0,children:kn?"Select a crew member first":"Select an item"}),Q&&e.jsx("option",{value:"SCT FORM",children:"SCT FORM"}),ss.filter(ke=>ke!=="SCT FORM").map(ke=>e.jsx("option",{value:ke,children:ke},ke))]}),$t&&e.jsx("div",{className:"absolute -bottom-6 left-0 text-xs text-red-400 animate-fade-in",children:"Select a crew member first."})]}),Ve==="flight"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Area"}),e.jsx("select",{value:xt,onChange:ke=>dn(ke.target.value),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:cs.map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Aircraft Number"}),e.jsx("select",{value:on,onChange:ke=>st(ke.target.value),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:Array.from({length:49},(ke,mt)=>String(mt+1).padStart(3,"0")).map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Start Time"}),e.jsx("select",{value:nt,onChange:ke=>{Ct(parseFloat(ke.target.value)),ee(null)},disabled:ze,className:`mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm transition-all duration-200 disabled:bg-gray-700/50 disabled:cursor-not-allowed ${X==="startTime"?"ring-2 ring-red-500":""}`,children:Ti.map(ke=>e.jsx("option",{value:ke.value,children:ke.label},ke.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Duration"}),e.jsx("input",{type:"number",step:"0.1",min:"0.1",value:ft,onChange:ke=>tt(ke.target.value===""?"":parseFloat(ke.target.value)),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed"})]})]}),Ve==="flight"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Location"}),e.jsxs("select",{value:Pt,onChange:ke=>yn(ke.target.value),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"Local",children:"Local"}),e.jsx("option",{value:"Land Away",children:"Land Away"})]})]}),Ve==="flight"&&Pt==="Land Away"&&!ze&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Origin"}),e.jsx("input",{type:"text",value:Tt,onChange:ke=>lt(ke.target.value.toUpperCase()),maxLength:3,placeholder:"e.g. ESL",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Destination"}),e.jsx("input",{type:"text",value:Et,onChange:ke=>Bt(ke.target.value.toUpperCase()),maxLength:3,placeholder:"e.g. PEA",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]})]}),Ve==="flight"&&Pt==="Land Away"&&e.jsx(e.Fragment,{children:e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg mb-4",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Deployment Period"}),e.jsxs("div",{className:"mt-2 grid grid-cols-4 gap-2 bg-gray-700/30 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Start Time"}),e.jsx("input",{type:"text",value:Ye,onChange:ke=>{const mt=ke.target.value.replace(/:/g,"").replace(/\D/g,"").slice(0,4);Dt(mt)},placeholder:"0800",className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Start Date"}),e.jsx("input",{type:"date",value:je,onChange:ke=>$e(ke.target.value),style:{colorScheme:"dark"},className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"End Time"}),e.jsx("input",{type:"text",value:Ce,onChange:ke=>{const mt=ke.target.value.replace(/:/g,"").replace(/\D/g,"").slice(0,4);At(mt)},placeholder:"1700",className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"End Date"}),e.jsx("input",{type:"date",value:St,onChange:ke=>hn(ke.target.value),style:{colorScheme:"dark"},className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm"})]})]}),e.jsxs("div",{className:"mt-2 bg-gray-700/30 p-3 rounded-lg",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Number of Aircraft"}),e.jsx("input",{type:"number",min:"1",max:"20",value:B,onChange:ke=>Ae(parseInt(ke.target.value)||1),className:"w-24 bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm text-center"}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"aircraft deploying"})]})]})}),Fe==="SCT FORM"&&e.jsxs("div",{className:"p-3 bg-gray-900/50 rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-300",children:"Formation Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Formation Callsign"}),e.jsx("select",{value:Kt,onChange:ke=>Mt(ke.target.value),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:Qn?Qn.map(ke=>e.jsxs("option",{value:ke.code,children:[ke.name," (",ke.code,") - ",ke.unit]},ke.code)):as.map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Aircraft Count"}),e.jsx("select",{value:kt,onChange:ke=>Ge(parseInt(ke.target.value)),disabled:ze,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:Array.from({length:7},(ke,mt)=>mt+2).map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]})]})]}),e.jsx("div",{className:"space-y-4",children:be.map(Ao)}),(Ve==="flight"||Ve==="ftd"||Ve==="cpt")&&e.jsxs("div",{className:"border-t border-gray-600 pt-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Add to Deployment"}),e.jsx("div",{className:"space-y-3",children:_n().length>0?_n().map(ke=>e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer hover:bg-gray-700 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:Mn===ke.id,onChange:mt=>{mt.target.checked?jn(ke.id):jn("")},className:"h-4 w-4 text-sky-600 bg-gray-700 border-gray-600 rounded focus:ring-sky-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:rr(ke)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",ke.resourceId,")"]})]},ke.id)):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No deployments available for this event type"})})]})]}):e.jsxs("div",{className:"text-gray-300 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Syllabus Item:"})," ",n.flightNumber]}),n.type==="flight"&&e.jsxs("p",{children:[e.jsx("strong",{children:"Route:"})," ",n.origin,"-",n.destination]}),n.type==="flight"&&n.area&&e.jsxs("p",{children:[e.jsx("strong",{children:"Area:"})," ",n.area]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dual/Solo:"})," ",e.jsx("span",{className:"font-semibold",children:n.flightType})]}),n.flightType==="Dual"?e.jsxs(e.Fragment,{children:[n.eventCategory==="sct"?e.jsxs("p",{children:[e.jsx("strong",{children:"Instructor:"})," ",n.instructor||n.pilot]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Instructor:"})," ",n.instructor]}),n.type==="ground"&&n.attendees&&n.attendees.length>0?e.jsxs("div",{children:[e.jsx("p",{children:e.jsxs("strong",{children:["Attendees (",n.attendees.length,"):"]})}),e.jsx("div",{className:"mt-1 bg-gray-700/50 p-2 rounded-md max-h-32 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:n.attendees.map(ke=>e.jsx("li",{className:"text-sm text-gray-300",children:ke.split(" – ")[0]},ke))})})]}):n.eventCategory==="sct"?null:e.jsxs("p",{children:[e.jsx("strong",{children:"Student:"})," ",n.student||n.group]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"PIC:"})," ",n.pilot]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Second Position:"}),e.jsx("span",{className:"inline-block px-2 py-0.5 bg-yellow-500/20 border border-yellow-500/50 text-yellow-400 rounded text-sm font-semibold",children:"SOLO"})]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",n.duration.toFixed(1)," hours"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Start Time:"})," ",Math.floor(n.startTime),":",String(Math.round(n.startTime%1*60)).padStart(2,"0")]})]})}),e.jsxs("div",{className:"w-56 flex-shrink-0 border-l border-gray-700 bg-gray-800/50 p-4 flex flex-col space-y-3",children:[!F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 border border-gray-600 rounded-lg text-center",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-400",children:"Conflict?"}),H?e.jsx("p",{className:"text-2xl font-bold text-red-500",children:"YES"}):e.jsx("p",{className:"text-2xl font-bold text-green-500",children:"NO"})]}),e.jsx("button",{onClick:()=>O(n),className:"w-full px-4 py-2 rounded-md text-sm font-semibold shadow-md text-center btn-orange-brushed",children:"NEO"}),e.jsx("button",{onClick:no,disabled:!vs,className:"w-full px-4 py-2 rounded-md text-sm font-semibold shadow-md text-center btn-aluminium-brushed disabled:opacity-50 disabled:cursor-not-allowed",children:"Trainee Scores"}),e.jsx("button",{onClick:xi,className:"w-full px-4 py-2 rounded-md text-sm font-semibold shadow-md text-center btn-aluminium-brushed",children:"LMP"}),n.type==="flight"&&e.jsx("button",{onClick:so,className:"w-full px-4 py-2 rounded-md text-sm font-semibold shadow-md text-center btn-aluminium-brushed",children:"Auth"}),(vs&&n.type==="ground"||n.flightNumber.includes("MB")||n.flightNumber.includes(" MB"))&&e.jsx("button",{onClick:ro,className:"w-full px-4 py-2 rounded-md text-sm font-semibold shadow-md text-center btn-aluminium-brushed",children:"Complete"}),vs&&e.jsx("button",{onClick:Ta,className:"w-full px-4 py-2 rounded-md text-sm font-semibold shadow-md text-center btn-aluminium-brushed",children:"PT-051"}),n.type==="flight"&&e.jsx("button",{onClick:Go,className:"w-full px-4 py-2 rounded-md text-sm font-semibold shadow-md text-center btn-shape-fill",children:"Post Flight"})]}),e.jsx("div",{className:"flex-grow"})," ",F?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:to,className:"w-full px-4 py-2 text-white rounded-md transition-colors text-sm font-semibold shadow-md text-center bg-sky-600 hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Save"}),e.jsx("button",{onClick:Js,className:"w-full px-4 py-2 text-white rounded-md transition-colors text-sm font-semibold shadow-md text-center bg-purple-600 hover:bg-purple
button",{onClick:()=>dn("QFI","section"),className:`absolute top-10 right-2 p-1 rounded-full transition-colors ${ne==="QFI"?"bg-red-500 text-white":"text-gray-400 hover:text-white hover:bg-gray-600"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 13a.5.5 0 01.5.5v1a4 4 0 004 4h1a4 4 0 004-4v-1a.5.5 0 011 0v1a5 5 0 01-5 5h-1a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Weather"}),e.jsx("textarea",{value:X.Weather,onChange:we=>Xe("Weather",we.target.value),rows:1,className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded p-2 text-sm text-white focus:ring-1 focus:ring-sky-500 focus:border-sky-500 resize-none overflow-hidden",style:{minHeight:"42px"},onInput:we=>{we.currentTarget.style.height="auto",we.currentTarget.style.height=we.currentTarget.scrollHeight+"px"},ref:we=>{we&&(we.style.height="auto",we.style.height=we.scrollHeight+"px")}}),e.jsx("button",{onClick:()=>dn("Weather","section"),className:`absolute top-8 right-2 p-1 rounded-full transition-colors ${ne==="Weather"?"bg-red-500 text-white":"text-gray-400 hover:text-white hover:bg-gray-600"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 13a.5.5 0 01.5.5v1a4 4 0 004 4h1a4 4 0 004-4v-1a.5.5 0 011 0v1a5 5 0 01-5 5h-1a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"NEST"}),e.jsx("input",{type:"text",value:X.NEST,onChange:we=>Xe("NEST",we.target.value),maxLength:8,className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded p-2 text-sm text-white focus:ring-1 focus:ring-sky-500 focus:border-sky-500"}),e.jsx("button",{onClick:()=>dn("NEST","section"),className:`absolute top-8 right-2 p-1 rounded-full transition-colors ${ne==="NEST"?"bg-red-500 text-white":"text-gray-400 hover:text-white hover:bg-gray-600"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 13a.5.5 0 01.5.5v1a4 4 0 004 4h1a4 4 0 004-4v-1a.5.5 0 011 0v1a5 5 0 01-5 5h-1a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Profile"}),e.jsx("textarea",{value:X.Profile,onChange:we=>Xe("Profile",we.target.value),rows:4,className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded p-2 text-sm text-white focus:ring-1 focus:ring-sky-500 focus:border-sky-500 resize-none overflow-hidden",style:{minHeight:"100px"},onInput:we=>{we.currentTarget.style.height="auto",we.currentTarget.style.height=we.currentTarget.scrollHeight+"px"},ref:we=>{we&&(we.style.height="auto",we.style.height=we.scrollHeight+"px")}}),e.jsx("button",{onClick:()=>dn("Profile","section"),className:`absolute top-8 right-2 p-1 rounded-full transition-colors ${ne==="Profile"?"bg-red-500 text-white":"text-gray-400 hover:text-white hover:bg-gray-600"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 13a.5.5 0 01.5.5v1a4 4 0 004 4h1a4 4 0 004-4v-1a.5.5 0 011 0v1a5 5 0 01-5 5h-1a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"})]})})]},"Profile"),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Overall"}),e.jsx("textarea",{value:X.Overall,onChange:we=>Xe("Overall",we.target.value),rows:6,className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded p-2 text-sm text-white focus:ring-1 focus:ring-sky-500 focus:border-sky-500 resize-none overflow-hidden",style:{minHeight:"150px"},onInput:we=>{we.currentTarget.style.height="auto",we.currentTarget.style.height=we.currentTarget.scrollHeight+"px"},ref:we=>{we&&(we.style.height="auto",we.style.height=we.scrollHeight+"px")}}),e.jsx("button",{onClick:()=>dn("Overall","section"),className:`absolute top-8 right-2 p-1 rounded-full transition-colors ${ne==="Overall"?"bg-red-500 text-white":"text-gray-400 hover:text-white hover:bg-gray-600"}`,children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"}),e.jsx("path",{d:"M5.5 13a.5.5 0 01.5.5v1a4 4 0 004 4h1a4 4 0 004-4v-1a.5.5 0 011 0v1a5 5 0 01-5 5h-1a5 5 0 01-5-5v-1a.5.5 0 01.5-.5z"})]})})]},"Overall")]})]}),e.jsx("div",{className:"space-y-4",children:d2.map(we=>{const Re=t.type==="ground";return e.jsxs("fieldset",{className:`p-4 border rounded-lg ${Re?"border-gray-800 bg-gray-800/30 opacity-50":"border-gray-700"}`,children:[e.jsx("legend",{className:`px-2 text-sm font-semibold ${Re?"text-gray-500":"text-gray-300"}`,children:we.category}),e.jsxs("table",{className:"w-full mt-2 border-collapse",children:[e.jsx("thead",{className:"sr-only",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Element"}),z1.map(be=>e.jsx("th",{children:be},String(be))),e.jsx("th",{children:"Comments"})]})}),e.jsx("tbody",{children:we.elements.map(be=>{const Ze=se.scores.find(ot=>ot.element===be);return e.jsxs("tr",{className:"border-t border-gray-700",children:[e.jsx("td",{className:"py-3 pr-2 font-semibold text-white w-48",children:be}),z1.map(ot=>{const Vt=Pt=>Pt==="DEMO"?"Demo":String(Pt);return e.jsx("td",{className:`py-3 text-center w-12 ${We[String(ot)]||""}`,children:e.jsxs("label",{className:`flex flex-col items-center justify-center ${Re?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("input",{type:"radio",name:be,value:String(ot),checked:(Ze==null?void 0:Ze.grade)===ot,onChange:()=>Z(be,ot),disabled:Re,className:`h-4 w-4 ${fe(ot)} bg-gray-700 border-gray-600 focus:ring-sky-500 focus:ring-2 ${Re?"opacity-50 cursor-not-allowed":""}`}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:Vt(ot)})]})},String(ot))}),e.jsxs("td",{className:"py-3 pl-2 relative",children:[e.jsx("textarea",{value:(Ze==null?void 0:Ze.comment)||"",onChange:ot=>Fe(be,ot.target.value),rows:1,placeholder:"Comments...",className:"w-full bg-gray-800 border border-gray-600 rounded p-2 text-sm text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500 resize-none overflow-hidden",style:{minHeight:"42px"},onInput:ot=>{ot.currentTarget.style.height="auto",ot.currentTarget.style.height=ot.currentTarget.scrollHeight+"px"},ref:ot=>{ot&&(ot.style.height="auto",ot.style.height=ot.scrollHeight+"px")}}),e.jsx("button",{onClick:()=>st(be),className:"absolute top-4 right-2 text-gray-400 hover:text-sky-400 p-1",title:"Insert from Phrase Bank",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h.01a1 1 0 100-2H10zm3 0a1 1 0 000 2h.01a1 1 0 100-2H13z",clipRule:"evenodd"})]})})]})]},be)})})]})]},we.category)})})]}),ae&&Te&&e.jsx(QE,{element:Te,onClose:()=>Q(!1),onInsert:kt,phraseBank:y})]})},nA=({onConfirm:n,onCancel:t})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[70] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-sm border border-gray-700",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Confirm Authorisation"})}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-300",children:"Are you sure you wish to authorise this flight?"})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"NO"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm font-semibold",children:"YES"})]})]})}),V1=({onConfirm:n,onCancel:t})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[70] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-sm border border-red-500/50",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-red-400",children:"Clear Authorisation"})}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx("p",{className:"text-gray-300",children:"Are you sure you want to clear all signatures for this flight?"}),e.jsx("p",{className:"text-amber-400 text-sm",children:"This action requires PIN verification and cannot be undone."})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"No, Cancel"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold",children:"Yes, Clear"})]})]})}),W1=({staff:n,selectedStaff:t,onSelect:s,placeholder:i="Search staff...",disabled:o=!1})=>{const[l,d]=C.useState(!1),[u,f]=C.useState(""),h=C.useRef(null);C.useEffect(()=>{const T=E=>{h.current&&!h.current.contains(E.target)&&(d(!1),f(""))};return document.addEventListener("mousedown",T),()=>{document.removeEventListener("mousedown",T)}},[]);const m=C.useMemo(()=>{const T=n.reduce((_,R)=>{const H=R.unit||"Unassigned";return _[H]||(_[H]=[]),_[H].push(R),_},{}),E=["1FTS","CFS","2FTS"],A=Object.keys(T).sort((_,R)=>{const H=E.indexOf(_),O=E.indexOf(R);return H!==-1&&O!==-1?H-O:H!==-1?-1:O!==-1?1:_.localeCompare(R)});return Object.keys(T).forEach(_=>{T[_].sort((R,H)=>R.rank!==H.rank?R.rank.localeCompare(H.rank):R.name.localeCompare(H.name))}),A.reduce((_,R)=>(_[R]=T[R],_),{})},[n]),v=C.useMemo(()=>{if(!u)return m;const T={};return Object.entries(m).forEach(([E,A])=>{const _=A.filter(R=>R.name.toLowerCase().includes(u.toLowerCase())||R.rank.toLowerCase().includes(u.toLowerCase())||R.unit&&R.unit.toLowerCase().includes(u.toLowerCase()));_.length>0&&(T[E]=_)}),T},[m,u]),x=t||"",y=T=>{s(T),d(!1),f("")};return e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("button",{type:"button",onClick:()=>!o&&d(!l),disabled:o,className:`w-full text-left px-3 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed ${!t&&!defaultName?"text-gray-400":""}`,children:[x||i,e.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),l&&!o&&e.jsxs("div",{className:"absolute z-50 mt-1 w-full bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-60 overflow-auto",children:[e.jsx("div",{className:"p-2 border-b border-gray-600",children:e.jsx("input",{type:"text",value:u,onChange:T=>f(T.target.value),placeholder:"Search...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white text-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500",autoFocus:!0})}),e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[Object.entries(v).map(([T,E])=>e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-1 bg-gray-900 text-xs font-semibold text-gray-400 uppercase tracking-wider",children:T}),E.map(A=>e.jsxs("button",{type:"button",onClick:()=>y(A.name),className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-gray-700 focus:bg-gray-700 focus:outline-none",children:[e.jsx("span",{className:"font-medium",children:A.rank})," ",A.name]},A.name))]},T)),Object.keys(v).length===0&&e.jsxs("div",{className:"px-3 py-4 text-sm text-gray-500 text-center",children:['No staff found matching "',u,'"']})]})]})]})},zd=({label:n,value:t})=>e.jsxs("div",{className:"flex justify-between text-sm py-1 border-b border-gray-700/50",children:[e.jsxs("span",{className:"text-gray-400 font-medium",children:[n,":"]}),e.jsx("span",{className:"text-gray-200",children:t||"N/A"})]}),sA=({event:n,onClose:t,onAuthorise:s,onClearAuth:i,instructorsList:o,currentUserName:l,currentUserRank:d,currentUserUnit:u})=>{const[f,h]=C.useState(n.authNotes??""),[m,v]=C.useState(!1),[x,y]=C.useState(!1),[T,E]=C.useState(null),[A,_]=C.useState(n.isVerbalAuth??!1),[R,H]=C.useState(!1),[O,W]=C.useState(!1),ne=C.useMemo(()=>n.instructor||n.pilot,[n]),V=C.useMemo(()=>`${d} ${l}`,[d,l]),U=C.useMemo(()=>V,[V]),D=C.useMemo(()=>{if(n.instructor){const ye=o.find(Le=>Le.name===n.instructor);return ye?`${ye.rank} ${ye.name}`:n.instructor}if(n.pilot){const ye=o.find(Le=>Le.name===n.pilot);return ye?`${ye.rank} ${ye.name}`:n.pilot}return""},[n.instructor,n.pilot,o]),[$,M]=C.useState(()=>n.authoSignedBy||U),[P,ae]=C.useState(()=>n.captainSignedBy||D);Ua.useEffect(()=>{A&&!n.authoSignedBy&&!n.captainSignedBy&&M(P)},[A,P,n.authoSignedBy,n.captainSignedBy]);const Q=ye=>{ye==="autho"&&!$||ye==="captain"&&!P||A&&$!==P||(E(ye),ye==="autho"?v(!0):y(!0))},Te=()=>{v(!1),y(!0)},Y=()=>{v(!1),E(null)},fe=()=>{if(T){const ye=T==="autho"?$:P;ye.split(" ").slice(1).join(" "),s(n.id,f,T,A,ye)}y(!1),E(null)},ge=()=>{H(!1),W(!0),y(!0)},Ne=()=>{i(n.id),y(!1),W(!1)},Oe=()=>{y(!1),E(null),W(!1)},se=ye=>{if(!ye)return"";const Le=new Date(ye),xe=String(Le.getDate()).padStart(2,"0"),pe=Le.toLocaleString("en-GB",{month:"short"}).toUpperCase(),ce=String(Le.getFullYear()).slice(-2),He=String(Le.getHours()).padStart(2,"0"),_e=String(Le.getMinutes()).padStart(2,"0");return`${xe} ${pe} ${ce} ${He}:${_e}`},F=!!(n.authoSignedBy??n.captainSignedBy),J=!!(n.authoSignedBy&&n.captainSignedBy),X="1111",ee=ye=>{_(ye),ye&&!n.authoSignedBy&&!n.captainSignedBy&&M(P)},K=ye=>{if(!ye)return"";const Le=ye.lastIndexOf(" ");if(Le>0){const xe=ye.substring(Le+1);if(!isNaN(Number(xe)))return ye.substring(0,Le)}return ye},ue=ye=>ye?ye.split(" – ")[0]||ye:"";return J?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:ye=>ye.stopPropagation(),children:[e.jsxs("div",{className:"p-3 border-b border-gray-700 flex justify-between items-center bg-gray-900",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"h-6 w-6 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h2",{className:"text-lg font-bold text-green-400",children:"Flight Authorisation Complete"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-3 text-center border border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-center mb-1",children:[e.jsx("svg",{className:"h-5 w-5 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("p",{className:"text-green-400 font-semibold",children:"Authorisation Approved"})]}),e.jsx("p",{className:"text-gray-400 text-xs",children:"This flight has been fully authorised and is cleared to proceed"})]}),e.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-3 border border-gray-600",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Flight Summary"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Syllabus:"}),e.jsx("span",{className:"text-white font-medium",children:n.flightNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Start Time:"}),e.jsxs("span",{className:"text-white font-medium",children:[Math.floor(n.startTime),":",String(Math.round(n.startTime%1*60)).padStart(2,"0")]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Instructor:"}),e.jsx("span",{className:"text-white font-medium",children:n.instructor})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Student:"}),e.jsx("span",{className:"text-white font-medium",children:ue(n.student)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Aircraft:"}),e.jsx("span",{className:"text-white font-medium",children:K(n.resourceId)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Route:"}),e.jsxs("span",{className:"text-white font-medium",children:[n.origin,"-",n.destination]})]})]})]}),e.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-3 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"h-4 w-4 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-300",children:"Authorising Officer (AUTHO)"})]}),e.jsx("p",{className:"text-green-400 font-bold text-base ml-6",children:n.authoSignedBy}),e.jsxs("p",{className:"text-gray-400 text-xs ml-6",children:["Signed: ",se(n.authoSignedAt)]})]}),e.jsxs("div",{className:"bg-gray-700/30 rounded-lg p-3 border border-gray-600",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"h-4 w-4 text-green-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("h3",{className:"text-sm font-semibold text-gray-300",children:"Captain (PIC)"})]}),e.jsx("p",{className:"text-green-400 font-bold text-base ml-6",children:n.captainSignedBy}),e.jsxs("p",{className:"text-gray-400 text-xs ml-6",children:["Signed: ",se(n.captainSignedAt)]})]})]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-900 border-t border-gray-700 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>H(!0),className:"px-4 py-2 bg-red-600 text-white rounded text-sm font-semibold hover:bg-red-700 transition-colors",children:"Clear Auth"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded text-sm font-semibold hover:bg-gray-700 transition-colors",children:"Close"})]})]})}),x&&e.jsx(Im,{correctPin:X,onConfirm:Ne,onCancel:Oe}),R&&e.jsx(V1,{onConfirm:ge,onCancel:()=>H(!1)})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:ye=>ye.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-400",children:"Flight Authorisation"}),e.jsx("button",{onClick:t,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Flight Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 mt-1",children:[e.jsx(zd,{label:"Syllabus",value:n.flightNumber}),e.jsx(zd,{label:"Start Time",value:`${Math.floor(n.startTime)}:${String(Math.round(n.startTime%1*60)).padStart(2,"0")}`}),e.jsx(zd,{label:"Instructor",value:n.instructor}),e.jsx(zd,{label:"Student",value:ue(n.student)}),e.jsx(zd,{label:"Aircraft",value:K(n.resourceId)}),e.jsx(zd,{label:"Route",value:`${n.origin}-${n.destination}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"auth-notes",className:"block text-sm font-medium text-gray-400",children:"Notes"}),e.jsx("textarea",{id:"auth-notes",rows:3,value:f,onChange:ye=>h(ye.target.value),disabled:!!(n.authoSignedBy??n.captainSignedBy),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",placeholder:"Enter any authorisation notes here..."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-gray-900/50 rounded-lg",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"font-semibold text-gray-300 mb-2",children:"Authorising Officer (AUTHO)"}),n.authoSignedBy?e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-green-400",children:n.authoSignedBy}),e.jsx("p",{className:"text-xs text-gray-400",children:se(n.authoSignedAt)})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(W1,{staff:o,selectedStaff:$,onSelect:M,placeholder:"Select Authorising Officer...",disabled:A}),e.jsxs("button",{onClick:()=>Q("autho"),disabled:!$||A&&$!==P,className:"w-full px-3 py-1.5 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-sm font-semibold disabled:bg-gray-500 disabled:cursor-not-allowed",children:["Sign as AUTHO ",A&&"(Locked to PIC)"]})]})]})}),e.jsxs("div",{className:"p-3 bg-gray-900/50 rounded-lg",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("h3",{className:"font-semibold text-gray-300 mb-2",children:["Captain (PIC) - ",ne]}),n.captainSignedBy?e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-green-400",children:n.captainSignedBy}),e.jsx("p",{className:"text-xs text-gray-400",children:se(n.captainSignedAt)})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(W1,{staff:o,selectedStaff:P,onSelect:ye=>{ae(ye),A&&!n.authoSignedBy&&M(ye)},placeholder:"Select Captain (PIC)...",disabled:!!(n.authoSignedBy&&!n.isVerbalAuth)}),e.jsx("button",{onClick:()=>Q("captain"),disabled:!P||!(n.authoSignedBy||n.isVerbalAuth)||A&&$!==P,className:"w-full px-3 py-1.5 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-sm font-semibold disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Sign as PIC"})]})]}),!n.captainSignedBy&&e.jsxs("label",{className:"flex items-center space-x-2 mt-3 pt-3 border-t border-gray-700/50",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:ye=>ee(ye.target.checked),disabled:!!n.authoSignedBy,className:"h-4 w-4 bg-gray-700 border-gray-600 rounded focus:ring-amber-500 focus:ring-offset-gray-800 accent-amber-500 disabled:accent-gray-600"}),e.jsxs("span",{className:`text-sm ${n.authoSignedBy?"text-gray-500":"text-gray-300"}`,children:["Verbal AUTH received. See Notes.",A&&e.jsx("span",{className:"ml-2 text-amber-400 font-medium",children:"(Both AUTHO and PIC must be same person)"})]})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-between items-center",children:[e.jsx("div",{children:F&&e.jsx("button",{onClick:()=>H(!0),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold",children:"Clear Auth"})}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Close"})]})]})}),m&&e.jsx(nA,{onConfirm:Te,onCancel:Y}),x&&e.jsx(Im,{correctPin:X,onConfirm:O?Ne:fe,onCancel:Oe}),R&&e.jsx(V1,{onConfirm:ge,onCancel:()=>H(!1)})]})},rA=({onClose:n,onConfirm:t})=>{const[s,i]=C.useState(null),o=C.useRef(null),l=f=>{f.target.files&&f.target.files.length>0&&i(f.target.files[0])},d=()=>{var f;(f=o.current)==null||f.click()},u=()=>{s&&t(s)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[70] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Upload a File"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Select a file from your local machine to upload to the repository."}),e.jsxs("div",{className:"border-2 border-dashed border-gray-600 rounded-lg p-8 flex flex-col items-center justify-center text-center cursor-pointer hover:border-sky-500 transition-colors",onClick:d,children:[e.jsx("input",{type:"file",ref:o,onChange:l,className:"hidden"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-gray-500 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),s?e.jsx("p",{className:"text-white font-semibold",children:s.name}):e.jsx("p",{className:"text-gray-400",children:"Click to select a file"})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:u,disabled:!s,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"OK"})]})]})})},iA=({onClose:n,onConfirm:t,fileName:s,folders:i})=>{var u;const[o,l]=C.useState(((u=i[0])==null?void 0:u.id)||""),d=()=>{o?t(o):alert("Please select a destination folder.")};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[70] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Select Destination"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("p",{className:"text-gray-400 text-sm",children:["Select a destination folder for the file: ",e.jsx("span",{className:"font-semibold text-gray-200",children:s})]}),e.jsx("div",{className:"space-y-2",children:i.map(f=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 rounded-md bg-gray-700/50 hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"destination-folder",value:f.id,checked:o===f.id,onChange:()=>l(f.id),className:"h-4 w-4 accent-sky-500 bg-gray-600 border-gray-500"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-sky-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),e.jsx("span",{className:"text-white font-medium",children:f.name})]},f.id))})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:!o,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Confirm & Upload"})]})]})})},aA=({fileName:n,onConfirm:t,onClose:s})=>e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[70] flex items-center justify-center animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:i=>i.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Download File"})}),e.jsx("div",{className:"p-6",children:e.jsxs("p",{className:"text-gray-300",children:["Do you want to download ",e.jsx("strong",{className:"text-sky-400",children:n})," to your computer?"]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Cancel"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"OK"})]})]})}),oA=({fileName:n,onConfirm:t,onClose:s})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[80] flex items-center justify-center animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-amber-500/50",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-amber-900/20 flex items-center space-x-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{className:"text-xl font-bold text-amber-400",children:"Confirm Deletion"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("p",{className:"text-gray-300",children:["Are you sure you want to permanently delete ",e.jsx("strong",{className:"text-white",children:n}),"?"]}),e.jsx("p",{className:"text-gray-400 mt-2 text-sm",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Cancel"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold",children:"Yes, Delete"})]})]})}),lA=({fileName:n,onConfirm:t,onClose:s})=>{const[i,o]=C.useState(""),[l,d]=C.useState("minor"),[u,f]=C.useState(""),h=m=>{if(m.preventDefault(),i.length<4){f("PIN must be 4 digits.");return}t(i,l)};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[80] flex items-center justify-center animate-fade-in",onClick:s,children:e.jsxs("form",{onSubmit:h,className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Confirm Update"})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("p",{className:"text-gray-400",children:["Enter your PIN to apply updates from ",e.jsx("strong",{className:"text-gray-200",children:n}),"."]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin-input",className:"block text-sm font-medium text-gray-400",children:"PIN"}),e.jsx("input",{id:"pin-input",type:"password",value:i,onChange:m=>{o(m.target.value.replace(/\D/g,"")),f("")},maxLength:4,autoFocus:!0,className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white text-center text-2xl tracking-[.5em] focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"}),u&&e.jsx("p",{className:"text-red-400 text-sm text-center mt-1",children:u})]}),e.jsxs("fieldset",{children:[e.jsx("legend",{className:"text-sm font-medium text-gray-400 mb-2",children:"Select Update Type"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-start space-x-3 p-3 rounded-md bg-gray-700/50 hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"update-type",value:"minor",checked:l==="minor",onChange:()=>d("minor"),className:"h-5 w-5 mt-0.5 accent-sky-500 bg-gray-600 border-gray-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"Minor Update"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Update existing records and add new ones. You will be prompted to confirm new entries."})]})]}),e.jsxs("label",{className:"flex items-start space-x-3 p-3 rounded-md bg-gray-700/50 hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"update-type",value:"bulk",checked:l==="bulk",onChange:()=>d("bulk"),className:"h-5 w-5 mt-0.5 accent-sky-500 bg-gray-600 border-gray-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-medium",children:"Bulk Update"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Warning: This will delete all existing data and replace it with the contents of the file."})]})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"Confirm Update"})]})]})})},cA=({rowData:n,onConfirm:t,onCancel:s})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg border border-sky-500/50",onClick:i=>i.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-sky-900/20 flex items-center space-x-3",children:e.jsx("h2",{className:"text-xl font-bold text-sky-400",children:"New Record Found"})}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-300",children:"A record from the file could not be matched to any existing data."}),e.jsx("div",{className:"mt-4 bg-gray-900/50 p-3 rounded-md text-xs font-mono text-gray-400 max-h-40 overflow-auto",children:e.jsx("pre",{children:JSON.stringify(n,null,2)})}),e.jsx("p",{className:"text-gray-300 mt-4",children:"Do you want to add this as a new person/event?"})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"No, Skip"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm font-semibold",children:"Yes, Add New"})]})]})}),dA=({message:n,onClose:t})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-amber-500/50",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-amber-900/20 flex items-center space-x-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-amber-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{className:"text-xl font-bold text-amber-400",children:"Update Notice"})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-300",children:n})}),e.jsx("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end",children:e.jsx("button",{onClick:t,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"OK"})})]})}),uA=({summary:n,onClose:t})=>e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-sky-500/50",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-sky-900/20 flex items-center space-x-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-sky-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h2",{className:"text-xl font-bold text-sky-400",children:"Update Complete"})]}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs("p",{className:"text-gray-300",children:["The ",e.jsxs("strong",{className:"text-white",children:[n.type," Update"]})," process has finished."]}),e.jsxs("div",{className:"bg-gray-700/50 p-3 rounded-md grid grid-cols-2 gap-2 text-sm",children:[n.type==="Bulk"?e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Records Replaced:"}),e.jsx("span",{className:"font-bold text-white float-right",children:n.replaced})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Records Updated:"}),e.jsx("span",{className:"font-bold text-white float-right",children:n.updated})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"New Records Added:"}),e.jsx("span",{className:"font-bold text-green-400 float-right",children:n.added})]}),n.unaltered!==void 0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Records Unaltered:"}),e.jsx("span",{className:"font-bold text-blue-400 float-right",children:n.unaltered})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Rows Skipped:"}),e.jsx("span",{className:"font-bold text-amber-400 float-right",children:n.skipped})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end",children:e.jsx("button",{onClick:t,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"OK"})})]})}),Y1=["Generic Flying Elements","Pre-Post Flight","Walk Around","Strap-in","Ground Checks","Airborne Checks","Stationary","Visual","Effects of Control","Trimming","Straight and Level","Level medium Turn","Level Steep turn","Visual - Initial & Pitch","Landing","Crosswind","Radio Comms","Situational Awareness","Lookout","Knowledge"],fA=({onClose:n,onSave:t})=>{const[s,i]=C.useState(""),o=()=>{s.trim()&&t(s.trim())};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Add New Flight Element"})}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"element-name",className:"block text-sm font-medium text-gray-400",children:"Element Name"}),e.jsx("input",{id:"element-name",type:"text",value:s,onChange:l=>i(l.target.value),autoFocus:!0,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:o,disabled:!s.trim(),className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Save"})]})]})})},hA=({onClose:n,onDelete:t,flightElements:s})=>{const[i,o]=C.useState(new Set),l=u=>{const f=new Set(i);f.has(u)?f.delete(u):f.add(u),o(f)},d=()=>{if(i.size===0){alert("Please select at least one element to delete.");return}t(i)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[100] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700 flex flex-col max-h-[80vh]",onClick:u=>u.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Delete Flight Elements"})}),e.jsx("div",{className:"p-6 flex-1 overflow-y-auto",children:s.length>0?e.jsx("ul",{className:"space-y-2",children:s.map(u=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center space-x-3 p-2 rounded hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.has(u),onChange:()=>l(u),className:"h-4 w-4 accent-red-500 bg-gray-600"}),e.jsx("span",{className:"text-sm text-gray-300",children:u})]})},u))}):e.jsx("p",{className:"text-gray-500 text-center italic",children:"No elements to delete."})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:i.size===0,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Delete Selected"})]})]})})},mA=({onClose:n,phraseBank:t,onUpdatePhraseBank:s,initialTab:i="Airmanship"})=>{const[o,l]=C.useState(i),[d,u]=C.useState(!1),[f,h]=C.useState(!1),[m,v]=C.useState(()=>{const V=Object.keys(t).filter(U=>!["Airmanship","Preparation","Technique"].includes(U)&&!Y1.includes(U));return[...Y1,...V]}),[x,y]=C.useState(m[0]),T=o==="Elements"?x:o,E=(V,U,D)=>{const $=t&&t[T]||{},P=[...$[V]||[]];P[U]=D,s({...t,[T]:{...$,[V]:P}})},A=V=>{const U=t&&t[T]||{},D=U[V]||[];s({...t,[T]:{...U,[V]:[...D,""]}})},_=(V,U)=>{const D=t&&t[T]||{},$=D[V]||[];s({...t,[T]:{...D,[V]:$.filter((M,P)=>P!==U)}})},R=()=>{u(!0)},H=V=>{if(m.includes(V)){alert("An element with this name already exists.");return}v(U=>[...U,V]),s({...t,[V]:{0:[],1:[],2:[],3:[],4:[],5:[]}}),y(V),u(!1)},O=V=>{const U=m.filter($=>!V.has($));v(U);const D={...t};V.forEach($=>{delete D[$]}),s(D),V.has(x)&&y(U[0]||"Generic Flying Elements"),h(!1)},W=V=>V>=4?"border-green-500/30 bg-green-900/10":V>=2?"border-yellow-500/30 bg-yellow-900/10":"border-red-500/30 bg-red-900/10",ne=V=>{switch(V){case 5:return"5 - Excellent";case 4:return"4 - High Satisfactory";case 3:return"3 - Satisfactory";case 2:return"2 - Low Satisfactory";case 1:return"1 - Marginal";case 0:return"0 - Unsatisfactory";default:return String(V)}};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-6xl border border-gray-700 flex flex-col h-[85vh]",onClick:V=>V.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Scoring Matrix Setup"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex border-b border-gray-700 bg-gray-900/30 shrink-0",children:["Airmanship","Preparation","Technique","Elements"].map(V=>e.jsx("button",{onClick:()=>l(V),className:`flex-1 py-3 text-lg font-semibold text-center border-b-4 transition-colors ${o===V?"border-sky-500 text-sky-400 bg-gray-800":"border-transparent text-gray-400 hover:text-gray-200 hover:bg-gray-800/50"}`,children:V},V))}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[o==="Elements"&&e.jsxs("div",{className:"w-64 bg-gray-800 border-r border-gray-700 flex flex-col shrink-0 overflow-y-auto",children:[e.jsxs("div",{className:"p-3 text-xs font-bold text-gray-500 uppercase tracking-wider bg-gray-900/50 flex justify-between items-center",children:[e.jsx("span",{children:"Flight Elements"}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("button",{onClick:()=>h(!0),className:"p-1 rounded-full bg-gray-700 hover:bg-gray-600",title:"Delete flight element(s)",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:R,className:"p-1 rounded-full bg-gray-700 hover:bg-gray-600",title:"Add new flight element",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-sky-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})})})]})]}),m.map(V=>e.jsx("button",{onClick:()=>y(V),className:`text-left px-4 py-3 border-l-4 transition-colors font-medium text-sm ${x===V?"border-sky-500 bg-gray-700 text-white":"border-transparent text-gray-400 hover:bg-gray-700/50 hover:text-gray-200"}`,children:V},V))]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-gray-900",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-2xl font-bold text-sky-400",children:T}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Define standardized phrases for each grade level."})]}),[5,4,3,2,1,0].map(V=>e.jsxs("div",{className:`border rounded-lg overflow-hidden ${W(V)}`,children:[e.jsxs("div",{className:"px-4 py-2 font-bold text-sm border-b border-gray-700/30 flex justify-between items-center",children:[e.jsx("span",{className:"text-white opacity-90",children:ne(V)}),e.jsx("button",{onClick:()=>A(V),className:"text-xs bg-gray-700 hover:bg-gray-600 text-white px-2 py-1 rounded transition-colors border border-gray-600",children:"+ Add Phrase"})]}),e.jsx("div",{className:"p-4 space-y-2",children:t&&t[T]&&t[T][V]?t[T][V].map((U,D)=>e.jsxs("div",{className:"flex items-start space-x-2 group",children:[e.jsx("textarea",{value:U,onChange:$=>E(V,D,$.target.value),rows:1,className:"flex-1 bg-gray-800 border border-gray-600 rounded p-2 text-sm text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500 resize-none overflow-hidden",style:{minHeight:"38px",height:"auto"},onInput:$=>{const M=$.currentTarget;M.style.height="auto",M.style.height=`${M.scrollHeight}px`}}),e.jsx("button",{onClick:()=>_(V,D),className:"p-2 text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete phrase",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},D)):e.jsx("p",{className:"text-xs text-gray-500 italic pl-1",children:"No phrases defined."})})]},V))]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-800 border-t border-gray-700 flex justify-end shrink-0",children:e.jsx("button",{onClick:n,className:"px-6 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold shadow-md",children:"Done"})}),d&&e.jsx(fA,{onClose:()=>u(!1),onSave:H}),f&&e.jsx(hA,{onClose:()=>h(!1),onDelete:O,flightElements:m})]})})},gA=({courses:n,onConfirm:t,onClose:s,updateType:i})=>{const[o,l]=C.useState(""),[d,u]=C.useState(""),f=h=>{if(h.preventDefault(),!o){u("Please select a course.");return}t(o)};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center animate-fade-in",onClick:s,children:e.jsxs("form",{onSubmit:f,className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:h=>h.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"Select Course"})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("p",{className:"text-gray-400",children:i==="minor"?"Select the course to update. Existing trainees will be updated and new trainees will be added.":"Select the course to update. WARNING: All existing trainees in this course will be replaced with the uploaded data."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"course-select",className:"block text-sm font-medium text-gray-400 mb-2",children:"Course"}),e.jsxs("select",{id:"course-select",value:o,onChange:h=>{l(h.target.value),u("")},autoFocus:!0,className:"block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500",children:[e.jsx("option",{value:"",children:"-- Select a Course --"}),n.map(h=>e.jsx("option",{value:h,children:h},h))]}),d&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:d})]}),i==="bulk"&&o&&e.jsx("div",{className:"bg-red-900/20 border border-red-700 rounded-md p-3",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-red-400 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-400 font-medium text-sm",children:"Warning"}),e.jsxs("p",{className:"text-red-300 text-xs mt-1",children:["This will permanently delete all trainees currently in ",e.jsx("strong",{children:o})," and replace them with the uploaded data."]})]})]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Cancel"}),e.jsx("button",{type:"submit",className:`px-4 py-2 rounded-md transition-colors text-sm font-semibold ${i==="bulk"?"bg-red-600 hover:bg-red-700 text-white":"bg-sky-600 hover:bg-sky-700 text-white"}`,children:i==="bulk"?"Replace Course Data":"Update Course"})]})]})})},pA=({codes:n,onAddCode:t,onEditCode:s,onToggleActive:i,onDeleteCode:o,canEdit:l,usedCodes:d})=>{const[u,f]=C.useState(!1),[h,m]=C.useState(null),[v,x]=C.useState(null),[y,T]=C.useState({code:"",category:"Aircraft",description:"",appliesTo:"Both",isActive:!0}),E=()=>{T({code:"",category:"Aircraft",description:"",appliesTo:"Both",isActive:!0}),f(!0),m(null)},A=V=>{T(V),m(V.code),f(!1)},_=()=>{f(!1),m(null),T({code:"",category:"Aircraft",description:"",appliesTo:"Both",isActive:!0})},R=V=>{x(V)},H=()=>{v&&(o(v),x(null))},O=()=>{x(null)},W=()=>{if(!y.code||!y.description)return;const V={code:y.code.toUpperCase(),category:y.category,description:y.description,appliesTo:y.appliesTo,isActive:y.isActive??!0,createdAt:y.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()};u?t(V):h&&s(h,V),_()},ne=[...n].sort((V,U)=>V.category!==U.category?V.category.localeCompare(U.category):V.code.localeCompare(U.code));return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Cancellation Codes (Master Table)"}),l&&e.jsx("button",{onClick:E,disabled:u||h!==null,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold disabled:bg-gray-600 disabled:cursor-not-allowed",children:"+ Add Code"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-semibold",children:"Code"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-semibold",children:"Category"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-semibold",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-semibold",children:"Applies To"}),e.jsx("th",{className:"text-center py-3 px-4 text-gray-300 font-semibold",children:"Status"}),l&&e.jsx("th",{className:"text-center py-3 px-4 text-gray-300 font-semibold",children:"Actions"})]})}),e.jsxs("tbody",{children:[u&&e.jsxs("tr",{className:"border-b border-gray-700 bg-gray-700/30",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"text",value:y.code,onChange:V=>T({...y,code:V.target.value.toUpperCase()}),maxLength:4,className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm",placeholder:"CODE"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("select",{value:y.category,onChange:V=>T({...y,category:V.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm",children:[e.jsx("option",{value:"Aircraft",children:"Aircraft"}),e.jsx("option",{value:"Crew",children:"Crew"}),e.jsx("option",{value:"Program",children:"Program"}),e.jsx("option",{value:"Weather",children:"Weather"})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"text",value:y.description,onChange:V=>T({...y,description:V.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm",placeholder:"Description"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("select",{value:y.appliesTo,onChange:V=>T({...y,appliesTo:V.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm",children:[e.jsx("option",{value:"Flight",children:"Flight"}),e.jsx("option",{value:"FTD",children:"FTD"}),e.jsx("option",{value:"Both",children:"Both"})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:"inline-block px-2 py-1 rounded text-xs font-semibold bg-green-900/50 text-green-400",children:"Active"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:W,className:"px-3 py-1 bg-green-600 text-white rounded text-xs font-semibold hover:bg-green-700",children:"Save"}),e.jsx("button",{onClick:_,className:"px-3 py-1 bg-gray-600 text-white rounded text-xs font-semibold hover:bg-gray-700",children:"Cancel"})]})})]}),ne.map(V=>{const U=h===V.code,D=d.has(V.code);return U?e.jsxs("tr",{className:"border-b border-gray-700 bg-gray-700/30",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"text",value:y.code,onChange:$=>T({...y,code:$.target.value.toUpperCase()}),maxLength:4,className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("select",{value:y.category,onChange:$=>T({...y,category:$.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm",children:[e.jsx("option",{value:"Aircraft",children:"Aircraft"}),e.jsx("option",{value:"Crew",children:"Crew"}),e.jsx("option",{value:"Program",children:"Program"}),e.jsx("option",{value:"Weather",children:"Weather"})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"text",value:y.description,onChange:$=>T({...y,description:$.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("select",{value:y.appliesTo,onChange:$=>T({...y,appliesTo:$.target.value}),className:"w-full bg-gray-700 border border-gray-600 rounded px-2 py-1 text-white text-sm",children:[e.jsx("option",{value:"Flight",children:"Flight"}),e.jsx("option",{value:"FTD",children:"FTD"}),e.jsx("option",{value:"Both",children:"Both"})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${y.isActive?"bg-green-900/50 text-green-400":"bg-red-900/50 text-red-400"}`,children:y.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:W,className:"px-3 py-1 bg-green-600 text-white rounded text-xs font-semibold hover:bg-green-700",children:"Save"}),e.jsx("button",{onClick:_,className:"px-3 py-1 bg-gray-600 text-white rounded text-xs font-semibold hover:bg-gray-700",children:"Cancel"})]})})]},V.code):e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-700/20",children:[e.jsx("td",{className:"py-3 px-4 text-white font-mono font-semibold",children:V.code}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:V.category}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:V.description}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:V.appliesTo}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs font-semibold ${V.isActive?"bg-green-900/50 text-green-400":"bg-red-900/50 text-red-400"}`,children:V.isActive?"Active":"Inactive"})}),l&&e.jsxs("td",{className:"py-3 px-4",children:[e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx("button",{onClick:()=>A(V),disabled:u||h!==null,className:"px-3 py-1 bg-sky-600 text-white rounded text-xs font-semibold hover:bg-sky-700 disabled:bg-gray-600 disabled:cursor-not-allowed",children:"Edit"}),e.jsx("button",{onClick:()=>i(V.code),disabled:u||h!==null,className:`px-3 py-1 rounded text-xs font-semibold disabled:bg-gray-600 disabled:cursor-not-allowed ${V.isActive?"bg-amber-600 text-white hover:bg-amber-700":"bg-green-600 text-white hover:bg-green-700"}`,children:V.isActive?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>R(V.code),disabled:u||h!==null||D,className:"px-3 py-1 bg-red-600 text-white rounded text-xs font-semibold hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed",title:D?"Cannot delete code that has been used":"Delete code",children:"Delete"})]}),D&&e.jsx("p",{className:"text-xs text-gray-500 text-center mt-1",children:"Used in history"})]})]},V.code)})]})]})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:[e.jsx("p",{children:"• Only authorized users (Admin/Config roles) can add, edit, or activate/deactivate codes."}),e.jsx("p",{children:"• Codes that have been used in cancellations cannot be deleted."}),e.jsx("p",{children:"• Inactive codes remain visible in historical records."})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6 max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Confirm Delete"}),e.jsxs("p",{className:"text-gray-300 mb-6",children:["Are you sure you want to delete the cancellation code ",e.jsx("span",{className:"font-mono font-bold text-red-400",children:v}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:O,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:H,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Delete"})]})]})})]})},xA=({cancellationRecords:n,cancellationCodes:t})=>{const[s,i]=C.useState("month"),[o,l]=C.useState(!1),[d,u]=C.useState("count"),[f,h]=C.useState("desc"),m=R=>{const H=new Date,O=new Date(H);let W=new Date(H);switch(R){case"week":W.setDate(H.getDate()-7);break;case"month":W.setMonth(H.getMonth()-1);break;case"6months":W.setMonth(H.getMonth()-6);break;case"year":W.setFullYear(H.getFullYear()-1);break;case"2years":W.setFullYear(H.getFullYear()-2);break;case"5years":W.setFullYear(H.getFullYear()-5);break;case"lastFY":const ne=H.getFullYear();H.getMonth()>=6?(W=new Date(ne-1,6,1),O.setFullYear(ne),O.setMonth(5,30)):(W=new Date(ne-2,6,1),O.setFullYear(ne-1),O.setMonth(5,30));break;case"lastCY":W=new Date(H.getFullYear()-1,0,1),O.setFullYear(H.getFullYear()-1),O.setMonth(11,31);break}return{start:W,end:O}},v=R=>{const H=m(R),O=H.end.getTime()-H.start.getTime(),W=new Date(H.start);return{start:new Date(H.start.getTime()-O),end:W}},x=(R,H,O)=>R.filter(W=>{const ne=new Date(W.eventDate);return ne>=H&&ne<=O}),y=C.useMemo(()=>{const R=m(s),H=v(s),O=x(n,R.start,R.end),W=x(n,H.start,H.end),ne=O.length;let U=[...t.map(D=>{const $=O.filter(Q=>Q.cancellationCode===D.code||Q.cancellationCode==="OTHER"&&Q.manualCodeEntry===D.code).length,M=W.filter(Q=>Q.cancellationCode===D.code||Q.cancellationCode==="OTHER"&&Q.manualCodeEntry===D.code).length,P=ne>0?$/ne*100:0;let ae=0;return M>0?ae=($-M)/M*100:$>0&&(ae=100),{code:D.code,category:D.category,description:D.description,totalCount:$,percentage:P,trend:ae,previousCount:M}})];switch(d){case"count":U.sort((D,$)=>f==="desc"?$.totalCount-D.totalCount:D.totalCount-$.totalCount);break;case"percentage":U.sort((D,$)=>f==="desc"?$.percentage-D.percentage:D.percentage-$.percentage);break;case"category":U.sort((D,$)=>{const M=f==="desc"?$.category.localeCompare(D.category):D.category.localeCompare($.category);return M!==0?M:$.totalCount-D.totalCount});break}return o||(U=U.filter(D=>D.totalCount>0)),U},[n,t,s,d,f,o]),T=R=>{d===R?h(f==="desc"?"asc":"desc"):(u(R),h("desc"))},E=R=>({week:"Past Week",month:"Past Month","6months":"Past 6 Months",year:"Past Year","2years":"Past 2 Years","5years":"Past 5 Years",lastFY:"Last Financial Year",lastCY:"Last Calendar Year"})[R],A=R=>R>5?e.jsx("span",{className:"text-red-400",children:"↑"}):R<-5?e.jsx("span",{className:"text-green-400",children:"↓"}):e.jsx("span",{className:"text-gray-400",children:"→"}),_=y.reduce((R,H)=>R+H.totalCount,0);return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6 mt-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-xl font-bold text-white",children:"AC History (Cancellation Analytics & Trends)"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Time Period"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["week","month","6months","year","2years","5years","lastFY","lastCY"].map(R=>e.jsx("button",{onClick:()=>i(R),className:`px-4 py-2 rounded-md text-sm font-semibold transition-colors ${s===R?"bg-sky-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:E(R)},R))})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:R=>l(R.target.checked),className:"h-4 w-4 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 accent-sky-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Show codes with zero occurrences"})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Total Cancellations: ",e.jsx("span",{className:"font-semibold text-white",children:_})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-semibold",children:"Code"}),e.jsxs("th",{className:"text-left py-3 px-4 text-gray-300 font-semibold cursor-pointer hover:text-white",onClick:()=>T("category"),children:["Category ",d==="category"&&(f==="desc"?"↓":"↑")]}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-300 font-semibold",children:"Description"}),e.jsxs("th",{className:"text-right py-3 px-4 text-gray-300 font-semibold cursor-pointer hover:text-white",onClick:()=>T("count"),children:["Total ",d==="count"&&(f==="desc"?"↓":"↑")]}),e.jsxs("th",{className:"text-right py-3 px-4 text-gray-300 font-semibold cursor-pointer hover:text-white",onClick:()=>T("percentage"),children:["Percentage ",d==="percentage"&&(f==="desc"?"↓":"↑")]}),e.jsx("th",{className:"text-center py-3 px-4 text-gray-300 font-semibold",children:"Trend"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-8 text-center text-gray-400",children:"No cancellation data available for the selected period."})}):y.map(R=>e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-700/20",children:[e.jsx("td",{className:"py-3 px-4 text-white font-mono font-semibold",children:R.code}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:R.category}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:R.description}),e.jsx("td",{className:"py-3 px-4 text-right text-white font-semibold",children:R.totalCount}),e.jsxs("td",{className:"py-3 px-4 text-right text-white",children:[R.percentage.toFixed(1),"%"]}),e.jsxs("td",{className:"py-3 px-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[A(R.trend),e.jsxs("span",{className:`text-xs ${R.trend>5?"text-red-400":R.trend<-5?"text-green-400":"text-gray-400"}`,children:[R.trend>0?"+":"",R.trend.toFixed(0),"%"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["(prev: ",R.previousCount,")"]})]})]},R.code))})]})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:[e.jsx("p",{children:"• Percentages are calculated relative to all Flight + FTD cancellations in the selected period."}),e.jsx("p",{children:"• Trend indicators compare the selected period to the immediately preceding equivalent period."}),e.jsx("p",{children:"• Both active and inactive codes appear in analytics if used historically."})]})]})},yA=({cancellationRecords:n,cancellationCodes:t})=>{const[s,i]=C.useState("30days"),[o,l]=C.useState("date"),[d,u]=C.useState("desc"),f=C.useMemo(()=>{const T=new Date,E=new Date;switch(s){case"7days":E.setDate(T.getDate()-7);break;case"30days":E.setDate(T.getDate()-30);break;case"90days":E.setDate(T.getDate()-90);break;case"all":return n}return n.filter(A=>new Date(A.cancelledAt)>=E)},[n,s]),h=C.useMemo(()=>{const T=[...f];return T.sort((E,A)=>{let _=0;switch(o){case"date":_=new Date(E.cancelledAt).getTime()-new Date(A.cancelledAt).getTime();break;case"event":_=(E.eventName||"").localeCompare(A.eventName||"");break;case"code":_=E.cancellationCode.localeCompare(A.cancellationCode);break;case"personnel":_=(E.personnelAffected||"").localeCompare(A.personnelAffected||"");break}return d==="asc"?_:-_}),T},[f,o,d]),m=T=>{o===T?u(d==="asc"?"desc":"asc"):(l(T),u("desc"))},v=T=>{const E=t.find(A=>A.code===T);return(E==null?void 0:E.description)||"Unknown"},x=T=>{if(!T)return"No Date";const E=new Date(T);return isNaN(E.getTime())?(console.log("DATE FIX: Invalid date from:",T),"Invalid Date"):E.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},y=({field:T})=>o!==T?e.jsx("span",{className:"text-gray-500",children:"⇅"}):d==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"});return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Recent Cancellations"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-gray-400 text-sm",children:"Time Period:"}),e.jsxs("select",{value:s,onChange:T=>i(T.target.value),className:"bg-gray-700 border border-gray-600 rounded px-3 py-1 text-white text-sm",children:[e.jsx("option",{value:"7days",children:"Last 7 Days"}),e.jsx("option",{value:"30days",children:"Last 30 Days"}),e.jsx("option",{value:"90days",children:"Last 90 Days"}),e.jsx("option",{value:"all",children:"All Time"})]})]})]}),h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No cancellations found for the selected time period."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsxs("th",{className:"py-3 px-4 text-left text-gray-300 font-semibold cursor-pointer hover:text-white",onClick:()=>m("date"),children:["Date/Time ",e.jsx(y,{field:"date"})]}),e.jsxs("th",{className:"py-3 px-4 text-left text-gray-300 font-semibold cursor-pointer hover:text-white",onClick:()=>m("event"),children:["Event ",e.jsx(y,{field:"event"})]}),e.jsxs("th",{className:"py-3 px-4 text-left text-gray-300 font-semibold cursor-pointer hover:text-white",onClick:()=>m("code"),children:["Code ",e.jsx(y,{field:"code"})]}),e.jsx("th",{className:"py-3 px-4 text-left text-gray-300 font-semibold",children:"Reason"}),e.jsxs("th",{className:"py-3 px-4 text-left text-gray-300 font-semibold cursor-pointer hover:text-white",onClick:()=>m("personnel"),children:["Personnel Affected ",e.jsx(y,{field:"personnel"})]}),e.jsx("th",{className:"py-3 px-4 text-left text-gray-300 font-semibold",children:"Notes"})]})}),e.jsx("tbody",{children:h.map((T,E)=>e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-700/20",children:[e.jsx("td",{className:"py-3 px-4 text-gray-300 text-sm",children:x(T.cancelledAt||T.timestamp)}),e.jsx("td",{className:"py-3 px-4 text-white font-semibold",children:T.eventName||"N/A"}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"font-mono font-bold text-amber-400",children:T.cancellationCode})}),e.jsx("td",{className:"py-3 px-4 text-gray-300 text-sm",children:v(T.cancellationCode)}),e.jsx("td",{className:"py-3 px-4 text-gray-300 text-sm",children:T.personnelAffected||"N/A"}),e.jsx("td",{className:"py-3 px-4 text-gray-400 text-sm max-w-xs truncate",children:T.notes||"-"})]},E))})]})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Showing ",h.length," cancellation",h.length!==1?"s":""]})]})]})},Zu=[{code:"AD",category:"Aircraft",description:"On deployment",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"AT",category:"Aircraft",description:"Time constraint",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"AU",category:"Aircraft",description:"Unavailable",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"CI",category:"Crew",description:"Instructor",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"CO",category:"Crew",description:"Other crew",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"CP",category:"Crew",description:"Pilot",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"CS",category:"Crew",description:"Student",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"PC",category:"Program",description:"Change",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"PE",category:"Program",description:"Error",appliesTo:"Both",isActive:!0,createdAt:new Date().toISOString()},{code:"WX",category:"Weather",description:"Weather",appliesTo:"Flight",isActive:!0,createdAt:new Date().toISOString()}],bA=({currentUserRole:n,cancellationRecords:t})=>{const[s,i]=C.useState([]),[o,l]=C.useState(new Set),d=n==="Super Admin"||n==="Admin";C.useEffect(()=>{const x=localStorage.getItem("cancellationCodes");if(x)try{i(JSON.parse(x))}catch(y){console.error("Error loading cancellation codes:",y),i(Zu)}else i(Zu),localStorage.setItem("cancellationCodes",JSON.stringify(Zu))},[]),C.useEffect(()=>{const x=new Set;t.forEach(y=>{x.add(y.cancellationCode),y.manualCodeEntry&&x.add(y.manualCodeEntry)}),l(x)},[t]);const u=x=>{i(x),localStorage.setItem("cancellationCodes",JSON.stringify(x))},f=x=>{if(s.some(T=>T.code===x.code)){alert("A code with this identifier already exists.");return}const y=[...s,x];u(y)},h=(x,y)=>{const T=s.map(E=>E.code===x?y:E);u(T)},m=x=>{const y=s.map(T=>T.code===x?{...T,isActive:!T.isActive,updatedAt:new Date().toISOString()}:T);u(y)},v=x=>{const y=s.filter(T=>T.code!==x);u(y)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"AC History"}),e.jsx("p",{className:"text-gray-400",children:"Manage cancellation codes and view cancellation analytics and trends."})]}),e.jsx("button",{onClick:()=>{const x=localStorage.getItem("cancellationRecords");alert("cancellationRecords: "+x),console.log("cancellationRecords:",x)},className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 transition-colors",children:"Debug LocalStorage"})]})}),e.jsx(pA,{codes:s,onAddCode:f,onEditCode:h,onToggleActive:m,onDeleteCode:v,canEdit:d,usedCodes:o}),e.jsx(yA,{cancellationRecords:t,cancellationCodes:s}),e.jsx(xA,{cancellationRecords:t,cancellationCodes:s})]})},vA=({callsigns:n,onUpdateCallsigns:t,units:s,locations:i,canEditSettings:o,onAuditLog:l})=>{const[d,u]=C.useState(!1),[f,h]=C.useState([]),[m,v]=C.useState("ALL"),[x,y]=C.useState({name:"",code:"",unit:"",location:"",locationCode:""}),T=()=>{h([...n]),u(!0)},E=()=>{const W=n.map(V=>`${V.name} (${V.code})`).join(", "),ne=f.map(V=>`${V.name} (${V.code})`).join(", ");t(f),u(!1),l&&l({timestamp:new Date().toISOString(),page:"Settings - Location - Formation Callsigns",action:"Updated Formation Callsigns",changes:`From: [${W}] To: [${ne}]`})},A=()=>{y({name:"",code:"",unit:"",location:"",locationCode:""}),u(!1)},_=()=>{x.name&&x.code&&x.unit&&x.location&&x.locationCode&&(h([...f,{...x}]),y({name:"",code:"",unit:"",location:"",locationCode:""}))},R=W=>{h(f.filter((ne,V)=>V!==W))},H=(W,ne,V)=>{const U=[...f];U[W]={...U[W],[ne]:V},h(U)},O=d?m==="ALL"?f:f.filter(W=>W.unit===m):m==="ALL"?n:n.filter(W=>W.unit===m);return e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-[800px] h-fit",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Formation Callsigns"}),d?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:E,className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Save"}),e.jsx("button",{onClick:A,className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs font-semibold",children:"Cancel"})]}):e.jsx("button",{onClick:T,disabled:!o,className:`px-3 py-1 rounded-md text-xs font-semibold ${o?"bg-gray-600 text-white hover:bg-gray-700 cursor-pointer":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:"Edit"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"Filter by Unit:"}),e.jsxs("select",{value:m,onChange:W=>v(W.target.value),className:"bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white text-sm focus:outline-none focus:ring-sky-500",children:[e.jsx("option",{value:"ALL",children:"ALL"}),s.map(W=>e.jsx("option",{value:W,children:W},W))]})]}),d?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Manage formation callsigns for units."}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-700 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Code"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Location"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Loc Code"}),e.jsx("th",{className:"px-3 py-2 text-center text-gray-300 font-semibold",children:"Action"})]})}),e.jsx("tbody",{children:O.map((W,ne)=>{const V=f.findIndex(U=>U.name===W.name&&U.code===W.code&&U.unit===W.unit);return e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-700/30",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"text",value:W.name,onChange:U=>H(V,"name",U.target.value),className:"w-full bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"text",value:W.code,onChange:U=>H(V,"code",U.target.value.toUpperCase()),className:"w-full bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("select",{value:W.unit,onChange:U=>H(V,"unit",U.target.value),className:"w-full bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs",children:[e.jsx("option",{value:"",children:"Select..."}),s.map(U=>e.jsx("option",{value:U,children:U},U))]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("select",{value:W.location,onChange:U=>H(V,"location",U.target.value),className:"w-full bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs",children:[e.jsx("option",{value:"",children:"Select..."}),i.map(U=>e.jsx("option",{value:U,children:U},U))]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"text",value:W.locationCode,onChange:U=>H(V,"locationCode",U.target.value.toUpperCase()),className:"w-full bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs",maxLength:3})}),e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("button",{onClick:()=>R(V),className:"p-1 text-gray-400 hover:text-red-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})})]},ne)})})]})}),e.jsxs("div",{className:"border-t border-gray-700 pt-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-2",children:"Add New Callsign:"}),e.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[e.jsx("input",{type:"text",value:x.name,onChange:W=>y({...x,name:W.target.value}),placeholder:"Name",className:"bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs"}),e.jsx("input",{type:"text",value:x.code,onChange:W=>y({...x,code:W.target.value.toUpperCase()}),placeholder:"Code",className:"bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs"}),e.jsxs("select",{value:x.unit,onChange:W=>y({...x,unit:W.target.value}),className:"bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs",children:[e.jsx("option",{value:"",children:"Unit..."}),s.map(W=>e.jsx("option",{value:W,children:W},W))]}),e.jsxs("select",{value:x.location,onChange:W=>y({...x,location:W.target.value}),className:"bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs",children:[e.jsx("option",{value:"",children:"Location..."}),i.map(W=>e.jsx("option",{value:W,children:W},W))]}),e.jsx("input",{type:"text",value:x.locationCode,onChange:W=>y({...x,locationCode:W.target.value.toUpperCase()}),placeholder:"Code",maxLength:3,className:"bg-gray-700 border-gray-600 rounded px-2 py-1 text-white text-xs"}),e.jsx("button",{onClick:_,className:"px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-xs font-semibold",children:"Add"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Configured formation callsigns."}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-700 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Code"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Unit"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Location"}),e.jsx("th",{className:"px-3 py-2 text-left text-gray-300 font-semibold",children:"Loc Code"})]})}),e.jsx("tbody",{children:O.map((W,ne)=>e.jsxs("tr",{className:"border-b border-gray-700 hover:bg-gray-700/30",children:[e.jsx("td",{className:"px-3 py-2 text-white",children:W.name}),e.jsx("td",{className:"px-3 py-2 text-white",children:W.code}),e.jsx("td",{className:"px-3 py-2 text-white",children:W.unit}),e.jsx("td",{className:"px-3 py-2 text-white",children:W.location}),e.jsx("td",{className:"px-3 py-2 text-white",children:W.locationCode})]},ne))})]})})]})]})]})},NA=({instructors:n,trainees:t,onUpdateInstructorPermission:s,onUpdateTraineePermission:i,onShowSuccess:o,currentUserPermission:l="Super Admin"})=>{const[d,u]=C.useState(!1),[f,h]=C.useState(""),[m,v]=C.useState("All"),[x,y]=C.useState("All"),[T,E]=C.useState(new Map),A=l==="Super Admin",_=C.useMemo(()=>{const M=n.map(ae=>{var Q;return{id:ae.idNumber,name:ae.name,type:"Instructor",currentRole:[ae.isExecutive&&"Executive",ae.isFlyingSupervisor&&"Flying Supervisor",ae.isTestingOfficer&&"Testing Officer",ae.isIRE&&"IRE"].filter(Boolean).join(", ")||"Instructor",permissionLevel:((Q=ae.permissions)==null?void 0:Q[0])||"Staff"}}),P=t.map(ae=>{var Q;return{id:ae.idNumber,name:ae.name,type:"Trainee",currentRole:ae.course,permissionLevel:((Q=ae.permissions)==null?void 0:Q[0])||"Trainee"}});return[...M,...P].sort((ae,Q)=>ae.name.localeCompare(Q.name))},[n,t]),R=C.useMemo(()=>_.filter(M=>{var Te;const P=M.name.toLowerCase().includes(f.toLowerCase())||((Te=M.currentRole)==null?void 0:Te.toLowerCase().includes(f.toLowerCase())),ae=m==="All"||M.permissionLevel===m,Q=x==="All"||M.type===x;return P&&ae&&Q}),[_,f,m,x]),H=()=>{const M=new Map;_.forEach(P=>{M.set(`${P.type}-${P.id}`,P.permissionLevel)}),E(M),u(!0)},O=()=>{T.forEach((M,P)=>{var Y,fe;const[ae,Q]=P.split("-"),Te=parseInt(Q);if(ae==="Instructor"){const ge=n.find(Ne=>Ne.idNumber===Te);ge&&((Y=ge.permissions)==null?void 0:Y[0])!==M&&s(Te,M)}else if(ae==="Trainee"){const ge=t.find(Ne=>Ne.idNumber===Te);ge&&((fe=ge.permissions)==null?void 0:fe[0])!==M&&i(Te,M)}}),u(!1),o("User permissions updated successfully")},W=()=>{u(!1),E(new Map)},ne=(M,P)=>{const ae=`${M.type}-${M.id}`;E(Q=>{const Te=new Map(Q);return Te.set(ae,P),Te})},V=M=>{const P=`${M.type}-${M.id}`;return T.get(P)||M.permissionLevel},U=M=>({"Super Admin":"bg-purple
fixed inset-0 bg-black/60 z-[90] flex items-center justify-center animate-fade-in pointer-events-none",children:e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-xl border border-sky-500 p-12 max-w-2xl text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-sky-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-white",children:["Locality Changed to ",n]}),e.jsxs("p",{className:"mt-2 text-lg text-gray-300",children:["All subsequent scheduling and data modifications will now apply to the ",n," Daily Flying Program."]})]})]})})}),kA=({event:n,onReturn:t,onSave:s,school:i,traineesData:o,instructorsData:l})=>{var Bt,Kt;C.useMemo(()=>{const Mt=n.student||n.pilot;return o.find(ze=>ze.fullName===Mt)},[n,o]);const[d,u]=C.useState(""),[f,h]=C.useState("001"),[m,v]=C.useState(i),[x,y]=C.useState(i),[T,E]=C.useState(n.type==="flight"),[A,_]=C.useState(n.type==="ftd"),[R,H]=C.useState(n.flightType==="Solo"),[O,W]=C.useState(n.flightType==="Dual"),[ne,V]=C.useState(""),[U,D]=C.useState(""),[$,M]=C.useState(`${n.origin||i}-${n.destination||i} : ${n.flightNumber}`),[P,ae]=C.useState(""),[Q,Te]=C.useState(""),[Y,fe]=C.useState(""),[ge,Ne]=C.useState(""),[Oe,se]=C.useState(""),[F,J]=C.useState(""),[X,ee]=C.useState(!1),[K,ue]=C.useState(0),[ye,Le]=C.useState(!1),[xe,pe]=C.useState(0),[ce,He]=C.useState(!1),[_e,Z]=C.useState(0),[Fe,Xe]=C.useState(!1),[ft,tt]=C.useState(0),[Ve,Ke]=C.useState(!1),nt=C.useRef(null),[Ct,xt]=C.useState(!1),[dn,on]=C.useState("Saved"),st=C.useRef(!0),kt=Mt=>{if(!Mt)return"";const ze=Mt.split(" – ")[0],qt=l.find(jn=>jn.name===ze);if(qt)return`${qt.rank} ${ze.split(",")[0]}`;const Mn=o.find(jn=>jn.name===ze||jn.fullName===Mt);return Mn?`${Mn.rank} ${ze.split(",")[0]}`:ze.split(",")[0]},Ge=C.useMemo(()=>{const Mt=je=>{const $e=je.replace(":","");if($e.length<4)return null;const Ye=parseInt($e.substring(0,2),10),Dt=parseInt($e.substring(2,4),10);return isNaN(Ye)||isNaN(Dt)?null:Ye*60+Dt},ze=Mt(ne),qt=Mt(U);if(ze===null||qt===null)return"0.0";let Mn=qt-ze;return Mn<0&&(Mn+=1440),(Mn/60).toFixed(1)},[ne,U]);C.useEffect(()=>{const Mt=n.startTime,ze=String(Math.floor(Mt)).padStart(2,"0"),qt=String(Math.round(Mt%1*60)).padStart(2,"0"),Mn=`${ze}:${qt}`;V(Mn);const jn=n.landTime||n.startTime+n.duration,je=String(Math.floor(jn)).padStart(2,"0"),$e=String(Math.round(jn%1*60)).padStart(2,"0"),Ye=`${je}:${$e}`;D(Ye),nt.current||(nt.current={result:"",aircraftNumber:"001",from:i,to:i,isFlightLog:n.type==="flight",isFtdLog:n.type==="ftd",isSolo:n.flightType==="Solo",isDual:n.flightType==="Dual",duty:`${n.origin||i}-${n.destination||i} : ${n.flightNumber}`,takeoffTime:Mn,landTime:Ye,captainTime:"",instructorTime:"",nightTime:"",ifActualTime:"",ifSimTime:"",ineffectiveTime:"",ilsChecked:!1,ilsCount:0,rnpChecked:!1,rnpCount:0,tacanChecked:!1,tacanCount:0,vorChecked:!1,vorCount:0})},[n,i]),C.useEffect(()=>{O&&(Te(Ge),ae(Ge))},[O,Ge]);const ht=Mt=>{var kn,ts,un,Nn;const ze=parseFloat(Ge)||0,qt=parseFloat(ge)||0,Mn=(ye?xe:0)+(ce?_e:0)+(Fe?ft:0),jn=X?K:0;let je=0,$e=0,Ye=0,Dt=0,St=0,hn=0,Ce=0,At="",B="",Ae=0;if(T)if(Mt==="Crew"&&R)Ae=0;else{Ae=ze;const os=parseFloat(Y)||0,ss=Math.max(0,ze-os);Mt==="Captain"?(je=ss,Ye=os,At=P||(O?Ge:""),O&&(B=Q||Ge)):Mt==="Crew"&&O&&($e=ss,Dt=os)}else A&&(Mt==="Crew"&&R?Ce=0:(Ce=ze,Mt==="Captain"?B=Ge:Mt==="Crew"&&(hn=ze)));const rt=new Date(n.date),yt=rt.getFullYear().toString().slice(-2),et=rt.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}),$t=((ts=(kn=n.instructor||n.pilot)==null?void 0:kn.split(" – ")[0])==null?void 0:ts.split(",")[0])||"",pn=((Nn=(un=n.student)==null?void 0:un.split(" – ")[0])==null?void 0:Nn.split(",")[0])||(R?"Solo":"");return{year:yt,date:et,type:A?"FTD":"PC-21",tail:A?`FTD-${f}`:`A54-${f}`,captain:$t,crew:pn,duty:$,dayP1:je>0?je.toFixed(1):"",dayP2:"",dayDual:$e>0?$e.toFixed(1):"",nightP1:Ye>0?Ye.toFixed(1):"",nightP2:"",nightDual:Dt>0?Dt.toFixed(1):"",total:Ae>0?Ae.toFixed(1):"",captTime:At,instTime:B,simActual:qt>0?qt.toFixed(1):"",app2D:Mn>0?Mn:"",app3D:jn>0?jn:"",simP1:St>0?St.toFixed(1):"",simP2:"",simDual:hn>0?hn.toFixed(1):"",simTotal:Ce>0?Ce.toFixed(1):""}};C.useEffect(()=>{if(!nt.current)return;const Mt={result:d,aircraftNumber:f,from:m,to:x,isFlightLog:T,isFtdLog:A,isSolo:R,isDual:O,duty:$,takeoffTime:ne,landTime:U,captainTime:P,instructorTime:Q,nightTime:Y,ifActualTime:ge,ifSimTime:Oe,ineffectiveTime:F,ilsChecked:X,ilsCount:X?K:0,rnpChecked:ye,rnpCount:ye?xe:0,tacanChecked:ce,tacanCount:ce?_e:0,vorChecked:Fe,vorCount:Fe?ft:0},ze={...nt.current,ilsCount:nt.current.ilsChecked?nt.current.ilsCount:0,rnpCount:nt.current.rnpChecked?nt.current.rnpCount:0,tacanCount:nt.current.tacanChecked?nt.current.tacanCount:0,vorCount:nt.current.vorChecked?nt.current.vorCount:0};JSON.stringify(Mt)!==JSON.stringify(ze)&&(xt(!0),on("Saving..."))},[d,f,m,x,T,A,R,O,$,ne,U,P,Q,Y,ge,Oe,F,X,K,ye,xe,ce,_e,Fe,ft]);const vt=C.useMemo(()=>Array.from({length:49},(Mt,ze)=>String(ze+1).padStart(3,"0")),[]),Ht=Mt=>{const ze=d;u(Mt),ze&&Mt&&ze!==Mt&&jo(`postflight-${n.id}-result`,"Edit",`Updated post-flight result for ${n.flightNumber}`)},We=async(Mt=!1)=>{const ze={result:d,aircraftNumber:f,from:m,to:x,isFlightLog:T,isFtdLog:A,isSolo:R,isDual:O,duty:$,takeoffTime:ne,landTime:U,totalTime:Ge,captainTime:P,instructorTime:Q,nightTime:Y,ifActualTime:ge,ifSimTime:Oe,ineffectiveTime:F,approaches:{ils:X?K:0,rnp:ye?xe:0,tacan:ce?_e:0,vor:Fe?ft:0}};if(!Mt){og();const jn=[];jn.push(`Result: ${d}`),ne&&jn.push(`Takeoff: ${ne}`),U&&jn.push(`Land: ${U}`),Ge&&jn.push(`Total Time: ${Ge}`),Pn({action:"Edit",description:`Saved post-flight data for ${n.flightNumber}`,changes:jn.join(", "),page:"Post-Flight"})}Mt||s(ze);let qt="trainee_logbook",Mn=n.student;if((!Mn||Mn==="Multiple")&&(n.pilot?Mn=n.pilot:n.instructor&&(Mn=n.instructor,qt="staff_logbook")),Mn){const jn=Mn.split(" – ")[0].replace(/,\s/g,"_"),je=`Entry_${n.date}_${n.flightNumber.replace(/\s/g,"")}_${jn}.json`;try{const $e=JSON.stringify(ze,null,2),Ye=new File([$e],je,{type:"application/json"});await cd(Ye,qt,je)}catch($e){console.error("Failed to auto-save post-flight data to file:",$e)}}Mt||(xt(!1),on("Saved"))};C.useEffect(()=>{if(st.current){st.current=!1;return}if(Ct){const Mt=setTimeout(()=>{We(!0),on("Saved"),xt(!1)},1e3);return()=>clearTimeout(Mt)}},[Ct,d,f,m,x,T,A,R,O,$,ne,U,P,Q,Y,ge,Oe,F,X,K,ye,xe,ce,_e,Fe,ft]);const we=()=>{Ct?Ke(!0):t()},Re=()=>{We(!1)},be=(Mt,ze)=>{let qt=Mt.target.value.replace(/[^0-9]/g,"");qt.length>4&&(qt=qt.substring(0,4)),qt.length>2&&(qt=qt.slice(0,2)+":"+qt.slice(2)),ze(qt)},Ze=Mt=>{Mt.target.checked&&(E(!0),_(!1))},ot=Mt=>{Mt.target.checked&&(_(!0),E(!1))},Vt=Mt=>{const ze=Mt.target.checked;H(ze),W(!ze)},Pt=Mt=>{const ze=Mt.target.checked;W(ze),H(!ze)},yn=({value:Mt})=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"result",value:Mt,checked:d===Mt,onChange:ze=>Ht(ze.target.value),className:"h-4 w-4 accent-sky-500 bg-gray-600 border-gray-500"}),e.jsx("span",{className:"text-white",children:Mt})]}),Tt=({label:Mt,isChecked:ze,setIsChecked:qt,count:Mn,setCount:jn})=>e.jsxs("div",{className:"flex-shrink-0 flex items-end space-x-1",children:[e.jsxs("label",{className:"flex items-center space-x-1 pb-2 cursor-pointer h-[38px]",children:[e.jsx("span",{className:"text-sm font-medium text-gray-400 w-10 text-right",children:Mt}),e.jsx("input",{type:"checkbox",checked:ze,onChange:je=>{const $e=je.target.checked;qt($e),$e&&Mn===0&&jn(1)},className:"h-4 w-4 accent-sky-500 bg-gray-600 rounded border-gray-500"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:"Number"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:Mn===0?"":Mn,onChange:je=>jn(parseInt(je.target.value,10)||0),disabled:!ze,className:"block w-10 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-1 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed"})]})]}),lt=({label:Mt,subLabel:ze,value:qt,width:Mn,bgColor:jn="bg-gray-800",borderColor:je="border-gray-600",customTextClass:$e="text-xs"})=>e.jsxs("div",{className:`flex flex-col items-center justify-end ${Mn} flex-shrink-0 border-r ${je} last:border-r-0`,children:[(Mt||ze)&&e.jsxs("div",{className:"w-full text-center border-b border-gray-700 bg-gray-900/30 py-0.5",children:[Mt&&e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase leading-tight",children:Mt}),ze&&e.jsx("div",{className:"text-[8px] text-gray-500 leading-tight",children:ze})]}),e.jsx("div",{className:`w-full ${jn} text-white ${$e} font-mono py-1.5 text-center truncate px-0.5 h-7`,children:qt})]}),Et=({title:Mt,data:ze})=>e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-sm font-bold text-sky-400 mb-1 ml-1",children:Mt}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex flex-nowrap bg-gray-900 border border-gray-600 rounded-md min-w-max",children:[e.jsx(lt,{label:"Year",value:ze.year,width:"w-10"}),e.jsx(lt,{label:"Date",value:ze.date,width:"w-14"}),e.jsx(lt,{label:"Type",value:ze.type,width:"w-12"}),e.jsx(lt,{label:"Tail",subLabel:"(Mark)",value:ze.tail,width:"w-16"}),e.jsx(lt,{label:"Captain",value:ze.captain,width:"w-24"}),e.jsx(lt,{label:"Co-Pilot /",subLabel:"Crew",value:ze.crew,width:"w-24"}),e.jsx(lt,{label:"Duty",value:ze.duty,width:"w-24",customTextClass:"text-[8px]"}),e.jsxs("div",{className:"flex flex-col border-r border-gray-600",children:[e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase text-center border-b border-gray-700 bg-gray-900/30",children:"Day Flying"}),e.jsxs("div",{className:"flex",children:[e.jsx(lt,{subLabel:"P1",value:ze.dayP1,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"P2",value:ze.dayP2,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"Dual",value:ze.dayDual,width:"w-10",borderColor:"border-transparent"})]})]}),e.jsxs("div",{className:"flex flex-col border-r border-gray-600",children:[e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase text-center border-b border-gray-700 bg-gray-900/30",children:"Night Flying"}),e.jsxs("div",{className:"flex",children:[e.jsx(lt,{subLabel:"P1",value:ze.nightP1,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"P2",value:ze.nightP2,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"Dual",value:ze.nightDual,width:"w-10",borderColor:"border-transparent"})]})]}),e.jsx(lt,{label:"TOTAL",value:ze.total,width:"w-12",bgColor:"bg-gray-700/50"}),e.jsx(lt,{label:"Captain",value:ze.captTime,width:"w-12"}),e.jsx(lt,{label:"Instructor",value:ze.instTime,width:"w-12"}),e.jsx(lt,{label:"Sim",value:"",width:"w-10"})," ",e.jsx(lt,{label:"Actual",value:ze.simActual,width:"w-10"}),e.jsx(lt,{label:"2D App",value:String(ze.app2D),width:"w-10"}),e.jsx(lt,{label:"3D App",value:String(ze.app3D),width:"w-10"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase text-center border-b border-gray-700 bg-gray-900/30",children:"Simulator"}),e.jsxs("div",{className:"flex",children:[e.jsx(lt,{subLabel:"P1",value:ze.simP1,width:"w-10",borderColor:"border-gray-700",bgColor:"bg-gray-800/50"}),e.jsx(lt,{subLabel:"P2",value:ze.simP2,width:"w-10",borderColor:"border-gray-700",bgColor:"bg-gray-800/50"}),e.jsx(lt,{subLabel:"Dual",value:ze.simDual,width:"w-10",borderColor:"border-gray-700",bgColor:"bg-gray-800/50"}),e.jsx(lt,{subLabel:"TOTAL",value:ze.simTotal,width:"w-10",borderColor:"border-transparent",bgColor:"bg-gray-800/50"})]})]})]})})]});return e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 h-full",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4 w-1/3",children:[e.jsx("span",{className:"font-bold text-white text-lg",children:n.flightNumber}),e.jsxs("div",{className:"flex items-center px-3 py-1 rounded-full bg-gray-900/50 border border-gray-700",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${dn==="Saved"?"bg-green-500":dn==="Saving..."?"bg-amber-500 animate-pulse":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-300 font-mono uppercase",children:dn==="Saved"?"Saved":dn})]})]}),e.jsx("h2",{className:"text-xl font-bold text-sky-400 text-center w-1/3",children:"POST FLIGHT TIMES"}),e.jsx("span",{className:"font-mono text-gray-300 text-lg w-1/3 text-right",children:n.date})]}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsxs("div",{className:"p-6 space-y-6 max-w-7xl mx-auto w-full",children:[e.jsx("div",{className:"flex items-start gap-6",children:e.jsxs("div",{className:"bg-gray-700/50 p-4 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Result"}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx(yn,{value:"DCO"}),e.jsx(yn,{value:"DPCO"}),e.jsx(yn,{value:"DNCO"})]})]})}),e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-lg font-semibold text-gray-300",children:"Times"}),e.jsxs("div",{className:"mt-2 flex items-end space-x-4",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Flight"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:T,onChange:Ze,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"FTD"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:A,onChange:ot,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Solo"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:R,onChange:Vt,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Dual"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:O,onChange:Pt,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Date"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center",children:n.date})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Aircraft"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center",children:"PC-21"})]}),e.jsxs("div",{className:"flex-shrink-0",style:{width:"6.75rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Number"}),e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx("span",{className:"p-2 bg-gray-700 rounded-l-md text-white h-[38px] flex items-center",children:"A54-"}),e.jsx("select",{value:f,onChange:Mt=>h(Mt.target.value),className:"block w-full bg-gray-700 border border-gray-600 rounded-r-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm appearance-none text-center",children:vt.map(Mt=>e.jsx("option",{value:Mt,children:Mt},Mt))})]})]}),e.jsxs("div",{className:"flex-shrink-0",style:{width:"12rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Duty"}),e.jsx("input",{type:"text",value:$,onChange:Mt=>M(Mt.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white text-xs focus:outline-none focus:ring-sky-500"})]}),e.jsxs("div",{className:"flex-1 min-w-0",style:{flexBasis:"8rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Captain/Instructor"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center truncate",children:(Bt=n.instructor||n.pilot)==null?void 0:Bt.split(" – ")[0]})]}),e.jsxs("div",{className:"flex-1 min-w-0",style:{flexBasis:"6rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Crew/Trainee"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center truncate",children:R?"Solo":(Kt=n.student)==null?void 0:Kt.split(" – ")[0]})]})]}),e.jsxs("div",{className:"mt-4 flex items-end space-x-4 overflow-x-auto pb-2",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 text-center",children:"Route"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("input",{type:"text",value:m,onChange:Mt=>v(Mt.target.value.toUpperCase()),maxLength:3,placeholder:"From",className:"w-16 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-2 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center"}),e.jsx("input",{type:"text",value:x,onChange:Mt=>y(Mt.target.value.toUpperCase()),maxLength:3,placeholder:"To",className:"w-16 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center"})]})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Takeoff"}),e.jsx("input",{type:"text",value:ne,onChange:Mt=>be(Mt,V),placeholder:"HH:MM",className:"mt-1 block w-24 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Land"}),e.jsx("input",{type:"text",value:U,onChange:Mt=>be(Mt,D),placeholder:"HH:MM",className:"mt-1 block w-24 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Total"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-900/50 border border-gray-500 rounded-md text-white h-[38px] flex items-center justify-center font-mono w-20",children:Ge})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Captain"}),e.jsx("input",{type:"text",value:P,onChange:Mt=>ae(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Instructor"}),e.jsx("input",{type:"text",value:Q,onChange:Mt=>Te(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Night"}),e.jsx("input",{type:"text",value:Y,onChange:Mt=>fe(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"IF Actual"}),e.jsx("input",{type:"text",value:ge,onChange:Mt=>Ne(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"IF Sim"}),e.jsx("input",{type:"text",value:Oe,onChange:Mt=>se(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Ineffective"}),e.jsx("input",{type:"text",value:F,onChange:Mt=>J(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsx(Tt,{label:"ILS/GLS",isChecked:X,setIsChecked:ee,count:K,setCount:ue}),e.jsx(Tt,{label:"RNP",isChecked:ye,setIsChecked:Le,count:xe,setCount:pe}),e.jsx(Tt,{label:"TACAN",isChecked:ce,setIsChecked:He,count:_e,setCount:Z}),e.jsx(Tt,{label:"VOR/DME",isChecked:Fe,setIsChecked:Xe,count:ft,setCount:tt})]})]}),e.jsx(Et,{title:`Captain's Log (${kt(n.instructor||n.pilot)})`,data:ht("Captain")}),!R&&e.jsx(Et,{title:`Crew's Log (${kt(n.student)})`,data:ht("Crew")})]})}),e.jsxs("div",{className:"flex-shrink-0 px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:Re,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"Save & Return"}),e.jsx("button",{onClick:we,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Return"}),e.jsx(Qa,{pageName:"Post-Flight"})]}),Ve&&e.jsx(Pv,{onSaveAndExit:()=>{Ke(!1),Re(),t()},onExitWithoutSaving:()=>{Ke(!1),t()},onCancel:()=>Ke(!1)})]})},il=({label:n,value:t,className:s=""})=>e.jsxs("div",{className:`bg-gray-700/50 p-3 rounded-lg ${s}`,children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 uppercase tracking-wider",children:n}),e.jsx("p",{className:"mt-1 text-md font-semibold text-white",children:t})]}),Vd=({title:n,items:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-sky-400 mb-2",children:n}),e.jsx("div",{className:"bg-gray-700/50 p-3 rounded-lg text-sm text-gray-300",children:t&&t.length>0?e.jsx("ul",{className:"space-y-1 list-disc list-inside",children:t.map((s,i)=>e.jsx("li",{children:s},i))}):e.jsx("p",{className:"italic text-gray-500",children:"None"})})]}),DA=(n,t)=>{const s={"2-5":{text:"text-green-300",bg:"bg-green-500/20"},1:{text:"text-amber-300",bg:"bg-amber-500/20"},0:{text:"text-red-300",bg:"bg-red-500/20"}},i=n>=2?"2-5":n===1?"1":"0";return s[i][t]},_A=n=>n.type==="Flight"?"Flight":n.type==="FTD"?"FTD":n.type==="Ground School"?n.code.includes("CPT")?"CPT":"Ground":"Flight",IA=({item:n,score:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:n.code}),e.jsx("p",{className:"text-lg text-gray-400 mt-1",children:n.eventDescription})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Core Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:[e.jsx(il,{label:"Phase",value:n.phase}),e.jsx(il,{label:"Module",value:n.module}),e.jsx(il,{label:"Type",value:_A(n)}),e.jsx(il,{label:"Day/Night",value:n.dayNight||"Day"}),e.jsx(il,{label:"Dual/Solo",value:n.sortieType||"Dual"}),e.jsx(il,{label:"Total Event Hours",value:e.jsxs(e.Fragment,{children:[n.totalEventHours.toFixed(1)," ",e.jsx("span",{className:"text-sm font-normal",children:"hrs"})]})}),e.jsx(il,{label:"Flight/Sim Hours",value:e.jsxs(e.Fragment,{children:[n.flightOrSimHours.toFixed(1)," ",e.jsx("span",{className:"text-sm font-normal",children:"hrs"})]})})]})]}),t&&e.jsxs("fieldset",{className:"p-4 border border-sky-700 rounded-lg bg-sky-900/10",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-sky-300",children:"Trainee's Score"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2",children:[e.jsx(il,{label:"Overall Score",value:n.type==="Ground School"?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:"-"}),e.jsx("span",{className:"text-green-300",children:"Complete"})]}):e.jsx("span",{className:`text-xl ${DA(t.score,"text")}`,children:t.score})}),e.jsx(il,{label:"Date",value:t.date}),e.jsx(il,{label:"Instructor",value:t.instructor})]}),e.jsx("div",{className:"mt-4",children:e.jsx(il,{label:"Notes",value:e.jsx("p",{className:"whitespace-pre-wrap",children:t.notes})})})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Prerequisites"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-2",children:[e.jsx(Vd,{title:"Ground School",items:n.prerequisitesGround}),e.jsx(Vd,{title:"Sim/Flying",items:n.prerequisitesFlying})]})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Event Breakdown"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-2",children:[e.jsx(Vd,{title:"Methods of Delivery",items:n.methodOfDelivery}),e.jsx(Vd,{title:"Methods of Assessment",items:n.methodOfAssessment})]})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Resources"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-2",children:[e.jsx(Vd,{title:"Physical Resources",items:n.resourcesPhysical}),e.jsx(Vd,{title:"Human Resources",items:n.resourcesHuman})]})]})]}),LA=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),MA=({trainee:n,traineeLmp:t,scores:s,onBack:i})=>{const[o,l]=C.useState(null),d=C.useMemo(()=>new Set(s.map(u=>u.event)),[s]);return C.useEffect(()=>{l(null)},[n.fullName]),e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Individual LMP"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[n.rank," ",n.name," - ",n.course]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold shadow-md",children:"← Back - Trainee Profile"}),e.jsx(Qa,{pageName:"Individual LMP"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-row overflow-hidden",children:[e.jsx("div",{className:"w-1/4 border-r border-gray-700 overflow-y-auto",children:e.jsx("ul",{className:"p-2 space-y-1",children:t.map(u=>{const f=d.has(u.code);return e.jsx("li",{children:e.jsxs("button",{onClick:()=>l(u),className:`w-full text-left p-2 rounded-md transition-colors text-sm flex items-center space-x-2 ${(o==null?void 0:o.code)===u.code?"bg-sky-700 text-white font-semibold":"text-gray-300 hover:bg-gray-700/50"}`,children:[f?e.jsx(LA,{}):e.jsx("div",{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:u.code})]})},u.code)})})}),e.jsx("div",{className:"w-3/4 overflow-y-auto",children:e.jsx("div",{className:"p-6 max-w-5xl mx-auto",children:o?e.jsx(IA,{item:o,score:s.find(u=>u.event===o.code)}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 italic",children:"Select an item from the list to view its details."})})})})]})]})},FA=({trainee:n,instructors:t,scores:s,traineeLmp:i,onClose:o,onSave:l})=>{const[d,u]=C.useState(""),[f,h]=C.useState([]),[m,v]=C.useState({quantity:0,duration:1,instructor:""}),[x,y]=C.useState({quantity:0,duration:1.5,instructor:""}),[T,E]=C.useState({quantity:0,duration:1.5,instructor:""}),A=C.useMemo(()=>s.filter(D=>D.score===0||D.score===1).map(D=>i.find($=>$.id===D.event)).filter(D=>!!D).sort((D,$)=>new Date(s.find(M=>M.event===$.id).date).getTime()-new Date(s.find(M=>M.event===D.id).date).getTime()),[s,i]),_=C.useMemo(()=>{const $=i.map(M=>{const P=s.find(ae=>ae.event===M.id);return{item:M,score:P,date:P&&P.score>=0?new Date(P.date).getTime():null}}).filter(M=>M.score&&M.score.score>=0&&M.date!==null).sort((M,P)=>P.date-M.date);return $.length>0?$[0].item:null},[i,s]),R=C.useMemo(()=>{if(!_)return null;const D=i.findIndex($=>$.id===_.id);return D>=0&&D<i.length-1?i[D+1]:null},[i,_]),H=C.useMemo(()=>i.find(D=>D.id===d),[d,i]),O=C.useMemo(()=>H?{...H,code:`${H.code}-RF`,eventDescription:`Re-Fly: ${H.eventDescription}`}:null,[H]),W=()=>{const D=[];if(m.quantity>0&&m.instructor&&m.duration>0)for(let $=0;$<m.quantity;$++)D.push({id:_r(),type:"TUT",duration:m.duration,instructor:m.instructor});if(x.quantity>0&&x.instructor&&x.duration>0)for(let $=0;$<x.quantity;$++)D.push({id:_r(),type:"FTD",duration:x.duration,instructor:x.instructor});if(T.quantity>0&&T.instructor&&T.duration>0)for(let $=0;$<T.quantity;$++)D.push({id:_r(),type:"Flight",duration:T.duration,instructor:T.instructor});D.length>0?(h($=>[...$,...D]),v({quantity:0,duration:1,instructor:""}),y({quantity:0,duration:1.5,instructor:""}),E({quantity:0,duration:1.5,instructor:""})):alert("Please enter a quantity, duration, and instructor for at least one event type.")},ne=D=>{h($=>$.filter(M=>M.id!==D))},V=()=>{if(!H||f.length===0){alert("Please select an event to remediate and add at least one remedial event.");return}l(n,H,f)},U=({label:D,state:$,setState:M})=>e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("div",{className:"w-28 flex-shrink-0",children:e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:D})}),e.jsxs("div",{style:{width:"4.5rem"},children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Qty"}),e.jsx("input",{type:"number",min:"0",value:$.quantity,onChange:P=>M(ae=>({...ae,quantity:parseInt(P.target.value,10)||0})),className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white text-sm"})]}),e.jsxs("div",{style:{width:"6rem"},children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Dur (hrs)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:$.duration,onChange:P=>M(ae=>({...ae,duration:parseFloat(P.target.value)||0})),className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white text-sm"})]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Instructor"}),e.jsxs("select",{value:$.instructor,onChange:P=>M(ae=>({...ae,instructor:P.target.value})),className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),t.map(P=>e.jsx("option",{value:P.name,children:P.name},P.idNumber))]})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[70] flex items-center justify-center animate-fade-in",onClick:o,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl border border-gray-700 flex flex-col h-[90vh]",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-sky-400",children:["Add Remedial Package for ",n.name]}),e.jsx("button",{onClick:o,className:"text-white hover:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6 flex-1 overflow-y-auto",children:[e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Step 1: Select Failed Event"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:d,onChange:D=>u(D.target.value),className:"block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",size:"8",children:[e.jsx("option",{value:"",disabled:!0,children:"Select an event to remediate..."}),A.map(D=>e.jsx("option",{value:D.id,style:{color:(_==null?void 0:_.id)===D.id?"#ef4444":"#ffffff",fontWeight:(_==null?void 0:_.id)===D.id?"bold":"normal"},children:D.code},D.id))]}),_&&(()=>{const D=A.findIndex($=>$.id===_.id);if(D>=0){const $=document.querySelector('select[size="8"]');if($){const M=Math.max(0,D-3);$.selectedIndex=M,setTimeout(()=>{$.selectedIndex=d||-1},100)}}return null})()]}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[_&&e.jsxs("div",{className:"text-red-400",children:["Last completed: ",_.code]}),R&&e.jsxs("div",{className:"text-green-400",children:["Next event: ",R.code]})]})]})]}),H&&e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Step 2: Build Remedial Package"}),e.jsxs("div",{className:"mt-2 p-3 bg-gray-700/30 rounded-lg space-y-3",children:[e.jsx(U,{label:"Tutorials",state:m,setState:v}),e.jsx(U,{label:"FTDs",state:x,setState:y}),e.jsx(U,{label:"Flights",state:T,setState:E})]}),e.jsx("button",{onClick:W,className:"w-full mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-semibold",children:"Add Events to Package"}),e.jsx("div",{className:"mt-4 space-y-2",children:f.map(D=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-700/50 rounded-md text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"font-bold text-sky-400 w-16",children:D.type}),e.jsxs("span",{className:"text-gray-300",children:[D.duration.toFixed(1)," hrs with ",(D.instructor||"").split(",")[0]]})]}),e.jsx("button",{onClick:()=>ne(D.id),className:"p-1 text-gray-400 hover:text-red-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},D.id))})]}),O&&e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Step 3: Review Auto-Generated Re-Fly"}),e.jsxs("div",{className:"mt-2 p-3 bg-gray-700/30 rounded-lg",children:[e.jsxs("p",{className:"text-white font-semibold",children:[O.code," - ",O.eventDescription]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"This is a copy of the original event and will be added as the final step of the package."})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:V,disabled:!H||f.length===0,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Save Package"})]})]})})},PA=({course:n,allTrainees:t,scores:s,traineeLMPs:i,onUpdateGradDate:o,onUpdateStartDate:l,onShowFullGraph:d})=>{const{name:u,color:f,gradDate:h,startDate:m}=n,v=y=>y.filter(T=>!T.event.includes("MB")&&!T.event.includes("-REM-")&&!T.event.includes("-RF")).length,x=C.useMemo(()=>{var Te;const y=t.filter(Y=>Y.course===u&&!Y.isPaused),E=(i.get((Te=y[0])==null?void 0:Te.fullName)||[]).filter(Y=>!Y.id.includes(" MB")&&!Y.isRemedial),A=E.length,_=y.map(Y=>{const fe=i.get(Y.fullName)||[],ge=s.get(Y.fullName)||[],Ne=new Set(ge.map(J=>J.event));let Oe="Finished";const se=v(ge);if(se<A){Oe="N/A";for(const J of fe)if(!Ne.has(J.id)&&!J.code.includes(" MB")&&J.prerequisites.every(ee=>Ne.has(ee))){Oe=J.code;break}}const F=A>0?se/A*100:0;return{trainee:Y,percentage:F,nextEvent:Oe,completedCount:se}}).sort((Y,fe)=>fe.completedCount-Y.completedCount),R=_.map(Y=>Y.completedCount).sort((Y,fe)=>Y-fe),H=R.length>0?R[R.length-1]:0,O=H-1;let W="N/A";H>0&&O<E.length?W=E[O].code:y.length>0&&(W="Not Started");const ne=R.length>0?R[0]:0,V=ne-1;let U="N/A";ne>0&&V<E.length?U=E[V].code:y.length>0&&(U="Not Started");let D=0;if(R.length>0){const Y=Math.floor(R.length/2);D=R.length%2!==0?R[Y]:(R[Y-1]+R[Y])/2}let $="N/A";const M=Math.floor(D)-1;A>0&&M>=0&&M<E.length?$=E[M].code:D<1&&y.length>0&&($="Not Started");const P=A>0?D/A*100:0;let ae=0;const Q=A-D;if(Q>0&&h){const Y=new Date;Y.setHours(0,0,0,0);const ge=(new Date(h).getTime()-Y.getTime())/(1e3*60*60*24);if(ge>0){const Ne=ge/7;ae=Q/Ne}}return{trainees:_.sort((Y,fe)=>fe.percentage-Y.percentage),medianProgressPercentage:P,medianEvent:$,totalSyllabusEvents:A,frontRunnerEvent:W,backMarkerEvent:U,requiredPace:ae,medianCountValue:D}},[u,t,s,i,h]);return e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 flex flex-col h-fit",children:[e.jsxs("div",{className:`p-4 border-b border-gray-700 rounded-t-lg ${f}`,children:[e.jsx("h2",{className:"text-lg font-bold text-white text-center mb-2",children:u}),e.jsxs("div",{className:"flex justify-between items-center text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{htmlFor:`start-date-${u.replace(/\s+/g,"-")}`,className:"text-white/80 font-semibold cursor-pointer",children:"Start:"}),e.jsx("input",{type:"date",id:`start-date-${u.replace(/\s+/g,"-")}`,value:m,onChange:y=>l(u,y.target.value),className:"bg-transparent text-white/80 font-semibold border-0 rounded p-1 focus:ring-2 focus:ring-sky-500 focus:outline-none w-28 appearance-none",style:{colorScheme:"dark"}})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{htmlFor:`grad-date-${u.replace(/\s+/g,"-")}`,className:"text-white/80 font-semibold cursor-pointer",children:"Grad:"}),e.jsx("input",{type:"date",id:`grad-date-${u.replace(/\s+/g,"-")}`,value:h,onChange:y=>o(u,y.target.value),className:"bg-transparent text-white/80 font-semibold border-0 rounded p-1 focus:ring-2 focus:ring-sky-500 focus:outline-none w-28 appearance-none",style:{colorScheme:"dark"}})]})]}),e.jsx("div",{className:"w-full bg-black/30 rounded-full h-2.5 mt-2",children:e.jsx("div",{className:"bg-white/80 h-2.5 rounded-full",style:{width:`${x.medianProgressPercentage}%`}})}),e.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-x-4 text-xs",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-white/70",children:["Front Runner: ",e.jsx("span",{className:"font-semibold text-white/90",children:x.frontRunnerEvent})]}),e.jsxs("p",{className:"text-white",children:["Median Progress: ",e.jsx("span",{className:"font-bold text-white",children:x.medianEvent})]}),e.jsxs("p",{className:"text-white/70",children:["Back Marker: ",e.jsx("span",{className:"font-semibold text-white/90",children:x.backMarkerEvent})]})]}),e.jsxs("div",{className:"text-right flex flex-col justify-center",children:[e.jsx("p",{className:"text-white/70",children:"Required Pace"}),e.jsxs("p",{className:"font-bold text-lg text-white",children:[x.requiredPace.toFixed(1),e.jsx("span",{className:"text-sm font-normal",children:"/wk"})]})]})]})]}),e.jsx("div",{className:"p-4 space-y-3 max-h-60 overflow-y-auto",children:x.trainees.map(({trainee:y,percentage:T,nextEvent:E})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:y.name}),e.jsx("span",{className:"text-xs font-mono text-sky-300",children:E})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:`${f} h-1.5 rounded-full`,style:{width:`${T}%`}})})]},y.idNumber))}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx("button",{onClick:d,className:"w-full text-center px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-500 transition-colors text-sm font-semibold",children:"Show Progress Graph"})})]})};function RA(n,t,s,i){if(console.log("[CourseStatistics] Input data:",{traineesCount:n.length,scoresMapSize:t.size,traineeLMPsMapSize:s.size,coursesCount:i.length}),n.length===0)return console.log("[CourseStatistics] No trainees provided"),{frontRunnerStats:{eventsPerWeek:0,totalEvents:0,totalWeeks:0,completionRate:0},backMarkerStats:{eventsPerWeek:0,totalEvents:0,totalWeeks:0,completionRate:0},courseAverageStats:{eventsPerWeek:0,totalEvents:0,totalWeeks:0,completionRate:0}};const o=[];for(const x of n){const y=i.find($=>$.name===x.course);if(!y){console.log(`[CourseStatistics] No course found for trainee ${x.fullName}, course: ${x.course}`);continue}const T=t.get(x.fullName)||[],E=s.get(x.fullName)||[];console.log(`[CourseStatistics] Processing trainee: ${x.fullName}`,{scoresCount:T.length,lmpCount:E.length,courseName:y.name,courseStart:y.startDate,courseGrad:y.gradDate});let A=0;for(const $ of T){if($.event.includes("MB")||$.event.includes("-REM-")||$.event.includes("-RF"))continue;const M=E.find(P=>P.id===$.event);M&&(M.type==="Flight"||M.type==="FTD")&&!M.isRemedial&&A++}const _=E.filter($=>($.type==="Flight"||$.type==="FTD")&&!$.isRemedial).length;if(console.log(`[CourseStatistics] ${x.fullName}: completed=${A}, total=${_}`),_===0){console.log(`[CourseStatistics] Skipping ${x.fullName} - no required events`);continue}const R=A/_,H=new Date(y.startDate+"T00:00:00Z"),O=new Date,W=Math.max(0,(O.getTime()-H.getTime())/(1e3*60*60*24*7)),ne=new Date(y.gradDate+"T00:00:00Z"),V=Math.max(0,(ne.getTime()-O.getTime())/(1e3*60*60*24*7)),U=_-A,D=V>0?U/V:0;console.log(`[CourseStatistics] ${x.fullName}: weeksRemaining=${V.toFixed(1)}, eventsRemaining=${U}, eventsPerWeek=${D.toFixed(1)}`),o.push({name:x.fullName,completedEvents:A,totalRequired:_,completionRate:R,eventsPerWeek:D,weeksElapsed:W,weeksRemaining:V})}if(o.length===0)return console.log("[CourseStatistics] No trainee stats calculated - returning zeros"),{frontRunnerStats:{eventsPerWeek:0,totalEvents:0,totalWeeks:0,completionRate:0},backMarkerStats:{eventsPerWeek:0,totalEvents:0,totalWeeks:0,completionRate:0},courseAverageStats:{eventsPerWeek:0,totalEvents:0,totalWeeks:0,completionRate:0}};console.log(`[CourseStatistics] Calculated stats for ${o.length} trainees`),o.sort((x,y)=>y.completionRate-x.completionRate);const l=o[0],d=o[o.length-1],u=o.reduce((x,y)=>x+y.completionRate,0)/o.length,f=o.reduce((x,y)=>x+y.eventsPerWeek,0)/o.length,h=o.reduce((x,y)=>x+y.completedEvents,0)/o.length,m=o.reduce((x,y)=>x+y.weeksRemaining,0)/o.length,v={frontRunnerStats:{eventsPerWeek:l.eventsPerWeek,totalEvents:l.completedEvents,totalWeeks:l.weeksRemaining,completionRate:l.completionRate},backMarkerStats:{eventsPerWeek:d.eventsPerWeek,totalEvents:d.completedEvents,totalWeeks:d.weeksRemaining,completionRate:d.completionRate},courseAverageStats:{eventsPerWeek:f,totalEvents:h,totalWeeks:m,completionRate:u}};return console.log("[CourseStatistics] Final result:",{frontRunner:`${l.name}: ${l.eventsPerWeek.toFixed(1)}/wk`,backMarker:`${d.name}: ${d.eventsPerWeek.toFixed(1)}/wk`,average:`${f.toFixed(1)}/wk`}),v}const UA=({courses:n,allTrainees:t,scores:s,traineeLMPs:i,courseColors:o,initialSelectedCourse:l,onClose:d})=>{const[u,f]=C.useState(l),h=C.useMemo(()=>{var x;const v=[];for(const y of n){if(!o[y.name])continue;const T=t.filter(U=>U.course===y.name&&!U.isPaused);if(T.length===0)continue;const _=(i.get((x=T[0])==null?void 0:x.fullName)||[]).filter(U=>(U.type==="Flight"||U.type==="FTD")&&!U.isRemedial).length;if(_===0)continue;const R=new Date(y.startDate+"T00:00:00Z"),H=new Date(y.gradDate+"T00:00:00Z");let O=null;for(const U of T){const D=s.get(U.fullName)||[],$=i.get(U.fullName)||[];for(const M of D){if(M.event.includes("MB")||M.event.includes("-REM-")||M.event.includes("-RF"))continue;const P=$.find(ae=>ae.id===M.event);if(P&&(P.type==="Flight"||P.type==="FTD")&&!P.isRemedial){const ae=new Date(M.date+"T00:00:00Z");(!O||ae<O)&&(O=ae)}}}if(!O){console.log(`[ProgressGraph] No first event date found for ${y.name}`);continue}const W=[],ne=new Date;ne.setHours(0,0,0,0);let V=new Date(O);for(V.setHours(0,0,0,0);V<=ne;){const U=new Date(V);U.setDate(U.getDate()+7);const D=[];for(const $ of T){const M=s.get($.fullName)||[],P=i.get($.fullName)||[];let ae=0;for(const Q of M)if(new Date(Q.date+"T00:00:00Z")<=U){if(Q.event.includes("MB")||Q.event.includes("-REM-")||Q.event.includes("-RF"))continue;const Y=P.find(fe=>fe.id===Q.event);Y&&(Y.type==="Flight"||Y.type==="FTD")&&!Y.isRemedial&&ae++}D.push({name:$.fullName,count:ae})}if(D.length>0){D.sort((ae,Q)=>Q.count-ae.count);const $=D[0].count,M=D[D.length-1].count,P=D.reduce((ae,Q)=>ae+Q.count,0)/D.length;W.push({weekDate:new Date(V),highest:$,lowest:M,average:P,highestTrainee:D[0].name,lowestTrainee:D[D.length-1].name})}V.setDate(V.getDate()+7)}console.log(`[ProgressGraph] Course: ${y.name}`),console.log(`  - Course Start: ${R.toLocaleDateString()}`),console.log(`  - Course Grad: ${H.toLocaleDateString()}`),console.log(`  - Total Events: ${_}`),console.log(`  - First Event Date: ${O==null?void 0:O.toLocaleDateString()}`),console.log(`  - Weekly Progress Points: ${W.length}`),W.length>0&&(console.log("  - Sample Week 1:",W[0]),console.log("  - Sample Last Week:",W[W.length-1])),v.push({course:y,startDate:R,endDate:H,totalEvents:_,weeklyProgress:W,color:o[y.name]})}return console.log(`[ProgressGraph] Total courses with data: ${v.length}`),v},[n,t,s,i,o]),m=u?h.filter(v=>v.course.name===u):h;return e.jsxs("div",{className:"fixed inset-0 z-50 bg-gray-900 flex flex-col",children:[e.jsxs("div",{className:"bg-gray-800 border-b border-gray-700 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors font-semibold",children:"← Minimize"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Course Progress Graphs"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-gray-300 text-sm font-semibold",children:"Filter:"}),e.jsxs("select",{value:u||"",onChange:v=>f(v.target.value||null),className:"bg-gray-700 text-white rounded-md px-3 py-2 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"",children:"All Courses"}),h.map(v=>e.jsx("option",{value:v.course.name,children:v.course.name},v.course.name))]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:e.jsx("div",{className:"space-y-8 max-w-7xl mx-auto",children:m.map(v=>e.jsx(BA,{data:v,allTrainees:t,scores:s,traineeLMPs:i,courses:n},v.course.name))})})]})},BA=({data:n,allTrainees:t,scores:s,traineeLMPs:i,courses:o})=>{const{course:l,startDate:d,endDate:u,totalEvents:f,weeklyProgress:h,color:m}=n,{frontRunnerStats:v,backMarkerStats:x,courseAverageStats:y}=C.useMemo(()=>{const D=t.filter($=>$.course===l.name&&!$.isPaused);return D.length===0?{frontRunnerStats:{eventsPerWeek:0},backMarkerStats:{eventsPerWeek:0},courseAverageStats:{eventsPerWeek:0}}:RA(D,s,i,[l])},[l,t,s,i]),T=800,E=450,A={top:50,right:50,bottom:70,left:70},_=T-A.left-A.right,R=E-A.top-A.bottom,H=D=>{const $=u.getTime()-d.getTime(),M=D.getTime()-d.getTime(),P=A.left+M/$*_;return Math.max(A.left,Math.min(A.left+_,P))},O=D=>A.top+R-D/f*R,W=C.useMemo(()=>{const D=[],$=[{rate:3.5,color:"#34d399",label:"3.5/wk",dash:"8 4"},{rate:4,color:"#fbbf24",label:"4.0/wk",dash:"none"},{rate:4.5,color:"#f87171",label:"4.5/wk",dash:"8 4"}];for(const{rate:M,color:P,label:ae,dash:Q}of $){const Y=f/M*7,fe=new Date(u);fe.setDate(fe.getDate()-Math.floor(Y)),D.push({x1:H(fe),y1:O(0),x2:H(u),y2:O(f),color:P,label:ae,dash:Q})}return D},[d,u,f]),ne=C.useMemo(()=>{const D=[];for(let M=0;M<=8;M++){const P=f/8*M;D.push({value:Math.round(P),y:O(P)})}return D},[f]),V=C.useMemo(()=>{const D=[],$=new Date(d);for($.setDate(1);$<=u;)$>=d&&D.push({date:new Date($),x:H($),label:$.toLocaleDateString("en-GB",{month:"short",year:"2-digit"})}),$.setMonth($.getMonth()+1);return D},[d,u]),U=C.useMemo(()=>h.length===0?"":h.map($=>({x:H($.weekDate),y:O($.average)})).map(($,M)=>`${M===0?"M":"L"} ${$.x} ${$.y}`).join(" "),[h]);return m.includes("sky")||m.includes("purple
