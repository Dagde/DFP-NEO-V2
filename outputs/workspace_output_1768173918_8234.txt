                return <CourseRosterView 
                            events={events}
                            traineesData={traineesData}
                            courseColors={courseColors}
                            archivedCourses={archivedCourses}
                            personnelData={personnelData}
                            onNavigateToHateSheet={(trainee) => {
                                setSelectedTraineeForHateSheet(trainee);
                                handleNavigation('HateSheet');
                            }}
                            onRestoreCourse={() => {}}
                            onUpdateTrainee={(data) => {
                                const isNewTrainee = !traineesData.find(t => t.idNumber === data.idNumber);
                                
                                if (isNewTrainee) {
                                    // Initialize Individual LMP for new trainee
                                    const lmpType = data.lmpType || 'BPC+IPC';
                                    const masterLMP = syllabusDetails.filter(item => {
                                        if (lmpType === 'BPC+IPC') {
                                            return !item.lmpType || item.lmpType === 'Master LMP';
                                        }
                                        return item.courses.includes(lmpType);
                                    });
                                    
                                    if (masterLMP.length > 0) {
                                        setTraineeLMPs(prev => {
                                            const newLMPs = new Map(prev);
                                            newLMPs.set(data.fullName, [...masterLMP]);
                                            console.log(`[Individual LMP] Initialized ${data.fullName}'s Individual LMP with ${lmpType} (${masterLMP.length} events)`);
                                            return newLMPs;
                                        });
                                    }
                                }
                                
                                setTraineesData(prev => prev.map(t => t.idNumber === data.idNumber ? data : t));
                            }}
                            onAddTrainee={handleAddTrainee}
                            school={school}
                            scores={scores}
                            syllabusDetails={syllabusDetails}
                            onNavigateToSyllabus={onNavigateToSyllabus}
                            onNavigateToCurrency={handleNavigateToCurrency}
                            onViewIndividualLMP={handleViewTraineeLMP}
                            onAddRemedialPackage={handleOpenAddRemedialPackage}
                            locations={locations}
                            units={units}
                            selectedPersonForProfile={selectedPersonForProfile as Trainee | null}
                            onProfileOpened={() => setSelectedPersonForProfile(null)}
                            traineeLMPs={traineeLMPs}
                            onViewLogbook={handleViewLogbook}
                            onDeleteTrainee={(trainee) => {
                                setTraineesData(prev => prev.filter(t => t.idNumber !== trainee.idNumber));
                                // Remove from trainee LMPs if exists
                                setTraineeLMPs(prev => {
                                    const newLMPs = new Map(prev);
                                    newLMPs.delete(trainee.fullName);
                                    return newLMPs;
                                });
                                // Log audit for deletion
                                logAudit({
                                    page: 'Trainee Roster',
                                    action: 'delete',
                                    description: `Deleted trainee from roster`,
                                    changes: `Removed: ${trainee.rank} ${trainee.name} (${trainee.course}) - ID: ${trainee.idNumber}`
                                });
                            }}
                        />;
            case 'HateSheet':
                if (selectedTraineeForHateSheet) {
                    const traineeAssessments = Array.from(pt051Assessments.values()).filter(
                        // FIX: Add explicit type annotation for `a` as TypeScript was failing to infer it.
                        (a: Pt051Assessment) => a.traineeFullName === selectedTraineeForHateSheet.fullName
                    );
                    const eventFromSchedules = [...eventsForDate, ...highestPriorityEvents];
                    return <HateSheetView
                                trainee={selectedTraineeForHateSheet}
