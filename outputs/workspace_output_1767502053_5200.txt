    const handleSave = () => {
        const eventsToSave: ScheduleEvent[] = crew.map((c, index) => {
            let eventColor = event.color;
            
            const traineeName = c.student || c.pilot;
            if (traineeName) {
                const traineeDetails = traineesData.find(t => t.fullName === traineeName);
                if (traineeDetails && courseColors[traineeDetails.course]) {
                    eventColor = courseColors[traineeDetails.course];
                }
            }
            
            // Handle deployment assignment
            let resourceId = event.resourceId;
            if (selectedDeploymentId) {
                // Find the selected deployment and assign its resourceId
                const selectedDeployment = getCurrentDeployments().find(d => d.id === selectedDeploymentId);
                if (selectedDeployment) {
                    resourceId = selectedDeployment.resourceId;
                    console.log(`Assigning event to deployment: ${selectedDeployment.id} (${resourceId})`);
                }
            }
            
            // For SCT FORM events with multiple aircraft, generate unique IDs for each event
            const eventId = (flightNumber === 'SCT FORM' && crew.length > 1) 
                ? `${event.id}-${index}-${Date.now()}` 
                : event.id;
            
            // For SCT FORM events with multiple aircraft, clear resourceId so findAvailableResourceId assigns them to different lines
            if (flightNumber === 'SCT FORM' && crew.length > 1) {
                resourceId = '';
            }
            
            const savedEvent = {
                ...event,
                id: eventId,
                type: eventType,
                flightNumber,
                startTime: typeof startTime === 'string' ? convertTimeToDecimal(startTime) : startTime,
                resourceId,
                duration: typeof duration === 'number' ? duration : 0, // Ensure duration is a number
                area: eventType === 'flight' ? area : undefined,
                aircraftNumber: eventType === 'flight' ? aircraftNumber : undefined,
                color: eventColor,
                flightType: c.flightType,
                instructor: c.instructor,
                student: c.student,
                pilot: c.pilot,
                group: c.group,
                groupTraineeIds: c.groupTraineeIds,
                locationType,
