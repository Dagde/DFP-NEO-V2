        
        // Remove from highest priority events
        setHighestPriorityEvents(prev => prev.filter(e => e.id !== selectedEvent.id));
        
        // Force a refresh of the events by updating the date
        const currentDate = date;
        setDate(''); // Clear date
        setTimeout(() => setDate(currentDate), 100); // Reset date after 100ms
        
        // Log the cancellation to audit trail
        const pageName = isNextDay ? 'Next Day Build' : 'Program Schedule';
        const eventType = selectedEvent.type || 'event';
        const personName = selectedEvent.student || selectedEvent.pilot || selectedEvent.instructor || 'Unknown';
        const codeDisplay = cancellationCode === 'OTHER' && manualCodeEntry ? manualCodeEntry : cancellationCode;
        const description = `Cancelled ${eventType} event for ${personName} (Code: ${codeDisplay})`;
        const changes = `Event: ${selectedEvent.syllabusItem || selectedEvent.flightNumber || eventType}, Time: ${selectedEvent.startTime}, Duration: ${selectedEvent.duration}hrs, Moved to STBY`;
        
        logAudit(pageName, "Cancel", description, changes);
        setSelectedEvent(null);
        
        console.log('ðŸš« ========== CANCELLATION COMPLETE ==========');
    };
    
    const handleDeleteEvent = () => {
        if (!selectedEvent) return;
        const eventDate = selectedEvent.date;

        setHighestPriorityEvents(prev => prev.filter(e => e.id !== selectedEvent.id));

        const isNextDay = eventDate === buildDfpDate && (activeView === 'NextDayBuild' || activeView === 'Priorities' || activeView === 'ProgramData');

        if (isNextDay) {
            setNextDayBuildEvents(prev => prev.filter(e => e.id !== selectedEvent.id));
        } else {
            setPublishedSchedules((prev: Record<string, ScheduleEvent[]>) => {
                const newScheduleForDate = (prev[eventDate] || []).filter(e => e.id !== selectedEvent.id);
                return { ...prev, [eventDate]: newScheduleForDate };
            });
        }
        
        // NEW APPROACH: Trigger PT-051 sync after deletion (only for Active DFP)
        if (!isNextDay) {
            console.log('ðŸ“‹ Triggering PT-051 sync after event deletion...');
            setTimeout(() => {
                console.log('â° Executing delayed PT-051 sync after deletion...');
                setPublishedSchedules(currentSchedules => {
                    setPt051Assessments(currentAssessments => {
                        syncPt051WithActiveDfp(currentSchedules, currentAssessments);
                        return currentAssessments;
                    });
                    return currentSchedules;
