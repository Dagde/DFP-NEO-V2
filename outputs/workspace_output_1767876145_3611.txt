      events = Array.isArray(scheduleResult) ? scheduleResult : [];

      console.log('Data loaded from API:', {
        instructors: instructors.length,
        trainees: trainees.length,
        events: events.length,
        courses: courses.length,
        coursePriorities: coursePriorities.length,
        scores: scoresResult.size,
        pt051Assessments: pt051Assessments.size,
        coursePercentages: coursePercentages.size,
        traineeLMPs: traineeLMPs.size,
      });
      
      console.log('‚úÖ Instructors sample:', instructors.slice(0, 3));
      console.log('‚úÖ Trainees sample:', trainees.slice(0, 3));
      
      // Log all unique course names from trainees
      const uniqueCourses = [...new Set(trainees.map(t => t.course).filter(c => c))];
      console.log('üìã Unique trainee courses:', uniqueCourses);
      
      // Log trainees with empty/missing courses
      const traineesWithoutCourse = trainees.filter(t => !t.course || t.course.trim() === '');
      console.log('‚ö†Ô∏è Trainees without course:', traineesWithoutCourse.length, traineesWithoutCourse.slice(0, 5));

      // Save to localStorage for faster next load (non-critical if it fails)
      try {
        saveToStorage(STORAGE_KEYS.INSTRUCTORS, instructors);
        saveToStorage(STORAGE_KEYS.TRAINEES, trainees);
        saveToStorage(STORAGE_KEYS.SCHEDULE, events);
        saveToStorage(STORAGE_KEYS.SCORES, Array.from(scoresResult.entries()));
      } catch (error) {
        console.warn('Failed to save some data to localStorage (continuing anyway):', error);
      }
    } catch (error) {
      console.warn('API fetch failed, falling back to localStorage or mock data:', error);
      console.error('Full error details:', error);
      
      // Try localStorage first
      instructors = loadFromStorage(STORAGE_KEYS.INSTRUCTORS, []);
      trainees = loadFromStorage(STORAGE_KEYS.TRAINEES, []);
      events = loadFromStorage(STORAGE_KEYS.SCHEDULE, []);
      const fallbackScores = loadFromStorage<Map<string, Score[]>>(STORAGE_KEYS.SCORES, new Map());

      // Ensure arrays
      instructors = Array.isArray(instructors) ? instructors : [];
      trainees = Array.isArray(trainees) ? trainees : [];
      events = Array.isArray(events) ? events : [];
      
      console.log('Loaded from localStorage:', {
        instructors: instructors.length,
        trainees: trainees.length,
        events: events.length,
        scores: fallbackScores.size,
      });

      // If localStorage is empty, use empty arrays
      if (instructors.length === 0) {
        console.log('Using empty data as fallback');
        instructors = [];
        trainees = [];
        events = [];
        
        // Save empty data to localStorage
        saveToStorage(STORAGE_KEYS.INSTRUCTORS, instructors);
        saveToStorage(STORAGE_KEYS.TRAINEES, trainees);
        saveToStorage(STORAGE_KEYS.SCHEDULE, events);
        saveToStorage(STORAGE_KEYS.SCORES, []);
      }
      
      return {
