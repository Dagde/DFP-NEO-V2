        if (next) {

            if (next.code.startsWith('BNF') && next.type === 'Flight') {
                // CRITICAL: Check if trainee already has day events (including Active DFP)
                if (isPersonScheduledForDayEvents(trainee.fullName)) {
                    console.log(`üåô ‚ùå ${trainee.fullName} excluded from BNF - has day events (Active DFP or NEO-Build)`);
                    // Add to regular flight list instead
                    nextEventLists.flight.push(trainee);
                } else {
                    nextEventLists.bnf.push(trainee);
                }
            } else if (next.type === 'Flight') {
                nextEventLists.flight.push(trainee);
            } else if (next.type === 'FTD') {
                nextEventLists.ftd.push(trainee);
            } else if (next.type === 'Ground School' && next.methodOfDelivery.includes('CPT')) {
                nextEventLists.cpt.push(trainee);
            } else if (next.type === 'Ground School') {
                   nextEventLists.ground.push(trainee);
               }
               
               // Handle plusOne separately
               if (plusOne) {
                   if (plusOne.type === 'Flight') nextPlusOneLists.flight.push(trainee);
                   else if (plusOne.type === 'FTD') nextPlusOneLists.ftd.push(trainee);
                   else if (plusOne.type === 'Ground School' && plusOne.methodOfDelivery.includes('CPT')) nextPlusOneLists.cpt.push(trainee);
                   else if (plusOne.type === 'Ground School') nextPlusOneLists.ground.push(trainee);
                  }
        }
    });
    
