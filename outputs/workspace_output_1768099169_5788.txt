// Data Service - Loads data from API with optional mock data integration
// Returns plain objects for React compatibility

import { fetchInstructors, fetchTrainees, fetchAircraft, fetchScores, fetchSchedule } from './api';
import { ESL_DATA } from '../mockData';

export async function initializeData() {
    console.log('ğŸ”§ initializeData() - Starting data initialization');

    // Load data source settings from localStorage
    const dataSourceSettings = JSON.parse(localStorage.getItem('dataSourceSettings') || '{"staff":false,"trainee":false,"course":false}');
    console.log('ğŸ›ï¸ Data source settings:', dataSourceSettings);

    let instructors: any[] = [];
    let trainees: any[] = [];
    let aircraft: any[] = [];
    let scores: Record<string, any[]> = {};
    let events: any[] = [];

    try {
        console.log('ğŸŒ Initializing data from API...');

        // Fetch instructors (Staff)
        console.log('ğŸ‘¨â€ğŸ« Fetching instructors from API...');
        const dbInstructors = await fetchInstructors();
        console.log('âœ… Database instructors loaded:', dbInstructors.length);

        if (dataSourceSettings.staff) {
            // Merge database + mock data for staff
            console.log('ğŸ”— Merging staff data (Database + Mock)...');
            const mockInstructors = ESL_DATA.instructors || [];
            instructors = mergeInstructorData(dbInstructors, mockInstructors);
            console.log('âœ… Merged instructors total:', instructors.length);
        } else {
            // Use only database data
            console.log('ğŸ“¦ Using database only for staff...');
            instructors = dbInstructors;
        }

        // Fetch trainees
