        // Create cancellation record
        const personnelNames = [
            selectedEvent.instructor,
            selectedEvent.student,
            selectedEvent.pilot
        ].filter(Boolean).join(', ');
        
        const cancellationRecord: CancellationRecord = {
            eventId: selectedEvent.id,
            cancellationCode: cancellationCode,
            cancelledBy: `${currentUser}`,
            cancelledAt: new Date().toISOString(),
            manualCodeEntry: manualCodeEntry,
            eventDate: selectedEvent.date,
            eventType: selectedEvent.type === 'ftd' ? 'ftd' : 'flight',
            resourceType: selectedEvent.resourceId || 'Unknown',
            eventName: selectedEvent.flightNumber || selectedEvent.syllabusItem || 'N/A',
            personnelAffected: personnelNames || 'N/A',
            notes: selectedEvent.notes || '',
        };
        
        console.log('üìù Created cancellation record:', JSON.stringify(cancellationRecord, null, 2));
        
        // Save cancellation record
        const updatedRecords = [...cancellationRecords, cancellationRecord];
        setCancellationRecords(updatedRecords);
        localStorage.setItem('cancellationRecords', JSON.stringify(updatedRecords));
        console.log('üíæ Saved cancellation records to localStorage. Total:', updatedRecords.length);
        
        // Mark event as cancelled and move to STBY
        const originalResourceId = selectedEvent.resourceId;
