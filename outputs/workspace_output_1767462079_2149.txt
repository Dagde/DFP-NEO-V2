dist/assets/index-uPhlgI5U.js:bg-purple-900/50 text-purple-300":x.action==="Restore"?"bg-cyan-900/50 text-cyan-300":"bg-gray-900/50 text-gray-300"}`,children:x.action})}),e.jsx("td",{className:"px-4 py-3 text-gray-300",children:x.description}),e.jsx("td",{className:"px-4 py-3 text-gray-400 text-sm",children:x.changes||"-"})]},x.id))})]})})}),e.jsxs("div",{className:"p-3 border-t border-gray-700 bg-gray-900 rounded-b-lg flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Total entries: ",e.jsx("span",{className:"font-medium text-white",children:h.length})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Last updated: ",new Date().toLocaleString()]})]})]})}),document.body)},Qa=({pageName:n,className:t=""})=>{const[s,i]=C.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>i(!0),className:`inline-flex items-center px-2 py-1 text-xs font-medium text-gray-400 hover:text-gray-200 bg-gray-700/50 hover:bg-gray-600/50 rounded border border-gray-600 hover:border-gray-500 transition-colors ${t}`,title:"View Audit Log",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Audit"]}),s&&e.jsx(F5,{pageName:n,onClose:()=>i(!1)})]})},P5=()=>({id:_r(),name:"New Primitive Currency",description:"",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"}),R5=()=>({id:_r(),name:"New Composite Currency",description:"",type:"composite",isVisible:!0,expiryCalculation:"EARLIEST_CHILD",logicTree:{operator:"AND",children:[]}}),U5=({onBack:n,masterCurrencies:t,currencyRequirements:s,onSave:i,onDelete:o})=>{const[l,d]=C.useState([]),[u,f]=C.useState(null),[h,m]=C.useState(""),[v,x]=C.useState(!1);C.useEffect(()=>{const H=[...t,...s];d(H),u&&!H.some(O=>O.id===u)&&f(null)},[t,s,u]);const y=C.useMemo(()=>l.filter(H=>H.name.toLowerCase().includes(h.toLowerCase())).sort((H,O)=>H.name.localeCompare(O.name)),[l,h]),T=C.useMemo(()=>l.find(H=>H.id===u)||null,[u,l]),E=H=>{d(O=>O.map(W=>W.id===H.id?H:W)),x(!0)},A=H=>{const O=H==="primitive"?P5():R5();d(W=>[...W,O]),f(O.id),x(!0)},_=()=>{if(!u)return;if(l.some(O=>{if(O.type==="composite"){const W=ne=>ne.children.some(V=>typeof V=="string"?V===u:W(V));return W(O.logicTree)}return!1})){alert("This currency cannot be deleted because it is used as a dependency in another composite currency.");return}window.confirm(`Are you sure you want to delete "${T==null?void 0:T.name}"? This action cannot be undone.`)&&(o(u),f(null))},R=()=>{i(l),x(!1)};return e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-hidden h-full",children:[e.jsxs("header",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Currency Builder"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Define primitive and composite currency rules."})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[v&&e.jsxs("button",{onClick:R,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold shadow-md flex items-center space-x-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6a1 1 0 10-2 0v5.586L7.707 10.293z"}),e.jsx("path",{d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"})]}),e.jsx("span",{children:"Save Changes"})]}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold shadow-md",children:"‚Üê Back to Settings"}),e.jsx(Qa,{pageName:"Currency Builder"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 border-r border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsx("input",{type:"text",placeholder:"Search currencies...",value:h,onChange:H=>m(H.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500"}),e.jsxs("div",{className:"flex mt-2 space-x-2",children:[e.jsx("button",{onClick:()=>A("primitive"),className:"flex-1 text-center py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-xs font-semibold",children:"+ Primitive"}),e.jsx("button",{onClick:()=>A("composite"),className:"flex-1 text-center py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 text-xs font-semibold",children:"+ Composite"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:y.map(H=>e.jsxs("div",{draggable:!0,onDragStart:O=>{O.dataTransfer.setData("application/currency-id",H.id),O.dataTransfer.effectAllowed="copy"},onClick:()=>f(H.id),className:`p-3 cursor-pointer border-l-4 ${u===H.id?"bg-sky-700 border-sky-400":"border-transparent hover:bg-gray-700/50"}`,children:[e.jsx("p",{className:`font-semibold ${H.type==="composite"?"text-purple-300":"text-green-300"}`,children:H.name}),e.jsx("p",{className:"text-xs text-gray-400",children:H.description||"No description"})]},H.id))})]}),e.jsx("div",{className:"w-2/3 overflow-y-auto p-6",children:T?e.jsxs("div",{className:"space-y-6",children:[T.type==="primitive"?e.jsx(B5,{currency:T,onUpdate:E}):e.jsx(O5,{currency:T,onUpdate:E,allCurrencies:l}),e.jsx($5,{currencyId:T.id,allCurrencies:l}),e.jsx("div",{className:"pt-6 border-t border-gray-700",children:e.jsx("button",{onClick:_,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold",children:"Delete Currency"})})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 italic",children:"Select a currency to edit, or add a new one."})})]})]})},B5=({currency:n,onUpdate:t})=>{const s=(i,o)=>{t({...n,[i]:o})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-green-400",children:"Edit Primitive Currency"}),e.jsx(ad,{label:"Name",value:n.name,onChange:i=>s("name",i)}),e.jsx(ad,{label:"Description",value:n.description,onChange:i=>s("description",i)}),e.jsx(jv,{label:"Visible in Main List",checked:n.isVisible,onChange:i=>s("isVisible",i)}),e.jsx(ad,{label:"Validity (Days)",type:"number",value:n.validityDays,onChange:i=>s("validityDays",Number(i))}),e.jsx(ad,{label:"Required Count",type:"number",value:n.requiredCount,onChange:i=>s("requiredCount",Number(i))}),e.jsxs(Ev,{label:"Expiry Rule",value:n.expiryRule,onChange:i=>s("expiryRule",i),children:[e.jsx("option",{value:"LAST_EVENT_PLUS_PERIOD",children:"Last Event + Period"}),e.jsx("option",{value:"ROLLING_WINDOW",children:"Rolling Window"})]}),e.jsx(ad,{label:"Event Codes (comma-separated)",value:n.eventCodes.join(", "),onChange:i=>s("eventCodes",i.split(",").map(o=>o.trim()).filter(Boolean))})]})},O5=({currency:n,onUpdate:t,allCurrencies:s})=>{const i=(l,d)=>{t({...n,[l]:d})},o=l=>{i("logicTree",l)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-purple-400",children:"Edit Composite Currency"}),e.jsx(ad,{label:"Name",value:n.name,onChange:l=>i("name",l)}),e.jsx(ad,{label:"Description",value:n.description,onChange:l=>i("description",l)}),e.jsx(jv,{label:"Visible in Main List",checked:n.isVisible,onChange:l=>i("isVisible",l)}),e.jsxs(Ev,{label:"Expiry Calculation",value:n.expiryCalculation,onChange:l=>i("expiryCalculation",l),children:[e.jsx("option",{value:"EARLIEST_CHILD",children:"Use Earliest Expiry"}),e.jsx("option",{value:"LATEST_CHILD",children:"Use Latest Expiry"})]}),e.jsx(Tv,{node:n.logicTree,path:[],onUpdate:o,allCurrencies:s})]})},Tv=({node:n,path:t,onUpdate:s,allCurrencies:i})=>{const o=v=>{v.preventDefault(),v.dataTransfer.dropEffect="copy"},l=v=>{v.preventDefault();const x=v.dataTransfer.getData("application/currency-id");if(x&&!n.children.includes(x)){const y=[...n.children,x];s({...n,children:y},t)}},d=(v,x)=>{const y=[...n.children];y[x]=v,s({...n,children:y},t)},u=v=>{const x=n.children.filter((y,T)=>T!==v);s({...n,children:x},t)},f=()=>{const v=[...n.children,"new_condition_placeholder"];s({...n,children:v},t)},h=()=>{const v={operator:"AND",children:[]},x=[...n.children,v];s({...n,children:x},t)},m=v=>{s({...n,operator:v},t)};return e.jsxs("div",{className:"p-4 border border-gray-600 rounded-lg bg-gray-700/30 space-y-3",onDragOver:o,onDrop:l,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>m("AND"),className:`px-3 py-1 text-xs font-bold rounded ${n.operator==="AND"?"bg-sky-600 text-white":"bg-gray-600 text-gray-300"}`,children:"ALL of these (AND)"}),e.jsx("button",{onClick:()=>m("OR"),className:`px-3 py-1 text-xs font-bold rounded ${n.operator==="OR"?"bg-purple-600 text-white":"bg-gray-600 text-gray-300"}`,children:"ANY of these (OR)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:f,className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 rounded",children:"+ Condition"}),e.jsx("button",{onClick:h,className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 rounded",children:"+ Group"})]})]}),e.jsx("div",{className:"space-y-2 pl-4 border-l-2 border-gray-500",children:n.children.length>0?n.children.map((v,x)=>{var y;return e.jsxs("div",{className:"flex items-center group",children:[typeof v=="string"?e.jsx("div",{className:"flex-1 p-2 bg-gray-800 rounded text-sm text-gray-300",children:((y=i.find(T=>T.id===v))==null?void 0:y.name)||"Unlinked Condition"}):e.jsx(Tv,{node:v,path:[...t,"children",x],onUpdate:(T,E)=>d(T,x),allCurrencies:i}),e.jsx("button",{onClick:()=>u(x),className:"ml-2 p-1 text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},x)}):e.jsx("div",{className:"text-xs text-gray-500 italic p-4 text-center",children:"Drag currencies here or add conditions/groups."})})]})},$5=({currencyId:n,allCurrencies:t})=>{const s=C.useMemo(()=>{const i=[],o=t.filter(l=>l.type==="composite");for(const l of o){const d=u=>u.children.some(f=>typeof f=="string"?f===n:d(f));d(l.logicTree)&&i.push(l.name)}return i},[n,t]);return s.length===0?null:e.jsxs("div",{className:"p-4 border border-gray-600 rounded-lg bg-gray-700/30",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Used In:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(i=>e.jsx("span",{className:"px-2 py-1 bg-purple-800 text-purple-200 text-xs font-medium rounded-full",children:i},i))})]})},ad=({label:n,value:t,onChange:s,type:i="text"})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("input",{type:i,value:t,onChange:o=>s(o.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500"})]}),jv=({label:n,checked:t,onChange:s})=>e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:i=>s(i.target.checked),className:"h-4 w-4 bg-gray-600 border-gray-500 rounded accent-sky-500"}),e.jsx("span",{className:"text-white",children:n})]}),Ev=({label:n,value:t,onChange:s,children:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("select",{value:t,onChange:o=>s(o.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500",children:i})]}),H5=()=>{Pn("Program Schedule","Add","Added new flight event BGF5 for PLTOFF Smith","Event: BGF5, Time: 0800, Duration: 1.2hrs, Instructor: SQNLDR Jones"),Pn("Program Schedule","Edit","Modified flight event BGF3 start time","Changed start time from 0900 to 1000"),Pn("Program Schedule","Delete","Removed ground event for Course 301","Event: Ground School, Time: 1400"),Pn("Next Day Build","View","Viewed Next Day Build schedule for 2024-12-30",null),Pn("Next Day Build","Add","Added SCT event for FLTLT Brown","Event: SCT GF, Time: 0730, Type: Solo"),Pn("Priorities","Edit","Updated course priority order","Moved Course 302 above Course 301"),Pn("Priorities","Edit","Changed flying window times","Start: 0700 ‚Üí 0730, End: 1700 ‚Üí 1730"),console.log("‚úÖ Test audit logs seeded successfully")},od=new Map,jo=(n,t,s)=>{const i=od.get(n);if(i){clearTimeout(i.timer);const o=t,l={...o,originalValues:i.originalParams.originalValues||o.originalValues,newValues:o.newValues},d=setTimeout(()=>{let u=t.changes;if(l.originalValues&&l.newValues){const f=[];if(l.originalValues.startTime!==void 0&&l.newValues.startTime!==void 0){const h=m=>{const v=Math.floor(m),x=Math.round((m-v)*60);return`${v.toString().padStart(2,"0")}${x.toString().padStart(2,"0")}`};f.push(`Start time: ${h(l.originalValues.startTime)} ‚Üí ${h(l.newValues.startTime)}`)}l.originalValues.resourceId!==void 0&&l.newValues.resourceId!==void 0&&f.push(`Resource: ${l.originalValues.resourceId} ‚Üí ${l.newValues.resourceId}`),u=f.join(", ")}s(l.page,l.action,l.description,u),od.delete(n)},3e3);od.set(n,{timer:d,originalParams:i.originalParams,latestParams:l})}else{const o=setTimeout(()=>{s(t.page,t.action,t.description,t.changes),od.delete(n)},3e3),l=t;od.set(n,{timer:o,originalParams:l,latestParams:l})}},og=()=>{od.forEach(({timer:n})=>{clearTimeout(n)}),od.clear()},q5="modulepreload",G5=function(n,t){return new URL(n,t).href},Jx={},oh=function(t,s,i){let o=Promise.resolve();if(s&&s.length>0){let d=function(m){return Promise.all(m.map(v=>Promise.resolve(v).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};const u=document.getElementsByTagName("link"),f=document.querySelector("meta[property=csp-nonce]"),h=(f==null?void 0:f.nonce)||(f==null?void 0:f.getAttribute("nonce"));o=d(s.map(m=>{if(m=G5(m,i),m in Jx)return;Jx[m]=!0;const v=m.endsWith(".css"),x=v?'[rel="stylesheet"]':"";if(!!i)for(let E=u.length-1;E>=0;E--){const A=u[E];if(A.href===m&&(!v||A.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${x}`))return;const T=document.createElement("link");if(T.rel=v?"stylesheet":q5,v||(T.as="script"),T.crossOrigin="",T.href=m,h&&T.setAttribute("nonce",h),document.head.appendChild(T),v)return new Promise((E,A)=>{T.addEventListener("load",E),T.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${m}`)))})}))}function l(d){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=d,window.dispatchEvent(u),!u.defaultPrevented)throw d}return o.then(d=>{for(const u of d||[])u.status==="rejected"&&l(u.reason);return t().catch(l)})},Av=({type:n,title:t,message:s,onConfirm:i,onCancel:o,confirmText:l="OK",cancelText:d="Cancel",variant:u="info"})=>{const h=(()=>{switch(u){case"error":return{borderColor:"border-red-500/50",headerBg:"bg-red-900/20",titleColor:"text-red-400",iconColor:"text-red-400",confirmBg:"bg-red-600 hover:bg-red-700"};case"warning":return{borderColor:"border-amber-500/50",headerBg:"bg-amber-900/20",titleColor:"text-amber-400",iconColor:"text-amber-400",confirmBg:"bg-amber-600 hover:bg-amber-700"};case"success":return{borderColor:"border-green-500/50",headerBg:"bg-green-900/20",titleColor:"text-green-400",iconColor:"text-green-400",confirmBg:"bg-green-600 hover:bg-green-700"};default:return{borderColor:"border-sky-500/50",headerBg:"bg-sky-900/20",titleColor:"text-sky-400",iconColor:"text-sky-400",confirmBg:"bg-sky-600 hover:bg-sky-700"}}})(),m=()=>{switch(u){case"error":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"warning":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})});case"success":return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});default:return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},v=()=>{i==null||i()},x=()=>{o==null||o()};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[90] flex items-center justify-center animate-fade-in",onClick:x,children:e.jsxs("div",{className:`bg-gray-800 rounded-lg shadow-xl w-full max-w-md border ${h.borderColor}`,onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:`p-4 border-b border-gray-700 ${h.headerBg} flex items-center space-x-3`,children:[e.jsx("span",{className:h.iconColor,children:m()}),e.jsx("h2",{className:`text-xl font-bold ${h.titleColor}`,children:t})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:s})}),e.jsxs("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex justify-end space-x-3",children:[n==="confirm"&&e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:d}),e.jsx("button",{onClick:v,className:`px-4 py-2 text-white rounded-md transition-colors text-sm font-semibold ${h.confirmBg}`,children:l})]})]})})};let Gu=null;const Xx=()=>(Gu||(Gu=document.createElement("div"),Gu.id="dark-modal-root",document.body.appendChild(Gu)),Gu),nf=(n,t="Confirm Action",s="info")=>new Promise(i=>{const o=()=>{const[d,u]=C.useState(!0),f=()=>{u(!1),setTimeout(()=>i(!0),300)},h=()=>{u(!1),setTimeout(()=>i(!1),300)};return d?wv.createPortal(e.jsx(Av,{type:"confirm",title:t,message:n,onConfirm:f,onCancel:h,variant:s}),Xx()):null},l=Ua.createElement(o);oh(async()=>{const{createRoot:d}=await Promise.resolve().then(()=>N5);return{createRoot:d}},void 0,import.meta.url).then(({createRoot:d})=>{d(Xx()).render(l)})}),z5=["bg-sky-400/50","bg-purple-400/50","bg-yellow-400/50","bg-pink-400/50","bg-teal-400/50","bg-indigo-400/50","bg-cyan-400/50","bg-fuchsia-400/50","bg-blue-400/50"],V5=["ADF","FIC","WSO","IFIC","OFI","Pilot Conversion"],W5=["","GS"],Hd=({label:n,value:t,onChange:s,children:i,id:o})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:o,className:"block text-sm font-medium text-gray-400",children:n}),e.jsx("select",{id:o,value:t,onChange:s,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",children:i})]}),kv=({onClose:n,onSave:t,existingCourses:s})=>{const[i,o]=C.useState("ADF"),[l,d]=C.useState(""),[u,f]=C.useState(""),[h,m]=C.useState(""),[v,x]=C.useState(""),[y,T]=C.useState(""),[E,A]=C.useState(0),[_,R]=C.useState(0),[H,O]=C.useState(0),W=C.useMemo(()=>{const $=new Set(Object.values(s));return z5.find(M=>!$.has(M))||"bg-gray-400/50"},[s]),ne=C.useMemo(()=>E+_+H,[E,_,H]),V=C.useMemo(()=>{const $=[],M=Object.keys(s).filter(P=>P.startsWith("CSE ")||P.startsWith("ADF")).map(P=>P.replace(/^(CSE|ADF)\s*/i,""));for(let P=290;P<=500;P++)M.includes(String(P))||$.push(P);return $},[s]),U=C.useMemo(()=>Array.from({length:41},($,M)=>M),[]);C.useEffect(()=>{i==="ADF"&&V.length>0?d(String(V[0])):d("")},[i,V]);const D=()=>{let $;if(i==="ADF"){if(!l){alert("Please select an ADF course number.");return}$=`ADF${l}${h}`}else{const M=u.trim();if(!M){alert("Please enter a course number.");return}$=`${i} ${M}${h}`}if(Object.keys(s).includes($)){alert(`Course "${$}" already exists.`);return}if(!v||!y){alert("Please fill in all required date fields.");return}if(new Date(y)<=new Date(v)){alert("Graduation date must be after the start date.");return}t({number:$,color:W,startDate:v,gradDate:y,raafStart:E,navyStart:_,armyStart:H})};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:$=>$.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"text-xl font-bold text-sky-400",children:"Add New Course"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(Hd,{label:"Course Type",id:"course-type",value:i,onChange:$=>o($.target.value),children:V5.map($=>e.jsx("option",{value:$,children:$},$))}),i==="ADF"?e.jsx(Hd,{label:"Course Number",id:"course-number",value:l,onChange:$=>d($.target.value),children:V.length>0?V.map($=>e.jsx("option",{value:$,children:$},$)):e.jsx("option",{disabled:!0,children:"No courses available"})}):e.jsxs("div",{children:[e.jsx("label",{htmlFor:"manual-course-number",className:"block text-sm font-medium text-gray-400",children:"Course Number"}),e.jsx("input",{type:"text",id:"manual-course-number",value:u,onChange:$=>f($.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",placeholder:"e.g., 210"})]}),e.jsx(Hd,{label:"Suffix",id:"suffix",value:h,onChange:$=>m($.target.value),children:W5.map($=>e.jsx("option",{value:$,children:$||"None"},$))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Allocated Colour"}),e.jsxs("div",{className:"mt-1 flex items-center space-x-2 p-2 bg-gray-700/50 rounded-md h-[38px]",children:[e.jsx("div",{className:`w-5 h-5 rounded-full ${W}`}),e.jsx("span",{className:"text-white font-mono text-sm",children:W})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start-date",className:"block text-sm font-medium text-gray-400",children:"Start Date"}),e.jsx("input",{type:"date",id:"start-date",value:v,onChange:$=>x($.target.value),style:{colorScheme:"dark"},className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"grad-date",className:"block text-sm font-medium text-gray-400",children:"Graduation Date"}),e.jsx("input",{type:"date",id:"grad-date",value:y,onChange:$=>T($.target.value),style:{colorScheme:"dark"},className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Initial Student Numbers"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:[e.jsx(Hd,{label:"RAAF",id:"raaf-start",value:E,onChange:$=>A(parseInt($.target.value)),children:U.map($=>e.jsx("option",{value:$,children:$},$))}),e.jsx(Hd,{label:"Navy",id:"navy-start",value:_,onChange:$=>R(parseInt($.target.value)),children:U.map($=>e.jsx("option",{value:$,children:$},$))}),e.jsx(Hd,{label:"Army",id:"army-start",value:H,onChange:$=>O(parseInt($.target.value)),children:U.map($=>e.jsx("option",{value:$,children:$},$))}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Total"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700/50 rounded-md text-white h-[38px] flex items-center justify-center font-semibold",children:ne})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Total Remaining on Course"}),e.jsx("p",{className:"mt-1 p-2 bg-gray-700/50 rounded-md text-white h-[38px] flex items-center font-semibold",children:ne}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This will be updated from Trainee profiles once they are assigned to this course."})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Save Course"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Cancel"})]})]})})},Y5=({onClose:n,onArchive:t,activeCourses:s})=>{const i=C.useMemo(()=>Object.keys(s),[s]),[o,l]=C.useState(i[0]||""),d=()=>{o&&t(o)};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-400",children:"Archive a Course"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300","aria-label":"Close",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"Which course would you like to move to the archive?"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"course-to-archive",className:"block text-sm font-medium text-gray-400",children:"Active Courses"}),e.jsx("select",{id:"course-to-archive",value:o,onChange:u=>l(u.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm",children:i.length>0?i.map(u=>e.jsx("option",{value:u,children:u},u)):e.jsx("option",{disabled:!0,children:"No active courses"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Archived courses are removed from the main list but are not deleted from the system."})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:d,disabled:!o,className:"px-4 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-700 transition-colors text-sm font-semibold disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Archive Course"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Cancel"})]})]})})},Kx=n=>n.startsWith("Course ")?n.replace("Course ","ADF"):n.replace(/^CSE\s*/i,"ADF").replace(" ",""),J5=({activeView:n,onNavigate:t,courseColors:s,onAddCourse:i,onArchiveCourse:o,onNextDayBuildClick:l,onBuildDfpClick:d,isSupervisor:u,onPublish:f,currentUserName:h,currentUserRank:m,instructorsList:v,onUserChange:x})=>{const[y,T]=C.useState(!1),[E,A]=C.useState(!1),[_,R]=C.useState(!1),[H,O]=C.useState(""),[W,ne]=C.useState(null),[V,U]=C.useState(!1),[D,$]=C.useState(""),[M,P]=C.useState(""),[ae,Q]=C.useState(!1),[Te,Y]=C.useState(!1),fe=C.useRef(null),[ge,Ne]=C.useState(!1),[Oe,se]=C.useState(!1),F=C.useRef(null),J=["NextDayBuild","Priorities","ProgramData","BuildAnalysis","NextDayInstructorSchedule","NextDayTraineeSchedule"].includes(n),[ee,K]=C.useState(J);C.useEffect(()=>{const Re=be=>{fe.current&&!fe.current.contains(be.target)&&(Y(!1),Q(!1)),F.current&&!F.current.contains(be.target)&&(se(!1),Ne(!1))};return document.addEventListener("mousedown",Re),()=>{document.removeEventListener("mousedown",Re)}},[]),C.useEffect(()=>{J&&K(!0)},[J]);const ue=()=>{K(Re=>!Re)},xe=[{id:"Syllabus",label:"Syllabus"},{id:"CourseProgress",label:"Course Progress"},{id:"TrainingRecords",label:"Training Records"}],Le=Re=>{i(Re),T(!1)},ye=Re=>{o(Re),A(!1)},pe=Re=>{if(Re.name===h){R(!1);return}ne(Re),U(!0),$(""),P("")},ce=()=>{W&&D===W.pin?(x(W.name),U(!1),R(!1),ne(null),$(""),P("")):P("Invalid PIN")},_e=v.filter(Re=>Re.name.toLowerCase().includes(H.toLowerCase())||Re.rank.toLowerCase().includes(H.toLowerCase())||Re.unit&&Re.unit.toLowerCase().includes(H.toLowerCase())).reduce((Re,be)=>{const Ze=be.unit||"Unassigned";return Re[Ze]||(Re[Ze]=[]),Re[Ze].push(be),Re},{}),Z=["1FTS","CFS","2FTS"],Fe=Object.keys(_e).sort((Re,be)=>{const Ze=Z.indexOf(Re),ot=Z.indexOf(be);return Ze!==-1&&ot!==-1?Ze-ot:Ze!==-1?-1:ot!==-1?1:Re.localeCompare(be)}),Xe=Object.entries(s),ft=5,tt=Xe.slice(0,ft),We=Xe.slice(ft,ft*2),nt=["MyDashboard","SupervisorDashboard"].includes(n),Ct=["Instructors","InstructorSchedule"].includes(n),xt=()=>Q(!0),dn=()=>{Te||Q(!1)},on=()=>{const Re=!Te;Y(Re),Re&&Q(!0)},st=Re=>{t(Re),Y(!1),Q(!1)},kt=ae||Te,Ge=["CourseRoster","TraineeSchedule"].includes(n),ht=()=>Ne(!0),vt=()=>{Oe||Ne(!1)},Ht=()=>{const Re=!Oe;se(Re),Re&&Ne(!0)},ze=Re=>{t(Re),se(!1),Ne(!1)},we=ge||Oe;return e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"w-[12.71rem] bg-gray-900 flex-shrink-0 flex flex-col border-r border-gray-700",children:[e.jsx("div",{className:"h-16 flex items-center justify-center flex-shrink-0 px-4 border-b border-gray-800",children:e.jsxs("div",{className:"flex w-full space-x-2 mt-2",children:[e.jsx("button",{onClick:()=>t("MyDashboard"),className:`w-1/2 flex items-center justify-center text-center px-1 py-1 text-sm font-semibold rounded-md btn-aluminium-brushed ${n==="MyDashboard"?"active":""}`,children:e.jsx("span",{className:"leading-tight",children:"My Dashboard"})}),e.jsx("button",{onClick:()=>u&&t("SupervisorDashboard"),disabled:!u,title:u?"View Supervisor Dashboard":"Access denied: Requires Flying Supervisor role.",className:`w-1/2 flex items-center justify-center text-center px-1 py-1 text-sm font-semibold rounded-md btn-aluminium-brushed ${n==="SupervisorDashboard"?"active":""} ${u?"":"opacity-50 cursor-not-allowed"}`,children:e.jsx("span",{className:"leading-tight",children:"Supervisor Dashboard"})})]})}),e.jsxs("nav",{className:"flex-1 overflow-y-auto py-4 px-2 space-y-1",children:[e.jsx("button",{onClick:()=>t("Program Schedule"),className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center space-x-3 btn-green-brushed rounded-md ${n==="Program Schedule"&&!nt?"active":""}`,children:e.jsx("span",{children:"DFP"})}),e.jsxs("div",{ref:fe,onMouseLeave:dn,children:[e.jsxs("button",{onClick:on,onMouseEnter:xt,className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center justify-between btn-aluminium-brushed rounded-md ${(Ct||kt)&&!nt?"active":""}`,children:[e.jsx("span",{children:"Staff"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transform transition-transform duration-200 ${kt?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),e.jsx("div",{className:`overflow-hidden transition-[max-height] duration-300 ease-in-out ${kt?"max-h-40":"max-h-0"}`,children:e.jsxs("div",{className:"pl-4 pr-2 pt-1 space-y-1 bg-black/10",children:[e.jsx("button",{onClick:()=>st("Instructors"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="Instructors"?"active":""}`,children:"Staff Profile"}),e.jsx("button",{onClick:()=>st("InstructorSchedule"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="InstructorSchedule"?"active":""}`,children:"Staff Schedule"})]})})]}),e.jsxs("div",{ref:F,onMouseLeave:vt,children:[e.jsxs("button",{onClick:Ht,onMouseEnter:ht,className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center justify-between btn-aluminium-brushed rounded-md ${(Ge||we)&&!nt?"active":""}`,children:[e.jsx("span",{children:"Trainee"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transform transition-transform duration-200 ${we?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),e.jsx("div",{className:`overflow-hidden transition-[max-height] duration-300 ease-in-out ${we?"max-h-40":"max-h-0"}`,children:e.jsxs("div",{className:"pl-4 pr-2 pt-1 space-y-1 bg-black/10",children:[e.jsx("button",{onClick:()=>ze("CourseRoster"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="CourseRoster"?"active":""}`,children:"Trainee Profile"}),e.jsx("button",{onClick:()=>ze("TraineeSchedule"),className:`w-full text-left px-4 py-1 text-sm font-medium btn-aluminium-brushed rounded-md ${n==="TraineeSchedule"?"active":""}`,children:"Trainee Schedule"})]})})]}),xe.map(Re=>e.jsx("button",{onClick:()=>t(Re.id),className:`w-full text-left px-4 py-1 text-sm font-medium flex items-center space-x-3 btn-aluminium-brushed rounded-md ${n===Re.id&&!nt?"active":""}`,children:e.jsx("span",{className:Re.id==="TrainingRecords"?"text-xs":"",children:Re.label})},Re.id)),e.jsxs("div",{className:"pt-12",children:[e.jsxs("button",{onClick:ue,className:`w-full text-left px-4 py-1 text-sm font-semibold flex items-center justify-between btn-aluminium-brushed rounded-md ${J?"active":""}`,children:[e.jsx("span",{children:"Next Day Build"}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 transform transition-transform duration-200 ${ee?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),e.jsx("div",{className:`overflow-hidden transition-[max-height] duration-300 ease-in-out ${ee?"max-h-96":"max-h-0"}`,children:e.jsxs("div",{className:"pl-4 pr-2 pt-1 space-y-1 bg-black/10",children:[e.jsx("button",{onClick:()=>t("NextDayBuild"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="NextDayBuild"?"active":""}`,children:e.jsx("span",{children:"Program Schedule"})}),e.jsx("button",{onClick:()=>t("NextDayInstructorSchedule"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="NextDayInstructorSchedule"?"active":""}`,children:e.jsx("span",{children:"Staff Schedule"})}),e.jsx("button",{onClick:()=>t("NextDayTraineeSchedule"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="NextDayTraineeSchedule"?"active":""}`,children:e.jsx("span",{children:"Trainee Schedule"})}),e.jsx("button",{onClick:()=>t("Priorities"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="Priorities"?"active":""}`,children:e.jsx("span",{children:"Priorities"})}),e.jsx("button",{onClick:()=>t("ProgramData"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="ProgramData"?"active":""}`,children:e.jsx("span",{children:"Program Data"})}),e.jsx("button",{onClick:()=>t("BuildAnalysis"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="BuildAnalysis"?"active":""}`,children:e.jsx("span",{children:"Build Analysis"})}),e.jsx("button",{onClick:d,className:"w-full text-left px-4 py-1 text-sm font-semibold btn-orange-brushed rounded-md",children:e.jsx("span",{children:"NEO - Build"})}),e.jsx("button",{onClick:f,className:"w-full text-left px-4 py-1 text-sm font-semibold btn-green-brushed rounded-md",children:e.jsx("span",{children:"Publish"})})]})})]})]}),e.jsxs("div",{className:"flex-shrink-0 border-t border-gray-700",children:[e.jsx("div",{className:"px-2 py-2 space-y-2",children:e.jsx("div",{children:e.jsx("button",{onClick:()=>t("Settings"),className:`w-full text-left px-4 py-1 text-sm font-semibold btn-aluminium-brushed rounded-md ${n==="Settings"?"active":""}`,children:e.jsx("span",{children:"Settings"})},"Settings")})}),e.jsxs("div",{className:"border-t border-gray-700 flex-shrink-0",children:[e.jsxs("div",{className:"px-4 pt-4 mb-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Courses"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>T(!0),className:"p-1 rounded bg-gray-700 hover:bg-gray-600 transition-colors","aria-label":"Add course",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:()=>A(!0),className:"p-1 rounded bg-gray-700 hover:bg-gray-600 transition-colors","aria-label":"Archive course",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-300",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"px-4 pb-2 flex space-x-4",children:[e.jsx("div",{className:"flex-1 min-w-0",children:tt.map(([Re,be])=>e.jsxs("div",{className:"py-1 flex items-center",children:[e.jsx("span",{className:`h-3 w-3 rounded-full ${be} mr-3 flex-shrink-0`}),e.jsx("span",{className:"text-xs text-gray-300 truncate",children:Kx(Re)})]},Re))}),We.length>0&&e.jsx("div",{className:"flex-1 min-w-0",children:We.map(([Re,be])=>e.jsxs("div",{className:"py-1 flex items-center",children:[e.jsx("span",{className:`h-3 w-3 rounded-full ${be} mr-3 flex-shrink-0`}),e.jsx("span",{className:"text-xs text-gray-300 truncate",children:Kx(Re)})]},Re))})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 flex-shrink-0 flex justify-between items-center text-xs text-gray-500",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>R(!_),className:"flex items-center space-x-1 text-gray-500 hover:text-gray-300 transition-colors",children:[e.jsxs("span",{className:"truncate",children:[m," ",h]}),e.jsx("svg",{className:`h-3 w-3 transform transition-transform ${_?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),_&&e.jsxs("div",{className:"absolute bottom-full left-0 mb-2 w-80 bg-gray-800 border border-gray-700 rounded-lg shadow-lg z-50",children:[e.jsxs("div",{className:"p-3 border-b border-gray-700",children:[e.jsx("input",{type:"text",placeholder:"Search users...",value:H,onChange:Re=>O(Re.target.value),className:"w-full pl-8 pr-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm text-white focus:outline-none focus:ring-1 focus:ring-sky-500"}),e.jsx("svg",{className:"absolute left-5 top-5 h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:Fe.map(Re=>e.jsxs("div",{children:[e.jsx("div",{className:"px-3 py-2 bg-gray-900 border-b border-gray-700 sticky top-0",children:e.jsx("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:Re})}),_e[Re].map(be=>e.jsxs("button",{onClick:()=>pe(be),className:`w-full px-3 py-2 text-left text-sm hover:bg-gray-700 transition-colors flex items-center justify-between ${be.name===h?"bg-gray-700 text-sky-400":"text-gray-300"}`,children:[e.jsxs("span",{children:[be.rank," ",be.name]}),be.name===h&&e.jsx("svg",{className:"h-4 w-4 text-sky-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},be.name))]},Re))}),e.jsx("div",{className:"p-2 border-t border-gray-700",children:e.jsx("button",{onClick:()=>R(!1),className:"w-full px-3 py-1 text-sm text-gray-400 hover:text-gray-300",children:"Cancel"})})]})]}),e.jsx("span",{children:"v1.0.0"})]})]})]}),y&&e.jsx(kv,{onClose:()=>T(!1),onSave
dist/assets/index-uPhlgI5U.js:bg-purple-500/20 pointer-events-none",style:{left:`${O}px`,width:`${W-O}px`}})]})},sr=200,zi=32,ur=0,El=24,tw=El-ur,ey=144,ty=40,nw=(n,t)=>{if(!n||!t||n.duration<=0||t.duration<=0)return!1;const s=n.startTime+n.duration,i=t.startTime+t.duration;return n.startTime<i&&s>t.startTime},Y0=n=>{const t=[];return n.flightType==="Solo"?n.pilot&&t.push(n.pilot):(n.instructor&&t.push(n.instructor),n.student&&t.push(n.student)),n.attendees&&t.push(...n.attendees),t},sw=(n,t)=>{if(!t)return!1;const s=t.find(o=>o.id===n.id);if(!s)return!0;const i=.001;return Math.abs(n.startTime-s.startTime)>i||Math.abs(n.duration-s.duration)>i?!0:n.resourceId!==s.resourceId||n.instructor!==s.instructor||n.student!==s.student||n.pilot!==s.pilot||(n.area||"")!==(s.area||"")},ny=n=>n.startsWith("PC-21")||n.startsWith("Deployed")?"PC-21":n.startsWith("STBY")?"STBY":n==="Duty Sup"?"Duty Sup":n==="TWR DI"?"TWR DI":n.startsWith("FTD")?"FTD":n.startsWith("CPT")?"CPT":n.startsWith("Ground")?"Ground":"Other",rw=({date:n,onDateChange:t,events:s,resources:i,instructors:o,traineesData:l,airframeCount:d,standbyCount:u,ftdCount:f,cptCount:h,onUpdateEvent:m,onSelectEvent:v,onReorderResources:x,zoomLevel:y,showValidation:T,showPrePost:E,syllabusDetails:A,personnelData:_,seatConfigs:R,daylightTimes:H,personnelConflicts:O,personnelConflictIds:W,unavailabilityConflicts:ne,onCptConflict:V,isMultiSelectMode:U,selectedEventIds:D,setSelectedEventIds:$,baselineEvents:M,isVisualAdjustMode:P=!1,visualAdjustEvent:ae=null,onVisualAdjustTimeChange:Q,isOracleMode:Te,oraclePreviewEvent:Y,onOracleMouseDown:fe,onOracleMouseMove:ge,onOracleMouseUp:Ne,detectConflictsForEvent:Oe,showDepartureDensityOverlay:se,showAircraftAvailability:F,plannedAvailability:X,dayFlyingStart:J,dayFlyingEnd:ee,onAvailabilityChange:K,timezoneOffset:ue=11})=>{const xe=C.useRef(null),Le=C.useRef(null),[ye,pe]=C.useState(()=>{const Tt=new Date,lt=ue*60*60*1e3;return new Date(Tt.getTime()+lt)}),ce=C.useRef(!0),He=C.useRef(y);C.useEffect(()=>{const Tt=()=>{const Et=new Date,Bt=ue*60*60*1e3,Kt=new Date(Et.getTime()+Bt);pe(Kt)};Tt();const lt=setInterval(Tt,1e3);return()=>clearInterval(lt)},[ue]);const[_e,Z]=C.useState(null),[Fe,Xe]=C.useState(null),[ft,tt]=C.useState(null),[We,Ke]=C.useState(null),nt=C.useRef(!1),Ct=C.useRef(null),[xt,dn]=C.useState(null),[on,st]=C.useState(null);C.useEffect(()=>{const Tt=setInterval(()=>{const Bt=new Date,Kt=ue*60*60*1e3,Mt=new Date(Bt.getTime()+Kt);pe(Mt)},1e3),lt=Bt=>{_e&&(console.log("Global mouse move - drag state active"),vt(Bt))},Et=Bt=>{console.log("Global mouse up called, draggingState exists:",!!_e),_e&&(console.log("Global mouse up - ending drag"),document.body.classList.remove("no-select"),Z(null),Xe(null),tt(null),Ke(null))};return document.addEventListener("mousemove",lt),document.addEventListener("mouseup",Et),()=>{clearInterval(Tt),document.removeEventListener("mousemove",lt),document.removeEventListener("mouseup",Et)}},[_e]);const kt=C.useMemo(()=>{const[Tt,lt,Et]=n.split("-").map(Number);return new Date(Date.UTC(Tt,lt-1,Et)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[n]);C.useEffect(()=>{const Tt=xe.current;if(Tt){if(ce.current){const Et=(8-ur)*sr*y;Tt.scrollLeft=Et,ce.current=!1}else{const lt=He.current;if(lt===y)return;const{scrollLeft:Et,clientWidth:Bt}=Tt,Mt=(Et+Bt/2)/(sr*lt)*sr*y-Bt/2;Tt.scrollLeft=Mt}He.current=y}},[y]);const Ge=C.useCallback((Tt,lt)=>{for(const Et of Tt){const Bt=A.find(Ve=>Ve.id===Et.flightNumber);if(!Bt)continue;const Kt=Et.startTime-(Bt.preFlightTime||0),Mt=Et.startTime+Et.duration+(Bt.postFlightTime||0);for(const Ve of lt){const qt=A.find(je=>je.id===Ve.flightNumber);if(!qt)continue;const Mn=Ve.startTime-(qt.preFlightTime||0),jn=Ve.startTime+Ve.duration+(qt.postFlightTime||0);if(Kt<jn&&Mt>Mn){const je=Y0(Et),$e=Y0(Ve),Ye=je.find(Dt=>$e.includes(Dt));if(Ye)return{conflictingEvent:Ve,personName:Ye}}}}return null},[A]),ht=(Tt,lt)=>{if(console.log("handleMouseDown called, event:",lt==null?void 0:lt.id,"isMultiSelectMode:",U),console.log("Event target:",Tt.target),console.log("Current target:",Tt.currentTarget),Tt.button===0){if(nt.current=!1,document.body.classList.add("no-select"),Te&&!lt){if(!Le.current)return;const Et=Le.current.getBoundingClientRect(),Kt=(Tt.clientX-Et.left)/(sr*y)+ur,Mt=Tt.clientY-Et.top,Ve=Math.floor(Mt/zi),qt=i[Ve]||i[0];fe(Kt,qt);return}if(lt){const Bt=Tt.currentTarget.getBoundingClientRect(),Kt=new Map,Mt=new Map,Ve=qt=>{console.log("üêç Processing event for drag:",qt.id,"resourceId:",qt.resourceId),console.log("üêç Available resources:",i);const Mn=i.indexOf(qt.resourceId);console.log("üêç Found row index:",Mn),Mn!==-1?(Kt.set(qt.id,{startTime:qt.startTime,rowIndex:Mn}),Mt.set(qt.id,qt.resourceId),console.log("üêç Event added to initialPositions")):console.log("üêç Event NOT added - resourceId not found in resources")};U&&D.has(lt.id)?D.forEach(qt=>{const Mn=s.find(jn=>jn.id===qt);Mn&&Ve(Mn)}):Ve(lt),Kt.size>0?(console.log("Setting dragging state with",Kt.size,"events for event:",lt.id),console.log("initialPositions:",Kt),Z({mainEventId:lt.id,xOffset:(Tt.clientX-Bt.left)/y,yOffset:Tt.clientY-Bt.top,initialPositions:Kt,originalResourceIds:Mt}),console.log("setDraggingState called with:",_e)):console.log("No initial positions - drag state not set")}else{if(!U||!Le.current)return;const Et=Le.current.getBoundingClientRect(),Bt=Tt.clientX-Et.left,Kt=Tt.clientY-Et.top;Ct.current={x:Bt,y:Kt},dn({x:Bt,y:Kt,width:0,height:0})}}},vt=Tt=>{if(console.log("handleMouseMove called, draggingState exists:",!!_e),!Le.current){console.log("Early return: no scheduleGridRef");return}nt.current=!0;const lt=Le.current.getBoundingClientRect(),Et=Tt.clientX-lt.left,Bt=Tt.clientY-lt.top;if(T){const Kt=Et/(sr*y)+ur;st(Kt)}if(Te&&Y){console.log("Early return: Oracle mode with preview event");const Kt=Et/(sr*y)+ur,Mt=i[Math.floor(Bt/zi)]||i[0];ge(Kt,Mt)}else{if(Ct.current){console.log("Early return: selectionStartPoint active (marquee selection)");const Ye=Tt.clientX-lt.left,Dt=Tt.clientY-lt.top,St=Math.min(Ct.current.x,Ye),hn=Math.min(Ct.current.y,Dt),Ce=Math.abs(Ye-Ct.current.x),At=Math.abs(Dt-Ct.current.y);dn({x:St,y:hn,width:Ce,height:At});const B=St,Ae=St+Ce,rt=hn,yt=hn+At,et=new Set;s.forEach($t=>{const pn=i.indexOf($t.resourceId);if(pn===-1)return;const kn=pn*zi,ts=kn+zi,un=($t.startTime-ur)*sr*y,Nn=un+$t.duration*sr*y;B<Nn&&Ae>un&&rt<ts&&yt>kn&&et.add($t.id)}),$(et);return}if(!_e){console.log("Early return: no draggingState");return}const Kt=_e.initialPositions.get(_e.mainEventId);if(!Kt)return;const Mt=(Et/y-_e.xOffset)/sr-Kt.startTime,Ve=Math.floor((Bt-_e.yOffset+zi/2)/zi)-Kt.rowIndex;console.log("Drag calculation - timeShift:",Mt,"rowShift:",Ve,"xInGrid:",Et,"yInGrid:",Bt);const qt=[],Mn=[...s];let jn=null,je=null;for(const[Ye,Dt]of _e.initialPositions.entries()){const St=s.find(yt=>yt.id===Ye);if(!St)continue;let hn=Dt.startTime+Mt,Ce=Dt.rowIndex+Ve;Ce<0&&(Ce=0),Ce>=i.length&&(Ce=i.length-1),hn<ur&&(hn=ur),hn+St.duration>El&&(hn=El-St.duration);const At=Math.round(hn*12)/12,B=i[Ce];qt.push({eventId:Ye,newStartTime:At,newResourceId:B});const Ae=Mn.findIndex(yt=>yt.id===Ye);Ae!==-1&&(Mn[Ae]={...Mn[Ae],startTime:At,resourceId:B});const rt=s.find(yt=>yt.id!==Ye&&!_e.initialPositions.has(yt.id)&&yt.resourceId===B&&nw({...St,startTime:At},yt));rt&&(jn=rt.id)}if(qt.find(Ye=>Ye.eventId===_e.mainEventId)){const Ye=Mn.find(hn=>hn.id===_e.mainEventId),Dt=Mn.filter(hn=>!_e.initialPositions.has(hn.id));let St=null;if(Oe)if(St=Oe(Ye,Dt),console.log("üîç Drag conflict check:",{eventId:Ye.id,hasConflict:St.hasConflict,conflictType:St.conflictType}),St.hasConflict){if(Xe({conflictingEventId:St.conflictingEventId,conflictedPersonName:St.conflictedPersonnel||""}),Ye.flightNumber.includes("CPT")&&St.conflictType==="personnel"){const hn=Dt.find(Ce=>Ce.id===St.conflictingEventId);hn&&(je={conflictingEvent:hn,newEvent:Ye,conflictedPerson:"trainee"})}}else Xe(null);else{const hn=Ge([Ye],Dt);hn?(Xe({conflictingEventId:hn.conflictingEvent.id,conflictedPersonName:hn.personName}),Ye.flightNumber.includes("CPT")&&(je={conflictingEvent:hn.conflictingEvent,newEvent:Ye,conflictedPerson:"trainee",personName:hn.personName})):Xe(null)}}tt(jn),Ke(je),console.log("üêç DRAG COMPLETE - Calling onUpdateEvent with",qt.length,"updates:"),console.log("üêç Updates:",qt),m(qt)}},Ht=Tt=>{if(console.log("Local handleMouseUp called - ignoring when dragState exists:",!!_e),_e){console.log("Ignoring local mouse up - global handler will manage");return}document.body.classList.remove("no-select"),Te&&Ne(),We&&V(We),console.log("Clearing drag state in local handleMouseUp"),Z(null),Xe(null),tt(null),Ke(null),st(null),Ct.current&&U&&(Ct.current=null,dn(null),!nt.current&&!Tt.shiftKey&&(Tt.target.closest('[data-is-flight-tile="true"]')||$(new Set))),setTimeout(()=>{nt.current=!1},0)},ze=C.useCallback(Tt=>{if(!Tt||!/^\d{2}:\d{2}$/.test(Tt))return null;const[lt,Et]=Tt.split(":").map(Number);return lt+Et/60},[]),we=()=>{const Tt=[];for(let Bt=ur;Bt<=El;Bt++)Tt.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-gray-500 flex items-center",style:{left:(Bt-ur)*sr*y},children:e.jsx("span",{className:"-translate-x-1/2",children:`${String(Bt).padStart(2,"0")}:00`})},Bt));const lt=ze(H.firstLight),Et=ze(H.lastLight);if(lt!==null){const Bt=(lt-ur)*sr*y;Tt.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:Bt},children:e.jsx("span",{className:"-translate-x-1/2",children:`FL ${H.firstLight}`})},"fl-label"))}if(Et!==null){const Bt=(Et-ur)*sr*y;Tt.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:Bt},children:e.jsx("span",{className:"-translate-x-1/2",children:`LL ${H.lastLight}`})},"ll-label"))}return Tt},Re=()=>{const Tt=[];for(let lt=ur;lt<=El;lt++)Tt.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(lt-ur)*sr*y},children:e.jsx("div",{className:"w-px h-full bg-gray-700/50"})},`v-${lt}`)),lt<El&&Tt.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(lt-ur+.5)*sr*y},children:e.jsx("div",{className:"w-px h-full bg-gray-700/25"})},`v-${lt}-30`));for(let lt=1;lt<=i.length;lt++)Tt.push(e.jsx("div",{className:"absolute left-0 w-full bg-gray-700/25",style:{top:lt*zi,height:"1px"}},`h-${lt}`));return Tt},be=()=>{const Tt=[];let lt=ny(i[0]);for(let Et=1;Et<i.length;Et++){const Bt=ny(i[Et]);Bt!==lt&&(Tt.push(e.jsx("div",{className:"absolute left-0 w-full border-t-2 border-gray-500 z-10",style:{top:Et*zi}},`sep-${Et}`)),lt=Bt)}return Tt},Ze=()=>{const Tt=ze(H.firstLight),lt=ze(H.lastLight);return e.jsxs(e.Fragment,{children:[Tt!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(Tt-ur)*sr*y}px`}}),lt!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(lt-ur)*sr*y}px`}})]})},ot=()=>{const Tt=ze(H.firstLight),lt=ze(H.lastLight),Et=[];if(Tt!==null&&Tt>ur){const Bt=(Tt-ur)*sr*y;Et.push(e.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/5 pointer-events-none z-[1]",style:{width:`${Bt}px`}},"night-shade-morning"))}if(lt!==null&&lt<El){const Bt=(lt-ur)*sr*y,Kt=(El-lt)*sr*y;Et.push(e.jsx("div",{className:"absolute top-0 h-full bg-white/5 pointer-events-none z-[1]",style:{left:`${Bt}px`,width:`${Kt}px`}},"night-shade-evening"))}return e.jsx(e.Fragment,{children:Et})},Vt=()=>{const lt=(Mt=>{const Ve=Mt.getUTCFullYear(),qt=String(Mt.getUTCMonth()+1).padStart(2,"0"),Mn=String(Mt.getUTCDate()).padStart(2,"0");return`${Ve}-${qt}-${Mn}`})(ye);if(n!==lt)return null;const Et=ye,Bt=Et.getUTCHours()+Et.getUTCMinutes()/60+Et.getUTCSeconds()/3600;if(Bt<ur||Bt>El)return null;const Kt=(Bt-ur)*sr*y;return e.jsxs("div",{className:"absolute top-0 h-full z-[30] pointer-events-none",style:{left:`${Kt}px`},children:[e.jsx("div",{className:"w-0.5 h-full bg-white animate-pulse"}),e.jsx("div",{className:"absolute -top-2.5 -translate-x-1/2 w-0 h-0",style:{borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"7px solid white"}})]})},Pt=()=>{if(!T||on===null||!se)return null;const Tt=on-.5,lt=on+.5,Et=s.filter(Ve=>Ve.type!=="flight"?!1:Ve.startTime>=Tt&&Ve.startTime<lt).length,Bt=(Tt-ur)*sr*y,Kt=(lt-ur)*sr*y,Mt=Kt-Bt;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-0 h-full bg-white/10 pointer-events-none z-[25]",style:{left:`${Bt}px`,width:`${Mt}px`}}),e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-white/40 pointer-events-none z-[26]",style:{left:`${Bt}px`}}),e.jsx("div",{className:"absolute top-0 h-full w-0.5 bg-white/40 pointer-events-none z-[26]",style:{left:`${Kt}px`}}),e.jsx("div",{className:"absolute top-2 bg-gray-800/95 border border-white/30 rounded px-3 py-1.5 shadow-lg pointer-events-none z-[27]",style:{left:`${Bt+Mt/2}px`,transform:"translateX(-50%)"},children:e.jsxs("div",{className:"text-white text-xs font-semibold whitespace-nowrap",children:["Flights starting in this hour: ",e.jsx("span",{className:"text-sky-400",children:Et})]})})]})},yn=()=>i.flatMap((Tt,lt)=>s.filter(Bt=>Bt.resourceId===Tt).map(Bt=>{const Kt=!!(_e&&_e.initialPositions.has(Bt.id)),Mt=Bt.id===(Fe==null?void 0:Fe.conflictingEventId)||Bt.id===ft,Ve=T&&W.has(Bt.id)||Mt||Kt&&!!(Fe||ft),qt=ne.get(Bt.id),Mn=!!qt,jn=qt||[];let je=null;if(Fe){const Dt=Y0(Bt);(Kt||Mt)&&Dt.includes(Fe.conflictedPersonName)&&(je=Fe.conflictedPersonName)}const $e=D.has(Bt.id),Ye=sw(Bt,M);return e.jsx(Gc,{event:Bt,traineesData:l,onSelectEvent:()=>{if(!nt.current)if(U){const Dt=new Set(D);Dt.has(Bt.id)?Dt.delete(Bt.id):Dt.add(Bt.id),$(Dt)}else v(Bt)},onMouseDown:Dt=>ht(Dt,Bt),onMouseEnter:()=>{},onMouseLeave:()=>{},pixelsPerHour:sr*y,rowHeight:zi,startHour:ur,row:lt,isDragging:Kt,isConflicting:Ve,isUnavailabilityConflict:Mn,unavailablePersonnel:jn,conflictedPersonnelName:je,personnelData:_,seatConfigs:R,isDraggable:!0,currentTime:ye,isSelected:$e,isChanged:Ye},Bt.id)}));return e.jsx("div",{ref:xe,className:"flex-1 overflow-auto relative bg-gray-900 select-none",children:e.jsxs("div",{style:{width:`${ey+tw*sr*y}px`,height:`${ty+i.length*zi}px`,display:"grid",gridTemplateColumns:`${ey}px 1fr`,gridTemplateRows:`${ty}px 1fr`},children:[e.jsx("div",{className:"sticky top-0 left-0 z-40 bg-gray-800 border-r border-b border-gray-700 p-1",children:e.jsxs("div",{className:"bg-gray-700 rounded-md w-full h-full flex items-center justify-center px-2 space-x-2",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:"<"}),e.jsx("span",{className:"flex-grow min-w-0 text-center font-semibold text-white cursor-default truncate text-xs",children:kt}),e.jsx("button",{onClick:()=>t(1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:">"})]})}),e.jsx("div",{className:"sticky top-0 z-20 bg-gray-800 border-b border-gray-700 relative",children:we()}),e.jsx("div",{className:"sticky left-0 z-30 bg-gray-800 border-r border-gray-700",children:e.jsx(Dv,{resources:i,onReorder:x,rowHeight:zi,airframeCount:d,standbyCount:u,ftdCount:f,cptCount:h,events:s})}),e.jsxs("div",{ref:Le,className:"relative bg-gray-900",onMouseDown:Tt=>ht(Tt),onMouseMove:vt,onMouseUp:Ht,onMouseLeave:Ht,children:[Re(),ot(),Ze(),be(),Vt(),Pt(),F&&X!==void 0&&J&&ee&&K&&e.jsx(ew,{currentDate:new Date(n),totalAircraft:d,plannedAvailability:X,dayFlyingStart:J,dayFlyingEnd:ee,gridHeight:i.length*zi,rowHeight:zi,pixelsPerHour:sr*y,startHour:ur,onAvailabilityChange:K}),yn(),P&&ae&&Q&&e.jsx(_v,{event:ae,onTimeChange:Q,scheduleStartHour:ur,scheduleEndHour:El,pixelsPerHour:sr*y}),Te&&Y&&e.jsxs(e.Fragment,{children:[e.jsx(Gc,{isPreview:!0,event:Y,onSelectEvent:()=>{},onMouseDown:()=>{},onMouseEnter:()=>{},onMouseLeave:()=>{},pixelsPerHour:sr*y,rowHeight:zi,startHour:ur,row:i.indexOf(Y.resourceId),isDragging:!1,traineesData:l,personnelData:_,seatConfigs:new Map,currentTime:new Date}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1 bg-sky-300/40 pointer-events-none z-50",style:{left:`${(Y.startTime-(Y.preStart||1)-ur)*sr*y}px`,width:`${(Y.preStart||1)*sr*y}px`,top:`${i.indexOf(Y.resourceId)*zi+zi/2}px`}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1 bg-sky-300/40 pointer-events-none z-50",style:{left:`${(Y.startTime+Y.duration-ur)*sr*y}px`,width:`${(Y.postEnd||.5)*sr*y}px`,top:`${i.indexOf(Y.resourceId)*zi+zi/2}px`}})]}),xt&&e.jsx("div",{className:"absolute bg-sky-500/20 border border-sky-400 z-50 pointer-events-none",style:{left:xt.x,top:xt.y,width:xt.width,height:xt.height}})]})]})})},sy=n=>{const t={"1FTS":"text-blue-300","2FTS":"text-green-300",CFS:"text-purple-300",CFTS:"text-orange-300",RMC:"text-red-300",ARFTU:"text-yellow-300",AWMU:"text-teal-300","No. 1 Squadron":"text-indigo-300","No. 2 Squadron":"text-pink-300","No. 3 Squadron":"text-cyan-300","No. 75 Squadron":"text-amber-300","No. 76 Squadron":"text-lime-300","No. 77 Squadron":"text-emerald-300"};return console.log("üé® UNIT COLOR DEBUG - Unit:",n,"Color:",t[n||""]||"text-gray-300"),t[n||""]||"text-gray-300"},iw=n=>({"1FTS":"bg-blue-500/20 border-blue-500/50 text-blue-300","2FTS":"bg-green-500/20 border-green-500/50 text-green-300",CFS:"bg-purple-500/20 border-purple-500/50 text-purple-300",CFTS:"bg-orange-500/20 border-orange-500/50 text-orange-300",RMC:"bg-red-500/20 border-red-500/50 text-red-300",ARFTU:"bg-yellow-500/20 border-yellow-500/50 text-yellow-300",AWMU:"bg-teal-500/20 border-teal-500/50 text-teal-300","No. 1 Squadron":"bg-indigo-500/20 border-indigo-500/50 text-indigo-300","No. 2 Squadron":"bg-pink-500/20 border-pink-500/50 text-pink-300","No. 3 Squadron":"bg-cyan-500/20 border-cyan-500/50 text-cyan-300","No. 75 Squadron":"bg-amber-500/20 border-amber-500/50 text-amber-300","No. 76 Squadron":"bg-lime-500/20 border-lime-500/50 text-lime-300","No. 77 Squadron":"bg-emerald-500/20 border-emerald-500/50 text-emerald-300"})[n||""]||"bg-gray-600/20 border-gray-500/50 text-gray-300",Iv=({personnel:n,rowHeight:t,onRowEnter:s,onRowLeave:i,onPersonClick:o,onRowRef:l,showUnits:d=!1,useUnitColors:u=!1})=>{console.log("üîç PERSONNEL COLUMN DEBUG - Props:",{personnelCount:n.length,showUnits:d,useUnitColors:u,samplePersonnel:n.slice(0,3).map(h=>({name:h.name,unit:h.unit}))});const f=Ua.useMemo(()=>{if(!d)return n;const h={};return h.Unassigned=n.filter(m=>!m.unit),n.forEach(m=>{m.unit&&(h[m.unit]||(h[m.unit]=[]),h[m.unit].push(m))}),h},[n,d]);return d?e.jsx("div",{className:"w-48 bg-gray-800 flex-shrink-0 h-full",children:e.jsx("ul",{children:Object.entries(f).map(([h,m])=>e.jsxs(Ua.Fragment,{children:[e.jsx("li",{className:"bg-gray-900/80 border-b border-gray-600 px-3 py-1",children:e.jsxs("span",{className:`text-xs font-semibold ${u&&iw(h).split(" ").find(v=>v.startsWith("text-"))||"text-gray-400"}`,children:[h," (",m.length,")"]})}),m.map(({name:v,rank:x,unit:y},T)=>e.jsxs("li",{ref:E=>l==null?void 0:l(v,E),className:`flex items-center justify-start pl-3 pr-2 py-1 text-xs transition-colors duration-150 border-b border-gray-700/50 bg-gray-800 ${o?"cursor-pointer hover:bg-gray-700":""}`,style:{height:t,minHeight:t},onMouseEnter:()=>s==null?void 0:s(T),onMouseLeave:()=>i==null?void 0:i(),onClick:()=>o==null?void 0:o(v),children:[e.jsx("span",{className:"font-mono text-gray-500 w-10 text-xs",children:x}),e.jsx("span",{className:`truncate font-medium flex-1 ${u?sy(y):"text-gray-300"}`,children:v})]},`${h}-${v}`))]},h))})}):e.jsx("div",{className:"w-40 bg-gray-800 flex-shrink-0 h-full",children:e.jsx("ul",{children:n.map(({name:h,rank:m,unit:v},x)=>e.jsxs("li",{ref:y=>l==null?void 0:l(h,y),className:`flex items-center justify-start pl-3 text-xs transition-colors duration-150 border-b border-gray-700/50 ${o?"cursor-pointer hover:bg-gray-700":""}`,style:{height:t},onMouseEnter:()=>s==null?void 0:s(x),onMouseLeave:()=>i==null?void 0:i(),onClick:()=>o==null?void 0:o(h),children:[e.jsx("span",{className:"font-mono text-gray-500 w-12 flex-shrink-0",children:m}),e.jsx("span",{className:`truncate font-medium ${u?sy(v):"text-gray-300"}`,children:h})]},h))})})},Si=200,Cl=32,fi=0,ac=24,ry=ac-fi,iy=160,J0=40,X0=n=>{const t=[];return n.flightType==="Solo"?n.pilot&&t.push(n.pilot):(n.instructor&&t.push(n.instructor),n.student&&t.push(n.student)),t},aw=(n,t,s=!0)=>{const i=[];return t.forEach(o=>{(o.unavailability||[]).forEach(d=>{const u=new Date(n+"T00:00:00Z"),f=new Date(d.startDate+"T00:00:00Z"),h=new Date(d.endDate+"T00:00:00Z"),m=new Date(h);if(d.allDay&&m.setDate(m.getDate()-1),u>=f&&u<=m){let v=d.allDay?.0167:parseFloat(d.startTime)/100,x=d.allDay?23.983:parseFloat(d.endTime)/100;d.allDay||(u.getTime()===f.getTime()&&u.getTime()===m.getTime()?(v=d.startTime?parseFloat(d.startTime)/100:.0167,x=d.endTime?parseFloat(d.endTime)/100:23.983):u.getTime()===f.getTime()&&d.startTime?(v=parseFloat(d.startTime)/100,x=23.983):u.getTime()===m.getTime()&&d.endTime?(v=.0167,x=parseFloat(d.endTime)/100):u>f&&u<m&&(v=.0167,x=23.983));const y=x-v,T={id:`unavailability-${o.name||o.fullName}-${d.id}`,date:n,startTime:v,duration:y,type:"unavailability",instructor:s?o.name:void 0,student:s?void 0:o.fullName,pilot:s?void 0:o.fullName,flightNumber:"UNAVAIL",resourceName:s?o.name:o.fullName,resourceId:s?`INST-${o.name}`:`TRAINEE-${o.fullName}`,eventType:"UNAVAILABILITY",allDay:d.allDay,reason:d.reason,notes:d.notes};i.push(T)}})}),i},ow=({date:n,onDateChange:t,events:s,instructors:i,instructorsData:o,onSelectEvent:l,onUpdateEvent:d,zoomLevel:u,daylightTimes:f,personnelData:h,seatConfigs:m,syllabusDetails:v,conflictingEventIds:x,showValidation:y,unavailabilityConflicts:T,onSelectInstructor:E,traineesData:A})=>{console.log("üîç INSTRUCTOR SCHEDULE ERROR TRACKING - Props received:"),console.log("  - date:",n),console.log("  - events count:",s==null?void 0:s.length),console.log("  - instructors count:",i==null?void 0:i.length),console.log("  - instructorsData count:",o==null?void 0:o.length),console.log("  - traineesData count:",A==null?void 0:A.length),console.log("  - zoomLevel:",u),console.log("  - daylightTimes:",f),console.log("  - personnelData size:",h==null?void 0:h.size),console.log("  - seatConfigs type:",typeof m),console.log("  - seatConfigs value:",m),console.log("  - seatConfigs === undefined:",m===void 0),console.log("  - seatConfigs === null:",m===null),console.log("  - syllabusDetails count:",v==null?void 0:v.length),console.log("  - conflictingEventIds size:",x==null?void 0:x.size),console.log("  - showValidation:",y),console.log("  - unavailabilityConflicts size:",T==null?void 0:T.size),console.log("  - Function props:"),console.log("    - onDateChange type:",typeof t),console.log("    - onSelectEvent type:",typeof l),console.log("    - onUpdateEvent type:",typeof d),console.log("    - onSelectInstructor type:",typeof E);try{const pe=m;console.log("‚úÖ seatConfigs access successful in InstructorScheduleView")}catch(pe){console.error("‚ùå seatConfigs access failed in InstructorScheduleView:",pe),console.error("‚ùå Error stack:",pe.stack)}n||console.error("‚ùå CRITICAL: date is undefined"),s||console.error("‚ùå CRITICAL: events is undefined"),i||console.error("‚ùå CRITICAL: instructors is undefined"),f||console.error("‚ùå CRITICAL: daylightTimes is undefined"),(s==null?void 0:s.length)>0&&console.log("üîç Sample event structure:",s[0]),(i==null?void 0:i.length)>0&&console.log("üîç Sample instructor structure:",i[0]);const _=C.useRef(null),[R,H]=C.useState(new Date),[O,W]=C.useState(null),[ne,V]=C.useState(null),[U,D]=C.useState(null),[$,M]=C.useState(null),P=C.useRef(null),ae=C.useRef(!0),Q=C.useRef(u),Te=C.useRef(!1);C.useEffect(()=>{const pe=setInterval(()=>H(new Date),1e3);return()=>clearInterval(pe)},[]);const Y=C.useMemo(()=>{const[pe,ce,He]=n.split("-").map(Number);return new Date(Date.UTC(pe,ce-1,He)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[n]),fe=C.useMemo(()=>{const pe=aw(n,o,!0);return[...s,...pe]},[n,s,o]);C.useEffect(()=>{const pe=_.current;if(pe){if(ae.current){const He=(8-fi)*Si*u;pe.scrollLeft=He,ae.current=!1}else{const ce=Q.current;if(ce===u)return;const{scrollLeft:He,clientWidth:_e}=pe,Fe=(He+_e/2)/(Si*ce)*Si*u-_e/2;pe.scrollLeft=Fe}Q.current=u}},[u]);const ge=C.useCallback((pe,ce)=>{for(const He of pe){const _e=v.find(Xe=>Xe.id===He.flightNumber);if(!_e)continue;const Z=He.startTime-_e.preFlightTime,Fe=He.startTime+He.duration+_e.postFlightTime;for(const Xe of ce){const ft=v.find(Ke=>Ke.id===Xe.flightNumber);if(!ft)continue;const tt=Xe.startTime-ft.preFlightTime,We=Xe.startTime+Xe.duration+ft.postFlightTime;if(Z<We&&Fe>tt){const Ke=X0(He),nt=X0(Xe),Ct=Ke.find(xt=>nt.includes(xt));if(Ct)return{conflictingEvent:Xe,personName:Ct}}}}return null},[v]),Ne=(pe,ce)=>{if(pe.button!==0)return;Te.current=!1,document.body.classList.add("no-select");const _e=pe.currentTarget.getBoundingClientRect(),Z=new Map,Fe=ce.instructor||"",Xe=i.findIndex(ft=>ft.name===Fe);Xe!==-1&&Z.set(ce.id,{startTime:ce.startTime,rowIndex:Xe}),Z.size>0&&W({mainEventId:ce.id,xOffset:(pe.clientX-_e.left)/u,initialPositions:Z})},Oe=pe=>{if(!O||!P.current)return;Te.current=!0;const ce=P.current.getBoundingClientRect(),_e=((pe.clientX-ce.left)/u-O.xOffset)/Si+fi,Z=fe.find(nt=>nt.id===O.mainEventId);if(!Z)return;let Fe=_e;Fe<fi&&(Fe=fi),Fe+Z.duration>ac&&(Fe=ac-Z.duration);const Xe=Math.round(Fe*12)/12,ft={...Z,startTime:Xe},tt=fe.filter(nt=>nt.id!==O.mainEventId),We=ge([ft],tt);V(We?{conflictingEventId:We.conflictingEvent.id,conflictedPersonName:We.personName}:null),Xe!==Z.startTime&&d([{eventId:O.mainEventId,newStartTime:Xe}])},se=()=>{document.body.classList.remove("no-select"),W(null),V(null),setTimeout(()=>{Te.current=!1},0)},F=i.length;console.log("üìè CALCULATING DIMENSIONS:"),console.log("  - TOTAL_HOURS:",ry),console.log("  - PIXELS_PER_HOUR:",Si),console.log("  - zoomLevel:",u),console.log("  - ROW_HEIGHT:",Cl),console.log("  - totalRows (instructors.length):",F);const X=ry*Si*u,J=F*Cl;console.log("üìè CALCULATED VALUES:"),console.log("  - timelineWidth:",X),console.log("  - containerHeight:",J);const ee=C.useCallback(pe=>{if(!pe||!/^\d{2}:\d{2}$/.test(pe))return null;const[ce,He]=pe.split(":").map(Number);return ce+He/60},[]),K=()=>{const pe=[];for(let _e=fi;_e<=ac;_e++)pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-gray-500 flex items-center",style:{left:(_e-fi)*Si*u},children:e.jsx("span",{className:"-translate-x-1/2",children:`${String(_e).padStart(2,"0")}:00`})},_e));const ce=ee(f.firstLight),He=ee(f.lastLight);if(ce!==null){const _e=(ce-fi)*Si*u;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`FL ${f.firstLight}`})},"fl-label"))}if(He!==null){const _e=(He-fi)*Si*u;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`LL ${f.lastLight}`})},"ll-label"))}return pe},ue=()=>{const pe=[];for(let ce=fi;ce<=ac;ce++)pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-fi)*Si*u},children:e.jsx("div",{className:"w-px h-full bg-gray-700/50"})},`v-${ce}`)),ce<ac&&pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-fi+.5)*Si*u},children:e.jsx("div",{className:"w-px h-full bg-gray-700/25"})},`v-${ce}-30`));for(let ce=1;ce<=F;ce++)pe.push(e.jsx("div",{className:"absolute left-0 w-full bg-gray-700/25",style:{top:ce*Cl,height:"1px"}},`h-${ce}`));return pe},xe=()=>{const pe=ee(f.firstLight),ce=ee(f.lastLight);return e.jsxs(e.Fragment,{children:[pe!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(pe-fi)*Si*u}px`}}),ce!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(ce-fi)*Si*u}px`}})]})},Le=()=>{const pe=ee(f.firstLight),ce=ee(f.lastLight),He=[];if(pe!==null&&pe>fi){const _e=(pe-fi)*Si*u;He.push(e.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/5 pointer-events-none z-[1]",style:{width:`${_e}px`}},"night-shade-morning"))}if(ce!==null&&ce<ac){const _e=(ce-fi)*Si*u,Z=(ac-ce)*Si*u;He.push(e.jsx("div",{className:"absolute top-0 h-full bg-white/5 pointer-events-none z-[1]",style:{left:`${_e}px`,width:`${Z}px`}},"night-shade-evening"))}return e.jsx(e.Fragment,{children:He})},ye=()=>{const ce=parseFloat(localStorage.getItem("timezoneOffset")||"0")*60*60*1e3,He=new Date(Date.now()+ce),_e=`${He.getUTCFullYear()}-${String(He.getUTCMonth()+1).padStart(2,"0")}-${String(He.getUTCDate()).padStart(2,"0")}`;if(n!==_e)return null;const Z=R,Fe=Z.getHours()+Z.getMinutes()/60+Z.getSeconds()/3600;if(Fe<fi||Fe>ac)return null;const Xe=(Fe-fi)*Si*u;return e.jsxs("div",{className:"absolute top-0 h-full z-[30] pointer-events-none",style:{left:`${Xe}px`},children:[e.jsx("div",{className:"w-0.5 h-full bg-white animate-pulse"}),e.jsx("div",{className:"absolute -top-2.5 -translate-x-1/2 w-0 h-0",style:{borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"7px solid white"}})]})};return console.log("üéØ INSTRUCTOR SCHEDULE VIEW - About to render"),console.log("üéØ Final calculations:"),console.log("  - totalRows:",i==null?void 0:i.length),console.log("  - timelineWidth:",typeof X<"u"?X:"NOT_CALCULATED"),console.log("  - containerHeight:",typeof J<"u"?J:"NOT_CALCULATED"),typeof X>"u"&&console.error("‚ùå CRITICAL: timelineWidth is undefined - this will cause rendering failure"),typeof J>"u"&&console.error("‚ùå CRITICAL: containerHeight is undefined - this will cause rendering failure"),console.log("üéØ Returning JSX..."),e.jsx("div",{ref:_,className:"flex-1 overflow-auto relative bg-gray-900",children:e.jsxs("div",{style:{width:`${iy+X}px`,height:`${J0+J}px`,display:"grid",gridTemplateColumns:`${iy}px 1fr`,gridTemplateRows:`${J0}px 1fr`},children:[e.jsx("div",{className:"sticky top-0 left-0 z-40 bg-gray-800 border-r border-b border-gray-700 p-1",children:e.jsxs("div",{className:"bg-gray-700 rounded-md w-full h-full flex items-center justify-center px-2 space-x-2",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"flex-grow min-w-0 text-center font-semibold text-white cursor-default truncate",children:Y}),e.jsx("button",{onClick:()=>t(1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})}),e.jsxs("div",{className:"sticky top-0 z-20 bg-gray-800 border-b border-gray-700",children:[" ",e.jsx("div",{className:"relative",style:{width:X,height:J0},children:K()})]}),e.jsxs("div",{className:"sticky left-0 z-30 bg-gray-800 border-r border-gray-700",children:[" ",e.jsx(Iv,{personnel:i,rowHeight:Cl,onPersonClick:E,onRowEnter:M,onRowLeave:()=>M(null),showUnits:!1,useUnitColors:!0})]}),e.jsxs("div",{ref:P,className:"relative",onMouseMove:Oe,onMouseUp:se,onMouseLeave:se,children:[ue(),Le(),xe(),ye(),i.flatMap((pe,ce)=>{const He=$===ce?e.jsx("div",{className:"absolute top-0 left-0 right-0 pointer-events-none z-10",style:{height:Cl,top:ce*Cl,backgroundColor:"rgba(255, 255, 255, 0.05)"}},`row-highlight-${ce}`):null,_e=[];if(y){const Xe=fe.filter(ft=>ft.instructor===pe.name).sort((ft,tt)=>ft.startTime-tt.startTime);for(let ft=0;ft<Xe.length;ft++){const tt=Xe[ft],We=Xe[ft-1],Ke=Xe[ft+1],nt=v.find(kt=>kt.id===tt.flightNumber);if(!nt)continue;const Ct=We&&(()=>{const kt=v.find(vt=>vt.id===We.flightNumber);if(!kt)return!1;const Ge=We.startTime+We.duration+kt.postFlightTime,ht=tt.startTime-nt.preFlightTime;return Ge>ht})(),xt=Ke&&(()=>{const kt=v.find(vt=>vt.id===Ke.flightNumber);if(!kt)return!1;const Ge=tt.startTime+tt.duration+nt.postFlightTime,ht=Ke.startTime-kt.preFlightTime;return Ge>ht})();if(!(U===tt.id)&&!(Ct||xt))continue;const st=(kt,Ge,ht,vt)=>{const Ht=kt*Si*u,ze=Cl*.25,we=ce*Cl+(Cl-ze)/2,Re=(Ge-fi)*Si*u,Ze=`absolute pointer-events-none z-20 rounded-full border shadow-lg backdrop-blur-sm transition-colors duration-200 ${ht?"bg-red-500/50 border-red-400/30":"bg-white/50 border-white/30"}`,ot={left:`${Re}px`,top:`${we}px`,width:`${Ht}px`,height:`${ze}px`};_e.push(e.jsx("div",{style:ot,className:Ze},vt))};if(nt.preFlightTime>0){const kt=tt.startTime-nt.preFlightTime;st(nt.preFlightTime,kt,Ct||!1,`${tt.id}-pre-${ce}`)}if(nt.postFlightTime>0){const kt=tt.startTime+tt.duration;st(nt.postFlightTime,kt,xt||!1,`${tt.id}-post-${ce}`)}}}const Fe=fe.filter(Xe=>Xe.instructor===pe.name||Xe.flightType==="Dual"&&Xe.student===pe.name).sort((Xe,ft)=>Xe.startTime-ft.startTime).map(Xe=>{const ft=!!(O&&O.mainEventId===Xe.id),tt=Xe.id===(ne==null?void 0:ne.conflictingEventId),We=y&&x.has(Xe.id)||tt||ft&&!!ne,Ke=T.get(Xe.id),nt=!!Ke,Ct=Ke||[];let xt=null;if(ne){const dn=X0(Xe);(ft||tt)&&dn.includes(ne.conflictedPersonName)&&(xt=ne.conflictedPersonName)}return e.jsx(Gc,{event:Xe,traineesData:A,onSelectEvent:()=>{Te.current||l(Xe)},onMouseDown:dn=>Ne(dn,Xe),onMouseEnter:()=>D(Xe.id),onMouseLeave:()=>D(null),pixelsPerHour:Si*u,rowHeight:Cl,startHour:fi,row:ce,isDragging:ft,isConflicting:We,isUnavailabilityConflict:nt,unavailablePersonnel:Ct,conflictedPersonnelName:xt,personnelData:h,seatConfigs:m,isDraggable:!0,currentTime:R},`${Xe.id}-${pe.name}`)});return[He,..._e,...Fe]})]})]})})},Lv=({trainees:n,rowHeight:t,onRowEnter:s,onRowLeave:i,onTraineeClick:o,onRowRef:l,courseColors:d={}})=>{const u=h=>{const m=h.split(" ‚Äì ");return{name:m[0]||h,course:m[1]||""}},f=h=>({"bg-sky-400/50":"#38BDF8","bg-purple-400/50":"#C084FC","bg-yellow-400/50":"#FACC15","bg-pink-400/50":"#F472B6","bg-teal-400/50":"#2DD4BF","bg-indigo-400/50":"#818CF8","bg-cyan-400/50":"#22D3EE","bg-blue-400/50":"#60A5FA","bg-green-400/50":"#4ADE80","bg-orange-400/50":"#FB923C","bg-red-400/50":"#F87171","bg-gray-400/50":"#9CA3AF"})[h]||"#9CA3AF";return e.jsx("div",{className:"w-40 bg-gray-800 flex-shrink-0 h-full",children:e.jsx("ul",{children:n.map((h,m)=>{const{name:v,course:x}=u(h);return e.jsx("li",{ref:y=>l==null?void 0:l(h,y),className:`flex items-center justify-start pl-3 text-xs transition-colors duration-150 text-gray-300 border-b border-gray-700/50 ${o?"cursor-pointer hover:bg-gray-700":""}`,style:{height:t},onMouseEnter:()=>s==null?void 0:s(m),onMouseLeave:()=>i==null?void 0:i(),onClick:()=>o==null?void 0:o(h),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"truncate font-medium leading-tight",children:v}),x&&e.jsx("span",{className:"font-mono leading-tight",style:{color:f(d[x]||"bg-gray-400/50")},children:x})]})})})})})},Di=200,ec=32,hi=0,oc=24,lw=oc-hi,ay=160,K0=40,Z0=n=>{const t=[];return n.flightType==="Solo"?n.pilot&&t.push(n.pilot):(n.instructor&&t.push(n.instructor),n.student&&t.push(n.student)),t},cw=(n,t)=>{const s=[];return t.forEach(i=>{(i.unavailability||[]).forEach(l=>{const d=new Date(n+"T00:00:00Z"),u=new Date(l.startDate+"T00:00:00Z"),f=new Date(l.endDate+"T00:00:00Z"),h=new Date(f);if(l.allDay&&h.setDate(h.getDate()-1),d>=u&&d<=h){let m=l.allDay?.0167:parseFloat(l.startTime)/100,v=l.allDay?23.983:parseFloat(l.endTime)/100;l.allDay||(d.getTime()===u.getTime()&&d.getTime()===h.getTime()?(m=l.startTime?parseFloat(l.startTime)/100:.0167,v=l.endTime?parseFloat(l.endTime)/100:23.983):d.getTime()===u.getTime()&&l.startTime?(m=parseFloat(l.startTime)/100,v=23.983):d.getTime()===h.getTime()&&l.endTime?(m=.0167,v=parseFloat(l.endTime)/100):d>u&&d<h&&(m=.0167,v=23.983));const x=v-m,y={id:`unavailability-${i.fullName}-${l.id}`,date:n,startTime:m,duration:x,type:"unavailability",student:i.fullName,pilot:i.fullName,flightNumber:"UNAVAIL",resourceName:i.fullName,resourceId:`TRAINEE-${i.fullName}`,eventType:"UNAVAILABILITY",allDay:l.allDay,reason:l.reason,notes:l.notes};s.push(y)}})}),s},dw=({date:n,onDateChange:t,events:s,trainees:i,onSelectEvent:o,onUpdateEvent:l,zoomLevel:d,daylightTimes:u,personnelData:f,seatConfigs:h,syllabusDetails:m,conflictingEventIds:v,showValidation:x,unavailabilityConflicts:y,onSelectTrainee:T,traineesData:E,courseColors:A})=>{const _=C.useRef(null),[R,H]=C.useState(new Date),[O,W]=C.useState(null),[ne,V]=C.useState(null),[U,D]=C.useState(null),[$,M]=C.useState(null),P=C.useRef(null),ae=C.useRef(!0),Q=C.useRef(d),Te=C.useRef(!1);C.useEffect(()=>{const pe=setInterval(()=>H(new Date),1e3);return()=>clearInterval(pe)},[]);const Y=C.useMemo(()=>{const[pe,ce,He]=n.split("-").map(Number);return new Date(Date.UTC(pe,ce-1,He)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[n]),fe=C.useMemo(()=>{const pe=cw(n,E);return[...s,...pe]},[n,s,E]);C.useEffect(()=>{const pe=_.current;if(pe){if(ae.current){const He=(8-hi)*Di*d;pe.scrollLeft=He,ae.current=!1}else{const ce=Q.current;if(ce===d)return;const{scrollLeft:He,clientWidth:_e}=pe,Fe=(He+_e/2)/(Di*ce)*Di*d-_e/2;pe.scrollLeft=Fe}Q.current=d}},[d]);const ge=C.useCallback((pe,ce)=>{for(const He of pe){const _e=m.find(Xe=>Xe.id===He.flightNumber);if(!_e)continue;const Z=He.startTime-_e.preFlightTime,Fe=He.startTime+He.duration+_e.postFlightTime;for(const Xe of ce){const ft=m.find(Ke=>Ke.id===Xe.flightNumber);if(!ft)continue;const tt=Xe.startTime-ft.preFlightTime,We=Xe.startTime+Xe.duration+ft.postFlightTime;if(Z<We&&Fe>tt){const Ke=Z0(He),nt=Z0(Xe),Ct=Ke.find(xt=>nt.includes(xt));if(Ct)return{conflictingEvent:Xe,personName:Ct}}}}return null},[m]),Ne=(pe,ce)=>{if(pe.button!==0)return;Te.current=!1,document.body.classList.add("no-select");const _e=pe.currentTarget.getBoundingClientRect(),Z=new Map,Fe=ce.student||ce.pilot||"",Xe=i.findIndex(ft=>ft===Fe);Xe!==-1&&Z.set(ce.id,{startTime:ce.startTime,rowIndex:Xe}),Z.size>0&&W({mainEventId:ce.id,xOffset:(pe.clientX-_e.left)/d,initialPositions:Z})},Oe=pe=>{if(!O||!P.current)return;Te.current=!0;const ce=P.current.getBoundingClientRect(),_e=((pe.clientX-ce.left)/d-O.xOffset)/Di+hi,Z=fe.find(nt=>nt.id===O.mainEventId);if(!Z)return;let Fe=_e;Fe<hi&&(Fe=hi),Fe+Z.duration>oc&&(Fe=oc-Z.duration);const Xe=Math.round(Fe*12)/12,ft={...Z,startTime:Xe},tt=fe.filter(nt=>nt.id!==O.mainEventId),We=ge([ft],tt);V(We?{conflictingEventId:We.conflictingEvent.id,conflictedPersonName:We.personName}:null),Xe!==Z.startTime&&l([{eventId:O.mainEventId,newStartTime:Xe}])},se=()=>{document.body.classList.remove("no-select"),W(null),V(null),setTimeout(()=>{Te.current=!1},0)},F=i.length,X=lw*Di*d,J=F*ec,ee=C.useCallback(pe=>{if(!pe||!/^\d{2}:\d{2}$/.test(pe))return null;const[ce,He]=pe.split(":").map(Number);return ce+He/60},[]),K=()=>{const pe=[];for(let _e=hi;_e<=oc;_e++)pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-gray-500 flex items-center",style:{left:(_e-hi)*Di*d},children:e.jsx("span",{className:"-translate-x-1/2",children:`${String(_e).padStart(2,"0")}:00`})},_e));const ce=ee(u.firstLight),He=ee(u.lastLight);if(ce!==null){const _e=(ce-hi)*Di*d;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`FL ${u.firstLight}`})},"fl-label"))}if(He!==null){const _e=(He-hi)*Di*d;pe.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:_e},children:e.jsx("span",{className:"-translate-x-1/2",children:`LL ${u.lastLight}`})},"ll-label"))}return pe},ue=()=>{const pe=[];for(let ce=hi;ce<=oc;ce++)pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-hi)*Di*d},children:e.jsx("div",{className:"w-px h-full bg-gray-700/50"})},`v-${ce}`)),ce<oc&&pe.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ce-hi+.5)*Di*d},children:e.jsx("div",{className:"w-px h-full bg-gray-700/25"})},`v-${ce}-30`));for(let ce=1;ce<=F;ce++)pe.push(e.jsx("div",{className:"absolute left-0 w-full bg-gray-700/25",style:{top:ce*ec,height:"1px"}},`h-${ce}`));return pe},xe=()=>{const pe=ee(u.firstLight),ce=ee(u.lastLight);return e.jsxs(e.Fragment,{children:[pe!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(pe-hi)*Di*d}px`}}),ce!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(ce-hi)*Di*d}px`}})]})},Le=()=>{const pe=ee(u.firstLight),ce=ee(u.lastLight),He=[];if(pe!==null&&pe>hi){const _e=(pe-hi)*Di*d;He.push(e.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/5 pointer-events-none z-[1]",style:{width:`${_e}px`}},"night-shade-morning"))}if(ce!==null&&ce<oc){const _e=(ce-hi)*Di*d,Z=(oc-ce)*Di*d;He.push(e.jsx("div",{className:"absolute top-0 h-full bg-white/5 pointer-events-none z-[1]",style:{left:`${_e}px`,width:`${Z}px`}},"night-shade-evening"))}return e.jsx(e.Fragment,{children:He})},ye=()=>{const ce=parseFloat(localStorage.getItem("timezoneOffset")||"0")*60*60*1e3,He=new Date(Date.now()+ce),_e=`${He.getUTCFullYear()}-${String(He.getUTCMonth()+1).padStart(2,"0")}-${String(He.getUTCDate()).padStart(2,"0")}`;if(n!==_e)return null;const Z=R,Fe=Z.getHours()+Z.getMinutes()/60+Z.getSeconds()/3600;if(Fe<hi||Fe>oc)return null;const Xe=(Fe-hi)*Di*d;return e.jsxs("div",{className:"absolute top-0 h-full z-[30] pointer-events-none",style:{left:`${Xe}px`},children:[e.jsx("div",{className:"w-0.5 h-full bg-white animate-pulse"}),e.jsx("div",{className:"absolute -top-2.5 -translate-x-1/2 w-0 h-0",style:{borderLeft:"5px solid transparent",borderRight:"5px solid transparent",borderTop:"7px solid white"}})]})};return e.jsx("div",{ref:_,className:"flex-1 overflow-auto relative bg-gray-900",children:e.jsxs("div",{style:{width:`${ay+X}px`,height:`${K0+J}px`,display:"grid",gridTemplateColumns:`${ay}px 1fr`,gridTemplateRows:`${K0}px 1fr`},children:[e.jsx("div",{className:"sticky top-0 left-0 z-40 bg-gray-800 border-r border-b border-gray-700 p-1",children:e.jsxs("div",{className:"bg-gray-700 rounded-md w-full h-full flex items-center justify-center px-2 space-x-2",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"flex-grow min-w-0 text-center font-semibold text-white cursor-default truncate",children:Y}),e.jsx("button",{onClick:()=>t(1),className:"p-1 rounded-full hover:bg-gray-600 text-white flex-shrink-0",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})}),e.jsx("div",{className:"sticky top-0 z-20 bg-gray-800 border-b border-gray-700",children:e.jsx("div",{className:"relative",style:{width:X,height:K0},children:K()})}),e.jsx("div",{className:"sticky left-0 z-30 bg-gray-800 border-r border-gray-700",children:e.jsx(Lv,{trainees:i,rowHeight:ec,onTraineeClick:T,courseColors:A,onRowEnter:M,onRowLeave:()=>M(null)})}),e.jsxs("div",{ref:P,className:"relative",onMouseMove:Oe,onMouseUp:se,onMouseLeave:se,children:[ue(),Le(),xe(),ye(),i.flatMap((pe,ce)=>{const He=$===ce?e.jsx("div",{className:"absolute top-0 left-0 right-0 pointer-events-none z-10",style:{height:ec,top:ce*ec,backgroundColor:"rgba(255, 255, 255, 0.05)"}},`row-highlight-${ce}`):null,_e=[];if(x){const Xe=s.filter(ft=>ft.student===pe||ft.flightType==="Solo"&&ft.pilot===pe).sort((ft,tt)=>ft.startTime-tt.startTime);for(let ft=0;ft<Xe.length;ft++){const tt=Xe[ft],We=Xe[ft-1],Ke=Xe[ft+1],nt=m.find(kt=>kt.id===tt.flightNumber);if(!nt)continue;const Ct=We&&(()=>{const kt=m.find(vt=>vt.id===We.flightNumber);if(!kt)return!1;const Ge=We.startTime+We.duration+kt.postFlightTime,ht=tt.startTime-nt.preFlightTime;return Ge>ht})(),xt=Ke&&(()=>{const kt=m.find(vt=>vt.id===Ke.flightNumber);if(!kt)return!1;const Ge=tt.startTime+tt.duration+nt.postFlightTime,ht=Ke.startTime-kt.preFlightTime;return Ge>ht})();if(!(U===tt.id)&&!(Ct||xt))continue;const st=(kt,Ge,ht,vt)=>{const Ht=kt*Di*d,ze=ec*.25,we=ce*ec+(ec-ze)/2,Re=(Ge-hi)*Di*d,Ze=`absolute pointer-events-none z-20 rounded-full border shadow-lg backdrop-blur-sm transition-colors duration-200 ${ht?"bg-red-500/50 border-red-400/30":"bg-white/50 border-white/30"}`,ot={left:`${Re}px`,top:`${we}px`,width:`${Ht}px`,height:`${ze}px`};_e.push(e.jsx("div",{style:ot,className:Ze},vt))};if(nt.preFlightTime>0){const kt=tt.startTime-nt.preFlightTime;st(nt.preFlightTime,kt,Ct||!1,`${tt.id}-pre-${ce}`)}if(nt.postFlightTime>0){const kt=tt.startTime+tt.duration;st(nt.postFlightTime,kt,xt||!1,`${tt.id}-post-${ce}`)}}}const Fe=fe.filter(Xe=>Xe.student===pe||Xe.flightType==="Solo"&&Xe.pilot===pe).sort((Xe,ft)=>Xe.startTime-ft.startTime).map(Xe=>{const ft=!!(O&&O.mainEventId===Xe.id),tt=Xe.id===(ne==null?void 0:ne.conflictingEventId),We=x&&v.has(Xe.id)||tt||ft&&!!ne,Ke=y.get(Xe.id),nt=!!Ke,Ct=Ke||[];let xt=null;if(ne){const dn=Z0(Xe);(ft||tt)&&dn.includes(ne.conflictedPersonName)&&(xt=ne.conflictedPersonName)}return e.jsx(Gc,{event:Xe,traineesData:E,onSelectEvent:()=>{Te.current||o(Xe)},onMouseDown:dn=>Ne(dn,Xe),onMouseEnter:()=>D(Xe.id),onMouseLeave:()=>D(null),pixelsPerHour:Di*d,rowHeight:ec,startHour:hi,row:ce,isDragging:ft,isConflicting:We,isUnavailabilityConflict:nt,unavailablePersonnel:Ct,conflictedPersonnelName:xt,personnelData:f,seatConfigs:h,isDraggable:!0,currentTime:R},`${Xe.id}-${pe}`)});return[He,..._e,...Fe]})]})]})})};function oy(n,t,s,i,o,l){const d=[],u=[];n||d.push({type:"error",field:"startDate",message:"Start date is required",remediation:"Please select a start date from the calendar"}),t||d.push({type:"error",field:"endDate",message:"End date is required",remediation:"Please select an end date from the calendar"});const f=(E,A)=>{if(!E)return!0;if(E.length!==4)return d.push({type:"error",field:A,message:`Invalid ${A==="startTime"?"start":"end"} time format`,remediation:"Time must be exactly 4 digits in HHMM format (e.g., 0900 for 9:00 AM, 1400 for 2:00 PM)"}),!1;const _=parseInt(E.substring(0,2)),R=parseInt(E.substring(2,4));return isNaN(_)||isNaN(R)?(d.push({type:"error",field:A,message:`Invalid ${A==="startTime"?"start":"end"} time values`,remediation:"Time must contain only numbers. Hours (00-23) and minutes (00-59)"}),!1):_<0||_>23?(d.push({type:"error",field:A,message:`${A==="startTime"?"Start":"End"} hour out of range`,remediation:"Hours must be between 00 and 23. Use 24-hour format (e.g., 09 for 9 AM, 14 for 2 PM, 23 for 11 PM)"}),!1):R<0||R>59?(d.push({type:"error",field:A,message:`${A==="startTime"?"Start":"End"} minutes out of range`,remediation:"Minutes must be between 00 and 59 (e.g., 00, 15, 30, 45)"}),!1):!0},h=f(s,"startTime"),m=f(i,"endTime");if(d.some(E=>E.field==="startTime"||E.field==="endDate"||E.field==="startDate"))return{isValid:!1,errors:d,warnings:u};const v=new Date(n+"T00:00:00Z"),x=new Date(t+"T00:00:00Z");if(x<v)return d.push({type:"error",field:"endDate",message:"End date cannot be before start date",remediation:"Select an end date that is the same as or after the start date"}),{isValid:!1,errors:d,warnings:u};const y=!s&&!i;if(y&&x.getTime()===v.getTime()&&d.push({type:"error",field:"endDate",message:"All-day unavailability must span at least one full day",remediation:"For a single all-day unavailability, set the end date to the next day. Example: If unavailable on Dec 15, set start date to Dec 15 and end date to Dec 16."}),!y&&h&&m){const E=parseFloat(s)/100,A=parseFloat(i)/100;E>=A&&v.getTime()===x.getTime()&&d.push({type:"error",field:"endTime",message:"End time must be after start time for same-day events",remediation:"Set an end time that is later than the start time. Example: Start 0900, End 1200"}),(E<6||A>22)&&u.push({type:"warning",field:"startTime",message:"Unavailability times are outside normal operating hours",remediation:"Consider if these times are correct. Normal operating hours are 0600-2200 (6:00 AM - 10:00 PM)"}),E>0&&A>0&&A-E<.5&&u.push({type:"warning",field:"startTime",message:"Very short unavailability period",remediation:"This is less than 30 minutes. Consider if this duration is correct or if it should be longer"}),v.getTime()!==x.getTime()&&E>0&&A<23.983&&u.push({type:"warning",field:"endTime",message:"Multi-day timed event with specific end time",remediation:"For multi-day unavailability, consider using full-day (0001-2359) or setting end time to 2359 for last day"})}if((!o||o.trim()==="")&&d.push({type:"error",field:"general",message:"Reason for unavailability is required",remediation:"Please select a reason from the dropdown menu"}),l&&l.length>0){const E=uw({startDate:n,endDate:t,allDay:y},l);E.length>0&&u.push({type:"warning",field:"overlap",message:`Overlaps with ${E.length} existing unavailability period(s)`,remediation:"Review existing unavailability periods to avoid duplication. Overlapping periods may not display correctly in the schedule."})}return Math.ceil((x.getTime()-v.getTime())/(1e3*60*60*24))>30&&u.push({type:"warning",field:"endDate",message:"Very long unavailability period",remediation:"This unavailability spans more than 30 days. Please verify this is correct or consider breaking it into shorter periods"}),{isValid:d.length===0,errors:d,warnings:u}}function uw(n,t){const s=[];for(const i of t)fw(n,i)&&s.push(i);return s}function fw(n,t){const s=new Date(n.startDate+"T00:00:00Z"),i=new Date(n.endDate+"T00:00:00Z"),o=new Date(t.startDate+"T00:00:00Z"),l=new Date(t.endDate+"T00:00:00Z");return n.allDay&&i.setUTCDate(i.getUTCDate()-1),t.allDay&&l.setUTCDate(l.getUTCDate()-1),s<=l&&o<=i}const hw=({validation:n,className:t=""})=>{if(n.isValid)return null;const s=()=>e.jsx("svg",{className:"w-5 h-5 text-red-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),i=()=>e.jsx("svg",{className:"w-5 h-5 text-yellow-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),o=()=>e.jsx("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})});return e.jsxs("div",{className:`space-y-3 ${t}`,children:[n.errors.length>0&&e.jsx("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(s,{}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-red-400 font-semibold mb-2",children:["Data Entry Errors (",n.errors.length,")"]}),e.jsx("div",{className:"space-y-2",children:n.errors.map((l,d)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-red-300 font-medium",children:l.message}),e.jsxs("div",{className:"flex items-start mt-1 space-x-2",children:[e.jsx(o,{}),e.jsx("p",{className:"text-red-200",children:l.remediation})]})]},d))})]})]})}),n.warnings.length>0&&e.jsx("div",{className:"bg-yellow-900/20 border border-yellow-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(i,{}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"text-yellow-400 font-semibold mb-2",children:["Warnings (",n.warnings.length,")"]}),e.jsx("div",{className:"space-y-2",children:n.warnings.map((l,d)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-yellow-300 font-medium",children:l.message}),e.jsxs("div",{className:"flex items-start mt-1 space-x-2",children:[e.jsx(o,{}),e.jsx("p",{className:"text-yellow-200",children:l.remediation})]})]},d))})]})]})})]})},Mv=({onClose:n,onTodayOnly:t,onSave:s,unavailabilityPeriods:i,onRemove:o})=>{const[l,d]=C.useState(""),[u,f]=C.useState(""),[h,m]=C.useState(""),[v,x]=C.useState(""),[y,T]=C.useState("Appointment"),[E,A]=C.useState(null),[_,R]=C.useState(!1),H=["TMUF","TMUF - Ground Duties only","Leave","Appointment","Other"],O=()=>{d(""),f(""),m(""),x(""),T("Appointment"),A(null),R(!1)},W=()=>{if(l||u||h||v){const D=oy(l,u,h,v,y,i);A(D)}else A(null)};Ua.useEffect(()=>{_&&W()},[l,u,h,v,y,_]);const ne=()=>{console.log("handleSave
dist/assets/index-uPhlgI5U.js:bg-purple-600 hover:bg-purple-700",children:"Visual Adjust"})]}):e.jsx("button",{onClick:()=>X(!0),className:"w-full px-4 py-2 text-white rounded-md transition-colors text-sm font-semibold shadow-md text-center bg-gray-600 hover:bg-gray-700",children:"Edit"})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end flex-shrink-0",children:e.jsx("button",{onClick:t,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Close"})})]})}),K&&e.jsx(jw,{eventId:n.id,eventType:n.type==="ftd"?"ftd":"flight",onConfirm:(ke,mt,nn)=>{se?se(ke,mt,nn):i(),ue(!1)},onClose:()=>ue(!1),cancellationCodes:Oe}),xe&&e.jsx(Ew,{isOpen:xe,onClose:()=>Le(!1),event:n,trainees:(()=>{if(console.log("üîç Processing trainees for MassBriefCompleteFlyout"),console.log("üîç Event:",n),console.log("üîç Event.attendees:",n.attendees),console.log("üîç Event.group:",n.group),console.log("üîç Event.selectedTrainees:",n.selectedTrainees),console.log("üîç Event.trainees:",n.trainees),console.log("üîç Event keys:",Object.keys(n)),console.log("üîç Available trainees (strings):",d),console.log("üîç Available traineesData (objects):",v),n.attendees){console.log("üîç Processing attendees array");const ke=n.attendees.map((mt,nn)=>{console.log(`üîç Processing attendee ${nn}: "${mt}"`);const Yt=v.find(an=>{const en=`${an.rank} ${an.name}`;return console.log(`üîç Comparing "${en}" with "${mt.split(" ‚Äì ")[0]}"`),en===mt.split(" ‚Äì ")[0]});if(Yt)return console.log("üîç Found matching trainee:",Yt),Yt;{console.log("üîç Creating fallback trainee object");const an=mt.split(" ‚Äì "),en=an[0],Cn=an[1]||"";let Vn="",xn=en;const ls=en.indexOf(",");if(ls!==-1){const Zs=en.substring(0,ls).trim();xn=`${en.substring(ls+1).trim()} ${Zs}`}else{const Zs=en.trim().split(" ");Zs.length>=2&&(Vn=Zs[0],xn=Zs.slice(1).join(" "))}const Es={idNumber:0,fullName:en,name:xn,rank:Vn,course:Cn,isPaused:!1,unit:"",seatConfig:"Pilot",id:en};return console.log("üîç Fallback trainee:",Es),Es}});return console.log("üîç Final processed attendees:",ke),ke}if(n.group&&n.group.includes("Trainees Selected")){console.log("üîç Mass event detected, filtering trainees by course");let ke="";if(n.course)ke=n.course,console.log("üîç Event course:",ke);else if(d.length>0&&typeof d[0]=="string"){const Yt=d[0].split(" ‚Äì ");Yt.length>1&&(ke=Yt[1],console.log("üîç Extracted course from trainees:",ke))}const mt=ke?v.filter(nn=>nn.course===ke):v;return console.log("üîç Filtered trainees count:",mt.length),console.log("üîç Filtered trainees:",mt),mt}return console.log("üîç No attendees or mass event, returning empty array"),[]})(),onConfirm:Ba}),ye&&e.jsx(Aw,{isOpen:ye,onClose:()=>{pe(!1),t()},event:n,confirmedTrainees:ce})]})},Lw=({conflict:n,onResolve:t,onCancel:s})=>{const i=f=>{const h=Math.floor(f),m=Math.round(f%1*60);return`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`},o=n.conflictingEvent.startTime+n.conflictingEvent.duration,l=n.conflictedPerson==="instructor"?"Instructor":"Trainee",d=n.conflictingEvent.type==="ftd"?"FTD session":"flight",u=n.newEvent.type==="ftd"?"FTD session":"flight";return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[70] flex items-center justify-center",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-red-500/50 transform transition-all animate-fade-in",role:"alertdialog","aria-modal":"true","aria-labelledby":"conflict-title","aria-describedby":"conflict-description",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex items-center space-x-3 bg-red-900/20",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("h2",{id:"conflict-title",className:"text-xl font-bold text-red-400",children:"Scheduling Conflict"})]}),e.jsxs("div",{className:"p-6 text-gray-300",id:"conflict-description",children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{className:"text-white",children:n.personName})," is already scheduled for a"," ",e.jsx("strong",{className:"text-white",children:d})," (",n.conflictingEvent.flightNumber,") from"," ",e.jsx("strong",{className:"text-white",children:i(n.conflictingEvent.startTime)})," to"," ",e.jsx("strong",{className:"text-white",children:i(o)}),"."]}),e.jsxs("p",{className:"mb-4",children:["This conflicts with the new ",e.jsx("strong",{className:"text-white",children:u})," you are trying to schedule."]}),e.jsx("p",{children:"Please choose an option to resolve this conflict."})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-900/50 border-t border-gray-700 flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{onClick:()=>t("changeTime"),className:"w-full sm:w-auto px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"Change Time"}),e.jsxs("button",{onClick:()=>t("changePerson"),className:"w-full sm:w-auto px-4 py-2 bg-amber-600 text-white rounded-md hover:bg-amber-700 transition-colors text-sm font-semibold",children:["Replace ",l]}),e.jsx("button",{onClick:s,className:"w-full sm:w-auto px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors text-sm font-semibold",children:"Cancel & Delete Tile"})]})]})})},Mw=({onClose:n,onConfirm:t,courseNumber:s,traineesInCourse:i,traineeStatus:o})=>{const l=C.useMemo(()=>i.filter(m=>{var v;return!((v=o.get(m.fullName))!=null&&v.isPaused)}),[i,o]),[d,u]=C.useState(()=>l.map(m=>m.fullName)),f=m=>{u(v=>v.includes(m)?v.filter(x=>x!==m):[...v,m])},h=()=>{t(d)};return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[70] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50",children:e.jsxs("h2",{className:"text-xl font-bold text-white",children:["Confirm Attendees for ",s]})}),e.jsxs("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:[e.jsx("p",{className:"text-gray-400 mb-4 text-sm",children:"All active trainees are selected by default. Deselect any who will not be attending."}),e.jsx("ul",{className:"space-y-2",children:l.map(m=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center space-x-3 p-2 rounded hover:bg-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.includes(m.fullName),onChange:()=>f(m.fullName),className:"h-4 w-4 accent-sky-500 bg-gray-600"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[m.name," (",m.rank,")"]})]})},m.fullName))})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold",children:"Cancel"}),e.jsxs("button",{onClick:h,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:["Confirm (",d.length,")"]})]})]})})},Fw=({onClose:n,onSave:t,groundSyllabus:s,activeCourses:i,allTraineesByCourse:o,instructors:l,traineesData:d})=>{var X,J;const[u,f]=C.useState(((X=s[0])==null?void 0:X.code)||""),[h,m]=C.useState(8),[v,x]=C.useState(((J=s[0])==null?void 0:J.duration)||1),[y,T]=C.useState(""),[E,A]=C.useState(""),[_,R]=C.useState(Object.keys(i)[0]||""),[H,O]=C.useState(!1),[W,ne]=C.useState([]),[V,U]=C.useState("Ground 1"),[D,$]=C.useState(!1),[M,P]=C.useState(!1),ae=C.useRef(null),Q=C.useMemo(()=>d.filter(ee=>!ee.isPaused).map(ee=>ee.fullName),[d]),Te=C.useMemo(()=>u.includes("CPT"),[u]),[Y,fe]=C.useState("CPT 1");C.useEffect(()=>{const ee=s.find(K=>K.code===u);ee&&x(ee.duration)},[u,s]),C.useEffect(()=>{const ee=K=>{ae.current&&!ae.current.contains(K.target)&&$(!1)};return document.addEventListener("mousedown",ee),()=>document.removeEventListener("mousedown",ee)},[]);const ge=()=>{if(!u||!E){alert("Please select an event and an instructor.");return}let ee="single",K=[];if(H?(ee="course",K=W):(W.length>1&&(ee="multiple"),K=W),K.length===0){alert("Please select at least one trainee or an entire course.");return}const ue=Te?`${Y}: ${y}`.trim():y;t({flightNumber:u,startTime:h,duration:v,location:ue,instructor:E,selectionType:ee,course:H?_:void 0,attendees:K,resourceId:Te?Y:V})},Ne=ee=>{ne(K=>K.includes(ee)?K.filter(ue=>ue!==ee):[...K,ee])},Oe=ee=>{const K=ee.target.checked;O(K),ne([]),K&&_&&P(!0)},se=C.useMemo(()=>{const ee=[];for(let K=0;K<24;K++)for(let ue=0;ue<60;ue+=5){const xe=K+ue/60,Le=`${String(K).padStart(2,"0")}:${String(ue).padStart(2,"0")}`;ee.push({label:Le,value:xe})}return ee},[]),F=C.useMemo(()=>Array.from({length:24},(ee,K)=>(K+1)*.25),[]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[60] flex items-center justify-center animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-xl border border-gray-700",onClick:ee=>ee.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center bg-gray-900/50",children:[e.jsx("h2",{className:"text-xl font-bold text-teal-400",children:"Add Ground Event"}),e.jsx("button",{onClick:n,className:"text-white hover:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ground-event",className:"block text-sm font-medium text-gray-400",children:"Event"}),e.jsx("select",{id:"ground-event",value:u,onChange:ee=>f(ee.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",children:s.map(ee=>e.jsxs("option",{value:ee.code,children:[ee.code," - ",ee.eventDescription]},ee.code))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ground-instructor",className:"block text-sm font-medium text-gray-400",children:"Instructor"}),e.jsxs("select",{id:"ground-instructor",value:E,onChange:ee=>A(ee.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select an instructor"}),l.map(ee=>e.jsx("option",{value:ee,children:ee},ee))]})]})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Attendees"}),e.jsxs("div",{className:"mt-2 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ground-course",className:"block text-sm font-medium text-gray-400",children:"Course"}),e.jsx("select",{id:"ground-course",value:_,onChange:ee=>R(ee.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",children:Object.keys(i).map(ee=>e.jsx("option",{value:ee,children:ee},ee))})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-6",children:[e.jsx("input",{type:"checkbox",id:"entire-course",checked:H,onChange:Oe,className:"h-5 w-5 bg-gray-700 rounded accent-sky-500"}),e.jsx("label",{htmlFor:"entire-course",className:"font-semibold text-sky-400",children:"Select Entire Course"})]})]}),!H&&e.jsxs("div",{className:"relative",ref:ae,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Trainees"}),e.jsx("button",{onClick:()=>$(!D),className:"mt-1 w-full text-left bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500",children:W.length>0?`${W.length} selected`:"Select trainees..."}),D&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-gray-600 rounded-md shadow-lg max-h-60 overflow-y-auto",children:e.jsx("ul",{className:"p-2 space-y-1",children:Q.map(ee=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center space-x-3 p-2 rounded hover:bg-gray-700",children:[e.jsx("input",{type:"checkbox",checked:W.includes(ee),onChange:()=>Ne(ee),className:"h-4 w-4 accent-sky-500 bg-gray-600"}),e.jsx("span",{className:"text-sm text-gray-300",children:ee})]})},ee))})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ground-start",className:"block text-sm font-medium text-gray-400",children:"Start Time"}),e.jsx("select",{id:"ground-start",value:h,onChange:ee=>m(parseFloat(ee.target.value)),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",children:se.map(ee=>e.jsx("option",{value:ee.value,children:ee.label},ee.value))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ground-duration",className:"block text-sm font-medium text-gray-400",children:"Duration (hrs)"}),e.jsx("select",{id:"ground-duration",value:v,onChange:ee=>x(parseFloat(ee.target.value)),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",children:F.map(ee=>e.jsx("option",{value:ee,children:ee.toFixed(2)},ee))})]})]}),Te?e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cpt-resource",className:"block text-sm font-medium text-gray-400",children:"CPT Resource"}),e.jsx("select",{id:"cpt-resource",value:Y,onChange:ee=>fe(ee.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",children:Array.from({length:4},(ee,K)=>`CPT ${K+1}`).map(ee=>e.jsx("option",{value:ee,children:ee},ee))})]}):e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ground-resource",className:"block text-sm font-medium text-gray-400",children:"Ground Resource"}),e.jsx("select",{id:"ground-resource",value:V,onChange:ee=>U(ee.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",children:Array.from({length:6},(ee,K)=>`Ground ${K+1}`).map(ee=>e.jsx("option",{value:ee,children:ee},ee))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ground-location",className:"block text-sm font-medium text-gray-400",children:Te?"Notes":"Location"}),e.jsx("input",{type:"text",id:"ground-location",value:y,onChange:ee=>T(ee.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",placeholder:Te?"Add any relevant notes...":"Enter a location..."})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:ge,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700",children:"Save Event"}),e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"})]})]})}),M&&e.jsx(Mw,{onClose:()=>{P(!1),O(!1)},onConfirm:ee=>{ne(ee),P(!1)},courseNumber:_,traineesInCourse:o[_]||[],traineeStatus:d.reduce((ee,K)=>ee.set(K.fullName,{isPaused:K.isPaused}),new Map)})]})},Pw=["YMES","YMEN","YMAY","YSCB","YLTV"],Rw="STWJquK4I2XUtqN-Vpw1eCIpOqmq0CHpd4LChbc17MY",Uw=1800*1e3,Fv=({onClose:n})=>{const[t,s]=C.useState(()=>{const V=localStorage.getItem("tafLocations");return V?JSON.parse(V):Pw}),[i,o]=C.useState(new Map),[l,d]=C.useState(!1),[u,f]=C.useState([]),[h,m]=C.useState(new Set),[v,x]=C.useState(new Date),y=V=>{const U=/(\b(?:INTER|TEMPO)\s+\d{4}\/\d{4})/g;return V.split(U).map(($,M)=>$.match(U)?e.jsx("span",{className:"text-red-400 font-bold",children:$},M):e.jsx("span",{children:$},M))},T=async V=>{var U,D;m($=>new Set($).add(V));try{const $=await fetch(`https://avwx.rest/api/taf/${V.toUpperCase()}?token=${Rw}`);if(!$.ok)throw new Error(`HTTP ${$.status}`);const M=await $.json(),P=(U=M.meta)==null?void 0:U.warning,ae=(D=M.meta)==null?void 0:D["cache-timestamp"],Q=!!P;o(Te=>{const Y=new Map(Te);return Y.set(V,{station:V.toUpperCase(),raw:M.raw||"No TAF available",time:new Date().toLocaleTimeString(),error:void 0,isCached:Q,cacheTimestamp:ae}),Y})}catch($){console.error(`Error fetching TAF for ${V}:`,$),o(M=>{const P=new Map(M);return P.set(V,{station:V.toUpperCase(),raw:"",time:new Date().toLocaleTimeString(),error:"Failed to fetch TAF"}),P})}finally{m($=>{const M=new Set($);return M.delete(V),M})}},E=()=>{x(new Date),t.forEach(V=>{V.trim()&&T(V.trim())})};C.useEffect(()=>{E();const V=setInterval(()=>{E()},Uw);return()=>clearInterval(V)},[t]);const A=()=>{const V=u.map(U=>U.trim().toUpperCase()).filter(U=>U.length>=4);s(V),localStorage.setItem("tafLocations",JSON.stringify(V)),d(!1),V.forEach(U=>{i.has(U)||T(U)})},_=()=>{f([...t]),d(!0)},R=()=>{d(!1)},H=(V,U)=>{const D=[...u];D[V]=U,f(D)},O=V=>{T(V)},W=()=>{E()},ne=V=>{const U=Math.floor((new Date().getTime()-V.getTime())/1e3);if(U<60)return"Just now";const D=Math.floor(U/60);return D<60?`${D}m ago`:`${Math.floor(D/60)}h ago`};return e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-sky-400",children:"TAF Weather"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:["Updated ",ne(v)]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:W,className:"p-2 text-gray-400 hover:text-sky-400 transition-colors",title:"Refresh all",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:_,className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded-md text-sm font-semibold transition-colors",children:"Edit"})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,className:"px-3 py-1 bg-sky-600 hover:bg-sky-700 text-white rounded-md text-sm font-semibold transition-colors",children:"Save"}),e.jsx("button",{onClick:R,className:"px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white rounded-md text-sm font-semibold transition-colors",children:"Cancel"})]})]})]}),l?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Enter ICAO codes (e.g., YMES, YMEN)"}),u.map((V,U)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-gray-400 text-sm w-8",children:[U+1,"."]}),e.jsx("input",{type:"text",value:V,onChange:D=>H(U,D.target.value),placeholder:"ICAO code",maxLength:4,className:"flex-1 bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 uppercase"})]},U))]}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:t.map(V=>{const U=i.get(V),D=h.has(V);return e.jsxs("div",{className:"bg-gray-700/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-sky-300",children:V.toUpperCase()}),U&&!U.error&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Retrieved at ",U.time]})]}),e.jsx("button",{onClick:()=>O(V),disabled:D,className:`p-1 rounded transition-colors ${D?"text-gray-500 cursor-not-allowed":"text-gray-400 hover:text-sky-400"}`,title:"Refresh this location",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-4 w-4 ${D?"animate-spin":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})})})]}),D&&!U&&e.jsx("div",{className:"text-gray-400 text-sm",children:"Loading..."}),U&&!U.error&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-900 rounded p-3 mt-2",children:e.jsx("pre",{className:"text-xs text-green-400 font-mono whitespace-pre-wrap break-words",children:y(U.raw)})}),U.isCached&&e.jsxs("div",{className:"mt-2 text-xs text-yellow-500/70 italic",children:["‚ö†Ô∏è Old cached data - provided for display purposes only",U.cacheTimestamp&&` (Cached: ${new Date(U.cacheTimestamp).toLocaleDateString()})`]})]})]},V)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Auto-refreshes every 30 minutes ‚Ä¢ Data from AVWX"})})]})},fy=n=>{const t=Math.floor(n),s=Math.round(n%1*60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`},hy=n=>{if(!n)return"-";try{const t=new Date(n+"T00:00:00Z");if(isNaN(t.getTime()))return"-";const s=String(t.getUTCDate()).padStart(2,"0"),i=t.toLocaleDateString("en-GB",{month:"short",timeZone:"UTC"}).toUpperCase(),o=String(t.getUTCFullYear()).slice(-2);return`${s}${i}${o}`}catch{return"-"}},Bw=({userName:n,userRank:t,events:s,onSelectEvent:i,onNavigate:o,onSelectMyProfile:l,onSelectMyCurrency:d,onSelectMySct:u,sctRequests:f,pt051Assessments:h,onSelectPt051:m})=>{const v=[...s].sort((E,A)=>E.startTime-A.startTime),x=f.filter(E=>E.name===n.split(" ").reverse().join(", ")),y=Ua.useMemo(()=>{const E=`${n.split(" ").reverse().join(", ")}`;return Array.from(h.values()).filter(A=>!A.isCompleted&&A.instructorName===E).sort((A,_)=>new Date(A.date).getTime()-new Date(_.date).getTime())},[h,n]),T=({event:E})=>{var A;return e.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${E.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:E.flightNumber}),e.jsx("p",{className:"text-sm text-gray-400",children:E.flightType==="Solo"?`Solo: ${E.pilot}`:`w/ ${(A=E.student)==null?void 0:A.split(" ")[0]}`})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"font-mono text-gray-300",children:[fy(E.startTime)," - ",fy(E.startTime+E.duration)]}),e.jsx("button",{onClick:()=>i(E),className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Details"})]})]})};return e.jsxs("div",{className:"flex flex-col bg-gray-900 overflow-y-auto p-6 space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"My Dashboard"}),e.jsxs("p",{className:"text-lg text-gray-400",children:["Welcome, ",t," ",n]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-sky-400 mb-4",children:"My Hub"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:l,className:"w-full text-left px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-md text-white font-semibold transition-colors",children:"My Profile"}),e.jsx("button",{onClick:d,className:"w-full text-left px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-md text-white font-semibold transition-colors",children:"My Currency"}),e.jsx("button",{onClick:u,className:"w-full text-left px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded-md text-white font-semibold transition-colors",children:"My SCT"})]})]}),e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700",children:e.jsx(Fv,{})}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-sky-400 mb-4",children:"My Active SCT Requests"}),x.length>0?e.jsx("ul",{className:"space-y-2",children:x.map(E=>e.jsxs("li",{className:"p-2 bg-gray-700/50 rounded-md text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"font-semibold text-white",children:E.event}),E.dateRequested&&e.jsx("p",{className:"text-xs text-gray-500",children:hy(E.dateRequested)})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Expires: ",E.currentExpiry]})]},E.id))}):e.jsx("p",{className:"text-gray-500 text-center italic py-4",children:"No active SCT requests."})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-amber-400 mb-4",children:"Reports to be completed"}),y.length>0?e.jsx("ul",{className:"space-y-2",children:y.map(E=>e.jsx("li",{className:"p-3 bg-gray-700/50 rounded-md hover:bg-gray-700 transition-colors",children:e.jsx("button",{onClick:()=>m(E),className:"w-full text-left",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:E.flightNumber}),e.jsx("p",{className:"text-sm text-gray-400",children:E.trainedFullName})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-300 font-mono",children:hy(E.date)}),e.jsx("span",{className:"inline-block mt-1 px-2 py-1 text-xs font-semibold rounded-full bg-amber-500/20 text-amber-300",children:"Pending"})]})]})})},E.id))}):e.jsx("p",{className:"text-gray-500 text-center italic py-4",children:"No pending reports."})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-sky-400 mb-4",children:"Today's Schedule"}),v.length>0?e.jsx("ul",{className:"space-y-3",children:v.map(E=>e.jsx(T,{event:E},E.id))}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No events scheduled for today."})]})]})},em=n=>{if(!n)return"";const[t,s,i]=n.split("-").map(Number),o=new Date(Date.UTC(t,s-1,i)),l=String(o.getUTCDate()).padStart(2,"0"),d=o.toLocaleString("en-GB",{month:"short",timeZone:"UTC"}),u=String(o.getUTCFullYear()).slice(-2);return`${l}${d}${u}`},my=n=>n?n.replace(":",""):"",tm=({name:n,rank:t,period:s,status:i})=>{const o=C.useMemo(()=>{if(i)return i;if(!s)return"N/A";const{startDate:l,endDate:d,allDay:u,startTime:f,endTime:h}=s,m=em(l);if(u){const v=new Date(`${d}T00:00:00Z`);v.setUTCDate(v.getUTCDate()-1);const x=v.toISOString().split("T")[0],y=em(x);return l===x?`${m} All Day`:`${m} to ${y}`}else{const v=em(d),x=my(f),y=my(h);return l===d?`${x} ${m} - ${y}`:`${x} ${m} to ${y} ${v}`}},[s,i]);return e.jsxs("li",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded-md text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-mono text-gray-500 w-12 text-right",children:t}),e.jsx("span",{className:"font-semibold text-white",children:n.split(" ‚Äì ")[0]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`font-medium ${i?"text-amber-300":"text-gray-300"}`,children:i?"":s==null?void 0:s.reason}),e.jsx("span",{className:`font-mono ml-3 ${i?"text-amber-300":"text-gray-300"}`,children:o})]})]})},Ow=({instructorsData:n,traineesData:t,date:s,title:i})=>{const o=C.useMemo(()=>{if(!s)return console.error("‚ùå UnavailabilitiesWindow: date is undefined"),"Invalid Date";const[f,h,m]=s.split("-").map(Number);return new Date(Date.UTC(f,h-1,m)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[s]),{staffUnavailabilities:l,traineeUnavailabilities:d,pausedTrainees:u}=C.useMemo(()=>{const f=[];n.forEach(v=>{(v.unavailability||[]).forEach(x=>{(x.allDay?s>=x.startDate&&s<x.endDate:s>=x.startDate&&s<=x.endDate)&&f.push({name:v.name,rank:v.rank,period:x})})});const h=[],m=[];return t.forEach(v=>{v.isPaused?m.push({name:v.name,rank:v.rank}):(v.unavailability||[]).forEach(x=>{(x.allDay?s>=x.startDate&&s<x.endDate:s>=x.startDate&&s<=x.endDate)&&h.push({name:v.fullName,rank:v.rank,period:x})})}),{staffUnavailabilities:f.sort((v,x)=>v.name.localeCompare(x.name)),traineeUnavailabilities:h.sort((v,x)=>v.name.localeCompare(x.name)),pausedTrainees:m.sort((v,x)=>v.name.localeCompare(x.name))}},[n,t,s]);return e.jsxs("div",{className:"flex flex-col bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit flex-1 min-w-[350px] max-w-md",children:[e.jsx("h2",{className:"p-4 text-lg font-semibold text-gray-200 border-b border-gray-700 text-center",children:i||`Unavailabilities for ${o}`}),e.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto max-h-[calc(100vh-20rem)]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sky-400 mb-2",children:"Staff"}),l.length>0?e.jsx("ul",{className:"space-y-2",children:l.map(f=>e.jsx(tm,{...f},`${f.name}-${f.period.id}`))}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No staff unavailable."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sky-400 mb-2",children:"Trainees"}),d.length>0||u.length>0?e.jsxs("ul",{className:"space-y-2",children:[u.map(f=>e.jsx(tm,{name:f.name,rank:f.rank,status:"Paused/NTSC"},f.name)),d.map(f=>e.jsx(tm,{...f},`${f.name}-${f.period.id}`))]}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No trainees unavailable."})]})]})]})},$w=n=>{const t=Math.floor(n),s=Math.round(n%1*60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`},Hw=({instructorsData:n,traineesData:t,date:s,events:i,onNavigate:o,onOpenAuth:l})=>{const d=C.useMemo(()=>{const _=new Date().getHours()+new Date().getMinutes()/60;return i.filter(R=>R.type==="flight"&&!(R.authoSignedBy&&R.captainSignedBy)&&R.startTime+R.duration>_).sort((R,H)=>R.startTime-H.startTime).slice(0,5)},[i]),u=n.filter(_=>!_.isPaused).length,f=n.filter(_=>_.isPaused).length,h=n.filter(_=>{var R;return(R=_.unavailability)==null?void 0:R.some(H=>{var O,W;return((O=H.reason)==null?void 0:O.includes("TMUF"))||((W=H.reason)==null?void 0:W.includes("Medical"))})}).length,m=n.filter(_=>{var R;return(R=_.unavailability)==null?void 0:R.some(H=>H.reason&&!H.reason.includes("TMUF")&&!H.reason.includes("Medical")&&H.reason!=="Leave")}).length,v=n.length,x=t.filter(_=>!_.isPaused).length,y=t.filter(_=>_.isPaused).length,T=t.filter(_=>{var R;return(R=_.unavailability)==null?void 0:R.some(H=>{var O,W;return((O=H.reason)==null?void 0:O.includes("TMUF"))||((W=H.reason)==null?void 0:W.includes("Medical"))})}).length,E=t.filter(_=>{var R;return(R=_.unavailability)==null?void 0:R.some(H=>H.reason&&!H.reason.includes("TMUF")&&!H.reason.includes("Medical")&&H.reason!=="Leave")}).length,A=t.length;return e.jsx("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-6 max-w-7xl mx-auto w-full",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Supervisor Dashboard"}),e.jsx("p",{className:"text-lg text-gray-400",children:"Overview of personnel and program status for today."})]}),e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsxs("div",{className:"flex flex-col bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit flex-1 min-w-[350px] max-w-md",children:[e.jsx("h2",{className:"p-4 text-lg font-semibold text-gray-200 border-b border-gray-700 text-center",children:"AUTH"}),e.jsx("div",{className:"p-4 space-y-3",children:d.length>0?e.jsx("ul",{className:"space-y-3",children:d.map(_=>{var R,H,O;return e.jsxs("li",{className:"flex items-center justify-between p-3 bg-gray-700/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"font-mono text-gray-300 text-sm",children:$w(_.startTime)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white text-sm",children:_.flightNumber}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(R=_.instructor)==null?void 0:R.split(",")[0]," / ",((H=_.student)==null?void 0:H.split(",")[0])||((O=_.pilot)==null?void 0:O.split(",")[0])]})]})]}),e.jsx("button",{onClick:()=>l(_),className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Auth"})]},_.id)})}):e.jsx("p",{className:"text-gray-500 text-center italic py-8",children:"No flights require authorisation."})}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx("button",{onClick:()=>o("AUTH"),className:"w-full text-center px-4 py-2 rounded-md transition-colors font-semibold btn-green-brushed",children:"Go to Flight Authorisation"})})]}),e.jsxs("div",{className:"flex flex-col bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit flex-1 min-w-[350px] max-w-md",children:[e.jsx("h2",{className:"p-4 text-lg font-semibold text-gray-200 border-b border-gray-700 text-center",children:"Weather (TAF)"}),e.jsx("div",{className:"p-0",children:e.jsx(Fv,{})})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-6",children:[e.jsxs("div",{className:"flex flex-col bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit flex-1 min-w-[350px] max-w-md",children:[e.jsx("h2",{className:"p-4 text-lg font-semibold text-gray-200 border-b border-gray-700 text-center",children:"Personnel Management"}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-sky-400 mb-3",children:"Staff"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"Active"}),e.jsx("span",{className:"text-green-400 font-semibold",children:u})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"On Leave"}),e.jsx("span",{className:"text-yellow-400 font-semibold",children:f})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"TMUF"}),e.jsx("span",{className:"text-orange-400 font-semibold",children:h})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"Other Unavailability"}),e.jsx("span",{className:"text-red-400 font-semibold",children:m})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-600/50 rounded border-t border-gray-600",children:[e.jsx("span",{className:"text-white text-sm font-medium",children:"Total"}),e.jsx("span",{className:"text-gray-300 font-bold",children:v})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-sky-400 mb-3",children:"Trainees"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"Active"}),e.jsx("span",{className:"text-green-400 font-semibold",children:x})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"On Leave"}),e.jsx("span",{className:"text-yellow-400 font-semibold",children:y})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"TMUF"}),e.jsx("span",{className:"text-orange-400 font-semibold",children:T})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white text-sm",children:"Other Unavailability"}),e.jsx("span",{className:"text-red-400 font-semibold",children:E})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-600/50 rounded border-t border-gray-600",children:[e.jsx("span",{className:"text-white text-sm font-medium",children:"Total"}),e.jsx("span",{className:"text-gray-300 font-bold",children:A})]})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 space-y-2",children:[e.jsx("button",{onClick:()=>o&&o("Instructors"),className:"w-full px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-md text-sm font-semibold transition-colors",children:"Manage Staff"}),e.jsx("button",{onClick:()=>o&&o("CourseRoster"),className:"w-full px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white rounded-md text-sm font-semibold transition-colors",children:"Manage Trainees"})]})]}),e.jsxs("div",{className:"flex flex-col bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit flex-1 min-w-[350px] max-w-md",children:[e.jsx("h2",{className:"p-4 text-lg font-semibold text-gray-200 border-b border-gray-700 text-center",children:"Unavailability Management"}),e.jsx(Ow,{instructorsData:n,traineesData:t,date:s,title:"Today's Unavailabilities"})]})]})]})})},Mr=200,ya=32,zr=0,lc=24,qw=lc-zr,gy=144,py=40,Gw=(n,t)=>{if(!n||!t||n.duration<=0||t.duration<=0)return!1;const s=n.startTime+n.duration,i=t.startTime+t.duration;return n.startTime<i&&s>t.startTime},nm=n=>{const t=[];return n.flightType==="Solo"?n.pilot&&t.push(n.pilot):(n.instructor&&t.push(n.instructor),n.student&&t.push(n.student)),n.attendees&&t.push(...n.attendees),t},xy=n=>n.startsWith("PC-21")?"PC-21":n.startsWith("STBY")?"STBY":n==="Duty Sup"?"Duty Sup":n.startsWith("FTD")?"FTD":n.startsWith("CPT")?"CPT":n.startsWith("Ground")?"Ground":"Other",zw=({date:n,onDateChange:t,events:s,resources:i,instructors:o,airframeCount:l,standbyCount:d,ftdCount:u,cptCount:f,onUpdateEvent:h,onSelectEvent:m,onReorderResources:v,zoomLevel:x,showValidation:y,showPrePost:T,syllabusDetails:E,personnelData:A,seatConfigs:_,daylightTimes:R,personnelConflicts:H,personnelConflictIds:O,onCptConflict:W,isMultiSelectMode:ne,selectedEventIds:V,setSelectedEventIds:U,traineesData:D,isOracleMode:$,oraclePreviewEvent:M,onOracleMouseDown:P,onOracleMouseMove:ae,onOracleMouseUp:Q,isVisualAdjustMode:Te=!1,visualAdjustEvent:Y=null,onVisualAdjustTimeChange:fe})=>{const ge=C.useRef(null),Ne=C.useRef(null),[Oe,se]=C.useState(new Date),F=C.useRef(!0),X=C.useRef(x),[J,ee]=C.useState(null),[K,ue]=C.useState(null),[xe,Le]=C.useState(null),[ye,pe]=C.useState(null),ce=C.useRef(!1),He=C.useRef(null),[_e,Z]=C.useState(null);C.useEffect(()=>{const Ge=setInterval(()=>se(new Date),1e3);return()=>clearInterval(Ge)},[]),C.useMemo(()=>{const[Ge,ht,vt]=n.split("-").map(Number);return new Date(Date.UTC(Ge,ht-1,vt)).toLocaleDateString("en-GB",{day:"2-digit",month:"short",timeZone:"UTC"})},[n]),C.useEffect(()=>{const Ge=ge.current;if(Ge){if(F.current){const vt=(8-zr)*Mr*x;Ge.scrollLeft=vt,F.current=!1}else{const ht=X.current;if(ht===x)return;const{scrollLeft:vt,clientWidth:Ht}=Ge,we=(vt+Ht/2)/(Mr*ht)*Mr*x-Ht/2;Ge.scrollLeft=we}X.current=x}},[x]);const Fe=C.useCallback((Ge,ht)=>{for(const vt of Ge){const Ht=E.find(Re=>Re.id===vt.flightNumber);if(!Ht)continue;const ze=vt.startTime-(Ht.preFlightTime||0),we=vt.startTime+vt.duration+(Ht.postFlightTime||0);for(const Re of ht){const be=E.find(Vt=>Vt.id===Re.flightNumber);if(!be)continue;const Ze=Re.startTime-(be.preFlightTime||0),ot=Re.startTime+Re.duration+(be.postFlightTime||0);if(ze<ot&&we>Ze){const Vt=nm(vt),Pt=nm(Re),yn=Vt.find(Tt=>Pt.includes(Tt));if(yn)return{conflictingEvent:Re,personName:yn}}}}return null},[E]),Xe=(Ge,ht)=>{if(Ge.button===0){if(ce.current=!1,document.body.classList.add("no-select"),$&&!ht){if(!Ne.current)return;const vt=Ne.current.getBoundingClientRect(),ze=(Ge.clientX-vt.left)/(Mr*x)+zr,we=Ge.clientY-vt.top,Re=Math.floor(we/ya),be=i[Re]||i[0];P(ze,be);return}if(ht){const Ht=Ge.currentTarget.getBoundingClientRect(),ze=new Map,we=new Map,Re=be=>{const Ze=i.indexOf(be.resourceId);Ze!==-1&&(ze.set(be.id,{startTime:be.startTime,rowIndex:Ze}),we.set(be.id,be.resourceId))};ne&&V.has(ht.id)?V.forEach(be=>{const Ze=s.find(ot=>ot.id===be);Ze&&Re(Ze)}):Re(ht),ze.size>0&&ee({mainEventId:ht.id,xOffset:(Ge.clientX-Ht.left)/x,yOffset:Ge.clientY-Ht.top,initialPositions:ze,originalResourceIds:we})}else{if(!ne||!Ne.current)return;const vt=Ne.current.getBoundingClientRect(),Ht=Ge.clientX-vt.left,ze=Ge.clientY-vt.top;He.current={x:Ht,y:ze},Z({x:Ht,y:ze,width:0,height:0})}}},ft=Ge=>{if(!Ne.current)return;ce.current=!0;const ht=Ne.current.getBoundingClientRect(),vt=Ge.clientX-ht.left,Ht=Ge.clientY-ht.top;if($&&M){const yn=vt/(Mr*x)+zr,Tt=Math.floor(Ht/ya),lt=i[Tt]||i[0];ae(yn,lt);return}if(He.current){const yn=Ge.clientX-ht.left,Tt=Ge.clientY-ht.top,lt=Math.min(He.current.x,yn),Et=Math.min(He.current.y,Tt),Bt=Math.abs(yn-He.current.x),Kt=Math.abs(Tt-He.current.y);Z({x:lt,y:Et,width:Bt,height:Kt});const Mt=lt,Ve=lt+Bt,qt=Et,Mn=Et+Kt,jn=new Set;s.forEach(je=>{const $e=i.indexOf(je.resourceId);if($e===-1)return;const Ye=$e*ya,Dt=Ye+ya,St=(je.startTime-zr)*Mr*x,hn=St+je.duration*Mr*x;Mt<hn&&Ve>St&&qt<Dt&&Mn>Ye&&jn.add(je.id)}),U(jn);return}if(!J)return;const ze=J.initialPositions.get(J.mainEventId);if(!ze)return;const we=(vt/x-J.xOffset)/Mr-ze.startTime,Re=Math.floor((Ht-J.yOffset+ya/2)/ya)-ze.rowIndex,be=[],Ze=[...s];let ot=null,Vt=null;for(const[yn,Tt]of J.initialPositions.entries()){const lt=s.find(qt=>qt.id===yn);if(!lt)continue;let Et=Tt.startTime+we,Bt=Tt.rowIndex+Re;Bt<0&&(Bt=0),Bt>=i.length&&(Bt=i.length-1),Et<zr&&(Et=zr),Et+lt.duration>lc&&(Et=lc-lt.duration);const Kt=Math.round(Et*12)/12,Mt=i[Bt];be.push({eventId:yn,newStartTime:Kt,newResourceId:Mt});const Ve=s.find(qt=>qt.id!==yn&&!J.initialPositions.has(qt.id)&&qt.resourceId===Mt&&Gw({...lt,startTime:Kt},qt));Ve&&(ot=Ve.id)}if(be.forEach(yn=>{const Tt=Ze.findIndex(lt=>lt.id===yn.eventId);Tt!==-1&&(Ze[Tt]={...Ze[Tt],startTime:yn.newStartTime,resourceId:yn.newResourceId})}),be.find(yn=>yn.eventId===J.mainEventId)){const yn=Ze.find(Et=>Et.id===J.mainEventId),Tt=Ze.filter(Et=>Et.id!==yn.id),lt=Fe([yn],Tt);lt?(ue({conflictingEventId:lt.conflictingEvent.id,conflictedPersonName:lt.personName}),yn.flightNumber.includes("CPT")&&(Vt={conflictingEvent:lt.conflictingEvent,newEvent:yn,conflictedPerson:"trainee",personName:lt.personName})):ue(null)}Le(ot),pe(Vt),h(be)},tt=Ge=>{document.body.classList.remove("no-select"),$&&Q(),ye&&W(ye),ee(null),ue(null),Le(null),pe(null),He.current&&ne&&(He.current=null,Z(null),!ce.current&&!Ge.shiftKey&&(Ge.target.closest('[data-is-flight-tile="true"]')||U(new Set))),setTimeout(()=>{ce.current=!1},0)},We=C.useCallback(Ge=>{if(!Ge||!/^\d{2}:\d{2}$/.test(Ge))return null;const[ht,vt]=Ge.split(":").map(Number);return ht+vt/60},[]),Ke=()=>{const Ge=[];for(let Ht=zr;Ht<=lc;Ht++)Ge.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-gray-500 flex items-center",style:{left:(Ht-zr)*Mr*x},children:e.jsx("span",{className:"-translate-x-1/2",children:`${String(Ht).padStart(2,"0")}:00`})},Ht));const ht=We(R.firstLight),vt=We(R.lastLight);if(ht!==null){const Ht=(ht-zr)*Mr*x;Ge.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:Ht},children:e.jsx("span",{className:"-translate-x-1/2",children:`FL ${R.firstLight}`})},"fl-label"))}if(vt!==null){const Ht=(vt-zr)*Mr*x;Ge.push(e.jsx("div",{className:"absolute h-full top-0 text-xs text-white font-bold flex items-center",style:{left:Ht},children:e.jsx("span",{className:"-translate-x-1/2",children:`LL ${R.lastLight}`})},"ll-label"))}return Ge},nt=()=>{const Ge=[];for(let ht=zr;ht<=lc;ht++)Ge.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ht-zr)*Mr*x},children:e.jsx("div",{className:"w-px h-full bg-gray-700/50"})},`v-${ht}`)),ht<lc&&Ge.push(e.jsx("div",{className:"absolute h-full top-0",style:{left:(ht-zr+.5)*Mr*x},children:e.jsx("div",{className:"w-px h-full bg-gray-700/25"})},`v-${ht}-30`));for(let ht=1;ht<=i.length;ht++)Ge.push(e.jsx("div",{className:"absolute left-0 w-full bg-gray-700/25",style:{top:ht*ya,height:"1px"}},`h-${ht}`));return Ge},Ct=()=>{const Ge=[];let ht=xy(i[0]);for(let vt=1;vt<i.length;vt++){const Ht=xy(i[vt]);Ht!==ht&&(Ge.push(e.jsx("div",{className:"absolute left-0 w-full border-t-2 border-gray-500 z-10",style:{top:vt*ya}},`sep-${vt}`)),ht=Ht)}return Ge},xt=()=>{const Ge=We(R.firstLight),ht=We(R.lastLight);return e.jsxs(e.Fragment,{children:[Ge!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(Ge-zr)*Mr*x}px`}}),ht!==null&&e.jsx("div",{className:"absolute top-0 h-full z-[5] pointer-events-none border-l border-dashed border-white/30",style:{left:`${(ht-zr)*Mr*x}px`}})]})},dn=()=>{const Ge=We(R.firstLight),ht=We(R.lastLight),vt=[];if(Ge!==null&&Ge>zr){const Ht=(Ge-zr)*Mr*x;vt.push(e.jsx("div",{className:"absolute top-0 left-0 h-full bg-white/5 pointer-events-none z-[1]",style:{width:`${Ht}px`}},"night-shade-morning"))}if(ht!==null&&ht<lc){const Ht=(ht-zr)*Mr*x,ze=(lc-ht)*Mr*x;vt.push(e.jsx("div",{className:"absolute top-0 h-full bg-white/5 pointer-events-none z-[1]",style:{left:`${Ht}px`,width:`${ze}px`}},"night-shade-evening"))}return e.jsx(e.Fragment,{children:vt})},on=()=>i.flatMap((Ge,ht)=>s.filter(Ht=>Ht.resourceId===Ge).map(Ht=>{const ze=!!(J&&J.initialPositions.has(Ht.id)),we=Ht.id===(K==null?void 0:K.conflictingEventId)||Ht.id===xe,Re=y&&O.has(Ht.id)||we||ze&&!!(K||xe);let be=null;if(K){const Vt=nm(Ht);(ze||we)&&Vt.includes(K.conflictedPersonName)&&(be=K.conflictedPersonName)}const Ze=V.has(Ht.id);return e.jsx(Gc,{event:Ht,traineesData:D,onSelectEvent:()=>{if(!ce.current)if(ne){const Vt=new Set(V);Vt.has(Ht.id)?Vt.delete(Ht.id):Vt.add(Ht.id),U(Vt)}else m(Ht)},onMouseDown:Vt=>Xe(Vt,Ht),onMouseEnter:()=>{},onMouseLeave:()=>{},pixelsPerHour:Mr*x,rowHeight:ya,startHour:zr,row:ht,isDragging:ze,isConflicting:Re,isUnavailabilityConflict:Ht.isUnavailabilityConflict,conflictedPersonnelName:be,personnelData:A,seatConfigs:_,isDraggable:!0,currentTime:Oe,isSelected:Ze,isChanged:!1},Ht.id)})),st=Ge=>{const ht=new Date(n+"T00:00:00Z");Ge==="prev"?ht.setUTCDate(ht.getUTCDate()-1):ht.setUTCDate(ht.getUTCDate()+1);const vt=ht.getUTCFullYear(),Ht=String(ht.getUTCMonth()+1).padStart(2,"0"),ze=String(ht.getUTCDate()).padStart(2,"0");t(`${vt}-${Ht}-${ze}`)},kt=Ge=>{try{const ht=new Date(Ge+"T00:00:00Z");if(isNaN(ht.getTime()))return"-";const vt=String(ht.getUTCDate()).padStart(2,"0"),Ht=ht.toLocaleString("en-GB",{month:"short",timeZone:"UTC"});return`${vt} ${Ht}`}catch{return"-"}};return e.jsx("div",{ref:ge,className:"flex-1 overflow-auto relative bg-gray-900 select-none",children:e.jsxs("div",{style:{width:`${gy+qw*Mr*x}px`,height:`${py+i.length*ya}px`,display:"grid",gridTemplateColumns:`${gy}px 1fr`,gridTemplateRows:`${py}px 1fr`},children:[e.jsx("div",{className:"sticky top-0 left-0 z-40 bg-gray-800 border-r border-b border-gray-700 p-1",children:e.jsxs("div",{className:"bg-gray-700 rounded-md w-full h-full flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>st("prev"),className:"text-gray-400 hover:text-white transition-colors p-1",title:"Previous day",children:"‚Üê"}),e.jsx("span",{className:"text-xs text-gray-300 font-bold tracking-wider",children:kt(n)}),e.jsx("button",{onClick:()=>st("next"),className:"text-gray-400 hover:text-white transition-colors p-1",title:"Next day",children:"‚Üí"})]})}),e.jsx("div",{className:"sticky top-0 z-20 bg-gray-800 border-b border-gray-700 relative",children:Ke()}),e.jsx("div",{className:"sticky left-0 z-30 bg-gray-800 border-r border-gray-700",children:e.jsx(Dv,{resources:i,onReorder:v,rowHeight:ya,airframeCount:l,standbyCount:d,ftdCount:u,cptCount:f,events:s})}),e.jsxs("div",{ref:Ne,className:"relative bg-gray-900",onMouseDown:Ge=>Xe(Ge),onMouseMove:ft,onMouseUp:tt,onMouseLeave:tt,children:[nt(),dn(),xt(),Ct(),on(),Te&&Y&&fe&&e.jsx(_v,{event:Y,onTimeChange:fe,scheduleStartHour:zr,scheduleEndHour:lc,pixelsPerHour:Mr*x}),$&&M&&e.jsxs(e.Fragment,{children:[e.jsx(Gc,{isPreview:!0,event:M,onSelectEvent:()=>{},onMouseDown:()=>{},onMouseEnter:()=>{},onMouseLeave:()=>{},pixelsPerHour:Mr*x,rowHeight:ya,startHour:zr,row:i.indexOf(M.resourceId),isDragging:!1,traineesData:D,personnelData:A,seatConfigs:new Map,currentTime:new Date}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1 bg-sky-300/40 pointer-events-none z-50",style:{left:`${(M.startTime-(M.preStart||1)-zr)*Mr*x}px`,width:`${(M.preStart||1)*Mr*x}px`,top:`${i.indexOf(M.resourceId)*ya+ya/2}px`}}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 h-1 bg-sky-300/40 pointer-events-none z-50",style:{left:`${(M.startTime+M.duration-zr)*Mr*x}px`,width:`${(M.postEnd||.5)*Mr*x}px`,top:`${i.indexOf(M.resourceId)*ya+ya/2}px`}})]}),_e&&e.jsx("div",{className:"absolute bg-sky-500/20 border border-sky-400 z-50 pointer-events-none",style:{left:_e.x,top:_e.y,width:_e.width,height:_e.height}})]})]})})},Vw=({coursePriorities:n,onUpdatePriorities:t,coursePercentages:s,onUpdatePercentages:i,availableAircraftCount:o,onUpdateAircraftCount:l,availableFtdCount:d,onUpdateFtdCount:u,availableCptCount:f,onUpdateCptCount:h,flyingStartTime:m,onUpdateFlyingStartTime:v,flyingEndTime:x,onUpdateFlyingEndTime:y,ftdStartTime:T,onUpdateFtdStartTime:E,ftdEndTime:A,onUpdateFtdEndTime:_,allowNightFlying:R,onUpdateAllowNightFlying:H,commenceNightFlying:O,onUpdateCommenceNightFlying:W,ceaseNightFlying:ne,onUpdateCeaseNightFlying:V,instructorsData:U,traineesData:D,buildDfpDate:$,highestPriorityEvents:M,onSelectEvent:P,onUpdatePriorityEvent:ae,programWithPrimaries:Q,onUpdateProgramWithPrimaries:Te,sctFlights:Y,sctFtds:fe,onAddSctRequest:ge,onRemoveSctRequest:Ne,onUpdateSctRequest:Oe,syllabusDetails:se,scores:F=new Map,traineeLMPs:X=new Map,remedialRequests:J=[],onToggleRemedialRequest:ee=(xe,Le)=>{},currencyNames:K,activeSection:ue="course-priority"})=>{const xe=C.useRef(null),Le=C.useRef(null),[ye,pe]=C.useState(new Date().toLocaleString()),ce=["SCT GF","SCT IF","SCT NAV","SCT FORM"],He=C.useMemo(()=>U.map(ze=>ze.name).sort(),[U]),[_e,Z]=C.useState(new Date().toLocaleString()),[Fe,Xe]=C.useState(new Date().toLocaleString()),[ft,tt]=C.useState(new Date().toLocaleString()),[We,Ke]=C.useState(new Date().toLocaleString());C.useEffect(()=>{pe(new Date().toLocaleString())},[n,s]),C.useEffect(()=>{Z(new Date().toLocaleString())},[o]),C.useEffect(()=>{Xe(new Date().toLocaleString())},[m,x,O,ne,R]);const nt=C.useMemo(()=>Array.from(s.values()).reduce((ze,we)=>ze+we,0),[s]),Ct=C.useMemo(()=>{const ze=[];for(let we=0;we<24;we++)for(let Re=0;Re<60;Re+=15){const be=we+Re/60,Ze=`${String(we).padStart(2,"0")}:${String(Re).padStart(2,"0")}`;ze.push({label:Ze,value:be})}return ze},[]),xt=ze=>{xe.current=ze},dn=ze=>{Le.current=ze},on=()=>{if(xe.current!==null&&Le.current!==null){const ze=[...n],we=ze.splice(xe.current,1)[0];ze.splice(Le.current,0,we),t(ze),Pn("Priorities","Edit","Updated course priority order",`Moved ${we} from position ${xe.current+1} to position ${Le.current+1}`)}xe.current=null,Le.current=null},st=(ze,we)=>{const Re=new Map(s),be=Re.get(ze)??0,Ze=5;let ot=we==="increase"?Math.min(100,be+Ze):Math.max(5,be-Ze);Re.set(ze,ot),Pn("Priorities","Edit",`Updated course percentage for ${ze}`,`${be}% ‚Üí ${ot}%`),i(Re)},kt=({direction:ze,onClick:we,disabled:Re})=>e.jsx("button",{onClick:we,disabled:Re,className:"p-0.5 text-gray-400 rounded-sm hover:bg-gray-600 disabled:opacity-30 disabled:cursor-not-allowed","aria-label":ze==="up"?"Increase percentage":"Decrease percentage",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:ze==="up"?e.jsx("path",{fillRule:"evenodd",d:"M10 5l-5.5 5.5h11L10 5z",clipRule:"evenodd"}):e.jsx("path",{fillRule:"evenodd",d:"M10 15l5.5-5.5h-11L10 15z",clipRule:"evenodd"})})}),Ge=({type:ze,requests:we})=>{const Re=ot=>{if(!ot)return null;try{const Vt=new Date(ot+"T00:00:00Z"),Pt=new Date($+"T00:00:00Z");if(isNaN(Vt.getTime())||isNaN(Pt.getTime()))return null;const yn=Vt.getTime()-Pt.getTime(),Tt=Math.ceil(yn/(1e3*60*60*24));let lt="text-green-400";return Tt<=30?lt="text-red-400":Tt<=60&&(lt="text-amber-400"),{days:Tt,color:lt}}catch{return null}},be=ot=>{if(!ot)return"-";try{const Vt=new Date(ot+"T00:00:00Z");if(isNaN(Vt.getTime()))return"-";const Pt=String(Vt.getUTCDate()).padStart(2,"0"),yn=Vt.toLocaleString("en-GB",{month:"short",timeZone:"UTC"}),Tt=String(Vt.getUTCFullYear()).slice(-2);return`${Pt}${yn}${Tt}`}catch{return"-"}},Ze=Ua.useMemo(()=>{const ot=[];for(let Vt=6;Vt<24;Vt++)for(let Pt=0;Pt<60;Pt+=5){const yn=String(Vt).padStart(2,"0"),Tt=String(Pt).padStart(2,"0");ot.push(`${yn}:${Tt}`)}return ot},[]);return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-sky-400 mb-2",children:ze==="flight"?"Flights":"FTD"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-xs text-gray-400 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-2 text-left",children:"Name"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Event"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Solo/Dual"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Currency"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Currency Expire"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Date Req."}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Days to Expire"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Requested Time"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Priority"}),e.jsx("th",{className:"py-2 px-1 text-right"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700/50",children:we.map(ot=>{const Vt=Re(ot.currencyExpire);return e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2 w-48",children:e.jsxs("select",{value:ot.name,onChange:Pt=>Oe(ot.id,"name",Pt.target.value,ze),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-white focus:ring-sky-500 text-xs",children:[e.jsx("option",{value:"",children:"Select Instructor"}),He.map(Pt=>e.jsx("option",{value:Pt,children:Pt},Pt))]})}),e.jsx("td",{className:"py-1 px-2 w-40",children:e.jsx("select",{value:ot.event,onChange:Pt=>Oe(ot.id,"event",Pt.target.value,ze),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-white focus:ring-sky-500 text-xs",children:ce.map(Pt=>e.jsx("option",{value:Pt,children:Pt},Pt))})}),e.jsx("td",{className:"py-1 px-2 w-32",children:e.jsxs("select",{value:ot.flightType,onChange:Pt=>Oe(ot.id,"flightType",Pt.target.value,ze),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-white focus:ring-sky-500 text-xs",children:[e.jsx("option",{value:"Solo",children:"Solo"}),e.jsx("option",{value:"Dual",children:"Dual"})]})}),e.jsx("td",{className:"py-1 px-2 w-48",children:e.jsxs("select",{value:ot.currency,onChange:Pt=>Oe(ot.id,"currency",Pt.target.value,ze),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-white focus:ring-sky-500 text-xs",children:[e.jsx("option",{value:"",children:"Select Currency"}),K.map(Pt=>e.jsx("option",{value:Pt,children:Pt},Pt))]})}),e.jsx("td",{className:"py-1 px-2 w-40",children:e.jsx("input",{type:"date",value:ot.currencyExpire,onChange:Pt=>Oe(ot.id,"currencyExpire",Pt.target.value,ze),style:{colorScheme:"dark"},className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-white focus:ring-sky-500 text-xs"})}),e.jsx("td",{className:"py-1 px-2 w-24 text-gray-300 font-mono",children:be(ot.dateRequested)}),e.jsx("td",{className:"py-1 px-2 w-32 text-center",children:Vt?e.jsx("span",{className:`font-bold ${Vt.color}`,children:Vt.days}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsx("td",{className:"py-1 px-2 w-32",children:e.jsx("select",{value:ot.requestedTime||"15:00",onChange:Pt=>Oe(ot.id,"requestedTime",Pt.target.value,ze),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-white focus:ring-sky-500 text-xs",children:Ze.map(Pt=>e.jsx("option",{value:Pt,children:Pt},Pt))})}),e.jsx("td",{className:"py-1 px-2 w-32",children:e.jsxs("select",{value:ot.priority,onChange:Pt=>Oe(ot.id,"priority",Pt.target.value,ze),className:"w-full bg-gray-700 border-gray-600 rounded py-1 px-2 text-white focus:ring-sky-500 text-xs",children:[e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Low",children:"Low"})]})}),e.jsx("td",{className:"py-1 px-1 text-right",children:e.jsx("button",{onClick:()=>Ne(ot.id,ze),className:"p-1 text-gray-400 hover:text-red-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})})]},ot.id)})})]})}),e.jsx("button",{onClick:()=>ge(ze),className:"mt-2 px-3 py-1 bg-sky-600 text-white rounded hover:bg-sky-700 text-xs font-semibold",children:"+ Add Request"})]})},ht=M,vt=C.useMemo(()=>{const ze=[];return D.forEach(we=>{if(we.isPaused)return;const Re=X.get(we.fullName)||se,be=F.get(we.fullName)||[],Ze=new Set(be.map(ot=>ot.event));Re.forEach(ot=>{(ot.isRemedial||ot.code.includes("REM")||ot.code.endsWith("RF"))&&!Ze.has(ot.id)&&ze.push({trainee:we,item:ot})})}),ze.sort((we,Re)=>we.trainee.name.localeCompare(Re.trainee.name))},[D,X,F,se]),Ht=({events:ze})=>e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-xs text-gray-400 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-2 text-left",children:"Name"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Event"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Solo/Dual"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Currency"}),e.jsx("th",{className:"py-2 px-2 text-left",children:"Priority"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700/50",children:ze.map(we=>{const Re=we.instructor||we.pilot||we.student||"N/A";return e.jsxs("tr",{onClick:()=>P(we),className:"hover:bg-sky-900/50 transition-colors cursor-pointer",children:[e.jsx("td",{className:"py-2 px-2 text-gray-300",children:Re}),e.jsx("td",{className:"py-2 px-2 text-gray-300 font-semibold",children:we.flightNumber}),e.jsx("td",{className:"py-2 px-2 text-gray-300",children:we.soloOrDual||we.flightType||"N/A"}),e.jsx("td",{className:"py-2 px-2 text-gray-300",children:we.currency||"N/A"}),e.jsx("td",{className:"py-2 px-2 text-gray-300 bg-yellow-100 text-gray-800 font-semibold",children:"High"})]},we.id)})})]})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"section-course-priority grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Course Priority"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Last updated: ",ye]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700",children:[e.jsx("ul",{className:"space-y-2",children:n.map((ze,we)=>e.jsxs("li",{draggable:!0,onDragStart:()=>xt(we),onDragEnter:()=>dn(we),onDragEnd:on,onDragOver:Re=>Re.preventDefault(),className:"p-3 bg-gray-700/50 rounded-md text-white flex items-center justify-between cursor-grab active:cursor-grabbing",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"font-mono text-gray-500",children:we+1}),e.jsx("span",{className:"font-semibold",children:ze})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:`font-mono w-12 text-center ${nt!==100&&"text-red-400"}`,children:[s.get(ze)??0,"%"]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(kt,{direction:"up",onClick:()=>st(ze,"increase"),disabled:(s.get(ze)??0)>=100}),e.jsx(kt,{direction:"down",onClick:()=>st(ze,"decrease"),disabled:(s.get(ze)??0)<=5})]})]})]},ze))}),e.jsxs("div",{className:`mt-3 p-2 rounded text-center text-sm font-semibold ${nt===100?"bg-green-500/20 text-green-300":"bg-amber-500/20 text-amber-300"}`,children:["Total: ",nt,"%"]}),e.jsxs("div",{className:"mt-2 p-2 bg-blue-500/10 border border-blue-500/30 rounded text-xs text-blue-300",children:[e.jsx("p",{className:"font-semibold mb-1",children:"‚ÑπÔ∏è Weighted Priority System:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-200",children:[e.jsx("li",{children:"Percentages are auto-normalized to 100%"}),e.jsx("li",{children:"Minimum percentage per course: 5%"}),e.jsx("li",{children:"Higher % = more events (biased allocation)"}),e.jsx("li",{children:"All courses still get events (no starvation)"})]})]})]})]})}),e.jsx("div",{className:"section-build-factors",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit",children:[e.jsx("div",{className:"p-4 flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Build Factors"})}),e.jsxs("div",{className:"p-4 border-t border-gray-700 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"aircraft-count",className:"block text-sm font-medium text-gray-400",children:"Available Aircraft"}),e.jsx("input",{id:"aircraft-count",type:"number",value:o,onChange:ze=>{Pn("Priorities","Edit","Updated available aircraft count",`${o} ‚Üí ${parseInt(ze.target.value)}`),l(parseInt(ze.target.value))},className:"w-full mt-1 bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ftd-count",className:"block text-sm font-medium text-gray-400",children:"FTD Available"}),e.jsx("input",{id:"ftd-count",type:"number",value:d,onChange:ze=>{Pn("Priorities","Edit","Updated available FTD count",`${d} ‚Üí ${parseInt(ze.target.value)}`),u(parseInt(ze.target.value))},className:"w-full mt-1 bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cpt-count",className:"block text-sm font-medium text-gray-400",children:"CPT Available"}),e.jsx("input",{id:"cpt-count",type:"number",value:f,onChange:ze=>{Pn("Priorities","Edit","Updated available CPT count",`${f} ‚Üí ${parseInt(ze.target.value)}`),h(parseInt(ze.target.value))},className:"w-full mt-1 bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Day Flying Window"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("select",{value:m,onChange:ze=>{Pn("Priorities","Edit","Updated flying start time",`${m} ‚Üí ${parseFloat(ze.target.value)}`),v(parseFloat(ze.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center",children:Ct.map(ze=>e.jsx("option",{value:ze.value,children:ze.label},ze.value))}),e.jsx("span",{className:"text-gray-400",children:"to"}),e.jsx("select",{value:x,onChange:ze=>{Pn("Priorities","Edit","Updated flying end time",`${x} ‚Üí ${parseFloat(ze.target.value)}`),y(parseFloat(ze.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center",children:Ct.map(ze=>e.jsx("option",{value:ze.value,children:ze.label},ze.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"FTD Operating Window"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("select",{value:T,onChange:ze=>{Pn("Priorities","Edit","Updated FTD start time",`${T} ‚Üí ${parseFloat(ze.target.value)}`),E(parseFloat(ze.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center",children:Ct.map(ze=>e.jsx("option",{value:ze.value,children:ze.label},ze.value))}),e.jsx("span",{className:"text-gray-400",children:"to"}),e.jsx("select",{value:A,onChange:ze=>{Pn("Priorities","Edit","Updated FTD end time",`${A} ‚Üí ${parseFloat(ze.target.value)}`),_(parseFloat(ze.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center",children:Ct.map(ze=>e.jsx("option",{value:ze.value,children:ze.label},ze.value))})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:ze=>{Pn("Priorities","Edit","Updated allow night flying",`${R} ‚Üí ${ze.target.checked}`),H(ze.target.checked)},className:"h-5 w-5 bg-gray-700 rounded accent-sky-500"}),e.jsx("span",{className:"font-semibold text-sky-400",children:"Allow Night Flying"})]})}),R&&e.jsxs("div",{className:"pl-8 space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Night Flying Window"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:O,onChange:ze=>{Pn("Priorities","Edit","Updated commence night flying time",`${O} ‚Üí ${parseFloat(ze.target.value)}`),W(parseFloat(ze.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center",children:Ct.map(ze=>e.jsx("option",{value:ze.value,children:ze.label},ze.value))}),e.jsx("span",{className:"text-gray-400",children:"to"}),e.jsx("select",{value:ne,onChange:ze=>{Pn("Priorities","Edit","Updated cease night flying time",`${ne} ‚Üí ${parseFloat(ze.target.value)}`),V(parseFloat(ze.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center",children:Ct.map(ze=>e.jsx("option",{value:ze.value,children:ze.label},ze.value))})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:Q,onChange:ze=>{Pn("Priorities","Edit
dist/assets/index-uPhlgI5U.js:bg-purple-600",Admin:"bg-red-600",Staff:"bg-blue-600",Trainee:"bg-green-600",Ops:"bg-yellow-600",Scheduler:"bg-orange-600","Course Supervisor":"bg-pink-600"})[M],D=["Super Admin","Admin","Staff","Trainee","Ops","Scheduler","Course Supervisor"],$=C.useMemo(()=>{const M={"Super Admin":0,Admin:0,Staff:0,Trainee:0,Ops:0,Scheduler:0,"Course Supervisor":0};return _.forEach(P=>{M[P.permissionLevel]++}),M},[_]);return A?e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-full max-w-6xl h-fit",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Permissions Manager"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Assign permission levels to individual users"})]}),d?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:O,className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Save Changes"}),e.jsx("button",{onClick:W,className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs font-semibold",children:"Cancel"})]}):e.jsx("button",{onClick:H,className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs font-semibold",children:"Edit Permissions"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name or role/course...",value:f,onChange:M=>h(M.target.value),className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white text-sm focus:outline-none focus:ring-sky-500"})}),e.jsx("div",{children:e.jsxs("select",{value:x,onChange:M=>y(M.target.value),className:"bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white text-sm focus:outline-none focus:ring-sky-500",children:[e.jsx("option",{value:"All",children:"All Users"}),e.jsx("option",{value:"Instructor",children:"Instructors Only"}),e.jsx("option",{value:"Trainee",children:"Trainees Only"})]})}),e.jsx("div",{children:e.jsxs("select",{value:m,onChange:M=>v(M.target.value),className:"bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white text-sm focus:outline-none focus:ring-sky-500",children:[e.jsx("option",{value:"All",children:"All Permissions"}),D.map(M=>e.jsx("option",{value:M,children:M},M))]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 p-3 bg-gray-700/50 rounded-lg",children:[e.jsx("span",{className:"text-xs text-gray-400 mr-2",children:"Permission Summary:"}),D.map(M=>e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:`w-3 h-3 rounded ${U(M)}`}),e.jsxs("span",{className:"text-xs text-gray-300",children:[M,": ",$[M]]})]},M))]}),e.jsx("div",{className:"overflow-x-auto max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-800 z-10",children:e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("th",{className:"font-medium text-gray-400 px-4 py-3",children:"Name"}),e.jsx("th",{className:"font-medium text-gray-400 px-4 py-3",children:"Type"}),e.jsx("th",{className:"font-medium text-gray-400 px-4 py-3",children:"Role/Course"}),e.jsx("th",{className:"font-medium text-gray-400 px-4 py-3",children:"Permission Level"})]})}),e.jsx("tbody",{children:R.map((M,P)=>{const ae=d?V(M):M.permissionLevel;return e.jsxs("tr",{className:`border-b border-gray-700 ${P%2===0?"bg-gray-800/50":"bg-gray-800/30"}`,children:[e.jsx("td",{className:"py-3 px-4 text-gray-200 font-medium",children:M.name}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${M.type==="Instructor"?"bg-blue-600 text-white":"bg-green-600 text-white"}`,children:M.type})}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:M.currentRole}),e.jsx("td",{className:"py-3 px-4",children:d?e.jsx("select",{value:ae,onChange:Q=>ne(M,Q.target.value),className:`${U(ae)} text-white rounded-md py-1 px-2 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-sky-500`,children:D.map(Q=>e.jsx("option",{value:Q,children:Q},Q))}):e.jsx("span",{className:`${U(ae)} text-white px-3 py-1 rounded text-xs font-semibold inline-block`,children:ae})})]},`${M.type}-${M.id}`)})})]})}),R.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No users found matching your filters."}),e.jsx("div",{className:"p-3 bg-gray-700/50 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-400",children:["Showing ",R.length," of ",_.length," users"]})})]})]}):e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-full max-w-6xl h-fit",children:[e.jsxs("div",{className:"p-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Permissions Manager"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Manage user access permissions"})]}),e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-red-500 mb-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z",clipRule:"evenodd"})}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-400",children:"Only Super Admin users can manage permissions."})]})]})},wA=({preferredDutyPeriod:n,onUpdatePreferredDutyPeriod:t,maxCrewDutyPeriod:s,onUpdateMaxCrewDutyPeriod:i,flightTurnaround:o,onUpdateFlightTurnaround:l,ftdTurnaround:d,onUpdateFtdTurnaround:u,cptTurnaround:f,onUpdateCptTurnaround:h})=>{const m=C.useMemo(()=>Array.from({length:30},(x,y)=>parseFloat(((y+1)*.1).toFixed(1))),[]),v=({label:x,value:y,onChange:T,options:E})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:`turnaround-${x}`,className:"block text-sm font-medium text-gray-400",children:x}),e.jsx("select",{id:`turnaround-${x}`,value:y,onChange:A=>T(parseFloat(A.target.value)),className:"w-full mt-1 bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center",children:E.map(A=>e.jsxs("option",{value:A,children:[A.toFixed(1)," hrs"]},A))})]});return e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 h-fit",children:[e.jsx("div",{className:"p-4 flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Duty & Turnaround"})}),e.jsxs("div",{className:"p-4 border-t border-gray-700 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Crew Duty Period (hrs)"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Soft Limit"}),e.jsx("input",{type:"number",value:n,onChange:x=>{Pn("Settings","Edit","Updated soft limit duty period",`${n} ‚Üí ${parseInt(x.target.value)}`),t(parseInt(x.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center"})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Hard Limit"}),e.jsx("input",{type:"number",value:s,onChange:x=>{Pn("Settings","Edit","Updated hard limit duty period",`${s} ‚Üí ${parseInt(x.target.value)}`),i(parseInt(x.target.value))},className:"w-full bg-gray-700 border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 text-center"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Turnaround Times"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-1",children:[e.jsx(v,{label:"Flight",value:o,onChange:x=>{Pn("Settings","Edit","Updated flight turnaround time",`${o} ‚Üí ${x}`),l(x)},options:m}),e.jsx(v,{label:"FTD",value:d,onChange:x=>{Pn("Settings","Edit","Updated FTD turnaround time",`${d} ‚Üí ${x}`),u(x)},options:m}),e.jsx(v,{label:"CPT",value:f,onChange:x=>{Pn("Settings","Edit","Updated CPT turnaround time",`${f} ‚Üí ${x}`),h(x)},options:m})]})]})]})]})},J1=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-sky-400 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"})}),SA=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400 mr-2 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}),CA=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"})}),TA=({hideHeader:n=!1,locations:t,onUpdateLocations:s,units:i,onUpdateUnits:o,unitLocations:l,onUpdateUnitLocations:d,instructorsData:u,traineesData:f,syllabusDetails:h,onBulkUpdateInstructors:m,onReplaceInstructors:v,onBulkUpdateTrainees:x,onReplaceTrainees:y,onUpdateSyllabus:T,onShowSuccess:E,eventLimits:A,onUpdateEventLimits:_,phraseBank:R,onUpdatePhraseBank:H,onNavigate:O,masterCurrencies:W,currencyRequirements:ne,sctEvents:V,onUpdateSctEvents:U,preferredDutyPeriod:D,onUpdatePreferredDutyPeriod:$,maxCrewDutyPeriod:M,onUpdateMaxCrewDutyPeriod:P,flightTurnaround:ae,onUpdateFlightTurnaround:Q,ftdTurnaround:Te,onUpdateFtdTurnaround:Y,cptTurnaround:fe,onUpdateCptTurnaround:ge,currentUserPermission:Ne,activeSection:Oe="scoring-matrix",maxDispatchPerHour:se,onUpdateMaxDispatchPerHour:F,timezoneOffset:X,onUpdateTimezoneOffset:J,formationCallsigns:ee,onUpdateFormationCallsigns:K,courseColors:ue,setCourseColors:xe,onUpdateTraineeLMPs:Le,cancellationRecords:ye,cancellationCodes:pe})=>{const ce=["Super Admin","Admin","Scheduler"].includes(Ne),[He,_e]=C.useState(!1),[Z,Fe]=C.useState([]),[Xe,ft]=C.useState(""),[tt,We]=C.useState(!1),[Ke,nt]=C.useState([]),[Ct,xt]=C.useState(""),[dn,on]=C.useState({}),[st,kt]=C.useState(!1),[Ge,ht]=C.useState(!1),[vt,Ht]=C.useState([]),[ze,we]=C.useState(""),[Re,be]=C.useState(!1),[Ze,ot]=C.useState(A),[Vt,Pt]=C.useState(!1),[yn,Tt]=C.useState("Airmanship"),[lt,Et]=C.useState([]),[Bt]=C.useState([{id:"instructor_loads",name:"Instructor Loads"},{id:"trainee_loads",name:"Trainee Loads"},{id:"lmp_loads",name:"LMP Loads"},{id:"logbook_templates",name:"Logbook Template"},{id:"miscellaneous",name:"Miscellaneous"},{id:"trainee_data",name:"Trainee Data"},{id:"trainee_logbook",name:"Logbook",isSub:!0},{id:"staff_data",name:"Staff Data"},{id:"staff_logbook",name:"Logbook",isSub:!0}]),[Kt,Mt]=C.useState(!1),[Ve,qt]=C.useState(null),[Mn,jn]=C.useState(!1),[je,$e]=C.useState(null),[Ye,Dt]=C.useState(null),[St,hn]=C.useState(null),[Ce,At]=C.useState(!1),[B,Ae]=C.useState(!1),[rt,yt]=C.useState("minor"),[et,$t]=C.useState(""),[pn,kn]=C.useState([]),[ts,un]=C.useState(!1),[Nn,os]=C.useState(null),[ss,Hn]=C.useState(!1),[Jn,zn]=C.useState(""),[Fn,Rn]=C.useState(!1),[Qn,as]=C.useState({added:0,updated:0,replaced:0,skipped:0,type:""}),[cs,rs]=C.useState(!1),[Ms,hs]=C.useState([]),[_n,rr]=C.useState([]),[Cs,js]=C.useState([]),[Cr,Fs]=C.useState(0),Ds=C.useMemo(()=>new Set(Bt.map(Ee=>Ee.id)),[Bt]),Js=C.useMemo(()=>lt.filter(Ee=>!Ds.has(Ee.folderId)),[lt,Ds]),sa=C.useMemo(()=>Object.keys(ue).sort((Ee,rn)=>Ee.localeCompare(rn)),[ue]),to=(Ee,rn)=>{const gt=Ee.name||"",vn=rn.name||"";return gt.localeCompare(vn)},Ti=C.useMemo(()=>[...W,...ne].filter(Ee=>Ee.isVisible).sort(to),[W,ne]);C.useEffect(()=>{(async()=>{try{await rg(),ra()}catch(rn){console.error("Failed to initialize DB:",rn)}})()},[]),C.useEffect(()=>{cs&&Ms.length>0?Xn():cs&&Ms.length===0&&fs()},[cs,Ms]);const vs=Ee=>Oe?Oe===Ee:!0,ra=async()=>{const Ee=await ig();Et(Ee)},no=()=>{Fe([...t]),_e(!0)},xi=()=>{const Ee=t.join(", "),rn=Z.join(", ");s(Z),_e(!1),Pn({page:"Settings - Location",action:"update",description:"Updated operating locations",changes:`From: [${Ee}] To: [${rn}]`})},Ta=()=>{ft(""),_e(!1)},so=()=>{Xe&&!Z.includes(Xe)&&(Fe([...Z,Xe]),ft(""))},Go=Ee=>{Fe(Z.filter(rn=>rn!==Ee))},ro=()=>{nt([...i]),on({...l}),We(!0)},Ba=()=>{const Ee=i.join(", "),rn=Ke.join(", ");o(Ke);const gt={};for(const vn of Ke)gt[vn]=dn[vn];d(gt),We(!1),Pn({page:"Settings - Units",action:"update",description:"Updated organizational units and locations",changes:`From: [${Ee}] To: [${rn}]`})},Ao=()=>{xt(""),We(!1)},Vr=()=>{Ct&&!Ke.includes(Ct)&&(nt([...Ke,Ct]),on(Ee=>({...Ee,[Ct]:t[0]||""})),xt(""))},li=Ee=>{nt(Ke.filter(gt=>gt!==Ee));const rn={...dn};delete rn[Ee],on(rn)},Mi=()=>{Ht([...V]),kt(!0)},Qr=()=>{const Ee=V.join(", "),rn=vt.join(", ");U(vt),kt(!1),Pn({page:"Settings - SCT Events",action:"update",description:"Updated SCT event types",changes:`From: [${Ee}] To: [${rn}]`})},Fi=()=>{we(""),kt(!1)},ke=()=>{ze&&!vt.includes(ze)&&(Ht([...vt,ze]),we(""))},mt=Ee=>{Ht(vt.filter(rn=>rn!==Ee))},nn=(Ee,rn)=>{on(gt=>({...gt,[Ee]:rn}))},Yt=()=>{ot(JSON.parse(JSON.stringify(A))),be(!0)},an=()=>{_(Ze),be(!1),E("Events limits updated"),Pn({page:"Settings - Event Limits",action:"update",description:"Updated event scheduling limits",changes:"Updated limits for QFI, Staff, Trainee, and SIM IP categories"})},en=Ee=>{$(Ee),Pn({page:"Settings - Duty & Turnaround",action:"update",description:"Updated preferred duty period",changes:`Set to: ${Ee} hours`})},Cn=Ee=>{P(Ee),Pn({page:"Settings - Duty & Turnaround",action:"update",description:"Updated max crew duty period",changes:`Set to: ${Ee} hours`})},Vn=Ee=>{Q(Ee),Pn({page:"Settings - Duty & Turnaround",action:"update",description:"Updated flight turnaround time",changes:`Set to: ${Ee} minutes`})},xn=Ee=>{Y(Ee),Pn({page:"Settings - Duty & Turnaround",action:"update",description:"Updated FTD turnaround time",changes:`Set to: ${Ee} minutes`})},ls=Ee=>{ge(Ee),Pn({page:"Settings - Duty & Turnaround",action:"update",description:"Updated CPT turnaround time",changes:`Set to: ${Ee} minutes`})},Es=Ee=>{Tt(Ee),Pt(!0)},Zs=Ee=>{H(Ee),Pn({page:"Settings - Scoring Matrix",action:"update",description:"Updated scoring matrix phrase bank",changes:"Modified scoring criteria and phrases"})},ir=()=>{Mt(!0)},Pi=Ee=>{qt(Ee),Mt(!1),jn(!0)},Oa=async Ee=>{if(Ve){const rn=new Date,gt=rn.getFullYear().toString().slice(-2),vn=(rn.getMonth()+1).toString().padStart(2,"0"),Un=rn.getDate().toString().padStart(2,"0"),_s=`${gt}${vn}${Un}`,En=Bt.find(Xs=>Xs.id===Ee),es=En?En.name.replace(/\s+/g,"_"):"Uncategorized",Is=Ve.name,ps=`${_s}_${es}_${Is}`;await cd(Ve,Ee,ps),ra(),Pn({page:"Settings - Data Loaders",action:"create",description:`Uploaded file to ${es}`,changes:`File: ${ps}`})}jn(!1),qt(null)},Fr=Ee=>{$e(Ee)},ja=async()=>{if(je){const Ee=await ih(je.id);if(Ee){const rn=URL.createObjectURL(Ee.content),gt=document.createElement("a");gt.href=rn,gt.download=Ee.name,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(rn)}$e(null)}},Ri=Ee=>{Dt(Ee)},ci=async()=>{Ye&&(await ah(Ye.id),ra(),Pn({page:"Settings - Data Loaders",action:"delete",description:"Deleted file from data loaders",changes:`File: ${Ye.name}`}),Dt(null))},ko=()=>{const Ee=document.createElement("a");Ee.href="/Staff_Bulk_Update_Template.xlsx",Ee.download="Staff_Bulk_Update_Template.xlsx",document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee)},Bs=()=>{const Ee=document.createElement("a");Ee.href="/Trainee_Bulk_Update_Template.xlsx",Ee.download="Trainee_Bulk_Update_Template.xlsx",document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee)},Wr=()=>{const Ee=document.createElement("a");Ee.href="/LMP_Syllabus_Template.xlsx",Ee.download="LMP_Syllabus_Template.xlsx",document.body.appendChild(Ee),Ee.click(),document.body.removeChild(Ee)},Ea=()=>{const Ee=["Date","Aircraft","Pilot","Student","Sortie","Duration","Result"],rn=XLSX.utils.json_to_sheet([{}],{header:Ee}),gt=XLSX.utils.book_new();XLSX.utils.book_append_sheet(gt,rn,"Logbook"),XLSX.writeFile(gt,"Logbook_Template.xlsx")},Tr=Ee=>{hn(Ee),At(!0)},Do=async(Ee,rn)=>{if(Ee!=="1111"){E("Incorrect PIN.");return}At(!1),yt(rn),(St==null?void 0:St.folderId)==="trainee_loads"?(await yi(),Ae(!0)):io(rn,"")},yi=async()=>{if(St)try{const Ee=await ih(St.id);if(!Ee)return;const rn=await Ee.content.arrayBuffer(),gt=XLSX.read(rn,{type:"buffer"}),vn=gt.SheetNames[0],Un=gt.Sheets[vn],_s=XLSX.utils.sheet_to_json(Un),En=new Set;_s.forEach(es=>{const Is=k(es,["Course Prefix","coursePrefix"]),ps=k(es,["Course Number","courseNumber"]);if(Is&&ps)En.add(`${Is}${ps}`);else{const Xs=k(es,["Course"]);Xs&&En.add(Xs)}}),kn(Array.from(En))}catch(Ee){console.error("Error extracting courses from file:",Ee)}},di=Ee=>{$t(Ee),Ae(!1),io(rt,Ee)},io=async(Ee,rn)=>{if(St)try{const gt=await ih(St.id);if(!gt)throw new Error("File not found");const vn=await gt.content.arrayBuffer(),Un=XLSX.read(vn,{type:"buffer"}),_s=Un.SheetNames[0],En=Un.Sheets[_s],es=XLSX.utils.sheet_to_json(En);Ee==="bulk"?fn(es,rn):Wn(es,rn)}catch(gt){console.error("File processing error:",gt),E(`Error processing file: ${gt.message}`)}},Ui=(Ee,rn)=>{for(const vn of rn)if(Ee[vn]!==void 0)return Ee[vn];const gt=Object.keys(Ee);for(const vn of rn){const Un=vn.toLowerCase().replace(/[\s/]/g,"");for(const _s of gt)if(_s.toLowerCase().replace(/[\s/]/g,"")===Un)return Ee[_s]}},ao=Ee=>typeof Ee=="boolean"?Ee:typeof Ee=="string"?Ee.trim().toLowerCase()==="true":!!Ee,k=(Ee,rn)=>{const gt=Ui(Ee,rn);return gt!==void 0?String(gt).trim():void 0},re=(Ee,rn)=>{const gt=Ui(Ee,rn);if(gt==null||String(gt).trim()==="")return;const vn=parseFloat(String(gt).replace(/[A-Za-z]/g,"").trim());return isNaN(vn)?void 0:vn},De=(Ee,rn)=>{const gt=Ui(Ee,rn);if(gt!=null)return String(gt).split(";").map(vn=>vn.trim()).filter(Boolean)},Qe=Ee=>{const rn=re(Ee,["PMKeys/ID","idNumber"]);if(rn===void 0)return null;const gt={idNumber:rn},vn=k(Ee,["Srname","Surname","Last Name"]),Un=k(Ee,["First name","Firstname","Given Name"]);vn&&Un&&(gt.name=`${vn}, ${Un}`);const _s=k(Ee,["Rank"]);_s&&(gt.rank=_s);const En=re(Ee,["callsign number","callsignnumber"]);En!==void 0&&(gt.callsignNumber=En);const es=k(Ee,["Service"]);es&&(gt.service=es);const Is=k(Ee,["Category"]);Is&&(gt.category=Is);const ps=k(Ee,["Seat config","seatConfig"]);ps&&(gt.seatConfig=ps);const Xs=k(Ee,["Roles"]);if(Xs){const ar=Xs.toLowerCase();gt.isExecutive=ar.includes("executive"),gt.isFlyingSupervisor=ar.includes("supervisor"),gt.isTestingOfficer=ar.includes("testing"),gt.isIRE=ar.includes("ire")}return gt},pt=Ee=>{const rn=re(Ee,["PMKeys/ID","idNumber"]);if(rn===void 0)return null;const gt={idNumber:rn},vn=k(Ee,["Name","Name [Surname, Firstname]"]);if(vn)gt.name=vn;else{const Yr=k(Ee,["Surname","Last Name"]),aa=k(Ee,["First Name","Firstname","Given Name"]);Yr&&aa&&(gt.name=`${Yr}, ${aa}`)}const Un=k(Ee,["Course Prefix","coursePrefix"]),_s=k(Ee,["Course Number","courseNumber"]);if(Un&&_s)gt.course=`${Un}${_s}`;else{const Yr=k(Ee,["Course"]);Yr&&(gt.course=Yr)}const En=k(Ee,["LMP","lmpType"]);En&&(gt.lmpType=En);const es=k(Ee,["Rank"]);es&&(gt.rank=es);const Is=k(Ee,["Callsign","callsign"]);Is&&(gt.callsignNumber=parseInt(Is)||void 0);const ps=k(Ee,["Service"]);ps&&(gt.service=ps);const Xs=k(Ee,["Unit"]);Xs&&(gt.unit=Xs);const ar=k(Ee,["Flight","flight"]);ar&&(gt.flight=ar);const $s=k(Ee,["Location"]);$s&&(gt.location=$s);const ji=k(Ee,["Seat Config","seatConfig"]);ji&&(gt.seatConfig=ji);const or=k(Ee,["Phone Number","phoneNumber"]);or&&(gt.phoneNumber=or);const Bi=k(Ee,["Email"]);Bi&&(gt.email=Bi);const ia=k(Ee,["Primary Instructor","primaryInstructor"]);ia&&(gt.primaryInstructor=ia);const $r=k(Ee,["Secondary Instructor","secondaryInstructor"]);$r&&(gt.secondaryInstructor=$r);const Yi=k(Ee,["Permissions","permissions"]);Yi&&(gt.permissions=Yi.split(/\r?\n/).map(Yr=>Yr.trim()).filter(Boolean));const ei=Ui(Ee,["Is Paused","isPaused"]);return ei!==void 0&&(gt.isPaused=ao(ei)),gt.isPaused||(gt.isPaused=!1),gt.unit||(gt.unit=""),gt.rank||(gt.rank="FLGOFF"),gt.seatConfig||(gt.seatConfig="Front"),gt.unavailability||(gt.unavailability=[]),gt.name&&gt.course?gt.fullName=`${gt.name} ‚Äì ${gt.course}`:gt.name&&(gt.fullName=gt.name),gt},Jt=Ee=>{const rn=k(Ee,["Code"]);if(!rn)return null;const gt={code:rn},vn=k(Ee,["Phase"]);vn&&(gt.phase=vn);const Un=k(Ee,["Module"]);Un&&(gt.module=Un);const _s=k(Ee,["Event description","eventDescription"]);_s&&(gt.eventDescription=_s);const En=De(Ee,["Pre-requisite Events (Ground School)","prerequisitesGround"]);En&&(gt.prerequisitesGround=En);const es=De(Ee,["Pre-requisite Events (Sim/Flying)","prerequisitesFlying"]);es&&(gt.prerequisitesFlying=es),(En||es)&&(gt.prerequisites=[...En||[],...es||[]]);const Is=De(Ee,["Event Details - Common","eventDetailsCommon"]);Is&&(gt.eventDetailsCommon=Is);const ps=De(Ee,["Event Details - Sortie","eventDetailsSortie"]);ps&&(gt.eventDetailsSortie=ps);const Xs=re(Ee,["Total Event Hours","totalEventHours"]);Xs!==void 0&&(gt.totalEventHours=Xs);const ar=re(Ee,["Flight or Sim Hours","flightOrSimHours"]);ar!==void 0&&(gt.flightOrSimHours=ar,gt.duration=ar);const $s=De(Ee,["Method/s of Delivery","methodOfDelivery"]);$s&&(gt.methodOfDelivery=$s);const ji=De(Ee,["Type/s and Method/s of Assessment","methodOfAssessment"]);ji&&(gt.methodOfAssessment=ji);const or=De(Ee,["Resources Required (physical)","resourcesPhysical"]);or&&(gt.resourcesPhysical=or);const Bi=De(Ee,["Resources Required (Human)","resourcesHuman"]);return Bi&&(gt.resourcesHuman=Bi),gt},fn=(Ee,rn)=>{if(!St)return;let gt=0,vn=[];switch(St.folderId){case"instructor_loads":vn=Ee.map(Qe).filter(En=>En&&En.idNumber),v(vn);break;case"trainee_loads":if(rn){const En=Ee.map(pt);console.log("üîµ BULK UPDATE DEBUG - Parsed rows:",En.length),console.log("üîµ First parsed row:",En[0]),vn=En.filter(ps=>ps&&ps.idNumber&&ps.name),console.log("üîµ Filtered rows (with ID and name):",vn.length),vn.length===0&&(console.error("üî¥ NO ROWS PASSED FILTER! Check if rows have idNumber and name"),console.log("üî¥ Sample parsed row:",En[0]));const es=f.filter(ps=>ps.course!==rn);console.log("üîµ Other course trainees:",es.length);const Is=vn.map(ps=>({...ps,course:rn}));console.log("üîµ New trainees to add:",Is.length),console.log("üîµ Sample new trainee:",Is[0]),console.log("üîµ Total trainees after update:",es.length+Is.length),y([...es,...Is])}else vn=Ee.map(pt).filter(En=>En&&En.idNumber&&En.name),y(vn);break;case"lmp_loads":vn=Ee.map(Jt).filter(En=>En&&En.code),T(vn);break}gt=vn.length,as({type:"Bulk",replaced:gt,added:0,updated:0,skipped:Ee.length-gt}),Rn(!0);const Un=St.folderId==="instructor_loads"?"Instructors":St.folderId==="trainee_loads"?"Trainees":"LMP Data",_s=rn?` for course: ${rn}`:"";Pn({page:"Settings - Data Loaders",action:"update",description:`Bulk update: ${Un}${_s}`,changes:`Replaced ${gt} records from file: ${St.name}`}),hn(null)},Wn=(Ee,rn)=>{hs(Ee),rr([]),js([]),Fs(0),$t(rn),rs(!0)},Xn=()=>{if(!St){rs(!1);return}const[Ee,...rn]=Ms;hs(rn);let gt,vn;switch(St.folderId){case"instructor_loads":if(gt=Qe(Ee),!(gt!=null&&gt.idNumber)){Fs(Un=>Un+1);return}vn=u.find(Un=>Un.idNumber===gt.idNumber);break;case"trainee_loads":if(gt=pt(Ee),!(gt!=null&&gt.idNumber)){Fs(Un=>Un+1);return}et?(vn=f.find(Un=>Un.idNumber===gt.idNumber&&Un.course===et),gt.course=et):vn=f.find(Un=>Un.idNumber===gt.idNumber);break;case"lmp_loads":if(gt=Jt(Ee),!(gt!=null&&gt.code)){Fs(Un=>Un+1);return}vn=h.find(Un=>Un.code.trim().replace(/\s/g,"").toLowerCase()===String(gt.code).trim().replace(/\s/g,"").toLowerCase());break;default:Fs(Un=>Un+1);return}if(vn){const Un={...vn,...gt};St.folderId==="trainee_loads"&&(!gt.primaryInstructor&&vn.primaryInstructor&&(Un.primaryInstructor=vn.primaryInstructor),!gt.secondaryInstructor&&vn.secondaryInstructor&&(Un.secondaryInstructor=vn.secondaryInstructor)),rr(_s=>[..._s,Un])}else js(Un=>[...Un,gt])},fs=()=>{if(rs(!1),!St)return;let Ee=[];switch(St.folderId){case"instructor_loads":Ee=[...u],_n.forEach(En=>{const es=Ee.findIndex(Is=>Is.idNumber===En.idNumber);es!==-1&&(Ee[es]=En)});const vn=Ee.filter(En=>!Cs.some(es=>es.idNumber===En.idNumber));console.log(`[DEBUG] Filtered out ${Ee.length-vn.length} duplicate records`),m([...vn,...Cs]);break;case"trainee_loads":if(Ee=[...f],et){_n.forEach(es=>{const Is=Ee.findIndex(ps=>ps.idNumber===es.idNumber&&ps.course===et);Is!==-1&&(Ee[Is]=es)});const En=Cs.map(es=>({...es,course:et}));if(x([...Ee,...En]),console.log(`[DEBUG] About to initialize LMP for ${En.length} new trainees`),console.log("[DEBUG] onUpdateTraineeLMPs function available:",typeof Le),console.log("[DEBUG] New trainees:",En.map(es=>({name:es.fullName,lmpType:es.lmpType,course:es.course}))),Le&&Le(es=>{console.log(`[DEBUG] LMP initialization started. Previous LMPs count: ${es.size}`);const Is=new Map(es);return En.forEach(ps=>{if(console.log(`[DEBUG] Processing trainee: ${ps.fullName}, LMP Type: ${ps.lmpType}`),ps.fullName&&ps.lmpType){const Xs=h.filter(ar=>ar.courses.includes(ps.lmpType));console.log(`[DEBUG] Found ${Xs.length} master LMP items for ${ps.lmpType}`),Xs.length>0?(Is.set(ps.fullName,[...Xs]),console.log(`[Individual LMP] Initialized ${ps.fullName}'s Individual LMP with ${ps.lmpType} (${Xs.length} events)`)):console.warn(`[Individual LMP] No Master LMP found for LMP type: ${ps.lmpType}`)}else console.warn(`[DEBUG] Skipping trainee ${ps.fullName} - missing fullName or lmpType`)}),console.log(`[DEBUG] LMP initialization complete. New LMPs count: ${Is.size}`),Is}),et&&!ue[et]){const es=["#e74c3c","#3498db","#9b59b6","#1abc9c","#f39c12","#34495e","#16a085","#27ae60","#2980b9"],Is=Object.keys(ue).length%es.length,ps={...ue,[et]:es[Is]};xe(ps),console.log(`üé® Added color for course ${et}: ${es[Is]}`)}}else _n.forEach(En=>{const es=Ee.findIndex(Is=>Is.idNumber===En.idNumber);es!==-1&&(Ee[es]=En)}),x([...Ee,...Cs]);break;case"lmp_loads":const Un=new Map(_n.map(En=>[En.code.trim().replace(/\s/g,"").toLowerCase(),En])),_s=h.map(En=>{const es=En.code.trim().replace(/\s/g,"").toLowerCase();return Un.get(es)||En});T([..._s,...Cs]);break}as({type:"Minor",added:Cs.length,updated:_n.length,skipped:Cr,replaced:0}),Rn(!0);const rn=St.folderId==="instructor_loads"?"Instructors":St.folderId==="trainee_loads"?"Trainees":"LMP Data",gt=et?` for course: ${et}`:"";Pn({page:"Settings - Data Loaders",action:"update",description:`Minor update: ${rn}${gt}`,changes:`Added ${Cs.length}, Updated ${_n.length}, Skipped ${Cr} from file: ${St.name}`}),hn(null),hs([]),js([]),rr([]),Fs(0)},gs=()=>{Nn&&js(Ee=>[...Ee,Nn]),un(!1),os(null),rs(!0)},Os=()=>{Fs(Ee=>Ee+1),un(!1),os(null),rs(!0)},fr=({file:Ee})=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-gray-700/50 rounded text-sm group",children:[e.jsxs("div",{className:"flex items-center truncate",children:[e.jsx(SA,{}),e.jsx("span",{className:"truncate text-white",title:Ee.name,children:Ee.name})]}),e.jsxs("div",{className:"flex space-x-2 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>Tr(Ee),className:"p-1 text-gray-400 hover:text-green-400","aria-label":"Update from file",children:e.jsx(CA,{})}),e.jsx("button",{onClick:()=>Fr(Ee),className:"p-1 text-gray-400 hover:text-sky-400","aria-label":"Download file",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})}),e.jsx("button",{onClick:()=>Ri(Ee),className:"p-1 text-gray-400 hover:text-red-400","aria-label":"Delete file",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]})]},Ee.id);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[vs("validation")&&e.jsx("div",{className:"space-y-6",children:e.jsx(bA,{currentUserRole:Ne,cancellationRecords:ye||[]})}),vs("timezone")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6 w-96",children:[e.jsx("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Timezone Settings"})}),e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Timezone Offset (UTC)"}),e.jsxs("select",{value:X,onChange:Ee=>J(parseFloat(Ee.target.value)),className:"w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-sky-500",children:[e.jsx("option",{value:"-12",children:"UTC-12:00"}),e.jsx("option",{value:"-11",children:"UTC-11:00"}),e.jsx("option",{value:"-10",children:"UTC-10:00 (Hawaii)"}),e.jsx("option",{value:"-9",children:"UTC-09:00 (Alaska)"}),e.jsx("option",{value:"-8",children:"UTC-08:00 (Pacific)"}),e.jsx("option",{value:"-7",children:"UTC-07:00 (Mountain)"}),e.jsx("option",{value:"-6",children:"UTC-06:00 (Central)"}),e.jsx("option",{value:"-5",children:"UTC-05:00 (Eastern)"}),e.jsx("option",{value:"-4",children:"UTC-04:00"}),e.jsx("option",{value:"-3",children:"UTC-03:00"}),e.jsx("option",{value:"-2",children:"UTC-02:00"}),e.jsx("option",{value:"-1",children:"UTC-01:00"}),e.jsx("option",{value:"0",children:"UTC+00:00 (GMT/UTC)"}),e.jsx("option",{value:"1",children:"UTC+01:00 (CET)"}),e.jsx("option",{value:"2",children:"UTC+02:00"}),e.jsx("option",{value:"3",children:"UTC+03:00"}),e.jsx("option",{value:"4",children:"UTC+04:00"}),e.jsx("option",{value:"5",children:"UTC+05:00"}),e.jsx("option",{value:"5.5",children:"UTC+05:30 (India)"}),e.jsx("option",{value:"6",children:"UTC+06:00"}),e.jsx("option",{value:"7",children:"UTC+07:00"}),e.jsx("option",{value:"8",children:"UTC+08:00 (Singapore/Perth)"}),e.jsx("option",{value:"9",children:"UTC+09:00 (Japan/Korea)"}),e.jsx("option",{value:"9.5",children:"UTC+09:30 (Adelaide)"}),e.jsx("option",{value:"10",children:"UTC+10:00 (AEST Sydney/Brisbane)"}),e.jsx("option",{value:"10.5",children:"UTC+10:30"}),e.jsx("option",{value:"11",children:"UTC+11:00 (AEDT Sydney)"}),e.jsx("option",{value:"12",children:"UTC+12:00 (New Zealand)"}),e.jsx("option",{value:"13",children:"UTC+13:00 (NZDT)"})]}),e.jsxs("p",{className:"mt-2 text-xs text-gray-400",children:["Current server time: ",new Date().toUTCString()]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-400",children:["Your local time: ",new Date(Date.now()+X*60*60*1e3).toUTCString()]})]})})]}),vs("scoring-matrix")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6",children:[e.jsx("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Scoring Matrix"})}),e.jsxs("div",{className:"p-4 grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>Es("Airmanship"),className:"px-3 py-2 bg-gray-700 text-gray-200 rounded-md hover:bg-sky-700 hover:text-white transition-colors text-sm font-medium border border-gray-600",children:"Airmanship"}),e.jsx("button",{onClick:()=>Es("Preparation"),className:"px-3 py-2 bg-gray-700 text-gray-200 rounded-md hover:bg-sky-700 hover:text-white transition-colors text-sm font-medium border border-gray-600",children:"Preparation"}),e.jsx("button",{onClick:()=>Es("Technique"),className:"px-3 py-2 bg-gray-700 text-gray-200 rounded-md hover:bg-sky-700 hover:text-white transition-colors text-sm font-medium border border-gray-600",children:"Technique"}),e.jsx("button",{onClick:()=>Es("Elements"),className:"px-3 py-2 bg-gray-700 text-gray-200 rounded-md hover:bg-sky-700 hover:text-white transition-colors text-sm font-medium border border-gray-600",children:"Elements"})]})]}),vs("location")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-80 h-fit",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Location"}),He?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:xi,className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Save"}),e.jsx("button",{onClick:Ta,className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs font-semibold",children:"Cancel"})]}):e.jsx("button",{onClick:no,disabled:!ce,className:`px-3 py-1 rounded-md text-xs font-semibold ${ce?"bg-gray-600 text-white hover:bg-gray-700 cursor-pointer":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:"Edit"})]}),e.jsx("div",{className:"p-4 space-y-4",children:He?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Manage available operating locations."}),e.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto",children:Z.map(Ee=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white",children:Ee}),e.jsx("button",{onClick:()=>Go(Ee),className:"p-1 text-gray-400 hover:text-red-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]},Ee))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:Xe,onChange:Ee=>ft(Ee.target.value),placeholder:"New location name",className:"flex-grow bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white text-sm focus:outline-none focus:ring-sky-500"}),e.jsx("button",{onClick:so,className:"px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-semibold",children:"Add"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Configured operating locations."}),e.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto",children:t.map(Ee=>e.jsx("li",{className:"p-2 bg-gray-700/50 rounded text-white",children:Ee},Ee))})]})})]}),vs("location")&&e.jsx(vA,{callsigns:ee,onUpdateCallsigns:K,units:i,locations:t,canEditSettings:ce,onAuditLog:Pn}),vs("units")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-80 h-fit",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Units"}),tt?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Ba,className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Save"}),e.jsx("button",{onClick:Ao,className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs font-semibold",children:"Cancel"})]}):e.jsx("button",{onClick:ro,disabled:!ce,className:`px-3 py-1 rounded-md text-xs font-semibold ${ce?"bg-gray-600 text-white hover:bg-gray-700 cursor-pointer":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:"Edit"})]}),e.jsx("div",{className:"p-4 space-y-4",children:tt?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Manage units and their primary locations."}),e.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto",children:Ke.map(Ee=>e.jsxs("li",{className:"p-2 bg-gray-700/50 rounded",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white",children:Ee}),e.jsx("button",{onClick:()=>li(Ee),className:"p-1 text-gray-400 hover:text-red-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]}),e.jsx("select",{value:dn[Ee]||"",onChange:rn=>nn(Ee,rn.target.value),className:"mt-1 block w-full bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white text-xs",children:t.map(rn=>e.jsx("option",{value:rn,children:rn},rn))})]},Ee))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:Ct,onChange:Ee=>xt(Ee.target.value),placeholder:"New unit name",className:"flex-grow bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white text-sm focus:outline-none focus:ring-sky-500"}),e.jsx("button",{onClick:Vr,className:"px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-semibold",children:"Add"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Configured units and their locations."}),e.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto",children:i.map(Ee=>e.jsxs("li",{className:"p-2 bg-gray-700/50 rounded text-white flex justify-between",children:[e.jsx("span",{children:Ee}),e.jsx("span",{className:"text-gray-400",children:l[Ee]})]},Ee))})]})})]}),vs("duty-turnaround")&&e.jsx(wA,{preferredDutyPeriod:D,onUpdatePreferredDutyPeriod:en,maxCrewDutyPeriod:M,onUpdateMaxCrewDutyPeriod:Cn,flightTurnaround:ae,onUpdateFlightTurnaround:Vn,ftdTurnaround:Te,onUpdateFtdTurnaround:xn,cptTurnaround:fe,onUpdateCptTurnaround:ls}),vs("sct-events")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-80 h-fit",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"SCT Events"}),st?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Qr,className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Save"}),e.jsx("button",{onClick:Fi,className:"px-3 py-1 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-xs font-semibold",children:"Cancel"})]}):e.jsx("button",{onClick:Mi,disabled:!ce,className:`px-3 py-1 rounded-md text-xs font-semibold ${ce?"bg-gray-600 text-white hover:bg-gray-700 cursor-pointer":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:"Edit"})]}),e.jsx("div",{className:"p-4 space-y-4",children:st?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Manage SCT event types."}),e.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto",children:vt.map(Ee=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-gray-700/50 rounded",children:[e.jsx("span",{className:"text-white",children:Ee}),e.jsx("button",{onClick:()=>mt(Ee),className:"p-1 text-gray-400 hover:text-red-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})})]},Ee))}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:ze,onChange:Ee=>we(Ee.target.value),placeholder:"New SCT event name",className:"flex-grow bg-gray-700 border-gray-600 rounded-md py-1 px-2 text-white text-sm focus:outline-none focus:ring-sky-500"}),e.jsx("button",{onClick:ke,className:"px-3 py-1 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-semibold",children:"+"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Configured SCT event types."}),e.jsx("ul",{className:"space-y-2 max-h-40 overflow-y-auto",children:V.map(Ee=>e.jsx("li",{className:"p-2 bg-gray-700/50 rounded text-white",children:Ee},Ee))})]})})]}),vs("currencies")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-[40rem] h-fit flex flex-col",children:[e.jsx("div",{className:"p-4 flex justify-between items-center shrink-0",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Currencies"})}),e.jsx("div",{className:"flex-1 overflow-y-auto max-h-[400px]",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"font-medium text-gray-400 px-4 pt-0 pb-2 border-b border-gray-700",children:"Currency"}),e.jsx("th",{className:"font-medium text-gray-400 px-4 pt-0 pb-2 border-b border-gray-700",children:"Type"})]})}),e.jsx("tbody",{children:Ti.map((Ee,rn)=>e.jsxs("tr",{className:"border-t border-gray-700",children:[e.jsx("td",{className:"py-2 px-4 text-gray-200",children:Ee.name}),e.jsx("td",{className:"py-2 px-4 text-gray-300 capitalize",children:Ee.type})]},Ee.id))})]})}),e.jsx("div",{className:"p-4 border-t border-gray-700 shrink-0",children:e.jsx("button",{onClick:()=>O("CurrencyBuilder"),className:"w-full px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"Currency Builder"})})]}),vs("business-rules")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-[40rem] h-fit",children:[e.jsx("div",{className:"p-4 flex justify-between items-center",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Business Rules"})}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Max dispatch / hr"}),e.jsx("select",{value:se,onChange:Ee=>F(parseInt(Ee.target.value)),disabled:!ce,className:`w-full px-3 py-2 rounded-md border focus:ring-sky-500 focus:border-sky-500 ${ce?"bg-gray-700 border-gray-600 text-white":"bg-gray-600 border-gray-500 text-gray-300 cursor-not-allowed"}`,children:[1,2,3,4,5,6,7,8,9,10,12,15,20].map(Ee=>e.jsx("option",{value:Ee,children:Ee},Ee))}),ce&&e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Maximum number of dispatches allowed per hour"})]})})})]}),vs("data-loaders")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-[30rem] h-fit",children:[e.jsx("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Data Loaders"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Templates"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Download templates to ensure correct formatting for bulk uploads."}),e.jsx("button",{onClick:ko,className:"w-full px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-sm font-semibold",children:"Download Staff Template (.xlsx)"}),e.jsx("button",{onClick:Bs,className:"w-full px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-sm font-semibold",children:"Download Trainee Template (.xlsx)"}),e.jsx("button",{onClick:Wr,className:"w-full px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-sm font-semibold",children:"Download LMP Template (.xlsx)"}),e.jsx("button",{onClick:Ea,className:"w-full px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-sm font-semibold",children:"Download Logbook Template (.xlsx)"})]})]}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Data Storage"}),e.jsxs("div",{className:"mt-2 space-y-3",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Manage files stored in the local browser repository for bulk updates or other operations."}),e.jsx("div",{className:"max-h-60 overflow-y-auto pr-2",children:e.jsxs("div",{className:"space-y-4",children:[Bt.map(Ee=>{const rn=lt.filter(vn=>vn.folderId===Ee.id),gt=Ee.isSub;return e.jsxs("div",{className:gt?"ml-8":"",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(J1,{}),e.jsx("h4",{className:"text-sm font-semibold text-gray-300",children:Ee.name})]}),e.jsx("div",{className:"pl-4 border-l-2 border-gray-600 ml-2.5",children:rn.length>0?e.jsx("ul",{className:"space-y-1 pt-2",children:rn.sort((vn,Un)=>vn.name.localeCompare(Un.name)).map(vn=>e.jsx(fr,{file:vn},vn.id))}):e.jsx("p",{className:"text-xs text-gray-500 italic pl-3 pt-1",children:"Empty"})})]},Ee.id)}),Js.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(J1,{}),e.jsx("h4",{className:"text-sm font-semibold text-gray-300",children:"Uncategorized"})]}),e.jsx("div",{className:"pl-4 border-l-2 border-gray-600 ml-2.5",children:e.jsx("ul",{className:"space-y-1 pt-2",children:Js.sort((Ee,rn)=>Ee.name.localeCompare(rn.name)).map(Ee=>e.jsx(fr,{file:Ee},Ee.id))})})]},"uncategorized")]})}),e.jsx("button",{onClick:ir,className:"w-full mt-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors text-sm font-semibold",children:"Upload File"})]})]})]})]}),vs("event-limits")&&e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 w-96 h-fit",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-200",children:"Events Limits"}),Re?e.jsx("button",{onClick:an,className:"px-3 py-1 bg-sky-600 text-white rounded-md hover:bg-sky-700 text-xs font-semibold",children:"Save"}):e.jsx("button",{onClick:Yt,disabled:!ce,className:`px-3 py-1 rounded-md text-xs font-semibold ${ce?"bg-gray-600 text-white hover:bg-gray-700 cursor-pointer":"bg-gray-700 text-gray-500 cursor-not-allowed"}`,children:"Edit"})]}),e.jsxs("div",{className:"p-4 space-y-4 max-h-96 overflow-y-auto",children:[e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Execs"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max Flight/FTD:"}),Re?e.jsx("input",{type:"number",value:Ze.exec.maxFlightFtd,onChange:Ee=>ot({...Ze,exec:{...Ze.exec,maxFlightFtd:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"1"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max Duty Sup:"}),Re?e.jsx("input",{type:"number",value:Ze.exec.maxDutySup,onChange:Ee=>ot({...Ze,exec:{...Ze.exec,maxDutySup:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"2"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max total all events:"}),Re?e.jsx("input",{type:"number",value:Ze.exec.maxTotal||2,onChange:Ee=>ot({...Ze,exec:{...Ze.exec,maxTotal:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"2"})]})]})]}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Staff"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max Flight/FTD:"}),Re?e.jsx("input",{type:"number",value:Ze.instructor.maxFlightFtd||2,onChange:Ee=>ot({...Ze,instructor:{...Ze.instructor,maxFlightFtd:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"2"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Staff (Flying Supervisor role assigned) - Max Duty Sup:"}),Re?e.jsx("input",{type:"number",value:Ze.instructor.maxDutySup,onChange:Ee=>ot({...Ze,instructor:{...Ze.instructor,maxDutySup:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"2"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max total all events:"}),Re?e.jsx("input",{type:"number",value:Ze.instructor.maxTotal||3,onChange:Ee=>ot({...Ze,instructor:{...Ze.instructor,maxTotal:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"3"})]})]})]}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Trainees"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max Flight/FTD:"}),Re?e.jsx("input",{type:"number",value:Ze.trainee.maxFlightFtd||1,onChange:Ee=>ot({...Ze,trainee:{...Ze.trainee,maxFlightFtd:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"1"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max total all events:"}),Re?e.jsx("input",{type:"number",value:Ze.trainee.maxTotal||2,onChange:Ee=>ot({...Ze,trainee:{maxTotal:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"2"})]})]})]}),e.jsxs("fieldset",{className:"p-3 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"SIM IPs"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max FTD:"}),Re?e.jsx("input",{type:"number",value:Ze.simIp.maxFtd||2,onChange:Ee=>ot({...Ze,simIp:{...Ze.simIp,maxFtd:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"2"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Max total all events:"}),Re?e.jsx("input",{type:"number",value:Ze.simIp.maxTotal||2,onChange:Ee=>ot({...Ze,simIp:{maxTotal:parseInt(Ee.target.value)||0}}),className:"w-12 bg-gray-700 border border-gray-600 rounded text-center text-white text-sm focus:outline-none focus:ring-sky-500"}):e.jsx("span",{className:"text-white font-mono",children:"2"})]})]})]})]})]}),vs("permissions")&&e.jsx(NA,{instructors:u,trainees:f,onUpdateInstructorPermission:(Ee,rn)=>{var _s;const gt=u.find(En=>En.idNumber===Ee),vn=((_s=gt==null?void 0:gt.permissions)==null?void 0:_s[0])||"None",Un=u.map(En=>En.idNumber===Ee?{...En,permissions:[rn]}:En);m(Un),Pn({page:"Settings - Permissions",action:"update",description:`Updated instructor permission: ${gt==null?void 0:gt.name}`,changes:`From: ${vn} To: ${rn}`})},onUpdateTraineePermission:(Ee,rn)=>{var _s;const gt=f.find(En=>En.idNumber===Ee),vn=((_s=gt==null?void 0:gt.permissions)==null?void 0:_s[0])||"None",Un=f.map(En=>En.idNumber===Ee?{...En,permissions:[rn]}:En);x(Un),Pn({page:"Settings - Permissions",action:"update",description:`Updated trainee permission: ${gt==null?void 0:gt.name}`,changes:`From: ${vn} To: ${rn}`})},onShowSuccess:E,currentUserPermission:Ne})]}),Vt&&e.jsx(mA,{onClose:()=>Pt(!1),phraseBank:R,onUpdatePhraseBank:Zs,initialTab:yn}),Kt&&e.jsx(rA,{onClose:()=>Mt(!1),onConfirm:Pi}),Mn&&Ve&&e.jsx(iA,{onClose:()=>jn(!1),onConfirm:Oa,fileName:Ve.name,folders:Bt.filter(Ee=>!Ee.isSub)}),je&&e.jsx(aA,{fileName:je.name,onConfirm:ja,onClose:()=>$e(null)}),Ye&&e.jsx(oA,{fileName:Ye.name,onConfirm:ci,onClose:()=>Dt(null)}),Ce&&St&&e.jsx(lA,{fileName:St.name,onConfirm:Do,onClose:()=>At(!1)}),B&&e.jsx(gA,{courses:sa,onConfirm:di,onClose:()=>Ae(!1),updateType:rt}),ts&&Nn&&e.jsx(cA,{rowData:Nn,onConfirm:gs,onCancel:Os}),ss&&e.jsx(dA,{message:Jn,onClose:()=>Hn(!1)}),Fn&&e.jsx(uA,{summary:Qn,onClose:()=>Rn(!1)})]})},jA=n=>{const[t,s]=C.useState("scoring-matrix"),i=[{id:"validation",label:"AC History",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})},{id:"timezone",label:"Timezone",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})},{id:"scoring-matrix",label:"Scoring Matrix",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z",clipRule:"evenodd"})]})},{id:"location",label:"Location",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})},{id:"units",label:"Units",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"})})},{id:"duty-turnaround",label:"Duty & Turnaround",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})})},{id:"sct-events",label:"SCT Events",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})})},{id:"currencies",label:"Currencies",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"}),e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z",clipRule:"evenodd"})]})},{id:"business-rules",label:"Business Rules",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4.75A.75.75 0 013.75 4h12.5a.75.75 0 010 1.5H3.75A.75.75 0 013 4.75zm0 4.5a.75.75 0 01.75-.75h12.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75zm0 4.5a.75.75 0 01.75-.75h12.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z",clipRule:"evenodd"})})},{id:"data-loaders",label:"Data Loaders",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})},{id:"event-limits",label:"Event Limits",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})},{id:"permissions",label:"Permissions",icon:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}];return e.jsxs("div",{className:"flex-1 flex overflow-hidden bg-gray-900",children:[e.jsxs("div",{className:"w-64 bg-gray-800 border-r border-gray-700 flex flex-col flex-shrink-0",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Configuration"})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto p-4 space-y-1",children:i.map(o=>e.jsx("button",{onClick:()=>s(o.id),className:`w-full text-left px-4 py-3 rounded-lg transition-all ${t===o.id?"bg-sky-600 text-white shadow-lg":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:e.jsxs("div",{className:"flex items-center space-x-3",children:[o.icon,e.jsx("span",{className:"font-medium",children:o.label})]})},o.id))}),e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(Qa,{pageName:"Settings"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-900",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-3",children:[t==="validation"&&"AC History",t==="timezone"&&"Timezone Settings",t==="scoring-matrix"&&"Scoring Matrix",t==="location"&&"Location",t==="units"&&"Units",t==="duty-turnaround"&&"Duty & Turnaround",t==="sct-events"&&"SCT Events",t==="currencies"&&"Currencies",t==="business-rules"&&"Business Rules",t==="data-loaders"&&"Data Loaders",t==="event-limits"&&"Event Limits",t==="permissions"&&"Permissions Manager"]}),!["Super Admin","Admin","Scheduler"].includes(n.currentUserPermission)&&e.jsx("div",{className:"text-sm text-yellow-200 bg-yellow-900/30 border border-yellow-600/50 rounded px-3 py-2 inline-block",children:e.jsx("strong",{children:"Read-Only Mode"})})]}),e.jsx(TA,{...n,hideHeader:!0,activeSection:t})]})})]})},EA=()=>e.jsx("div",{children:"Authorisation View Component"}),AA=({locality:n})=>e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[90] flex items-center justify-center animate-fade-in pointer-events-none",children:e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-xl border border-sky-500 p-12 max-w-2xl text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-sky-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-white",children:["Locality Changed to ",n]}),e.jsxs("p",{className:"mt-2 text-lg text-gray-300",children:["All subsequent scheduling and data modifications will now apply to the ",n," Daily Flying Program."]})]})]})})}),kA=({event:n,onReturn:t,onSave:s,school:i,traineesData:o,instructorsData:l})=>{var Bt,Kt;C.useMemo(()=>{const Mt=n.student||n.pilot;return o.find(Ve=>Ve.fullName===Mt)},[n,o]);const[d,u]=C.useState(""),[f,h]=C.useState("001"),[m,v]=C.useState(i),[x,y]=C.useState(i),[T,E]=C.useState(n.type==="flight"),[A,_]=C.useState(n.type==="ftd"),[R,H]=C.useState(n.flightType==="Solo"),[O,W]=C.useState(n.flightType==="Dual"),[ne,V]=C.useState(""),[U,D]=C.useState(""),[$,M]=C.useState(`${n.origin||i}-${n.destination||i} : ${n.flightNumber}`),[P,ae]=C.useState(""),[Q,Te]=C.useState(""),[Y,fe]=C.useState(""),[ge,Ne]=C.useState(""),[Oe,se]=C.useState(""),[F,X]=C.useState(""),[J,ee]=C.useState(!1),[K,ue]=C.useState(0),[xe,Le]=C.useState(!1),[ye,pe]=C.useState(0),[ce,He]=C.useState(!1),[_e,Z]=C.useState(0),[Fe,Xe]=C.useState(!1),[ft,tt]=C.useState(0),[We,Ke]=C.useState(!1),nt=C.useRef(null),[Ct,xt]=C.useState(!1),[dn,on]=C.useState("Saved"),st=C.useRef(!0),kt=Mt=>{if(!Mt)return"";const Ve=Mt.split(" ‚Äì ")[0],qt=l.find(jn=>jn.name===Ve);if(qt)return`${qt.rank} ${Ve.split(",")[0]}`;const Mn=o.find(jn=>jn.name===Ve||jn.fullName===Mt);return Mn?`${Mn.rank} ${Ve.split(",")[0]}`:Ve.split(",")[0]},Ge=C.useMemo(()=>{const Mt=je=>{const $e=je.replace(":","");if($e.length<4)return null;const Ye=parseInt($e.substring(0,2),10),Dt=parseInt($e.substring(2,4),10);return isNaN(Ye)||isNaN(Dt)?null:Ye*60+Dt},Ve=Mt(ne),qt=Mt(U);if(Ve===null||qt===null)return"0.0";let Mn=qt-Ve;return Mn<0&&(Mn+=1440),(Mn/60).toFixed(1)},[ne,U]);C.useEffect(()=>{const Mt=n.startTime,Ve=String(Math.floor(Mt)).padStart(2,"0"),qt=String(Math.round(Mt%1*60)).padStart(2,"0"),Mn=`${Ve}:${qt}`;V(Mn);const jn=n.landTime||n.startTime+n.duration,je=String(Math.floor(jn)).padStart(2,"0"),$e=String(Math.round(jn%1*60)).padStart(2,"0"),Ye=`${je}:${$e}`;D(Ye),nt.current||(nt.current={result:"",aircraftNumber:"001",from:i,to:i,isFlightLog:n.type==="flight",isFtdLog:n.type==="ftd",isSolo:n.flightType==="Solo",isDual:n.flightType==="Dual",duty:`${n.origin||i}-${n.destination||i} : ${n.flightNumber}`,takeoffTime:Mn,landTime:Ye,captainTime:"",instructorTime:"",nightTime:"",ifActualTime:"",ifSimTime:"",ineffectiveTime:"",ilsChecked:!1,ilsCount:0,rnpChecked:!1,rnpCount:0,tacanChecked:!1,tacanCount:0,vorChecked:!1,vorCount:0})},[n,i]),C.useEffect(()=>{O&&(Te(Ge),ae(Ge))},[O,Ge]);const ht=Mt=>{var kn,ts,un,Nn;const Ve=parseFloat(Ge)||0,qt=parseFloat(ge)||0,Mn=(xe?ye:0)+(ce?_e:0)+(Fe?ft:0),jn=J?K:0;let je=0,$e=0,Ye=0,Dt=0,St=0,hn=0,Ce=0,At="",B="",Ae=0;if(T)if(Mt==="Crew"&&R)Ae=0;else{Ae=Ve;const os=parseFloat(Y)||0,ss=Math.max(0,Ve-os);Mt==="Captain"?(je=ss,Ye=os,At=P||(O?Ge:""),O&&(B=Q||Ge)):Mt==="Crew"&&O&&($e=ss,Dt=os)}else A&&(Mt==="Crew"&&R?Ce=0:(Ce=Ve,Mt==="Captain"?B=Ge:Mt==="Crew"&&(hn=Ve)));const rt=new Date(n.date),yt=rt.getFullYear().toString().slice(-2),et=rt.toLocaleDateString("en-GB",{day:"2-digit",month:"short"}),$t=((ts=(kn=n.instructor||n.pilot)==null?void 0:kn.split(" ‚Äì ")[0])==null?void 0:ts.split(",")[0])||"",pn=((Nn=(un=n.student)==null?void 0:un.split(" ‚Äì ")[0])==null?void 0:Nn.split(",")[0])||(R?"Solo":"");return{year:yt,date:et,type:A?"FTD":"PC-21",tail:A?`FTD-${f}`:`A54-${f}`,captain:$t,crew:pn,duty:$,dayP1:je>0?je.toFixed(1):"",dayP2:"",dayDual:$e>0?$e.toFixed(1):"",nightP1:Ye>0?Ye.toFixed(1):"",nightP2:"",nightDual:Dt>0?Dt.toFixed(1):"",total:Ae>0?Ae.toFixed(1):"",captTime:At,instTime:B,simActual:qt>0?qt.toFixed(1):"",app2D:Mn>0?Mn:"",app3D:jn>0?jn:"",simP1:St>0?St.toFixed(1):"",simP2:"",simDual:hn>0?hn.toFixed(1):"",simTotal:Ce>0?Ce.toFixed(1):""}};C.useEffect(()=>{if(!nt.current)return;const Mt={result:d,aircraftNumber:f,from:m,to:x,isFlightLog:T,isFtdLog:A,isSolo:R,isDual:O,duty:$,takeoffTime:ne,landTime:U,captainTime:P,instructorTime:Q,nightTime:Y,ifActualTime:ge,ifSimTime:Oe,ineffectiveTime:F,ilsChecked:J,ilsCount:J?K:0,rnpChecked:xe,rnpCount:xe?ye:0,tacanChecked:ce,tacanCount:ce?_e:0,vorChecked:Fe,vorCount:Fe?ft:0},Ve={...nt.current,ilsCount:nt.current.ilsChecked?nt.current.ilsCount:0,rnpCount:nt.current.rnpChecked?nt.current.rnpCount:0,tacanCount:nt.current.tacanChecked?nt.current.tacanCount:0,vorCount:nt.current.vorChecked?nt.current.vorCount:0};JSON.stringify(Mt)!==JSON.stringify(Ve)&&(xt(!0),on("Saving..."))},[d,f,m,x,T,A,R,O,$,ne,U,P,Q,Y,ge,Oe,F,J,K,xe,ye,ce,_e,Fe,ft]);const vt=C.useMemo(()=>Array.from({length:49},(Mt,Ve)=>String(Ve+1).padStart(3,"0")),[]),Ht=Mt=>{const Ve=d;u(Mt),Ve&&Mt&&Ve!==Mt&&jo(`postflight-${n.id}-result`,"Edit",`Updated post-flight result for ${n.flightNumber}`)},ze=async(Mt=!1)=>{const Ve={result:d,aircraftNumber:f,from:m,to:x,isFlightLog:T,isFtdLog:A,isSolo:R,isDual:O,duty:$,takeoffTime:ne,landTime:U,totalTime:Ge,captainTime:P,instructorTime:Q,nightTime:Y,ifActualTime:ge,ifSimTime:Oe,ineffectiveTime:F,approaches:{ils:J?K:0,rnp:xe?ye:0,tacan:ce?_e:0,vor:Fe?ft:0}};if(!Mt){og();const jn=[];jn.push(`Result: ${d}`),ne&&jn.push(`Takeoff: ${ne}`),U&&jn.push(`Land: ${U}`),Ge&&jn.push(`Total Time: ${Ge}`),Pn({action:"Edit",description:`Saved post-flight data for ${n.flightNumber}`,changes:jn.join(", "),page:"Post-Flight"})}Mt||s(Ve);let qt="trainee_logbook",Mn=n.student;if((!Mn||Mn==="Multiple")&&(n.pilot?Mn=n.pilot:n.instructor&&(Mn=n.instructor,qt="staff_logbook")),Mn){const jn=Mn.split(" ‚Äì ")[0].replace(/,\s/g,"_"),je=`Entry_${n.date}_${n.flightNumber.replace(/\s/g,"")}_${jn}.json`;try{const $e=JSON.stringify(Ve,null,2),Ye=new File([$e],je,{type:"application/json"});await cd(Ye,qt,je)}catch($e){console.error("Failed to auto-save post-flight data to file:",$e)}}Mt||(xt(!1),on("Saved"))};C.useEffect(()=>{if(st.current){st.current=!1;return}if(Ct){const Mt=setTimeout(()=>{ze(!0),on("Saved"),xt(!1)},1e3);return()=>clearTimeout(Mt)}},[Ct,d,f,m,x,T,A,R,O,$,ne,U,P,Q,Y,ge,Oe,F,J,K,xe,ye,ce,_e,Fe,ft]);const we=()=>{Ct?Ke(!0):t()},Re=()=>{ze(!1)},be=(Mt,Ve)=>{let qt=Mt.target.value.replace(/[^0-9]/g,"");qt.length>4&&(qt=qt.substring(0,4)),qt.length>2&&(qt=qt.slice(0,2)+":"+qt.slice(2)),Ve(qt)},Ze=Mt=>{Mt.target.checked&&(E(!0),_(!1))},ot=Mt=>{Mt.target.checked&&(_(!0),E(!1))},Vt=Mt=>{const Ve=Mt.target.checked;H(Ve),W(!Ve)},Pt=Mt=>{const Ve=Mt.target.checked;W(Ve),H(!Ve)},yn=({value:Mt})=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"result",value:Mt,checked:d===Mt,onChange:Ve=>Ht(Ve.target.value),className:"h-4 w-4 accent-sky-500 bg-gray-600 border-gray-500"}),e.jsx("span",{className:"text-white",children:Mt})]}),Tt=({label:Mt,isChecked:Ve,setIsChecked:qt,count:Mn,setCount:jn})=>e.jsxs("div",{className:"flex-shrink-0 flex items-end space-x-1",children:[e.jsxs("label",{className:"flex items-center space-x-1 pb-2 cursor-pointer h-[38px]",children:[e.jsx("span",{className:"text-sm font-medium text-gray-400 w-10 text-right",children:Mt}),e.jsx("input",{type:"checkbox",checked:Ve,onChange:je=>{const $e=je.target.checked;qt($e),$e&&Mn===0&&jn(1)},className:"h-4 w-4 accent-sky-500 bg-gray-600 rounded border-gray-500"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400 mb-1",children:"Number"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:Mn===0?"":Mn,onChange:je=>jn(parseInt(je.target.value,10)||0),disabled:!Ve,className:"block w-10 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-1 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center disabled:bg-gray-800 disabled:text-gray-500 disabled:cursor-not-allowed"})]})]}),lt=({label:Mt,subLabel:Ve,value:qt,width:Mn,bgColor:jn="bg-gray-800",borderColor:je="border-gray-600",customTextClass:$e="text-xs"})=>e.jsxs("div",{className:`flex flex-col items-center justify-end ${Mn} flex-shrink-0 border-r ${je} last:border-r-0`,children:[(Mt||Ve)&&e.jsxs("div",{className:"w-full text-center border-b border-gray-700 bg-gray-900/30 py-0.5",children:[Mt&&e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase leading-tight",children:Mt}),Ve&&e.jsx("div",{className:"text-[8px] text-gray-500 leading-tight",children:Ve})]}),e.jsx("div",{className:`w-full ${jn} text-white ${$e} font-mono py-1.5 text-center truncate px-0.5 h-7`,children:qt})]}),Et=({title:Mt,data:Ve})=>e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-sm font-bold text-sky-400 mb-1 ml-1",children:Mt}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex flex-nowrap bg-gray-900 border border-gray-600 rounded-md min-w-max",children:[e.jsx(lt,{label:"Year",value:Ve.year,width:"w-10"}),e.jsx(lt,{label:"Date",value:Ve.date,width:"w-14"}),e.jsx(lt,{label:"Type",value:Ve.type,width:"w-12"}),e.jsx(lt,{label:"Tail",subLabel:"(Mark)",value:Ve.tail,width:"w-16"}),e.jsx(lt,{label:"Captain",value:Ve.captain,width:"w-24"}),e.jsx(lt,{label:"Co-Pilot /",subLabel:"Crew",value:Ve.crew,width:"w-24"}),e.jsx(lt,{label:"Duty",value:Ve.duty,width:"w-24",customTextClass:"text-[8px]"}),e.jsxs("div",{className:"flex flex-col border-r border-gray-600",children:[e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase text-center border-b border-gray-700 bg-gray-900/30",children:"Day Flying"}),e.jsxs("div",{className:"flex",children:[e.jsx(lt,{subLabel:"P1",value:Ve.dayP1,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"P2",value:Ve.dayP2,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"Dual",value:Ve.dayDual,width:"w-10",borderColor:"border-transparent"})]})]}),e.jsxs("div",{className:"flex flex-col border-r border-gray-600",children:[e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase text-center border-b border-gray-700 bg-gray-900/30",children:"Night Flying"}),e.jsxs("div",{className:"flex",children:[e.jsx(lt,{subLabel:"P1",value:Ve.nightP1,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"P2",value:Ve.nightP2,width:"w-10",borderColor:"border-gray-700"}),e.jsx(lt,{subLabel:"Dual",value:Ve.nightDual,width:"w-10",borderColor:"border-transparent"})]})]}),e.jsx(lt,{label:"TOTAL",value:Ve.total,width:"w-12",bgColor:"bg-gray-700/50"}),e.jsx(lt,{label:"Captain",value:Ve.captTime,width:"w-12"}),e.jsx(lt,{label:"Instructor",value:Ve.instTime,width:"w-12"}),e.jsx(lt,{label:"Sim",value:"",width:"w-10"})," ",e.jsx(lt,{label:"Actual",value:Ve.simActual,width:"w-10"}),e.jsx(lt,{label:"2D App",value:String(Ve.app2D),width:"w-10"}),e.jsx(lt,{label:"3D App",value:String(Ve.app3D),width:"w-10"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-[9px] font-bold text-gray-400 uppercase text-center border-b border-gray-700 bg-gray-900/30",children:"Simulator"}),e.jsxs("div",{className:"flex",children:[e.jsx(lt,{subLabel:"P1",value:Ve.simP1,width:"w-10",borderColor:"border-gray-700",bgColor:"bg-gray-800/50"}),e.jsx(lt,{subLabel:"P2",value:Ve.simP2,width:"w-10",borderColor:"border-gray-700",bgColor:"bg-gray-800/50"}),e.jsx(lt,{subLabel:"Dual",value:Ve.simDual,width:"w-10",borderColor:"border-gray-700",bgColor:"bg-gray-800/50"}),e.jsx(lt,{subLabel:"TOTAL",value:Ve.simTotal,width:"w-10",borderColor:"border-transparent",bgColor:"bg-gray-800/50"})]})]})]})})]});return e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 h-full",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-4 w-1/3",children:[e.jsx("span",{className:"font-bold text-white text-lg",children:n.flightNumber}),e.jsxs("div",{className:"flex items-center px-3 py-1 rounded-full bg-gray-900/50 border border-gray-700",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${dn==="Saved"?"bg-green-500":dn==="Saving..."?"bg-amber-500 animate-pulse":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-300 font-mono uppercase",children:dn==="Saved"?"Saved":dn})]})]}),e.jsx("h2",{className:"text-xl font-bold text-sky-400 text-center w-1/3",children:"POST FLIGHT TIMES"}),e.jsx("span",{className:"font-mono text-gray-300 text-lg w-1/3 text-right",children:n.date})]}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsxs("div",{className:"p-6 space-y-6 max-w-7xl mx-auto w-full",children:[e.jsx("div",{className:"flex items-start gap-6",children:e.jsxs("div",{className:"bg-gray-700/50 p-4 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Result"}),e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsx(yn,{value:"DCO"}),e.jsx(yn,{value:"DPCO"}),e.jsx(yn,{value:"DNCO"})]})]})}),e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-lg font-semibold text-gray-300",children:"Times"}),e.jsxs("div",{className:"mt-2 flex items-end space-x-4",children:[e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Flight"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:T,onChange:Ze,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"FTD"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:A,onChange:ot,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Solo"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:R,onChange:Vt,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-center",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Dual"}),e.jsx("div",{className:"mt-1 h-[38px] flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:O,onChange:Pt,className:"h-5 w-5 bg-gray-700 border-gray-600 rounded focus:ring-sky-500 focus:ring-offset-gray-800 accent-sky-500"})})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Date"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center",children:n.date})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Aircraft"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center",children:"PC-21"})]}),e.jsxs("div",{className:"flex-shrink-0",style:{width:"6.75rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Number"}),e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx("span",{className:"p-2 bg-gray-700 rounded-l-md text-white h-[38px] flex items-center",children:"A54-"}),e.jsx("select",{value:f,onChange:Mt=>h(Mt.target.value),className:"block w-full bg-gray-700 border border-gray-600 rounded-r-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm appearance-none text-center",children:vt.map(Mt=>e.jsx("option",{value:Mt,children:Mt},Mt))})]})]}),e.jsxs("div",{className:"flex-shrink-0",style:{width:"12rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Duty"}),e.jsx("input",{type:"text",value:$,onChange:Mt=>M(Mt.target.value),className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white text-xs focus:outline-none focus:ring-sky-500"})]}),e.jsxs("div",{className:"flex-1 min-w-0",style:{flexBasis:"8rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Captain/Instructor"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center truncate",children:(Bt=n.instructor||n.pilot)==null?void 0:Bt.split(" ‚Äì ")[0]})]}),e.jsxs("div",{className:"flex-1 min-w-0",style:{flexBasis:"6rem"},children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Crew/Trainee"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-700 rounded-md text-white h-[38px] flex items-center truncate",children:R?"Solo":(Kt=n.student)==null?void 0:Kt.split(" ‚Äì ")[0]})]})]}),e.jsxs("div",{className:"mt-4 flex items-end space-x-4 overflow-x-auto pb-2",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 text-center",children:"Route"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("input",{type:"text",value:m,onChange:Mt=>v(Mt.target.value.toUpperCase()),maxLength:3,placeholder:"From",className:"w-16 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-2 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center"}),e.jsx("input",{type:"text",value:x,onChange:Mt=>y(Mt.target.value.toUpperCase()),maxLength:3,placeholder:"To",className:"w-16 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center"})]})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Takeoff"}),e.jsx("input",{type:"text",value:ne,onChange:Mt=>be(Mt,V),placeholder:"HH:MM",className:"mt-1 block w-24 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Land"}),e.jsx("input",{type:"text",value:U,onChange:Mt=>be(Mt,D),placeholder:"HH:MM",className:"mt-1 block w-24 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Total"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-900/50 border border-gray-500 rounded-md text-white h-[38px] flex items-center justify-center font-mono w-20",children:Ge})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Captain"}),e.jsx("input",{type:"text",value:P,onChange:Mt=>ae(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Instructor"}),e.jsx("input",{type:"text",value:Q,onChange:Mt=>Te(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Night"}),e.jsx("input",{type:"text",value:Y,onChange:Mt=>fe(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"IF Actual"}),e.jsx("input",{type:"text",value:ge,onChange:Mt=>Ne(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"IF Sim"}),e.jsx("input",{type:"text",value:Oe,onChange:Mt=>se(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Ineffective"}),e.jsx("input",{type:"text",value:F,onChange:Mt=>X(Mt.target.value),placeholder:"0.0",className:"mt-1 block w-20 bg-gray-700 border border-gray-600 rounded-md h-[38px] py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm text-center font-mono"})]}),e.jsx(Tt,{label:"ILS/GLS",isChecked:J,setIsChecked:ee,count:K,setCount:ue}),e.jsx(Tt,{label:"RNP",isChecked:xe,setIsChecked:Le,count:ye,setCount:pe}),e.jsx(Tt,{label:"TACAN",isChecked:ce,setIsChecked:He,count:_e,setCount:Z}),e.jsx(Tt,{label:"VOR/DME",isChecked:Fe,setIsChecked:Xe,count:ft,setCount:tt})]})]}),e.jsx(Et,{title:`Captain's Log (${kt(n.instructor||n.pilot)})`,data:ht("Captain")}),!R&&e.jsx(Et,{title:`Crew's Log (${kt(n.student)})`,data:ht("Crew")})]})}),e.jsxs("div",{className:"flex-shrink-0 px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:Re,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 transition-colors text-sm font-semibold",children:"Save & Return"}),e.jsx("button",{onClick:we,className:"px-4 py-2 bg-transparent border border-gray-600 text-gray-300 rounded-md hover:bg-gray-700 hover:text-white transition-colors text-sm",children:"Return"}),e.jsx(Qa,{pageName:"Post-Flight"})]}),We&&e.jsx(Pv,{onSaveAndExit:()=>{Ke(!1),Re(),t()},onExitWithoutSaving:()=>{Ke(!1),t()},onCancel:()=>Ke(!1)})]})},il=({label:n,value:t,className:s=""})=>e.jsxs("div",{className:`bg-gray-700/50 p-3 rounded-lg ${s}`,children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 uppercase tracking-wider",children:n}),e.jsx("p",{className:"mt-1 text-md font-semibold text-white",children:t})]}),Vd=({title:n,items:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-sky-400 mb-2",children:n}),e.jsx("div",{className:"bg-gray-700/50 p-3 rounded-lg text-sm text-gray-300",children:t&&t.length>0?e.jsx("ul",{className:"space-y-1 list-disc list-inside",children:t.map((s,i)=>e.jsx("li",{children:s},i))}):e.jsx("p",{className:"italic text-gray-500",children:"None"})})]}),DA=(n,t)=>{const s={"2-5":{text:"text-green-300",bg:"bg-green-500/20"},1:{text:"text-amber-300",bg:"bg-amber-500/20"},0:{text:"text-red-300",bg:"bg-red-500/20"}},i=n>=2?"2-5":n===1?"1":"0";return s[i][t]},_A=n=>n.type==="Flight"?"Flight":n.type==="FTD"?"FTD":n.type==="Ground School"?n.code.includes("CPT")?"CPT":"Ground":"Flight",IA=({item:n,score:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white",children:n.code}),e.jsx("p",{className:"text-lg text-gray-400 mt-1",children:n.eventDescription})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Core Details"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:[e.jsx(il,{label:"Phase",value:n.phase}),e.jsx(il,{label:"Module",value:n.module}),e.jsx(il,{label:"Type",value:_A(n)}),e.jsx(il,{label:"Day/Night",value:n.dayNight||"Day"}),e.jsx(il,{label:"Dual/Solo",value:n.sortieType||"Dual"}),e.jsx(il,{label:"Total Event Hours",value:e.jsxs(e.Fragment,{children:[n.totalEventHours.toFixed(1)," ",e.jsx("span",{className:"text-sm font-normal",children:"hrs"})]})}),e.jsx(il,{label:"Flight/Sim Hours",value:e.jsxs(e.Fragment,{children:[n.flightOrSimHours.toFixed(1)," ",e.jsx("span",{className:"text-sm font-normal",children:"hrs"})]})})]})]}),t&&e.jsxs("fieldset",{className:"p-4 border border-sky-700 rounded-lg bg-sky-900/10",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-sky-300",children:"Trainee's Score"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2",children:[e.jsx(il,{label:"Overall Score",value:n.type==="Ground School"?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:"-"}),e.jsx("span",{className:"text-green-300",children:"Complete"})]}):e.jsx("span",{className:`text-xl ${DA(t.score,"text")}`,children:t.score})}),e.jsx(il,{label:"Date",value:t.date}),e.jsx(il,{label:"Instructor",value:t.instructor})]}),e.jsx("div",{className:"mt-4",children:e.jsx(il,{label:"Notes",value:e.jsx("p",{className:"whitespace-pre-wrap",children:t.notes})})})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Prerequisites"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-2",children:[e.jsx(Vd,{title:"Ground School",items:n.prerequisitesGround}),e.jsx(Vd,{title:"Sim/Flying",items:n.prerequisitesFlying})]})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Event Breakdown"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-2",children:[e.jsx(Vd,{title:"Methods of Delivery",items:n.methodOfDelivery}),e.jsx(Vd,{title:"Methods of Assessment",items:n.methodOfAssessment})]})]}),e.jsxs("fieldset",{className:"p-4 border border-gray-700 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Resources"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-2",children:[e.jsx(Vd,{title:"Physical Resources",items:n.resourcesPhysical}),e.jsx(Vd,{title:"Human Resources",items:n.resourcesHuman})]})]})]}),LA=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-400 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),MA=({trainee:n,traineeLmp:t,scores:s,onBack:i})=>{const[o,l]=C.useState(null),d=C.useMemo(()=>new Set(s.map(u=>u.event)),[s]);return C.useEffect(()=>{l(null)},[n.fullName]),e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Individual LMP"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[n.rank," ",n.name," - ",n.course]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors text-sm font-semibold shadow-md",children:"‚Üê Back - Trainee Profile"}),e.jsx(Qa,{pageName:"Individual LMP"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-row overflow-hidden",children:[e.jsx("div",{className:"w-1/4 border-r border-gray-700 overflow-y-auto",children:e.jsx("ul",{className:"p-2 space-y-1",children:t.map(u=>{const f=d.has(u.code);return e.jsx("li",{children:e.jsxs("button",{onClick:()=>l(u),className:`w-full text-left p-2 rounded-md transition-colors text-sm flex items-center space-x-2 ${(o==null?void 0:o.code)===u.code?"bg-sky-700 text-white font-semibold":"text-gray-300 hover:bg-gray-700/50"}`,children:[f?e.jsx(LA,{}):e.jsx("div",{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:u.code})]})},u.code)})})}),e.jsx("div",{className:"w-3/4 overflow-y-auto",children:e.jsx("div",{className:"p-6 max-w-5xl mx-auto",children:o?e.jsx(IA,{item:o,score:s.find(u=>u.event===o.code)}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 italic",children:"Select an item from the list to view its details."})})})})]})]})},FA=({trainee:n,instructors:t,scores:s,traineeLmp:i,onClose:o,onSave:l})=>{const[d,u]=C.useState(""),[f,h]=C.useState([]),[m,v]=C.useState({quantity:0,duration:1,instructor:""}),[x,y]=C.useState({quantity:0,duration:1.5,instructor:""}),[T,E]=C.useState({quantity:0,duration:1.5,instructor:""}),A=C.useMemo(()=>s.filter(D=>D.score===0||D.score===1).map(D=>i.find($=>$.id===D.event)).filter(D=>!!D).sort((D,$)=>new Date(s.find(M=>M.event===$.id).date).getTime()-new Date(s.find(M=>M.event===D.id).date).getTime()),[s,i]),_=C.useMemo(()=>{const $=i.map(M=>{const P=s.find(ae=>ae.event===M.id);return{item:M,score:P,date:P&&P.score>=0?new Date(P.date).getTime():null}}).filter(M=>M.score&&M.score.score>=0&&M.date!==null).sort((M,P)=>P.date-M.date);return $.length>0?$[0].item:null},[i,s]),R=C.useMemo(()=>{if(!_)return null;const D=i.findIndex($=>$.id===_.id);return D>=0&&D<i.length-1?i[D+1]:null},[i,_]),H=C.useMemo(()=>i.find(D=>D.id===d),[d,i]),O=C.useMemo(()=>H?{...H,code:`${H.code}-RF`,eventDescription:`Re-Fly: ${H.eventDescription}`}:null,[H]),W=()=>{const D=[];if(m.quantity>0&&m.instructor&&m.duration>0)for(let $=0;$<m.quantity;$++)D.push({id:_r(),type:"TUT",duration:m.duration,instructor:m.instructor});if(x.quantity>0&&x.instructor&&x.duration>0)for(let $=0;$<x.quantity;$++)D.push({id:_r(),type:"FTD",duration:x.duration,instructor:x.instructor});if(T.quantity>0&&T.instructor&&T.duration>0)for(let $=0;$<T.quantity;$++)D.push({id:_r(),type:"Flight",duration:T.duration,instructor:T.instructor});D.length>0?(h($=>[...$,...D]),v({quantity:0,duration:1,instructor:""}),y({quantity:0,duration:1.5,instructor:""}),E({quantity:0,duration:1.5,instructor:""})):alert("Please enter a quantity, duration, and instructor for at least one event type.")},ne=D=>{h($=>$.filter(M=>M.id!==D))},V=()=>{if(!H||f.length===0){alert("Please select an event to remediate and add at least one remedial event.");return}l(n,H,f)},U=({label:D,state:$,setState:M})=>e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("div",{className:"w-28 flex-shrink-0",children:e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:D})}),e.jsxs("div",{style:{width:"4.5rem"},children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Qty"}),e.jsx("input",{type:"number",min:"0",value:$.quantity,onChange:P=>M(ae=>({...ae,quantity:parseInt(P.target.value,10)||0})),className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white text-sm"})]}),e.jsxs("div",{style:{width:"6rem"},children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Dur (hrs)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:$.duration,onChange:P=>M(ae=>({...ae,duration:parseFloat(P.target.value)||0})),className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white text-sm"})]}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Instructor"}),e.jsxs("select",{value:$.instructor,onChange:P=>M(ae=>({...ae,instructor:P.target.value})),className:"mt-1 w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white text-sm",children:[e.jsx("option",{value:"",disabled:!0,children:"Select"}),t.map(P=>e.jsx("option",{value:P.name,children:P.name},P.idNumber))]})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[70] flex items-center justify-center animate-fade-in",onClick:o,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl border border-gray-700 flex flex-col h-[90vh]",onClick:D=>D.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-gray-700 bg-gray-900/50 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-sky-400",children:["Add Remedial Package for ",n.name]}),e.jsx("button",{onClick:o,className:"text-white hover:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6 space-y-6 flex-1 overflow-y-auto",children:[e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Step 1: Select Failed Event"}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:d,onChange:D=>u(D.target.value),className:"block w-full bg-gray-700 border border-gray-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-sky-500 sm:text-sm",size:"8",children:[e.jsx("option",{value:"",disabled:!0,children:"Select an event to remediate..."}),A.map(D=>e.jsx("option",{value:D.id,style:{color:(_==null?void 0:_.id)===D.id?"#ef4444":"#ffffff",fontWeight:(_==null?void 0:_.id)===D.id?"bold":"normal"},children:D.code},D.id))]}),_&&(()=>{const D=A.findIndex($=>$.id===_.id);if(D>=0){const $=document.querySelector('select[size="8"]');if($){const M=Math.max(0,D-3);$.selectedIndex=M,setTimeout(()=>{$.selectedIndex=d||-1},100)}}return null})()]}),e.jsxs("div",{className:"mt-2 text-xs space-y-1",children:[_&&e.jsxs("div",{className:"text-red-400",children:["Last completed: ",_.code]}),R&&e.jsxs("div",{className:"text-green-400",children:["Next event: ",R.code]})]})]})]}),H&&e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Step 2: Build Remedial Package"}),e.jsxs("div",{className:"mt-2 p-3 bg-gray-700/30 rounded-lg space-y-3",children:[e.jsx(U,{label:"Tutorials",state:m,setState:v}),e.jsx(U,{label:"FTDs",state:x,setState:y}),e.jsx(U,{label:"Flights",state:T,setState:E})]}),e.jsx("button",{onClick:W,className:"w-full mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 text-sm font-semibold",children:"Add Events to Package"}),e.jsx("div",{className:"mt-4 space-y-2",children:f.map(D=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-700/50 rounded-md text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"font-bold text-sky-400 w-16",children:D.type}),e.jsxs("span",{className:"text-gray-300",children:[D.duration.toFixed(1)," hrs with ",(D.instructor||"").split(",")[0]]})]}),e.jsx("button",{onClick:()=>ne(D.id),className:"p-1 text-gray-400 hover:text-red-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},D.id))})]}),O&&e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Step 3: Review Auto-Generated Re-Fly"}),e.jsxs("div",{className:"mt-2 p-3 bg-gray-700/30 rounded-lg",children:[e.jsxs("p",{className:"text-white font-semibold",children:[O.code," - ",O.eventDescription]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"This is a copy of the original event and will be added as the final step of the package."})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-800/50 border-t border-gray-700 flex justify-end space-x-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{onClick:V,disabled:!H||f.length===0,className:"px-4 py-2 bg-sky-600 text-white rounded-md hover:bg-sky-700 disabled:bg-gray-500 disabled:cursor-not-allowed",children:"Save
dist/assets/index-uPhlgI5U.js:bg-purple-400/50",startDate:"2025-07-01",gradDate:"2026-04-01",raafStart:18,navyStart:7,armyStart:0},{name:"ADF303",color:"bg-yellow-400/50",startDate:"2025-07-01",gradDate:"2026-02-01",raafStart:20,navyStart:5,armyStart:0},{name:"FIC 210",color:"bg-pink-400/50",startDate:"2025-10-01",gradDate:"2026-04-01",raafStart:4,navyStart:0,armyStart:0},{name:"FIC211",color:"bg-orange-400/50",startDate:"2025-12-01",gradDate:"2026-06-01",raafStart:8,navyStart:2,armyStart:0}],s_=[{name:"ADF304",color:"bg-teal-400/50",startDate:"2023-02-15",gradDate:"2023-07-20",raafStart:12,navyStart:0,armyStart:0},{name:"ADF305",color:"bg-indigo-400/50",startDate:"2023-04-10",gradDate:"2023-10-05",raafStart:10,navyStart:2,armyStart:0},{name:"IFF 6",color:"bg-cyan-400/50",startDate:"2023-06-01",gradDate:"2023-08-15",raafStart:4,navyStart:0,armyStart:0},{name:"FIC211",color:"bg-orange-400/50",startDate:"2025-12-01",gradDate:"2026-06-01",raafStart:8,navyStart:2,armyStart:0}],nN=n=>{const t=n==="ESL",s=t?n_:s_,i=t?15:12,o=XD(n);let l=[];s.forEach(_=>{const H=[{rank:"PLTOFF",count:_.raafStart+_.navyStart+_.armyStart}];l=[...l,...JD(_.name,H,t?"1FTS":"2FTS")]});const d=QD(l,o),u=ZD(d,qc,o),h=((_=new Date)=>{const O=new Date(_.getTime()+396e5),W=O.getUTCFullYear(),ne=String(O.getUTCMonth()+1).padStart(2,"0"),V=String(O.getUTCDate()).padStart(2,"0");return`${W}-${ne}-${V}`})();let m=e_(o,d,s,i,n,h);const v=t_(o,d,qc);m=[...m,...v];const x={},y=[],T=new Map,E={};s.forEach((_,R)=>{x[_.name]=_.color,y.push(_.name),T.set(_.name,Math.floor(100/s.length))});const A=new Map;return d.forEach(_=>A.set(_.fullName,qc)),{instructors:o,trainees:d,scores:u,pt051Assessments:new Map,courses:s,courseColors:x,archivedCourses:E,coursePriorities:y,coursePercentages:T,traineeLMPs:A,events:m}},Za=nN("ESL"),xv=nN("PEA"),r_=[{id:"aircrew-medical",name:"Aircrew Medical",description:"Annual aircrew medical check.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"combat-survival",name:"Combat Survival Refresher",description:"Annual combat survival training.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"live-fire",name:"W/PN Live Fire Licence",description:"Annual live fire qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"category-check",name:"Category Check",description:"Annual instructor category check.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"wpn-handling",name:"WPN Handing Test",description:"Annual weapon handling test.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"pft",name:"Physical Fitness Test",description:"Annual physical fitness test.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"arm",name:"Aviation Risk Management",description:"Annual ARM course.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"nts",name:"Non-Technical Skills",description:"Annual NTS training.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"alse-survival",name:"ALSE/Survival Theory",description:"Annual ALSE and survival theory.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"dinghy-drill",name:"Dinghy Drill",description:"Annual dinghy drill.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"pc21-life-support",name:"PC21 Life Support AF/BF Qualification",description:"Annual PC21 life support qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"pc21-training",name:"PC21 AF/BF/TA Training",description:"Annual PC21 training.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"avmed-refresher",name:"AVMED Refresher",description:"Annual AVMED refresher.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"duty-instructor",name:"Duty Instructor",description:"Annual duty instructor qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"fob",name:"Flying Order Book",description:"Annual FOB check.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"night-glide-solo",name:"Night Glide Solo",description:"Annual night glide solo qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"4-ship-wing",name:"4 Ship Wing",description:"Annual 4-ship wing qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"4-ship-lead",name:"4 Ship Lead",description:"Annual 4-ship lead qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"tac-form-wing",name:"Tac Form wing",description:"Annual tactical formation wing qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"tac-form-lead",name:"Tac Form Lead",description:"Annual tactical formation lead qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"if-currency-ride",name:"IF Currency Ride",description:"Annual instrument flight currency ride.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"low-flying",name:"Low Flying",description:"Annual low flying qualification.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"navigation",name:"Navigation",description:"Annual navigation check.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"dental",name:"Dental",description:"Annual dental check.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"pc21-emergency-check",name:"PC21 Emergency Check",description:"Annual PC21 emergency check.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"pc21-instrument-rating",name:"PC21 Instrument Rating Test",description:"Annual PC21 instrument rating test.",type:"primitive",isVisible:!0,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"pc21-day-gf-30d",name:"PC21 Day General Flying 30D",description:"At least one general flying event in last 30 days.",type:"primitive",isVisible:!0,validityDays:30,eventCodes:[],requiredCount:1,expiryRule:"ROLLING_WINDOW"},{id:"pc21-3-ia-90d",name:"PC21 3 Instrument Approach in 90 Days",description:"Three instrument approaches in last 90 days.",type:"primitive",isVisible:!0,validityDays:90,eventCodes:[],requiredCount:3,expiryRule:"ROLLING_WINDOW"},{id:"ia-3d-90d",name:"IA 3D PC21 90D",description:"3D instrument approach in last 90 days.",type:"primitive",isVisible:!0,validityDays:90,eventCodes:[],requiredCount:1,expiryRule:"ROLLING_WINDOW"},{id:"ia-2d-90d",name:"IA 2D PC21 90D",description:"2D instrument approach in last 90 days.",type:"primitive",isVisible:!0,validityDays:90,eventCodes:[],requiredCount:1,expiryRule:"ROLLING_WINDOW"},{id:"pc21-night-90d",name:"PC21 Night Flying 90D",description:"Night flying event in last 90 days.",type:"primitive",isVisible:!0,validityDays:90,eventCodes:[],requiredCount:1,expiryRule:"ROLLING_WINDOW"},{id:"wpn-9mm",name:"9mm Qualification",description:"Qualification on 9mm pistol.",type:"primitive",isVisible:!1,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"wpn-glock",name:"Glock Qualification",description:"Qualification on Glock pistol.",type:"primitive",isVisible:!1,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"},{id:"wpn-rifle",name:"Rifle Qualification",description:"Qualification on service rifle.",type:"primitive",isVisible:!1,validityDays:365,eventCodes:[],requiredCount:1,expiryRule:"LAST_EVENT_PLUS_PERIOD"}],i_=[{id:"day-go",name:"DAY GO",description:"Determines if a pilot is authorized for day flying operations.",type:"composite",isVisible:!0,expiryCalculation:"EARLIEST_CHILD",logicTree:{operator:"AND",children:["aircrew-medical","pft",{operator:"OR",children:["pc21-day-gf-30d","if-currency-ride"]}]}},{id:"if-go-no-go",name:"IF GO/NO GO",description:"Determines if a pilot is authorized for instrument flying operations.",type:"composite",isVisible:!0,expiryCalculation:"EARLIEST_CHILD",logicTree:{operator:"AND",children:["day-go","pc21-instrument-rating","pc21-3-ia-90d"]}},{id:"weapons-currency",name:"Weapons Currency",description:"Overall weapons qualification status.",type:"composite",isVisible:!0,expiryCalculation:"LATEST_CHILD",logicTree:{operator:"OR",children:["wpn-9mm","wpn-glock","wpn-rifle"]}}],a_=[{category:"Core Dimensions",elements:["Airmanship","Preparation","Technique"]},{category:"Procedural Framework",elements:["Pre-Post Flight","Walk Around","Strap-in","Ground Checks","Airborne Checks"]},{category:"Takeoff",elements:["Stationary"]},{category:"Departure",elements:["Visual"]},{category:"Core Handling Skills",elements:["Effects of Control","Trimming","Straight and Level"]},{category:"Turns",elements:["Level medium Turn","Level Steep turn"]},{category:"Recovery",elements:["Visual - Initial &amp; Pitch"]},{category:"Landing",elements:["Landing","Crosswind"]},{category:"Domestics",elements:["Radio Comms","Situational Awareness","Lookout","Knowledge"]}],o_=a_.flatMap(n=>n.elements),yv=(n,t)=>{if(!n||!t||n.duration<=0||t.duration<=0)return!1;const s=n.startTime+n.duration,i=t.startTime+t.duration;return n.startTime<i&&s>t.startTime},Ls=n=>{var i;const t=new Set;return((i=n.flightNumber)==null?void 0:i.startsWith("SCT"))?(n.pilot&&t.add(n.pilot),n.crew&&t.add(n.crew)):(n.instructor&&t.add(n.instructor),n.flightType==="Solo"?n.pilot&&t.add(n.pilot):n.student&&t.add(n.student)),n.attendees&&n.attendees.forEach(o=>t.add(o)),n.groupTraineeIds&&n.groupTraineeIds.length>0,Array.from(t)},Ra=(n,t)=>{const s=t.find(i=>i.id===n.flightNumber);if(s){const i=n.startTime-(s.preFlightTime||0),o=n.startTime+n.duration+(s.postFlightTime||0);return{start:i,end:o}}return{start:n.startTime,end:n.startTime+n.duration}},kl=(n,t)=>{const s=t.find(i=>i.id===n.flightNumber);if(s){const i=n.startTime-s.preFlightTime,o=n.startTime+n.duration+s.postFlightTime;return{start:i,end:o}}return{start:n.startTime,end:n.startTime+n.duration}},ic=(n,t,s)=>{if(s&&s.includes(n.flightNumber))return n.flightNumber==="Night SCT"?"Night":"Day";const i=t.find(o=>o.id===n.flightNumber);return i&&i.dayNight?i.dayNight:"Day"},Th=n=>{if(!n)return null;let t,s;if(n.includes(":")){const i=n.split(":").map(Number);if(i.length!==2||isNaN(i[0])||isNaN(i[1]))return null;[t,s]=i}else if(n.length===4&&/^\d{4}$/.test(n))t=parseInt(n.substring(0,2),10),s=parseInt(n.substring(2,4),10);else return null;return isNaN(t)||isNaN(s)||t<0||t>=24||s<0||s>=60?null:t+s/60},jh=n=>{const t=Math.floor(n),s=Math.round(n%1*60);return`${String(t).padStart(2,"0")}:${String(s).padStart(2,"0")}`},_m=(n,t,s,i=qc)=>{const o=[...t.filter(h=>Ls(h).includes(n)),s];if(o.length===0)return 0;const l=o.map(h=>kl(h,i)).sort((h,m)=>h.start-m.start),d=l[0].start;o.find(h=>kl(h,i).end===l[l.length-1].end);const u=l[l.length-1].end,f=Math.max(0,u-d);return parseFloat(f.toFixed(1))},l_=(n,t)=>{if(!n)return 999;const s=new Date(n+"T00:00:00Z"),i=new Date(t+"T00:00:00Z");return Math.floor((i.getTime()-s.getTime())/(1e3*60*60*24))},Li=(n,t,s,i,o)=>{if(!n.unavailability)return!1;for(const l of n.unavailability)if(l.allDay?i>=l.startDate&&i<l.endDate:i>=l.startDate&&i<=l.endDate){if(l.reason==="TMUF - Ground Duties only"&&o!=="flight")continue;if(l.allDay)return!0;const u=Th(l.startTime),f=Th(l.endTime);if(u!==null&&f!==null){let h=i===l.startDate?u:0,m=i===l.endDate?f:24;if(t<m&&s>h)return!0}else return!0}return!1},c_=(n,t,s)=>{const i=["A","B","C","D","E","F","G","H"],o=["S","T","U","V","W","X","Y","Z"],l=n,d=n+t,u=f=>s.some(h=>{if(h.type!=="flight"||h.area!==f)return!1;const m=h.startTime,v=h.startTime+h.duration;return l<v&&d>m});for(const f of i)if(!u(f))return f;for(const f of o)if(!u(f))return f;return null},d_=(n,t,s)=>{const i=new Date(s+"T00:00:00Z");i.setDate(i.getDate()-1);const o=i.toISOString().split("T")[0],l=t[o]||[];if(l.length===0)return null;const d=l.filter(h=>{var m;return h.student===n||((m=h.attendees)==null?void 0:m.includes(n))});if(d.length===0)return null;const u=d.filter(h=>{const m=!h.isCancelled,v=!h.isUnsuccessful;return m&&v});if(u.length===0)return null;const f=u.sort((h,m)=>m.startTime-h.startTime)[0];return console.log(`‚úì ELCE for ${n}: ${f.flightNumber} (completed ${o})`),f.flightNumber},tf=(n,t,s,i,o,l)=>{const d=t.has(n.fullName),u=t.get(n.fullName)||i;if(d){const y=u.filter(T=>T.isRemedial);y.length>0&&console.log(`üîç [${n.fullName}] Has Individual LMP with ${y.length} remedial events`)}else console.log(`‚ö†Ô∏è [${n.fullName}] Using Master LMP (no Individual LMP found)`);if(!u||u.length===0)return{next:null,plusOne:null};const f=s.get(n.fullName)||[],h=new Set(f.map(y=>y.event));if(o&&l){const y=d_(n.fullName,o,l);y&&h.add(y)}let m=null,v=null,x=-1;for(let y=0;y<u.length;y++){const T=u[y];if(h.has(T.id)||T.code.includes(" MB"))continue;if(T.prerequisites.every(A=>h.has(A))){m=T,x=y,T.isRemedial&&console.log(`‚úÖ [${n.fullName}] Next event is REMEDIAL: ${T.code}`);break}}if(x!==-1)for(let y=x+1;y<u.length;y++){const T=u[y];if(!T.code.includes(" MB")){v=T;break}}return{next:m,plusOne:v}};function u_(n,t,s,i,o,l,d){const u=new Map;return t.forEach(h=>{u.set(h,0)}),n.filter(h=>!h.isPaused).forEach(h=>{if(!t.includes(h.course))return;const{next:m,plusOne:v}=tf(h,s,i,o,l,d);if(m){const x=u.get(h.course)||0;u.set(h.course,x+1)}if(v){const x=u.get(h.course)||0;u.set(h.course,x+1)}}),u}function f_(n,t,s,i,o,l,d,u,f,h){const m=n.filter(P=>!P.flightNumber.includes("Duty Sup")&&!P.resourceId.startsWith("STBY")&&!P.resourceId.startsWith("BNF-STBY")),v=m.length,y=(P=>{const ae=Array.from(P.values()).reduce((Te,Y)=>Te+Y,0);if(ae===0)return P;const Q=new Map;return P.forEach((Te,Y)=>{Q.set(Y,Te/ae*100)}),Q})(t),T=new Map,E=new Map;s.forEach(P=>{T.set(P,0),E.set(P,{flight:0,ftd:0,cpt:0,ground:0})}),m.forEach(P=>{const ae=l.find(Q=>Q.fullName===P.student||Q.fullName===P.pilot);if(ae&&s.includes(ae.course)){const Q=ae.course;T.set(Q,(T.get(Q)||0)+1);const Te=E.get(Q);P.type==="flight"?Te.flight++:P.type==="ftd"?Te.ftd++:P.type==="cpt"?Te.cpt++:P.type==="ground"&&Te.ground++}});const A=u_(l,s,d,u,f,h,o),_=s.map(P=>{const ae=y.get(P)||0,Q=T.get(P)||0,Te=A.get(P)||0,Y=v>0?Q/v*100:0,fe=Y-ae,ge=Te>0?Q/Te*100:0;let Ne;return Math.abs(fe)<=5?Ne="good":Math.abs(fe)<=10?Ne="fair":Ne="poor",{courseName:P,targetPercentage:ae,actualPercentage:Y,deviation:fe,eventCount:Q,possibleEvents:Te,schedulingEfficiency:ge,eventsByType:E.get(P)||{flight:0,ftd:0,cpt:0,ground:0},limitingFactors:{insufficientInstructors:0,noAircraftSlots:0,noFtdSlots:0,noCptSlots:0,traineeLimit:0,instructorLimit:0,noTimeSlots:0},status:Ne}}),R=new Map;for(let P=0;P<24;P++)R.set(P,0);m.forEach(P=>{const ae=Math.floor(P.startTime);R.set(ae,(R.get(ae)||0)+1)});const H=v/24;let O=0;R.forEach(P=>{O+=Math.abs(P-H)}),O=O/(v*2);const W=1-O,ne=m.filter(P=>P.type==="flight").length;m.filter(P=>P.type==="ftd").length;const V=n.filter(P=>P.resourceId.startsWith("STBY")||P.resourceId.startsWith("BNF-STBY")).length,U=i>0?ne/i*100:0,D=[],$=_.every(P=>P.status==="good"),M=_.some(P=>P.status==="poor");return $?D.push({type:"success",message:"Excellent! All courses achieved their target percentages within ¬±5%.",recommendation:"Current settings are optimal. Continue monitoring future builds."}):M?D.push({type:"warning",message:"Some courses deviated significantly from targets (>10%).",recommendation:"Review resource constraints and unavailability periods. Consider adjusting percentages or increasing resources."}):D.push({type:"info",message:"Most courses achieved their targets. Minor deviations detected.",recommendation:"Monitor trends over multiple builds. Small deviations are normal with limited resources."}),W>.8?D.push({type:"success",message:"Events are well-distributed throughout the day.",recommendation:"Random shuffle is working effectively to prevent clustering."}):W<.6&&D.push({type:"warning",message:"Events show some clustering in certain time periods.",recommendation:"This may be due to resource constraints or unavailability. Review instructor and aircraft availability."}),U>90?D.push({type:"success",message:`High aircraft utilization (${U.toFixed(0)}%).`,recommendation:"Resources are being used efficiently."}):U<60&&D.push({type:"info",message:`Aircraft utilization is ${U.toFixed(0)}%.`,recommendation:"Consider reducing available aircraft count or increasing trainee demand."}),V>0&&D.push({type:"warning",message:`${V} events placed on standby.`,recommendation:"These trainees could not be scheduled due to resource constraints. Consider increasing resources or adjusting schedules."}),{buildDate:o,totalEvents:v,availableAircraft:i,courseAnalysis:_,timeDistribution:{eventsByHour:R,clusteringScore:O,uniformityScore:W},resourceUtilization:{aircraftUtilization:U,instructorUtilization:0,ftdUtilization:0,standbyCount:V},insights:D}}function h_(n,t,s){const{instructors:i,trainees:o,syllabus:l,scores:d,coursePriorities:u,coursePercentages:f,availableAircraftCount:h,ftdCount:m,cptCount:v,courseColors:x,school:y,dayStart:T,dayEnd:E,ftdStart:A,ftdEnd:_,allowNightFlying:R,commenceNightFlying:H,ceaseNightFlying:O,buildDate:W,highestPriorityEvents:ne,programWithPrimaries:V,traineeLMPs:U,flightTurnaround:D,ftdTurnaround:$,cptTurnaround:M,preferredDutyPeriod:P,maxCrewDutyPeriod:ae,eventLimits:Q,sctFtds:Te,sctFlights:Y,remedialRequests:fe,sctEvents:ge,getEventDayNightClassification:Ne}=n,Oe=(je,$e)=>{const Dt=($e?[...K,$e]:K).filter(At=>Ls(At).includes(je));if(Dt.length===0)return 0;const St=Dt.map(At=>kl(At,l)).sort((At,B)=>At.start-B.start);let hn=0,Ce=null;for(const At of St){let B=At.start,Ae=At.end;const rt=Math.max(B,T),yt=Math.min(Ae,E);let et=0,$t=0;ce.bnf.length>=2&&(et=Math.max(B,H),$t=Math.min(Ae,O)),rt<yt&&(Ce?rt<=Ce.end?Ce.end=Math.max(Ce.end,yt):(hn+=Ce.end-Ce.start,Ce={start:rt,end:yt}):Ce={start:rt,end:yt}),et<$t&&ce.bnf.length>=2&&(Ce?et<=Ce.end?Ce.end=Math.max(Ce.end,$t):(hn+=Ce.end-Ce.start,Ce={start:et,end:$t}):Ce={start:et,end:$t})}return Ce&&(hn+=Ce.end-Ce.start),hn},se=new Set,F=je=>K.some(Ye=>{if(!Ls(Ye).includes(je))return!1;const Dt=Ne(Ye,l,ge);return Dt==="Day"||Dt==="Day/Night"}),X=je=>ce.bnf.length<2?!1:K.some(Ye=>{if(!Ls(Ye).includes(je))return!1;const Dt=Ne(Ye,l,ge);return Dt==="Night"||Dt==="Day/Night"})||se.has(je);t({message:"Initializing DFP build...",percentage:0});const J=s[W]||[];console.log(`üîµ Active DFP has ${J.length} events for ${W}`);const ee=J.map(je=>{const{date:$e,...Ye}=je;return Ye});let K=[...ee];const ue=new Map;i.forEach(je=>ue.set(je.name,{flightFtd:0,ground:0,cpt:0,dutySup:0,isStby:!1})),o.forEach(je=>ue.set(je.fullName,{flightFtd:0,ground:0,cpt:0,dutySup:0,isStby:!1})),console.log("üîµ Initializing event counts from Active DFP..."),ee.forEach(je=>{Ls(je).forEach($e=>{const Ye=ue.get($e);Ye&&(je.type==="flight"||je.type==="ftd"?(Ye.flightFtd++,console.log(`  üîµ ${$e}: flight/ftd count = ${Ye.flightFtd}`)):je.type==="ground"?Ye.ground++:je.type==="cpt"&&Ye.cpt++)})}),console.log("DEBUG ===== BUILD ALGORITHM: PROCESSING HIGHEST PRIORITY EVENTS ====="),console.log(`DEBUG Total Highest Priority Events to check: ${ne.length}`),console.log(`DEBUG Build Date: ${W}`);let xe=0,Le=0;ne.forEach(je=>{if(console.log(`DEBUG Checking event: ${je.flightNumber} - ${je.student||je.pilot||"N/A"} (ID: ${je.id})`),console.log(`  - event.date: ${je.date}, buildDate: ${W}, match: ${je.date===W}`),console.log(`  - event.isTimeFixed: ${je.isTimeFixed}`),je.date===W&&je.isTimeFixed){const{date:$e,...Ye}=je;!Ye.pilot&&Ye.instructor&&(Ye.pilot=Ye.instructor),K.push(Ye),xe++,console.log(`  ‚úì DEBUG INCLUDED in build (ID: ${je.id})`),console.log(`  - pilot: ${Ye.pilot}, instructor: ${Ye.instructor}, student: ${Ye.student}`),Ls(je).forEach(Dt=>{const St=ue.get(Dt);St&&(je.type==="flight"||je.type==="ftd")?St.flightFtd++:St&&je.type==="ground"?St.ground++:St&&je.type==="cpt"&&St.cpt++})}else Le++,console.log(`  ‚úó DEBUG SKIPPED - Reason: ${je.date!==W?"date mismatch":"isTimeFixed is false"}`)}),console.log(`DEBUG Summary: ${xe} events INCLUDED, ${Le} events SKIPPED`),console.log("DEBUG ===== BUILD ALGORITHM: HIGHEST PRIORITY PROCESSING COMPLETE ====="),console.log("DEBUG ===== ASSIGNING RESOURCES TO HIGHEST PRIORITY EVENTS ====="),K.forEach(je=>{if(!je.resourceId||je.resourceId===""){const $e=je.type==="flight"?"PC-21 ":je.type==="ftd"?"FTD ":je.type==="cpt"?"CPT ":"Ground ",Ye=je.type==="flight"?h:je.type==="ftd"?m:je.type==="cpt"?v:6;let Dt=null;for(let St=1;St<=Ye;St++){const hn=`${$e}${St}`;if(!K.some(At=>At.resourceId===hn&&At.id!==je.id&&At.startTime<je.startTime+je.duration&&At.startTime+At.duration>je.startTime)){Dt=hn;break}}Dt?(je.resourceId=Dt,console.log(`DEBUG Assigned ${Dt} to highest priority event: ${je.flightNumber} - ${je.student||je.pilot||"N/A"}`)):console.warn(`DEBUG Could not find available resource for: ${je.flightNumber}`)}}),console.log("DEBUG ===== RESOURCE ASSIGNMENT COMPLETE ====="),t({message:'Compiling "Next Event" lists...',percentage:10});const ye=o.filter(je=>!je.isPaused&&!Li(je,T,O,W,"flight")),pe=new Map;ye.forEach(je=>{const $e=tf(je,U,d,l,s,W);pe.set(je.fullName,$e)});const ce={flight:[],ftd:[],cpt:[],ground:[],bnf:[]},He={flight:[],ftd:[],cpt:[],ground:[]};ye.forEach(je=>{const{next:$e,plusOne:Ye}=pe.get(je.fullName)||{next:null,plusOne:null};$e&&($e.code.startsWith("BNF")&&$e.type==="Flight"?F(je.fullName)?(console.log(`üåô ‚ùå ${je.fullName} excluded from BNF - has day events (Active DFP or NEO-Build)`),ce.flight.push(je)):ce.bnf.push(je):$e.type==="Flight"?ce.flight.push(je):$e.type==="FTD"?ce.ftd.push(je):$e.type==="Ground School"&&$e.methodOfDelivery.includes("CPT")?ce.cpt.push(je):$e.type==="Ground School"&&ce.ground.push(je),Ye&&(Ye.type==="Flight"?He.flight.push(je):Ye.type==="FTD"?He.ftd.push(je):Ye.type==="Ground School"&&Ye.methodOfDelivery.includes("CPT")?He.cpt.push(je):Ye.type==="Ground School"&&He.ground.push(je)))}),new Set(ce.bnf.map(je=>je.fullName)),t({message:"Ranking trainees...",percentage:20});const _e=je=>{const $e=ye.filter(St=>St.course===je);if($e.length===0)return 0;const Ye=$e.map(St=>(d.get(St.fullName)||[]).filter(hn=>!hn.event.includes("-REM-")&&!hn.event.includes("-RF")).length).sort((St,hn)=>St-hn),Dt=Math.floor(Ye.length/2);return Ye.length%2!==0?Ye[Dt]:(Ye[Dt-1]+Ye[Dt])/2},Z=new Map;u.forEach(je=>Z.set(je,_e(je)));const Fe=new Date(W+"T00:00:00Z"),Xe=je=>{if(!je)return 999;const $e=new Date(je+"T00:00:00Z");return Math.floor((Fe.getTime()-$e.getTime())/(1e3*3600*24))},ft=(je,$e)=>{const Ye=Xe(je.lastEventDate),Dt=Xe($e.lastEventDate);if(Ye!==Dt)return Dt-Ye;const St=Xe(je.lastFlightDate),hn=Xe($e.lastFlightDate);if(St!==hn)return hn-St;const Ce=Z.get(je.course)||0,At=Z.get($e.course)||0,B=(d.get(je.fullName)||[]).filter(et=>!et.event.includes("-REM-")&&!et.event.includes("-RF")).length,Ae=(d.get($e.fullName)||[]).filter(et=>!et.event.includes("-REM-")&&!et.event.includes("-RF")).length,rt=Ce-B,yt=At-Ae;return rt!==yt?yt-rt:je.name.localeCompare($e.name)};Object.values(ce).forEach(je=>je.sort(ft)),Object.values(He).forEach(je=>je.sort(ft));const tt=je=>{const $e=[];if(je.forEach((Ce,At)=>{var Ae;const B=(Ae=pe.get(Ce.fullName))==null?void 0:Ae.next;B&&B.sortieType==="Solo"&&B.twrDiReqd==="YES"&&$e.push(At)}),$e.length<=1)return je;const Ye=$e[0],Dt=$e.slice(1),St=[],hn=[];return Dt.forEach(Ce=>{hn.push(je[Ce])}),je.forEach((Ce,At)=>{Dt.includes(At)||(St.push(Ce),At===Ye&&St.push(...hn))}),St};ce.flight=tt(ce.flight),t({message:"Allocating course slots...",percentage:30});const We=je=>{const $e=Array.from(je.values()).reduce((Dt,St)=>Dt+St,0);if($e===0)return je;const Ye=new Map;return je.forEach((Dt,St)=>{Ye.set(St,Dt/$e*100)}),Ye},Ke=(je,$e)=>{const Ye=new Map;return je.forEach((Dt,St)=>{Ye.set(St,Math.max(Dt,$e))}),We(Ye)},nt=je=>{if(!je.length)return[];const $e=[];je.forEach((yt,et)=>{var pn;const $t=(pn=pe.get(yt.fullName))==null?void 0:pn.next;$t&&$t.sortieType==="Solo"&&$t.twrDiReqd==="YES"&&$e.push(et)});let Ye=[],Dt=-1,St=[];$e.length>=2?(Dt=$e[0],$e.forEach(yt=>{Ye.push(je[yt])}),je.forEach((yt,et)=>{$e.includes(et)||St.push(yt)})):St=[...je];const hn=We(f),Ce=Ke(hn,5),At=new Map;u.forEach(yt=>At.set(yt,[])),St.forEach(yt=>{var et;return(et=At.get(yt.course))==null?void 0:et.push(yt)});const B=[],Ae=new Map;u.forEach(yt=>Ae.set(yt,0));let rt=0;for(;B.length<St.length;){rt++;let yt=-1/0,et=null;for(const $t of u){const pn=At.get($t);if(!pn||pn.length===0)continue;const kn=Ae.get($t)||0,Nn=(Ce.get($t)||0)/100*rt-kn;Nn>yt&&(yt=Nn,et=$t)}if(et){const pn=At.get(et).shift();B.push(pn),Ae.set(et,(Ae.get(et)||0)+1)}else break}if(Ye.length>=2){const yt=[];let et=!1,$t=0;for(let pn=0;pn<Dt;pn++)$e.includes(pn)||$t++;for(let pn=0;pn<B.length;pn++)pn===$t&&!et&&(yt.push(...Ye),et=!0),yt.push(B[pn]);return et||yt.push(...Ye),yt}else return B},Ct=new Set(ce.bnf.map(je=>je.fullName)),xt=je=>ce.bnf.length>=2?je.filter($e=>!Ct.has($e.fullName)):je,dn=new Map;let on=[...i.map(je=>({...je,unavailability:[...je.unavailability||[]]}))];if(ce.bnf.length>=2){const je=ce.bnf.length,$e=je,Ye=H,Dt=O;console.log("üåô ===== NIGHT INSTRUCTOR SELECTION ====="),console.log(`üåô Need ${$e} instructors for ${je} BNF trainees`);const St=i.filter(At=>At.role!=="QFI"||Li(At,Ye,Dt,W,"flight")?!1:F(At.name)?(console.log(`üåô ‚ùå ${At.name} excluded - has day events (Active DFP or NEO-Build)`),!1):(console.log(`üåô ‚úÖ ${At.name} eligible for night flying`),!0));console.log(`üåô Eligible pool: ${St.length} instructors`);const hn=[...St].sort(()=>.5-Math.random()).slice(0,$e);console.log(`üåô Selected instructors: ${hn.map(At=>At.name).join(", ")}`);const Ce=ce.bnf;hn.forEach((At,B)=>{const Ae=Ce[B];if(Ae){dn.set(Ae.fullName,At.name),se.add(At.name);const rt=on.find(yt=>yt.idNumber===At.idNumber);if(rt){const yt={id:`night-res-${At.idNumber}`,startDate:W,endDate:W,allDay:!1,startTime:jh(T),endTime:jh(E),reason:"Other",notes:"Reserved for Night Flying"};rt.unavailability.push(yt)}}})}const st=(je,$e,Ye,Dt,St,hn,Ce)=>{const At=$e==="flight"?.08333333333333333:.25,B=`${Ce?"BNF":$e.toUpperCase()} ${Ye?"Next+1":"Next"}`;t({message:`Placing ${B} events...`,percentage:40+["flight","ftd","cpt","ground"].indexOf($e)*10});let Ae=[...je],rt=!0;const yt=[];if(($e==="cpt"||$e==="ground")&&!Ce)for(let $t=Dt;$t<St;$t+=2)yt.push({start:$t,end:$t+2,count:0});for(;rt&&Ae.length>0;){rt=!1;const et=[];for(const $t of Ae){const{next:pn,plusOne:kn}=pe.get($t.fullName),ts=Ye?kn:pn;if(!ts)continue;let un=Dt;if(Ye){const Hn=K.find(Jn=>Ls(Jn).includes($t.fullName)&&Jn.flightNumber===pn.id);if(!Hn){et.push($t);continue}un=Math.max(Dt,Hn.startTime+Hn.duration)}const Nn=[...yt].sort((Hn,Jn)=>Hn.count-Jn.count||Hn.start-Jn.start);let os=!1;const ss=($e==="cpt"||$e==="ground")&&!Ce&&yt.length>0?Nn.map(Hn=>({start:Math.max(un,Hn.start),end:Hn.end})):[{start:un,end:St}];for(const Hn of ss){if(os)break;for(let Jn=Hn.start;Jn<=Hn.end-ts.duration;Jn+=At){const zn=kt($t,ts,Jn,$e,Ce,Ye);if(zn&&typeof zn=="object"&&"id"in zn){K.push(zn);const Fn=zn.instructor?ue.get(zn.instructor):null,Rn=ue.get($t.fullName);if($e==="flight"||$e==="ftd"?(Rn.flightFtd++,Fn&&Fn.flightFtd++):$e==="ground"?(Rn.ground++,Fn&&Fn.ground++):$e==="cpt"&&(Rn.cpt++,Fn&&Fn.cpt++),$e==="cpt"||$e==="ground"){const Qn=yt.find(as=>Jn>=as.start&&Jn<as.end);Qn&&Qn.count++}os=!0,rt=!0;break}}}os||et.push($t)}Ae=et}},kt=(je,$e,Ye,Dt,St,hn)=>{const Ce=ue.get(je.fullName),At=$e.code.startsWith("BNF")&&$e.type==="Flight",B=At?2:Q.trainee.maxFlightFtd;if(Dt==="flight"||Dt==="ftd"){if(Ce.flightFtd>=B)return null}else if(Ce.ground>=2)return null;const Ae=At?4:Q.trainee.maxTotal;if(Ce.flightFtd+Ce.ground+Ce.cpt>=Ae)return null;const rt=kl({startTime:Ye,flightNumber:$e.id,duration:$e.duration},l);if(Li(je,rt.start,rt.end,W,Dt))return null;const yt=(Nn,os,ss)=>{if(os.code.startsWith("BNF")){const zn=dn.get(Nn.fullName);if(!zn)return null;const Fn=on.find(_n=>_n.name===zn);if(!Fn||Li(Fn,rt.start,rt.end,W,"flight"))return null;const Rn=ue.get(Fn.name),Qn=Q.exec.maxFlightFtd,as=Q.instructor.maxFlightFtd,cs=Q.instructor.maxTotal,rs={...rt,instructor:Fn.name,flightNumber:os.id,type:os.type},Ms=Oe(Fn.name,rs);if(Ms>P)return console.log(`SOFT LIMIT VIOLATION: ${Fn.name} would exceed ${P}hrs (current: ${Ms.toFixed(2)}hrs)`),null;if(Fn.isExecutive){if(St){if(Rn.flightFtd+Rn.ground+Rn.cpt>=cs)return null}else if(Rn.flightFtd>=Qn)return null}else if(Rn.flightFtd>=as||Rn.flightFtd+Rn.ground+Rn.cpt+Rn.dutySup>=cs||Fn.isFlyingSupervisor&&Rn.dutySup>=Q.instructor.maxDutySup)return null;if(K.filter(_n=>!_n.resourceId.startsWith("STBY")&&!_n.resourceId.startsWith("BNF-STBY")).some(_n=>{if(!Ls(_n).includes(Fn.name))return!1;const rr=kl(_n,l);return rt.start<rr.end&&rt.end>rr.start}))return null;if(St&&ss){const{next:_n}=pe.get(Nn.fullName),rr=K.find(Cs=>Cs.flightNumber===(_n==null?void 0:_n.id)&&Ls(Cs).includes(Nn.fullName)&&Ls(Cs).includes(Fn.name));if(rr){const Cs=l.find(Ds=>Ds.id===rr.flightNumber),js=os;((Cs==null?void 0:Cs.postFlightTime)||0)+(js.preFlightTime||0);const Cr=rr.startTime+rr.duration+((Cs==null?void 0:Cs.postFlightTime)||0);if(Ye-(os.preFlightTime||0)<Cr)return null}}return Fn}let Jn=[];if(Dt==="ftd"){const zn=on.filter(Qn=>Qn.role==="SIM IP"&&!(ce.bnf.length>=2&&X(Qn.name))).sort((Qn,as)=>{var cs,rs;return(((cs=ue.get(Qn.name))==null?void 0:cs.flightFtd)||0)-(((rs=ue.get(as.name))==null?void 0:rs.flightFtd)||0)}),Fn=on.filter(Qn=>Qn.role==="QFI"&&!(ce.bnf.length>=2&&X(Qn.name)));let Rn=[];if(V){const Qn=[Nn.primaryInstructor,Nn.secondaryInstructor].filter(Boolean),as=Fn.filter(rs=>Qn.includes(rs.name)),cs=Fn.filter(rs=>!Qn.includes(rs.name));as.sort((rs,Ms)=>{var hs,_n;return(((hs=ue.get(rs.name))==null?void 0:hs.flightFtd)||0)-(((_n=ue.get(Ms.name))==null?void 0:_n.flightFtd)||0)}),cs.sort((rs,Ms)=>{var hs,_n;return(((hs=ue.get(rs.name))==null?void 0:hs.flightFtd)||0)-(((_n=ue.get(Ms.name))==null?void 0:_n.flightFtd)||0)}),Rn=[...as,...cs]}else Rn=Fn.sort((Qn,as)=>{var cs,rs;return(((cs=ue.get(Qn.name))==null?void 0:cs.flightFtd)||0)-(((rs=ue.get(as.name))==null?void 0:rs.flightFtd)||0)});Jn=[...zn,...Rn]}else{const zn=on.filter(Fn=>{const Rn=Fn.role==="QFI";return!(Dt==="flight"&&!Rn||ce.bnf.length>=2&&X(Fn.name))});if(V){const Fn=[Nn.primaryInstructor,Nn.secondaryInstructor].filter(Boolean),Rn=zn.filter(as=>Fn.includes(as.name)),Qn=zn.filter(as=>!Fn.includes(as.name));Qn.sort((as,cs)=>{var hs,_n;const rs=((hs=ue.get(as.name))==null?void 0:hs.flightFtd)||0,Ms=((_n=ue.get(cs.name))==null?void 0:_n.flightFtd)||0;return rs!==Ms?rs-Ms:as.name.localeCompare(cs.name)}),Jn=[...Rn,...Qn]}else Jn=zn.sort((Fn,Rn)=>{var cs,rs;const Qn=((cs=ue.get(Fn.name))==null?void 0:cs.flightFtd)||0,as=((rs=ue.get(Rn.name))==null?void 0:rs.flightFtd)||0;return Qn!==as?Qn-as:Fn.name.localeCompare(Rn.name)})}for(const zn of Jn){const Fn=Dt==="cpt"?"ground":Dt;if(Li(zn,rt.start,rt.end,W,Fn))continue;const Rn=ue.get(zn.name),Qn={...rt,instructor:zn.name,flightNumber:os.id,type:os.type},as=Oe(zn.name,Qn);if(as>P){console.log(`SOFT LIMIT VIOLATION: ${zn.name} would exceed ${P}hrs (current: ${as.toFixed(2)}hrs)`);continue}if(Fn==="ground"){const hs=Rn.flightFtd>0?1:4;if(Rn.ground>=hs)continue}if(zn.isExecutive){if(St&&(Fn==="flight"||Fn==="ftd")){if(Rn.flightFtd+Rn.ground+Rn.cpt>=Q.exec.maxTotal)continue}else if((Fn==="flight"||Fn==="ftd")&&Rn.flightFtd>=Q.exec.maxFlightFtd)continue;if(Rn.flightFtd+Rn.dutySup>=Q.exec.maxDutySup||Rn.flightFtd+Rn.ground+Rn.cpt+Rn.dutySup>=Q.exec.maxTotal)continue}else if(zn.role==="SIM IP"){if((Fn==="flight"||Fn==="ftd")&&Rn.flightFtd>=Q.simIp.maxFtd||Rn.flightFtd+Rn.ground+Rn.cpt>=Q.simIp.maxTotal)continue}else if((Fn==="flight"||Fn==="ftd")&&Rn.flightFtd>=Q.instructor.maxFlightFtd||Rn.flightFtd+Rn.ground+Rn.cpt+Rn.dutySup>=Q.instructor.maxTotal||zn.isFlyingSupervisor&&Rn.dutySup>=Q.instructor.maxDutySup)continue;if(K.filter(hs=>!hs.resourceId.startsWith("STBY")&&!hs.resourceId.startsWith("BNF-STBY")).some(hs=>{if(!Ls(hs).includes(zn.name))return!1;const _n=kl(hs,l);return rt.start<_n.end&&rt.end>_n.start}))continue;const Ms=[...K,{startTime:Ye,duration:$e.duration,flightNumber:$e.id,instructor:zn.name,type:Dt}].filter(hs=>Ls(hs).includes(zn.name)&&(hs.type==="flight"||hs.type==="ftd"||hs.flightNumber.includes("Duty Sup")));if(Ms.length>0){const hs=Ms.sort((Ds,Js)=>Ds.startTime-Js.startTime),_n=hs[0],rr=hs[hs.length-1],Cs=l.find(Ds=>Ds.id===_n.flightNumber),js=l.find(Ds=>Ds.id===rr.flightNumber),Cr=_n.startTime-((Cs==null?void 0:Cs.preFlightTime)||0);if(rr.startTime+rr.duration+((js==null?void 0:js.postFlightTime)||0)-Cr>ae)continue}return zn}return null},et=$e.sortieType==="Solo";let $t=null;if(!et&&($t=yt(je,$e,hn),!$t))return null;let pn=null;const kn=Dt==="flight"?"PC-21 ":Dt==="ftd"?"FTD ":Dt==="cpt"?"CPT ":"Ground ",ts=Dt==="flight"?h:Dt==="ftd"?m:Dt==="cpt"?v:6;for(let Nn=1;Nn<=ts;Nn++){const os=`${kn}${Nn}`;if(!K.some(Hn=>{if(Hn.resourceId!==os)return!1;let Jn=0;if(Hn.type==="flight"){const Rn=Hn.flightNumber.startsWith("BNF");if(St&&Rn){const Qn=[$t==null?void 0:$t.name,je.fullName].filter(Boolean),as=Ls(Hn);if(Qn.some(rs=>rs&&as.includes(rs))){const rs=l.find(Ms=>Ms.id===Hn.flightNumber);Jn=((rs==null?void 0:rs.postFlightTime)||0)+($e.preFlightTime||0)}else Jn=D}else Jn=D}else Hn.type==="ftd"?Jn=$:(Hn.type==="cpt"||Hn.type==="ground"&&Hn.flightNumber.includes("CPT"))&&(Jn=M);const zn=Hn.startTime+Hn.duration+Jn;return Ye<zn&&Ye+$e.duration>Hn.startTime})){pn=os;break}}if(!pn)return null;let un;if(Dt==="flight"){const Nn=$e.code.startsWith("BNF"),os=Nn?O:E;if(Ye<(Nn?H:T)||Ye+$e.duration>os||(un=c_(Ye,$e.duration,K),!un))return null;const ss=K.filter(zn=>!zn.resourceId.startsWith("STBY")&&!zn.resourceId.startsWith("BNF-STBY"));if(ss.filter(zn=>zn.type==="flight"&&zn.startTime>Ye-1&&zn.startTime<=Ye).length>=8||ss.some(zn=>{if(zn.type!=="flight")return!1;const Fn=Math.abs(zn.startTime-Ye),Rn=Math.round(Fn*60),Qn=St&&zn.flightNumber.startsWith("BNF");return Rn<5}))return null}return($e.id==="BGF18"||$e.id==="BGF11")&&(console.log("üîç SOLO FLIGHT DEBUG:",$e.id),console.log("  - sortieType:",$e.sortieType),console.log("  - type:",$e.type),console.log("  - code:",$e.code),console.log("  - Full syllabusItem:",JSON.stringify($e,null,2))),($e.id==="BGF18"||$e.id==="BGF11")&&console.log("SOLO DEBUG: "+$e.id+" sortieType: "+$e.sortieType),{id:_r(),type:Dt,instructor:$e.sortieType==="Solo"?"":($t==null?void 0:$t.name)||"",student:je.fullName,pilot:$e.sortieType==="Solo"?je.fullName:($t==null?void 0:$t.name)||"",flightNumber:$e.id,duration:$e.duration,startTime:Ye,resourceId:pn,color:x[je.course]||"bg-gray-500",flightType:$e.sortieType||"Dual",locationType:"Local",origin:y,destination:y,area:un,preStart:$e.preFlightTime,postEnd:$e.postFlightTime}};t({message:"Scheduling Duty Supervisors...",percentage:40}),K.filter(je=>je.type==="flight"&&!je.resourceId.startsWith("STBY")&&!je.resourceId.startsWith("BNF-STBY"));const Ge=T,ht=E;Ge>=ht&&t({message:"Invalid day flying window",percentage:90});let vt=null;if(ce.bnf.length>=2){console.log("üåô Pre-selecting night duty supervisor to prevent day assignments...");const je=new Set(Array.from(dn.values())),$e=on.filter(Ye=>(Ye.isFlyingSupervisor||Ye.unavailability.some(Dt=>Dt.reason==="TMUF - Ground Duties only"&&W>=Dt.startDate&&W<Dt.endDate))&&!je.has(Ye.name));console.log(`üåô Night supervisor pool: ${$e.length} candidates`),vt=$e.find(Ye=>Li(Ye,H,O,W,"duty_sup")?(console.log(`üåô ‚ùå ${Ye.name} - statically unavailable for night duty`),!1):F(Ye.name)?(console.log(`üåô ‚ùå ${Ye.name} - has day events (Active DFP or NEO-Build)`),!1):(console.log(`üåô ‚úÖ ${Ye.name} - eligible for night duty supervisor`),!0))||null,vt?(se.add(vt.name),console.log(`üåô Night duty supervisor pre-selected: ${vt.name} (marked for night duty only)`)):console.log("üåô ‚ö†Ô∏è WARNING: No eligible night duty supervisor found!")}const Ht=on.filter(je=>(je.isFlyingSupervisor||je.unavailability.some($e=>$e.reason==="TMUF - Ground Duties only"&&W>=$e.startDate&&W<$e.endDate))&&!(ce.bnf.length>=2&&X(je.name))),ze=Ht.filter(je=>je.unavailability.some($e=>$e.reason==="TMUF - Ground Duties only"&&W>=$e.startDate&&W<$e.endDate)),Re=[...Ht.filter(je=>!ze.find($e=>$e.idNumber===je.idNumber))].sort(()=>.5-Math.random()),be=[...ze,...Re];let Ze=Ge;for(console.log(`Duty Supervisor Allocation - Covering entire day window: ${Ge} to ${ht}`);Ze<ht;){if(K.some(Ce=>Ce.resourceId==="Duty Sup"&&Ze>=Ce.startTime&&Ze<Ce.startTime+Ce.duration)){Ze+=.5;continue}let $e=null,Ye=0;const Dt=be.filter(Ce=>ue.get(Ce.name).dutySup===0),St=be.filter(Ce=>ue.get(Ce.name).dutySup>0),hn=[...Dt,...St];for(const Ce of hn){const At=ue.get(Ce.name);Ce.isExecutive?Q.exec.maxFlightFtd+Q.exec.maxDutySup:Q.instructor.maxTotal;const B=Ce.isExecutive?Q.exec.maxDutySup:Q.instructor.maxDutySup,Ae=Ce.isExecutive?Q.exec.maxTotal:Q.instructor.maxTotal;if(At.dutySup>=B||At.flightFtd+At.ground+At.cpt+At.dutySup>=Ae||Li(Ce,Ze,Ze+.1,W,"duty_sup"))continue;const rt={startTime:Ze,duration:2,flightNumber:"Duty Sup",type:"ground"},yt=Oe(Ce.name,rt);if(console.log(`Duty Sup Check - ${Ce.name}: Total Duty = ${yt.toFixed(2)}hrs, Soft Limit = ${P}hrs`),yt>P){console.log(`Skipping ${Ce.name} - would exceed soft limit of ${P}hrs`);continue}if(K.filter(kn=>!kn.resourceId.startsWith("STBY")&&!kn.resourceId.startsWith("BNF-STBY")).some(kn=>{if(!Ls(kn).includes(Ce.name))return!1;const ts=kl(kn,l);return Ze<ts.end&&Ze+.1>ts.start}))continue;let $t=0;const pn=2;for(let kn=Ze;kn<ht&&!($t>=pn);kn+=.25){const ts=kn+.25;if(Li(Ce,kn,ts,W,"duty_sup"))break;const un={startTime:Ze,duration:ts-Ze,flightNumber:"Duty Sup",type:"ground"},os=[...K,un].filter(Hn=>Ls(Hn).includes(Ce.name));if(os.length>0){const Hn=os.map(Rn=>kl(Rn,l)).sort((Rn,Qn)=>Rn.start-Qn.start),Jn=Hn[0].start;if(Hn[Hn.length-1].end-Jn>P)break}if(K.filter(Hn=>!Hn.resourceId.startsWith("STBY")&&!Hn.resourceId.startsWith("BNF-STBY")).some(Hn=>{if(!Ls(Hn).includes(Ce.name))return!1;const Jn=kl(Hn,l);return kn<Jn.end&&ts>Jn.start}))break;$t+=.25}$t>Ye&&(Ye=Math.min($t,pn),$e=Ce)}$e&&Ye>0?(K.push({id:_r(),type:"ground",instructor:$e.name,flightNumber:"Duty Sup",duration:Ye,startTime:Ze,resourceId:"Duty Sup",color:"bg-amber-500/50",flightType:"Dual",locationType:"Local",origin:y,destination:y,pilot:void 0,student:""}),ue.get($e.name).dutySup++,console.log(`Duty Sup assigned: ${$e.name} from ${Ze} to ${Ze+Ye}`),Ze+=Ye):(console.log(`WARNING: No Duty Supervisor available for ${Ze} to ${Ze+.5} - GAP in coverage!`),Ze+=.5)}if(ce.bnf.length>=2&&vt?(t({message:"Scheduling Night Duty Supervisor...",percentage:42}),console.log(`Scheduling night duty supervisor: ${vt.name}`),K.push({id:_r(),type:"ground",instructor:vt.name,flightNumber:"Night Duty Sup",duration:O-H,startTime:H,resourceId:"Duty Sup",color:"bg-amber-700/50",flightType:"Dual",locationType:"Local",origin:y,destination:y,pilot:void 0,student:""}),ue.get(vt.name).dutySup++):ce.bnf.length>=2&&!vt&&console.log("WARNING: Night flying scheduled but no night duty supervisor available!"),t({message:"Scheduling Day Flight Events (Priority)...",percentage:45}),t({message:"Scheduling Day Flight Events (Next)...",percentage:50}),st(nt(xt(ce.flight)),"flight",!1,T,E,null,!1),t({message:"Scheduling Night Flying...",percentage:55}),ce.bnf.length>=2){const je=nt(ce.bnf);st(je,"flight",!1,H,O,null,!0)}if(t({message:"Scheduling FTD Events (Priority)...",percentage:60}),t({message:"Scheduling FTD Events (Next)...",percentage:65}),st(nt(xt(ce.ftd)),"ftd",!1,A,_,null,!1),t({message:"Scheduling CPT Events (Priority)...",percentage:70}),t({message:"Scheduling CPT Events (Next)...",percentage:72}),st(nt(xt(ce.cpt)),"cpt",!1,T,E,null,!1),t({message:"Scheduling Ground Events (Priority)...",percentage:74}),t({message:"Scheduling Ground Events (Next)...",percentage:76}),st(nt(xt(ce.ground)),"ground",!1,T,E,null,!1),t({message:"Scheduling Day Flight Events (Plus-One)...",percentage:78}),st(nt(xt(He.flight)),"flight",!0,T,E,"STBY",!1),ce.bnf.length>=2){t({message:"Scheduling Night Flight Events (Plus-One)...",percentage:80});const je=ce.bnf.filter($e=>{const{plusOne:Ye}=pe.get($e.fullName)||{plusOne:null};return Ye&&Ye.code.startsWith("BNF")&&Ye.type==="Flight"});st(je,"flight",!0,H,O,null,!0)}t({message:"Scheduling FTD Events (Plus-One)...",percentage:82}),st(nt(xt(He.ftd)),"ftd",!0,A,_,"STBY",!1),t({message:"Scheduling CPT Events (Plus-One)...",percentage:84}),st(nt(xt(He.cpt)),"cpt",!0,T,E,null,!1),t({message:"Scheduling Ground Events (Plus-One)...",percentage:86}),st(nt(xt(He.ground)),"ground",!0,T,E,null,!1),t({message:"Scheduling STBY flights...",percentage:88});const ot=(je,$e)=>$e.some(Ye=>Ye.type==="flight"&&Math.abs(Ye.startTime-je)<.01),Vt=(je,$e,Ye)=>Ye.filter(Dt=>Dt.type==="flight"&&Dt.startTime>je&&Dt.startTime<=$e).length,Pt=(je,$e)=>{const Ye=je-1;if(Vt(Ye,je,$e)>=8)return!0;const St=je+1,hn=$e.filter(Ce=>Ce.type==="flight"&&!Ce.resourceId.startsWith("STBY")&&Ce.startTime>je&&Ce.startTime<=St);for(const Ce of hn){const At=Ce.startTime-1,B=Ce.startTime,Ae=Vt(At,B,$e);if(je>At&&je<=B&&Ae>=8)return!0}return!1},yn=(je,$e,Ye,Dt,St)=>{const hn=Dt.preFlightTime||0,Ce=Dt.postFlightTime||0,At=$e-hn,B=$e+Ye+Ce;return!St.some(Ae=>{if(!Ls(Ae).includes(je))return!1;const rt=kl(Ae,l);return At<rt.end&&B>rt.start})},Tt=(je,$e,Ye,Dt,St,hn)=>{let Ce=[];if(St==="ftd"){const et=on.filter(pn=>pn.role==="SIM IP"),$t=on.filter(pn=>pn.role==="QFI");Ce=[...et,...$t]}else Ce=on.filter(et=>et.role==="QFI");const At=Ce.filter(et=>yn(et.name,Ye,Dt,$e,hn));if(At.length===0)return null;const B=At.map(et=>({instructor:et,count:hn.filter($t=>$t.instructor===et.name).length})),Ae=Math.min(...B.map(et=>et.count)),rt=B.filter(et=>et.count===Ae);return rt[Math.floor(Math.random()*rt.length)].instructor.name},lt=(je,$e,Ye,Dt)=>{const St=je+$e,hn=new Map;Ye.forEach(Ce=>{if(!Ce.resourceId.startsWith(Dt))return;const At=Ce.resourceId.match(/(\d+)$/);if(!At)return;const B=parseInt(At[1]);hn.has(B)||hn.set(B,[]),hn.get(B).push({start:Ce.startTime,end:Ce.startTime+Ce.duration})});for(let Ce=1;Ce<=Math.max(4,hn.size);Ce++)if(!(hn.get(Ce)||[]).some(Ae=>je<Ae.end&&St>Ae.start))return Ce;return Math.max(4,hn.size)+1},Et=ce.flight.filter(je=>{const{next:$e}=pe.get(je.fullName);return $e?!K.some(Ye=>Ye.student===je.fullName&&Ye.flightNumber===$e.id&&Ye.type==="flight"&&!Ye.resourceId.startsWith("STBY")):!1});console.log("Trainees needing STBY flights:",Et.length);const Bt=5/60,Kt=new Set;console.log("PASS 1: Scheduling STBY with instructors available..."),console.log(`Flying window: ${T.toFixed(2)} to ${E.toFixed(2)}`);for(const je of Et){const{next:$e}=pe.get(je.fullName);if(!$e)continue;let Ye=!1;for(let Dt=T;Dt<E;Dt+=Bt){const St=Dt>=10&&Dt<=10.33;if(ot(Dt,K)){St&&console.log(`  ${Dt.toFixed(2)}: Flight already exists`);continue}if(Dt+$e.duration>E){St&&console.log(`  ${Dt.toFixed(2)}: Would exceed flying window`);continue}if(Pt(Dt,K)){St&&console.log(`  ${Dt.toFixed(2)}: Would violate 8-per-hour rule`);continue}const Ce=Tt(je,$e,Dt,$e.duration,"flight",K);if(!Ce){St&&console.log(`  ${Dt.toFixed(2)}: No instructor available`);continue}const At=lt(Dt,$e.duration,K,"STBY");K.push({id:_r(),type:"flight",instructor:Ce,student:je.fullName,flightNumber:$e.id,duration:$e.duration,startTime:Dt,resourceId:`STBY ${At}`,color:x[je.course]||"bg-gray-500",flightType:"Dual",locationType:"Local",origin:y,destination:y,preStart:$e.preFlightTime,postEnd:$e.postFlightTime}),console.log(`PASS 1: STBY at ${Dt.toFixed(2)} for ${je.fullName}, instructor: ${Ce}`),Kt.add(je.fullName),Ye=!0;break}Ye||console.log(`PASS 1: Could not place ${je.fullName} anywhere in flying window`)}console.log(`PASS 1 complete: ${Kt.size} STBY flights with instructors`),console.log("PASS 2: Going back to beginning to schedule remaining STBY with TBA...");const Mt=Et.filter(je=>!Kt.has(je.fullName));console.log(`Remaining trainees needing STBY: ${Mt.length}`);for(const je of Mt){const{next:$e}=pe.get(je.fullName);if($e)for(let Ye=T;Ye<E;Ye+=Bt){if(ot(Ye,K)||Ye+$e.duration>E||Pt(Ye,K))continue;const St=lt(Ye,$e.duration,K,"STBY");K.push({id:_r(),type:"flight",instructor:"TBA",student:je.fullName,flightNumber:$e.id,duration:$e.duration,startTime:Ye,resourceId:`STBY ${St}`,color:x[je.course]||"bg-gray-500",flightType:"Dual",locationType:"Local",origin:y,destination:y,preStart:$e.preFlightTime,postEnd:$e.postFlightTime}),console.log(`PASS 2: STBY at ${Ye.toFixed(2)} for ${je.fullName}, instructor: TBA`),Kt.add(je.fullName);break}}console.log(`PASS 2 complete: Total STBY flights: ${Kt.size} (Pass 1: ${Kt.size-Mt.length}, Pass 2: ${Mt.length})`),t({message:"Scheduling STBY FTD events...",percentage:90});const Ve=ce.ftd.filter(je=>{const{next:$e}=pe.get(je.fullName);return!$e||$e.type!=="FTD"?!1:!K.some(Ye=>Ye.student===je.fullName&&Ye.flightNumber===$e.id&&Ye.type==="ftd"&&!Ye.resourceId.startsWith("STBY"))});if(console.log("Trainees needing STBY FTD events:",Ve.length),Ve.length>0){let je=1,$e=A;const Ye=$;console.log(`FTD STBY: Scheduling ${Ve.length} events with ${Ye.toFixed(2)}hr spacing`);for(const St of Ve){const{next:hn}=pe.get(St.fullName);if(!hn)continue;let Ce=!1;for(;!Ce&&je<=20;)if($e+hn.duration<=E)if(K.some(B=>{if(B.resourceId!==`STBY ${je}`)return!1;const Ae=B.startTime+B.duration+Ye;return $e<Ae}))je++,$e=A;else{const B=Tt(St,hn,$e,hn.duration,"ftd",K);K.push({id:_r(),type:"ftd",instructor:B||"TBA",student:St.fullName,pilot:B||"TBA",flightNumber:hn.id,duration:hn.duration,startTime:$e,resourceId:`STBY ${je}`,color:x[St.course]||"bg-gray-500",flightType:"Dual",locationType:"Local",origin:y,destination:y,preStart:hn.preFlightTime,postEnd:hn.postFlightTime}),console.log(`FTD STBY: Placed ${St.fullName} at ${$e.toFixed(2)} on STBY ${je}, instructor: ${B||"TBA"}`),$e+=hn.duration+Ye,Ce=!0}else je++,$e=T;Ce||console.log(`FTD STBY: Could not place ${St.fullName} - all STBY lines full`)}const Dt=K.filter(St=>St.type==="ftd"&&St.resourceId.startsWith("STBY"));console.log(`FTD STBY complete: Placed ${Dt.length} events across ${je-1} STBY lines`)}t({message:"Shuffling events for distribution...",percentage:95}),t({message:"Sorting events by resource order...",percentage:98});const qt=[...Array.from({length:24},(je,$e)=>`PC-21 ${$e+1}`),...Array.from({length:10},(je,$e)=>`Deployed ${$e+1}`),"Duty Sup",...Array.from({length:20},(je,$e)=>`STBY ${$e+1}`),...Array.from({length:10},(je,$e)=>`FTD ${$e+1}`),...Array.from({length:10},(je,$e)=>`CPT ${$e+1}`),...Array.from({length:10},(je,$e)=>`Ground ${$e+1}`)],Mn=new Map;qt.forEach((je,$e)=>{Mn.set(je,$e)});const jn=[...K].sort((je,$e)=>{const Ye=Mn.get(je.resourceId)??9999,Dt=Mn.get($e.resourceId)??9999;return Ye!==Dt?Ye-Dt:je.startTime-$e.startTime});return console.log("First 20 sorted events by resource:"),jn.slice(0,20).forEach(je=>{const $e=je.student||je.pilot||je.instructor||"N/A";console.log(`  ${je.resourceId}: ${$e} at ${je.startTime.toFixed(2)}`)}),console.log("DEBUG ===== FINAL BUILD RESULTS ====="),console.log(`DEBUG Total events in final build: ${jn.length}`),console.log("DEBUG Checking for originally locked events:"),ne.forEach(je=>{if(je.date===W&&je.isTimeFixed){const $e=jn.find(Ye=>Ye.id===je.id);console.log($e?`  ‚úì FOUND: ${je.flightNumber} - ${je.student||je.pilot||"N/A"} (ID: ${je.id})`:`  ‚úó MISSING: ${je.flightNumber} - ${je.student||je.pilot||"N/A"} (ID: ${je.id}) - THIS SHOULD NOT HAPPEN!`)}}),console.log("DEBUG ===== END FINAL BUILD RESULTS ====="),t({message:"Build complete!",percentage:100}),jn}const m_=()=>{Ua.useEffect(()=>{const I=String.prototype.split;return String.prototype.split=function(...q){return this===void 0||this===null?(console.error("üî¥ SPLIT CALLED ON UNDEFINED/NULL!"),console.trace("Stack trace:"),[]):I.apply(this,q)},()=>{String.prototype.split=I}},[]),Ua.useEffect(()=>{const I=console.error;return console.error=function(...q){const te=q.join(" ");(te.includes("split")||te.includes("undefined"))&&(console.log("üî¥ SPLIT ERROR DETECTED:",te),console.trace("Stack trace:")),I.apply(console,q)},window.addEventListener("error",q=>{var te;(q.message.includes("split")||q.message.includes("undefined"))&&(console.log("üî¥ GLOBAL ERROR CAUGHT:",q.message),console.log("üî¥ Error at:",q.filename,"Line:",q.lineno,"Column:",q.colno),console.log("üî¥ Stack:",(te=q.error)==null?void 0:te.stack))}),()=>{console.error=I}},[]);const t=I=>{const q=Math.floor(I),te=Math.round((I-q)*60);return`${q.toString().padStart(2,"0")}${te.toString().padStart(2,"0")}`},[s,i]=C.useState(()=>{const I=localStorage.getItem("timezoneOffset");return I?parseFloat(I):11}),[o,l]=C.useState(()=>{const I=localStorage.getItem("showDepartureDensityOverlay");return I!==null?JSON.parse(I):!0});C.useEffect(()=>{localStorage.setItem("showDepartureDensityOverlay",JSON.stringify(o))},[o]);const d=(I=new Date)=>{const q=s*60*60*1e3,te=new Date(I.getTime()+q),le=te.getUTCFullYear(),Ue=String(te.getUTCMonth()+1).padStart(2,"0"),Ie=String(te.getUTCDate()).padStart(2,"0");return`${le}-${Ue}-${Ie}`},u=(I,q="Notice",te="info")=>new Promise(le=>{Ne({type:"alert",title:q,message:I,variant:te,onConfirm:()=>{Ne(null),le()}})}),[f,h]=C.useState("Program Schedule"),[m,v]=C.useState("Program Schedule"),[x,y]=C.useState(()=>d()),[T,E]=C.useState(Za.events),[A,_]=C.useState(null),[R,H]=C.useState(!1),[O,W]=C.useState(null),[ne,V]=C.useState(null),[U,D]=C.useState(!1),[$,M]=C.useState(!0),[P,ae]=C.useState(!1),[Q,Te]=C.useState(!1),[Y,fe]=C.useState(new Set),[ge,Ne]=C.useState(null),[Oe,se]=C.useState(!1),[F,X]=C.useState(null),[J,ee]=C.useState("ESL"),[K,ue]=C.useState(Za.instructors),[xe,Le]=C.useState([]),[ye,pe]=C.useState(Za.trainees),[ce,He]=C.useState([]),[_e,Z]=C.useState("Bloggs, Joe"),Fe=K.find(I=>I.name===_e)||K[0],[Xe,ft]=C.useState((Fe==null?void 0:Fe.idNumber)||1);C.useEffect(()=>{if(Fe){const I=`${Fe.rank||""} ${Fe.name}`.trim();I5(I)}},[Fe]);const tt=I=>{Z(I);const q=K.find(te=>te.name===I);q&&ft(q.idNumber)},Ke=(I=>!I||I.length===0?"Staff":I.includes("Super Admin")?"Super Admin":I.includes("Admin")?"Admin":I.includes("Scheduler")?"Scheduler":I.includes("Course Supervisor")?"Course Supervisor":I.includes("Ops")?"Ops":I.includes("Staff")?"Staff":"Trainee")(Fe==null?void 0:Fe.permissions),[nt,Ct]=C.useState(Za.scores),[xt,dn]=C.useState(Za.pt051Assessments),[on,st]=C.useState(Za.courses),[kt,Ge]=C.useState(Za.courseColors),[ht,vt]=C.useState(Za.archivedCourses),[Ht,ze]=C.useState(Za.coursePriorities),[we,Re]=C.useState(Za.coursePercentages),[be,Ze]=C.useState(qc),[ot,Vt]=C.useState(Za.traineeLMPs),[Pt,yn]=C.useState({exec:{maxFlightFtd:1,maxDutySup:2,maxTotal:2},instructor:{maxFlightFtd:2,maxDutySup:31,maxTotal:3},trainee:{maxFlightFtd:1,maxTotal:2},simIp:{maxFtd:2,maxTotal:2}}),[Tt,lt]=C.useState(YD),[Et,Bt]=C.useState({}),[Kt,Mt]=C.useState([]),[Ve,qt]=C.useState(()=>{const I=new Date;return I.setDate(I.getDate()+1),d(I)}),[Mn,jn]=C.useState(null),[je,$e]=C.useState(15),[Ye,Dt]=C.useState(J==="ESL"?5:4),[St,hn]=C.useState(4),[Ce,At]=C.useState(8),[B,Ae]=C.useState(17),[rt,yt]=C.useState(8),[et,$t]=C.useState(17),[pn,kn]=C.useState(!0),[ts,un]=C.useState(18.5),[Nn,os]=C.useState(23.5),[ss,Hn]=C.useState(8),[Jn,zn]=C.useState(10),[Fn,Rn]=C.useState(8),[Qn,as]=C.useState(1.2),[cs,rs]=C.useState(.5),[Ms,hs]=C.useState(.5),[_n,rr]=C.useState(!1),[Cs,js]=C.useState({message:"",percentage:0}),[Cr,Fs]=C.useState(!1),[Ds,Js]=C.useState([]),[sa,to]=C.useState(!1),[Ti,vs]=C.useState([]),[ra,no]=C.useState(!0),[xi,Ta]=C.useState(()=>{const I=localStorage.getItem("cancellationRecords");return I?JSON.parse(I):[]}),[so,Go]=C.useState(()=>{const I=localStorage.getItem("cancellationCodes");return I?JSON.parse(I):(localStorage.setItem("cancellationCodes",JSON.stringify(Zu)),Zu)}),[ro,Ba]=C.useState(!1),[Ao,Vr]=C.useState(0),[li,Mi]=C.useState(!1),[Qr,Fi]=C.useState(!1),[ke,mt]=C.useState(null),[nn,Yt]=C.useState(null),[an,en]=C.useState(null),[Cn,Vn]=C.useState("program"),[xn,ls]=C.useState([]),[Es,Zs]=C.useState([]),[ir,Pi]=C.useState(!1),[Oa,Fr]=C.useState(null),[ja,Ri]=C.useState(null),[ci,ko]=C.useState([]),[Bs,Wr]=C.useState(null),[Ea,Tr]=C.useState([]),[Do,yi]=C.useState(null),[di,io]=C.useState(null),[Ui,ao]=C.useState(!1),[k,re]=C.useState(null),[De,Qe]=C.useState(!1),[pt,Jt]=C.useState(!1),[fn,Wn]=C.useState([]),[Xn,fs]=C.useState([]),[gs,Os]=C.useState(!1),[fr,Ee]=C.useState(je),[rn,gt]=C.useState(null),[vn,Un]=C.useState(!1),[_s,En]=C.useState(!1),[es,Is]=C.useState(null),[ps,Xs]=C.useState(!1),[ar,$s]=C.useState(null),[ji,or]=C.useState(null),[Bi,ia]=C.useState("Program Schedule"),[$r,Yi]=C.useState(null),[ei,Yr]=C.useState(!1),[aa,Ll]=C.useState(null),[Oi,Ji]=C.useState(!1),[Ks,Aa]=C.useState(null),[oa,_o]=C.useState(null),[vr,Nr]=C.useState(null),[$i,$a]=C.useState(null),[oo,Ha]=C.useState(!1),[zo,hr]=C.useState(null),[Wc,lo]=C.useState(!1),[ka,Jr]=C.useState(null),[Ei,Io]=C.useState(i_),[la,Da]=C.useState(r_),[co,qa]=C.useState(!1),[ul,ca]=C.useState(null),[uo,ti]=C.useState(!1),[Xi,Hs]=C.useState(null),[Ps,lr]=C.useState(null),[jr,Ga]=C.useState(["East Sale","Pearce","Williamtown","Amberley","Tindal","Edinburgh"]),[Ir,Vo]=C.useState(["SCT GF","SCT IF","SCT FORM","SCT Nav","Night SCT"]),[Wo,Yc]=C.useState(["1FTS","CFS","2FTS","76SQN","77SQN","1SQN","6SQN","2SQN","10SQN"]),[pd,xd]=C.useState({"1FTS":"East Sale",CFS:"East Sale","2FTS":"Pearce","76SQN":"Williamtown","77SQN":"Williamtown","1SQN":"Amberley","6SQN":"Amberley","2SQN":"Williamtown","10SQN":"Edinburgh"}),[Jc,Xc]=C.useState([{name:"Avon",code:"AVON",unit:"1FTS",location:"East Sale",locationCode:"ESL"},{name:"Garret",code:"GART",unit:"1FTS",location:"East Sale",locationCode:"ESL"},{name:"Gypsy",code:"GYPS",unit:"1FTS",location:"East Sale",locationCode:"ESL"},{name:"Merlin",code:"MERL",unit:"1FTS",location:"East Sale",locationCode:"ESL"},{name:"Mustang",code:"MUST",unit:"CFS",location:"East Sale",locationCode:"ESL"},{name:"Spitfire",code:"SPIT",unit:"CFS",location:"East Sale",locationCode:"ESL"},{name:"Tempest",code:"TMPS",unit:"CFS",location:"East Sale",locationCode:"ESL"},{name:"Typhoon",code:"TYPN",unit:"CFS",location:"East Sale",locationCode:"ESL"},{name:"Roulettes",code:"RLTS",unit:"CFS",location:"East Sale",locationCode:"ESL"},{name:"Vampire",code:"VAMP",unit:"2FTS",location:"Pearce",locationCode:"PEA"},{name:"Voodoo",code:"VODO",unit:"2FTS",location:"Pearce",locationCode:"PEA"},{name:"Vulcan",code:"VULC",unit:"2FTS",location:"Pearce",locationCode:"PEA"}]),[Ml,fo]=C.useState({}),Ki=C.useRef(()=>!1),fl=C.useRef(()=>{}),Hi=C.useRef(()=>{}),ho=C.useMemo(()=>{let q=0;if(console.log("buildResources - Current view:",f,"Current date:",x),f==="Program Schedule"||f==="DailyFlyingProgram"||f==="InstructorSchedule"||f==="TraineeSchedule"){const Ie=new Date(`${x}T00:00:00Z`).getTime(),he=new Date(Ie);he.setUTCDate(he.getUTCDate()+1);const qe=he.getTime(),at=Object.values(Et).flat().filter(Nt=>{if(Nt.type!=="deployment")return!1;const Be=new Date(`${Nt.date}T00:00:00Z`).getTime()+Nt.startTime*60*60*1e3,Wt=Be+Nt.duration*60*60*1e3;return Be<qe&&Wt>Ie});q=at.length,console.log(`Deployments overlapping with ${x}:`,at)}else if(["NextDayBuild","Priorities","ProgramData","NextDayInstructorSchedule","NextDayTraineeSchedule"].includes(f)){const Ie=Kt.filter(he=>he.type==="deployment");q=Ie.length,console.log("Next day build deployment events:",Ie)}console.log("deploymentCount:",q);const te=Array.from({length:24},(Ie,he)=>{const qe=24-he;if(qe<=q){const dt=q-qe+1;return console.log(`Transforming PC-21 ${he+1} to Deployed ${dt}`),`Deployed ${dt}`}return`PC-21 ${he+1}`});let le=4;if(["NextDayBuild","Priorities","ProgramData","NextDayInstructorSchedule","NextDayTraineeSchedule","BuildAnalysis"].includes(f)){const Ie=Kt.filter(he=>he.resourceId.startsWith("STBY")||he.resourceId.startsWith("BNF-STBY"));if(Ie.length>0){const he=Math.max(...Ie.map(qe=>{const dt=qe.resourceId.match(/STBY (\d+)/);return dt?parseInt(dt[1]):0}));le=Math.max(4,he)}}else{const he=(Et[x]||[]).filter(qe=>qe.resourceId.startsWith("STBY")||qe.resourceId.startsWith("BNF-STBY"));if(he.length>0){const qe=Math.max(...he.map(dt=>{const at=dt.resourceId.match(/STBY (\d+)/);return at?parseInt(at[1]):0}));le=Math.max(4,qe)}}const Ue=[...te,"Duty Sup","TWR DI",...Array.from({length:le},(Ie,he)=>`STBY ${he+1}`),...Array.from({length:5},(Ie,he)=>`FTD ${he+1}`),...Array.from({length:4},(Ie,he)=>`CPT ${he+1}`),...Array.from({length:6},(Ie,he)=>`Ground ${he+1}`)];return console.log("Built all resources:",Ue,"STBY lines:",le),Ue},[Ye,St,je,x,f,Et,Kt]);C.useCallback((I,q)=>{if(!I||I.length===0)return console.log("No events, returning empty resources"),[];const te=[];for(const le of I){if(!le||!le.resourceId){console.warn("Skipping invalid event:",le);continue}const Ue=le.resourceId;let Ie="Unknown";Ue.startsWith("PC-21")||Ue.startsWith("Deployed")?Ie="PC-21":Ue==="Duty Sup"?Ie="Duty Sup":Ue.startsWith("STBY")||Ue.startsWith("BNF-STBY")?Ie="STBY":Ue.startsWith("FTD")?Ie="FTD":Ue.startsWith("CPT")?Ie="CPT":Ue.startsWith("Ground")?Ie="Ground":Ie=Ue,te.push(Ie)}return console.log("Resource labels (one per event):",te.slice(0,30)),te},[]),C.useEffect(()=>{(async()=>{await rg(),await k5(),localStorage.getItem("dfp_audit_logs")||H5()})()},[]),C.useEffect(()=>{f==="MyDashboard"&&pl(Et,xt)},[f,Et,xt]),C.useEffect(()=>{(f==="Priorities"||f==="ProgramData")&&_a()},[xn,Es,f]),C.useEffect(()=>{console.log("üîÑ useEffect triggered - activeView:",f,"remedialRequests count:",ci.filter(I=>I.forceSchedule).length),f==="Priorities"||f==="ProgramData"?(console.log("‚úÖ Active view matches, calling sync..."),_a()):console.log("‚è∏Ô∏è Not syncing - activeView is:",f)},[ci,f]),C.useEffect(()=>{localStorage.setItem("timezoneOffset",s.toString())},[s]),C.useEffect(()=>{const I=d();x!==I&&(console.log("üìÖ Updating current date from",x,"to",I,"due to timezone change"),y(I))},[s]),C.useEffect(()=>{const I=()=>{const te=new Date;te.setDate(te.getDate()+1);const le=d(te);Ve!==le&&(console.log("üìÖ Updating build DFP date from",Ve,"to",le),qt(le))};I();const q=setInterval(()=>{I()},6e4);return()=>clearInterval(q)},[s]);const qs=C.useMemo(()=>{console.log("üü° eventsForDate memo recalculating"),console.log("üü° date:",x),console.log("üü° publishedSchedules keys:",Object.keys(Et));const I=Et[x]||[];console.log("üü° eventsForDate count:",I.length);const q=I.filter(te=>te.flightNumber==="SCT FORM");return q.length>0&&console.log("üü° SCT FORM events in eventsForDate:",q.map(te=>({id:te.id,instructor:te.instructor,pilot:te.pilot}))),I},[x,Et]),Fl=C.useMemo(()=>qs.filter(I=>!I.resourceId.startsWith("STBY")),[qs]),hl=C.useMemo(()=>Kt.filter(I=>!I.resourceId.startsWith("STBY")),[Kt]),da=C.useMemo(()=>{const I=[],q=new Date(`${x}T00:00:00Z`).getTime(),te=new Date(q);te.setUTCDate(te.getUTCDate()+1);const le=te.getTime(),Ue=Object.values(Et).flat();for(const Ie of Ue){let he,qe;if(he=new Date(`${Ie.date}T00:00:00Z`).getTime()+Ie.startTime*60*60*1e3,qe=he+Ie.duration*60*60*1e3,he<le&&qe>q){const dt=Math.max(he,q),at=Math.min(qe,le),Nt=(dt-q)/(1e3*60*60),Be=(at-dt)/(1e3*60*60);if(Be<=0)continue;let Wt="full";const Rt=he<q,tn=qe>le;Rt&&tn?Wt="middle":Rt?Wt="end":tn&&(Wt="start"),I.push({...Ie,segmentStartTime:Nt,segmentDuration:Be,segmentType:Wt})}}return I},[x,Et]),mo=C.useMemo(()=>{console.log("üöÄ [NEO-Build] nextDayEventSegments useMemo recalculating"),console.log("üöÄ [NEO-Build] buildDfpDate:",Ve),console.log("üöÄ [NEO-Build] nextDayBuildEvents.length:",Kt.length);const I=[],q=new Date(`${Ve}T00:00:00Z`).getTime(),te=new Date(q);te.setUTCDate(te.getUTCDate()+1);const le=te.getTime(),Ue=Kt.map(dt=>({...dt,date:Ve}));console.log("üöÄ [NEO-Build] buildEventsWithDate.length:",Ue.length);const Ie=new Date(q);Ie.setUTCDate(Ie.getUTCDate()-1);const he=Ie.toISOString().split("T")[0],qe=[...Et[he]||[],...Ue];for(const dt of qe){const at=new Date(`${dt.date}T00:00:00Z`).getTime()+dt.startTime*60*60*1e3,Nt=at+dt.duration*60*60*1e3;if(at<le&&Nt>q){const Be=Math.max(at,q),Wt=Math.min(Nt,le),Rt=(Be-q)/(1e3*60*60),tn=(Wt-Be)/(1e3*60*60);if(tn<=0)continue;let Dn="full";const wn=at<q,Ut=Nt>le;wn&&Ut?Dn="middle":wn?Dn="end":Ut&&(Dn="start"),I.push({...dt,segmentStartTime:Rt,segmentDuration:tn,segmentType:Dn})}}return console.log("üöÄ [NEO-Build] Final segments.length:",I.length),I},[Ve,Kt,Et]);C.useEffect(()=>{const I=d(),q=T.filter(te=>te.date===I);Object.keys(Ml).length===0&&q.length>0&&fo({[I]:JSON.parse(JSON.stringify(q))})},[T,Ml]);const bi=C.useMemo(()=>{const I=new Map,q=J==="ESL"?"ROLR":"VIPR";return K.forEach(te=>{te.name&&te.role==="QFI"&&te.callsignNumber>0&&I.set(te.name,{callsignPrefix:q,callsignNumber:te.callsignNumber})}),I},[K,J]),Pr=C.useMemo(()=>{const I=new Map;return K.forEach(q=>{q.name&&q.seatConfig&&I.set(q.name,q.seatConfig)}),ye.forEach(q=>{q.name&&q.seatConfig&&I.set(q.name,q.seatConfig)}),I},[K,ye]),ni=C.useCallback((I,q)=>{const te=I.startTime,le=I.startTime+I.duration,Ue=q.startTime,Ie=q.startTime+q.duration;return te<Ie&&le>Ue},[]),go=C.useCallback((I,q,te)=>{if(I.resourceId.startsWith("STBY")||I.resourceId.startsWith("BNF-STBY")||I.type==="deployment")return{hasConflict:!1,conflictingEventId:null,conflictType:null,conflictedPersonnel:null};if(I.flightNumber==="SCT FORM"&&I.pilot){const Be=I.id.split("-")[0],Wt=q.filter(Rt=>Rt.flightNumber==="SCT FORM"&&Rt.id.startsWith(Be)&&Rt.id!==I.id);for(const Rt of Wt)if(Rt.pilot===I.pilot&&I.pilot!=="")return console.log(`üö® DUPLICATE PILOT IN FORMATION: ${I.pilot} assigned to multiple aircraft`),{hasConflict:!0,conflictingEventId:Rt.id,conflictType:"personnel",conflictedPersonnel:I.pilot}}const le=q.filter(Be=>Be.id!==I.id&&!Be.resourceId.startsWith("STBY")&&!Be.resourceId.startsWith("BNF-STBY")&&Be.type!=="deployment");I.flightNumber==="SCT FORM"&&(console.log(`üîç Checking conflicts for SCT FORM event ${I.id}`),console.log(`   Instructor: "${I.instructor||"EMPTY"}"`),console.log("   Personnel:",Ls(I)));let Ue=0;I.type==="flight"?Ue=Qn:I.type==="ftd"?Ue=cs:(I.type==="cpt"||I.type==="ground"&&I.flightNumber.includes("CPT"))&&(Ue=Ms);const Ie=le.filter(Be=>Be.resourceId===I.resourceId);Ie.sort((Be,Wt)=>Be.startTime-Wt.startTime);for(let Be=0;Be<Ie.length;Be++){const Wt=Ie[Be];if(I.startTime>Wt.startTime&&I.startTime-(Wt.startTime+Wt.duration)<Ue)return{hasConflict:!0,conflictingEventId:Wt.id,conflictType:"turnaround",conflictedPersonnel:null};if(I.startTime<Wt.startTime){let Rt=0;if(Wt.type==="flight"?Rt=Qn:Wt.type==="ftd"?Rt=cs:(Wt.type==="cpt"||Wt.type==="ground"&&Wt.flightNumber.includes("CPT"))&&(Rt=Ms),Wt.startTime-(I.startTime+I.duration)<Rt)return{hasConflict:!0,conflictingEventId:Wt.id,conflictType:"turnaround",conflictedPersonnel:null}}}for(const Be of le)if(Be.resourceId===I.resourceId&&ni(I,Be))return{hasConflict:!0,conflictingEventId:Be.id,conflictType:"resource",conflictedPersonnel:null};const he=Ls(I),qe="date"in I?I:{...I},dt=Ra(qe,be);I.flightNumber==="SCT FORM"&&(console.log("   Target personnel for conflict check:",he),console.log(`   Target window: ${dt.start} - ${dt.end}`));for(const Be of le){const Wt=Ls(Be),Rt=he.filter(tn=>Wt.includes(tn));if(Rt.length>0){const tn="date"in Be?Be:{...Be},Dn=Ra(tn,be);if(dt.start<Dn.end&&dt.end>Dn.start)return I.flightNumber==="SCT FORM"&&(console.log("   ‚ùå PERSONNEL CONFLICT FOUND!"),console.log(`      Conflicting with event: ${Be.id} (${Be.flightNumber})`),console.log("      Common personnel:",Rt),console.log("      Event personnel:",Wt),console.log(`      Event window: ${Dn.start} - ${Dn.end}`)),{hasConflict:!0,conflictingEventId:Be.id,conflictType:"personnel",conflictedPersonnel:Rt[0]}}}const at=Ls(I),Nt=ic(I,be,Ir);if(Nt==="Day/Night")return{hasConflict:!1,conflictingEventId:null,conflictType:null,conflictedPersonnel:null};for(const Be of le){const Wt=Ls(Be),Rt=at.filter(tn=>Wt.includes(tn));if(Rt.length>0){const tn=ic(Be,be,Ir);if(tn==="Day/Night")continue;if(Nt==="Day"&&tn==="Night"||Nt==="Night"&&tn==="Day")return{hasConflict:!0,conflictingEventId:Be.id,conflictType:"day-night",conflictedPersonnel:Rt[0]}}}return{hasConflict:!1,conflictingEventId:null,conflictType:null,conflictedPersonnel:null}},[Qn,cs,Ms,be,Ve,ni,ts,Nn]),Xr=(I,q,te=1.5,le="flight",Ue,Ie,he)=>{const qe=Ue||x,dt=qs.filter(tn=>tn.id!==he&&Ls(tn).includes(I)&&tn.date===qe),at=dt.some(tn=>ic(tn,be,Ir)==="Day"),Nt=dt.some(tn=>ic(tn,be,Ir)==="Night");let Be=!1,Wt=!1,Rt=!1;if(Ie){const tn=ic({flightNumber:Ie},be,Ir);Be=tn==="Night",Wt=tn==="Day",Rt=tn==="Day/Night"}else Be=q>=ts&&q<Nn,Wt=!Be;return Rt?{isAllowed:!0,reason:"",hasDayEvents:at,hasNightEvents:Nt}:at&&Be?{isAllowed:!1,reason:`‚ùå DAY/NIGHT SEPARATION VIOLATION: ${I} already has day events scheduled and cannot be assigned to night events. This is a hard rule that cannot be violated.`,hasDayEvents:!0,hasNightEvents:!1}:Nt&&Wt?{isAllowed:!1,reason:`‚ùå DAY/NIGHT SEPARATION VIOLATION: ${I} already has night events scheduled (including DUTY SUP) and cannot be assigned to day events. This is a hard rule that cannot be violated.`,hasDayEvents:!1,hasNightEvents:!0}:{isAllowed:!0,reason:"",hasDayEvents:at,hasNightEvents:Nt}},Pl=C.useCallback((I,q,te)=>{const le=go(I,q,te);if(le.hasConflict)return le;const Ue=Ls(I),Ie=te||x;for(const he of Ue){const qe=Xr(he,I.startTime,I.duration,I.type,Ie,I.flightNumber,I.id);if(!qe.isAllowed)return{hasConflict:!0,conflictingEventId:I.id,conflictType:"day-night-separation",conflictedPersonnel:he,reason:qe.reason}}return{hasConflict:!1,conflictingEventId:null,conflictType:null,conflictedPersonnel:null}},[go,Ls,Xr,x]),Kr=C.useMemo(()=>{const I=new Set;if(!qs||qs.length===0)return I;qs.forEach(te=>{te.pilot||(te.instructor?te.pilot=te.instructor:te.student&&(te.pilot=te.student))});const q=qs.filter(te=>te.flightNumber==="SCT FORM");q.length>0&&q.forEach(te=>{console.log(`üî¥   - ID: ${te.id}, Instructor: "${te.instructor||"EMPTY"}", Pilot: ${te.pilot}`)});for(const te of qs){const le=qs.filter(Ie=>Ie.id!==te.id),Ue=Pl(te,le);Ue.hasConflict&&(console.log(`üî¥ ‚ùå CONFLICT FOUND: ${te.flightNumber} (${te.id}) - ${Ue.reason||Ue.conflictType}`),console.log("üî¥ Event instructor:",te.instructor),console.log("üî¥ Event student:",te.student),console.log("üî¥ Event pilot:",te.pilot),console.log("üî¥ Event personnel:",Ls(te)),I.add(te.id))}for(const te of qs){if(te.type!=="flight"||!te.flightNumber)continue;const le=be.find(he=>he.id===te.flightNumber);if(!le||le.twrDiReqd!=="YES")continue;const Ue=qs.filter(he=>he.eventCategory==="twr_di"&&he.type==="flight");let Ie=!1;for(const he of Ue){const qe=he.startTime,dt=he.startTime+he.duration,at=te.startTime,Nt=te.startTime+te.duration;if(qe<=at&&dt>=Nt){Ie=!0;break}}Ie||I.add(te.id)}return I},[qs,Pl,be]),po=C.useMemo(()=>{const I=new Set;if(!Kt||Kt.length===0)return I;for(const q of Kt){const te=Kt.filter(Ue=>Ue.id!==q.id);go(q,te,Ve).hasConflict&&I.add(q.id)}for(const q of Kt){if(q.type!=="flight"||!q.flightNumber)continue;const te=be.find(Ie=>Ie.id===q.flightNumber);if(!te||te.twrDiReqd!=="YES")continue;const le=Kt.filter(Ie=>Ie.eventCategory==="twr_di"&&Ie.type==="flight");let Ue=!1;for(const Ie of le){const he=Ie.startTime,qe=Ie.startTime+Ie.duration,dt=q.startTime,at=q.startTime+q.duration;if(he<=dt&&qe>=at){Ue=!0;break}}Ue||I.add(q.id)}return I},[Kt,go,Ve,be]),ua=C.useMemo(()=>{const I=new Map,q=[...K,...ye],te=new Map;q.forEach(Ue=>{te.set("fullName"in Ue?Ue.fullName:Ue.name,Ue)});const le=qs||[];for(const Ue of le){if(Ue.type==="deployment")continue;const Ie=Ls(Ue),he=[],qe=Ra(Ue,be),[dt,at,Nt]=Ue.date.split("-").map(Number),Be=new Date(Date.UTC(dt,at-1,Nt,0,qe.start*60)),Wt=new Date(Date.UTC(dt,at-1,Nt,0,qe.end*60));for(const Rt of Ie){const tn=te.get(Rt);if(!(!tn||!tn.unavailability||tn.unavailability.length===0))for(const Dn of tn.unavailability){const[wn,Ut,In]=Dn.startDate.split("-").map(Number),An=new Date(Date.UTC(wn,Ut-1,In)),[Sn,Ln,bn]=Dn.endDate.split("-").map(Number),gn=new Date(Date.UTC(Sn,Ln-1,bn));let Gn=new Date(An),bs=new Date(gn);if(!Dn.allDay){const Ss=Th(Dn.startTime),dr=Th(Dn.endTime);Ss!==null&&Gn.setUTCHours(0,Ss*60),dr!==null&&bs.setUTCHours(0,dr*60)}if(Be<bs&&Wt>Gn){let Ss=!0;if(Dn.reason==="TMUF - Ground Duties only"&&Ue.type!=="flight"&&(Ss=!1),Ss){he.push(Rt);break}}}}he.length>0&&I.set(Ue.id,[...new Set(he)])}return I},[qs,K,ye,be]),xo=C.useCallback((I,q,te)=>{Ki.current=I,fl.current=q,Hi.current=te},[]),ml=I=>{const q=d();(I==="MyDashboard"||I==="SupervisorDashboard")&&x!==q&&y(q),v(f),h(I)},xs=I=>{I==="Syllabus"&&(or(null),ia("Program Schedule")),Ki.current()?(Hs(I),ti(!0)):ml(I)},Yo=I=>{or(I),ia(f),xs("Syllabus")},hc=I=>{Yi(I),xs("TraineeLMP")},qi=I=>{lr(I),xs("Logbook")},gl=I=>{Ll(I),Yr(!0)},Lo=I=>{const q=new Date(Ve+"T00:00:00Z");I==="prev"?q.setUTCDate(q.getUTCDate()-1):q.setUTCDate(q.getUTCDate()+1),qt(d(q))},mc=C.useCallback(I=>{pe(le=>[...le,I]);const q=I.lmpType||"BPC+IPC",te=be.filter(le=>q==="BPC+IPC"?!le.lmpType||le.lmpType==="Master LMP":le.courses.includes(q));te.length>0&&Vt(le=>{const Ue=new Map(le);return Ue.set(I.fullName,[...te]),console.log(`[Individual LMP] Initialized ${I.fullName}'s Individual LMP with ${q} (${te.length} events)`),Ue}),$s("New Trainee Added!")},[be]),Rl=(I,q,te)=>{Vt(le=>{const Ue=new Map(le),Ie=Ue.get(I.fullName);if(!Ie)return console.error("LMP not found for trainee:",I.fullName),le;let he=q.id;const qe=[];te.forEach((Rt,tn)=>{let Dn="",wn="Flight";Rt.type==="TUT"?(Dn=`REM-T${tn+1}`,wn="Ground School"):Rt.type==="FTD"?(Dn=`REM-FTD${tn+1}`,wn="FTD"):Rt.type==="Flight"&&(Dn=`REM-F${tn+1}`,wn="Flight");const Ut={...q,id:`${q.code}-${Dn}`,code:`${q.code}-${Dn}`,isRemedial:!0,eventDescription:`Remedial ${Rt.type} for ${q.code}`,module:"Remedial",prerequisites:[he],duration:Rt.duration,flightOrSimHours:Rt.duration,totalEventHours:Rt.duration+(wn==="Ground School"?.25:1),type:wn,prerequisitesGround:[],prerequisitesFlying:[],preFlightTime:wn==="Ground School"?.25:wn==="FTD"?.5:1,postFlightTime:wn==="Ground School"?0:.5,location:"",methodOfDelivery:[],methodOfAssessment:[],resourcesPhysical:[],resourcesHuman:[Rt.instructor],eventDetailsCommon:[],eventDetailsSortie:[]};qe.push(Ut),he=Ut.id});const dt={...q,id:`${q.code}-RF`,code:`${q.code}-RF`,isRemedial:!0,eventDescription:`Re-Fly: ${q.eventDescription}`,module:"Remedial",prerequisites:[he],prerequisitesGround:[],prerequisitesFlying:[]};qe.push(dt);const at=new Set(qe.map(Rt=>Rt.id));let Nt=Ie.filter(Rt=>!at.has(Rt.id));const Be=Nt.findIndex(Rt=>Rt.id===q.id);return Be===-1?(console.error("Critical error: Failed to find insertion point. LMP not modified."),le):(Nt.splice(Be+1,0,...qe),Nt.filter(Rt=>Rt.prerequisites.includes(q.id)).forEach(Rt=>{const tn=Rt.prerequisites.indexOf(q.id);tn!==-1&&(Rt.prerequisites[tn]=dt.id,console.log(`‚úÖ Updated prerequisite for ${Rt.code}: ${q.id} ‚Üí ${dt.id}`))}),Ue.set(I.fullName,Nt),Ue)}),Yr(!1),$s("Remedial package added to trainee LMP.")},Zi=I=>{I==="save"?fl.current():Hi.current(),Xi&&ml(Xi),ti(!1),Hs(null)},fa=()=>{ti(!1),Hs(null)},Mo=I=>{ee(I),Xs(!0),setTimeout(()=>Xs(!1),2e3);const q=I==="ESL"?Za:xv;ue(q.instructors),pe(q.trainees),E(q.events),st(q.courses),Ct(q.scores),dn(q.pt051Assessments),Ge(q.courseColors),vt(q.archivedCourses),ze(q.coursePriorities),Re(q.coursePercentages),Vt(q.traineeLMPs),Mt([]),Bt({});const te=d();fo({[te]:JSON.parse(JSON.stringify(q.events.filter(le=>le.date===te)))})};C.useEffect(()=>{const I=J==="ESL"?Za:xv;E(I.events),st(I.courses);const q=d();Bt({[q]:I.events.filter(te=>te.date===q)})},[J]);const ha=I=>{Ge(te=>({...te,[I.number]:I.color}));const q={name:I.number,color:I.color,startDate:I.startDate,gradDate:I.gradDate,raafStart:I.raafStart,navyStart:I.navyStart,armyStart:I.armyStart};st(te=>[...te,q]),$s(`Course ${I.number} added successfully!`)},ma=async(I,q)=>{const te=kt[I];if(te)if(q){const le={...kt};delete le[I],Ge(le),vt(Ue=>({...Ue,[I]:te})),st(Ue=>Ue.filter(Ie=>Ie.name!==I)),$s(`Course ${I} archived successfully!`)}else{const le={...kt};delete le[I],Ge(le),st(Ue=>Ue.filter(Ie=>Ie.name!==I)),$s(`Course ${I} deleted permanently!`)}},Qi=I=>{xs("CourseRoster")},yd=()=>{xs("ArchivedCourses")},Kc=async I=>{const q=ht[I];if(!q)return;const te={...ht};delete te[I],vt(te),Ge(Ue=>({...Ue,[I]:q}));const le=Za.courses.find(Ue=>Ue.name===I);le&&st(Ue=>[...Ue,le]),$s(`Course ${I} unarchived successfully!`)},gc=async I=>{const q={...ht};delete q[I],vt(q),st(te=>te.filter(le=>le.name!==I)),$s(`Course ${I} deleted permanently!`)},Ul=I=>{const q=new Date(`${x}T00:00:00Z`);q.setUTCDate(q.getUTCDate()+I);const te=q.toISOString().split("T")[0];y(te)},si=I=>{const q=`${I.traineeFullName}_${I.eventId}_PT051`;dn(le=>new Map(le).set(q,I));const te=[I.overallGrade?`Overall Grade: ${I.overallGrade}`:null,I.overallResult?`Overall Result: ${I.overallResult}`:null,I.dcoResult?`DCO Result: ${I.dcoResult}`:null,I.overallComments?`Comments: ${I.overallComments.substring(0,50)}...`:null].filter(Boolean).join(", ");Pn("Mass Completion","Edit",`Updated PT-051 for ${I.traineeFullName} - Event: ${I.flightNumber} (${I.date})`,te)},cr=(I,q)=>{if(I.type==="deployment"){const he=q.filter(dt=>dt.type==="deployment").length+1,qe=Array.from({length:he},(dt,at)=>`Deployed ${at+1}`);console.log("Available Deployed resources:",qe),console.log("Checking deployment event:",I),console.log("Against existing events:",q.filter(dt=>dt.type==="deployment"));for(const dt of qe){const at=q.filter(Nt=>Nt.resourceId===dt&&yv(Nt,I));if(console.log(`Checking ${dt}:`,at.length>0?"OCCUPIED":"AVAILABLE",at),at.length===0)return console.log(`Assigning deployment to ${dt}`),dt}return console.log("All Deployed resources occupied, creating new one"),`Deployed ${he}`}let te;const le=be.find(Ie=>Ie.id===I.flightNumber);if(le)switch(le.type){case"Flight":te="PC-21 ";break;case"FTD":te="FTD ";break;case"Ground School":le.methodOfDelivery.includes("CPT")?te="CPT ":te="Ground ";break;default:console.warn(`Unexpected syllabus type for ${le.code}: ${le.type}`),te="Ground ";break}else switch(I.type){case"flight":te="PC-21 ";break;case"ftd":te="FTD ";break;case"cpt":te="CPT ";break;case"ground":I.flightNumber.toUpperCase().includes("CPT")?te="CPT ":te="Ground ";break;default:te="Ground "}const Ue=ho.filter(Ie=>Ie.startsWith(te));for(const Ie of Ue)if(!q.some(qe=>qe.resourceId===Ie&&yv(qe,I)))return Ie;return Ue[0]||`${te}1`},ws=(I,q={})=>{if(I){const Ie=(["NextDayBuild","Priorities","ProgramData","NextDayInstructorSchedule","NextDayTraineeSchedule"].includes(f)?Kt.map(qe=>({...qe,date:Ve})):qs).find(qe=>qe.id===I.id)||I;_(Ie),H(!1),W(null),Ji(!1);const he=Ti.some(qe=>qe.id===I.id);to(he),en(null)}else{const te={id:_r(),date:Cn==="nextDayBuild"||f==="NextDayBuild"||f==="Priorities"||f==="ProgramData"?Ve:x,type:q.type||"flight",flightNumber:"",duration:1.5,startTime:8,resourceId:"",color:"bg-gray-400/50",flightType:"Dual",locationType:"Local",origin:J,destination:J,isTimeFixed:!0};_(te),H(!0),W(null),to(!!q.isPriority),en(q.oracleContext||null)}},Ai=(I,q)=>{if(!ot||!q)return"Dual";const te=ot.get(q);if(!te)return"Dual";const le=te.find(Ue=>Ue.id===I||Ue.code===I);return le&&le.sortieType?le.sortieType:"Dual"},Er=(I,q)=>{Vt(te=>{const le=new Map(te),Ue=le.get(I);if(!Ue)return console.warn(`No Individual LMP found for trainee: ${I}`),te;const Ie=be.find(Nt=>Nt.id===q);if(!Ie)return console.warn(`Currency event ${q} not found in syllabus`),te;const he={...Ie,id:`${Ie.id}-CUR`,code:`${Ie.code}-CUR`,eventDescription:`${Ie.eventDescription} (Currency)`},qe=Ue.findIndex(Nt=>Nt.id===q);if(qe===-1)return console.warn(`Base event ${q} not found in trainee's LMP`),te;if(Ue.some(Nt=>Nt.id===`${q}-CUR`))return console.log(`Currency event ${q}-CUR already exists in trainee's LMP`),te;const at=[...Ue.slice(0,qe+1),he,...Ue.slice(qe+1)];return le.set(I,at),console.log(`Added currency event ${he.id} to ${I}'s Individual LMP`),le})},ga=(I,q)=>{var dt,at,Nt,Be,Wt,Rt,tn,Dn,wn;if(console.log("üîµ ========== handleSave
