        
        // Mark event as cancelled and move to STBY
        const originalResourceId = selectedEvent.resourceId;
        const newResourceId = selectedEvent.type === 'ftd' ? 'BNF-STBY' : 'STBY';
        
        console.log('ğŸ”„ Moving event from', originalResourceId, 'to', newResourceId);
        
        const cancelledEvent: ScheduleEvent = {
            ...selectedEvent,
            isCancelled: true,
            cancellationCode: cancellationCode,
            cancellationManualEntry: manualCodeEntry,
            cancelledBy: `${currentUser}`,
            cancelledAt: new Date().toISOString(),
            resourceId: newResourceId,
        };
        
        console.log('âœ… Created cancelled event:', {
            id: cancelledEvent.id,
            isCancelled: cancelledEvent.isCancelled,
            resourceId: cancelledEvent.resourceId,
            cancellationCode: cancelledEvent.cancellationCode
        });
        
        const isNextDay = eventDate === buildDfpDate && (activeView === 'NextDayBuild' || activeView === 'Priorities' || activeView === 'ProgramData');
        
        console.log('ğŸ” Is Next Day Build?', isNextDay);
        console.log('ğŸ” Active View:', activeView);
        console.log('ğŸ” Event Date:', eventDate, 'Build Date:', buildDfpDate);
        
        if (isNextDay) {
            console.log('ğŸ“ Updating nextDayBuildEvents');
            setNextDayBuildEvents(prev => {
                const updated = prev.map(e => e.id === selectedEvent.id ? cancelledEvent : e);
                console.log('âœ… Updated nextDayBuildEvents. Found event:', updated.some(e => e.id === selectedEvent.id));
                console.log('ğŸ” Event after update:', updated.find(e => e.id === selectedEvent.id));
                return updated;
            });
        } else {
            console.log('ğŸ“ Updating publishedSchedules for date:', eventDate);
            setPublishedSchedules((prev: Record<string, ScheduleEvent[]>) => {
                const scheduleForDate = prev[eventDate] || [];
                console.log('ğŸ“Š Events for this date before update:', scheduleForDate.length);
                const updatedSchedule = scheduleForDate.map(e => e.id === selectedEvent.id ? cancelledEvent : e);
                console.log('âœ… Updated schedule. Found event:', updatedSchedule.some(e => e.id === selectedEvent.id));
                console.log('ğŸ” Event after update:', updatedSchedule.find(e => e.id === selectedEvent.id));
                console.log('ğŸ” STBY events after update:', updatedSchedule.filter(e => e.resourceId?.includes('STBY')).length);
                return { ...prev, [eventDate]: updatedSchedule };
            });
        }
        
