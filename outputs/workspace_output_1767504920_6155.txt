PIC, flightType set to Solo`))}},[Pt,yn]=C.useState(n.locationType||"Local"),[Tt,lt]=C.useState(n.origin||m),[Et,Bt]=C.useState(n.destination||m),[Kt,Mt]=C.useState(n.formationType||""),[Ve,qt]=C.useState(n.isDeploy||!1),[Mn,jn]=C.useState(""),[je,$e]=C.useState(n.deploymentStartDate||n.date),[Ye,Dt]=C.useState(n.deploymentStartTime||""),[St,hn]=C.useState(n.deploymentEndDate||n.date),[Ce,At]=C.useState(n.deploymentEndTime||""),[B,Ae]=C.useState(n.deploymentAircraftCount||1),[rt,yt]=C.useState(null),et=C.useRef(null),[$t,pn]=C.useState(!1),kn=!!ne,ts=(ne==null?void 0:ne.availableInstructors)||l,un=ne?ne.availableTraineesAnalysis.map(ke=>ke.trainee.fullName):d,[Nn,os]=C.useState(kn?[]:u),ss=C.useMemo(()=>{let ke=[];return _e==="sct"?ke=U:_e==="lmp_event"||_e==="lmp_currency"?ke=f.filter(mt=>mt.lmpType==="Master LMP"||!mt.lmpType).map(mt=>mt.id):_e==="staff_cat"?ke=f.filter(mt=>mt.lmpType==="Staff CAT").map(mt=>mt.id):_e==="twr_di"?ke=f.map(mt=>mt.id):ke=Nn,Q&&!ke.includes("SCT FORM")&&(ke=[...ke,"SCT FORM"]),ke},[_e,U,f,Nn,Q]),Hn=C.useMemo(()=>{const ke=new Set(v.map(Cn=>Cn.fullName)),Yt=ts.filter(Cn=>!ke.has(Cn)).map(Cn=>{const Vn=x.find(xn=>xn.name===Cn);return{name:Cn,unit:(Vn==null?void 0:Vn.unit)||"Unknown",rank:(Vn==null?void 0:Vn.rank)||"FLGOFF"}}).reduce((Cn,Vn)=>(Cn[Vn.unit]||(Cn[Vn.unit]=[]),Cn[Vn.unit].push(Vn),Cn),{}),an=["WGCDR","SQNLDR","FLTLT","FLGOFF","PLTOFF"],en=Object.keys(Yt).sort((Cn,Vn)=>{const xn=Math.min(...Yt[Cn].map(Es=>an.indexOf(Es.rank))),ls=Math.min(...Yt[Vn].map(Es=>an.indexOf(Es.rank)));return xn-ls});return{grouped:Yt,sortedUnits:en}},[ts,v,x]),Jn=C.useMemo(()=>{const mt=un.map(Yt=>{const an=v.find(en=>en.name===Yt||en.fullName===Yt);return{name:Yt,course:(an==null?void 0:an.course)||"Unknown"}}).reduce((Yt,an)=>(Yt[an.course]||(Yt[an.course]=[]),Yt[an.course].push(an),Yt),{}),nn=Object.keys(mt).sort();return{grouped:mt,sortedCourses:nn}},[un,v]),zn=C.useMemo(()=>{const ke={};return[...ts,...un].forEach(mt=>{const nn=x.find(an=>an.name===mt),Yt=v.find(an=>an.name===mt||an.fullName===mt);ke[mt]={name:mt,rank:(nn==null?void 0:nn.rank)||(Yt==null?void 0:Yt.rank)||"",flightCount:0,ftdCount:0,cptCount:0,groundCount:0,startTime:""}}),D.forEach(mt=>{var Yt,an;if((Yt=mt.resourceId)!=null&&Yt.startsWith("STBY")||(an=mt.resourceId)!=null&&an.startsWith("BNF-STBY")||mt.type==="deployment")return;const nn=new Set;mt.instructor&&nn.add(mt.instructor),mt.student&&nn.add(mt.student),mt.groupTraineeIds&&mt.groupTraineeIds.length>0&&mt.groupTraineeIds.forEach(en=>{const Cn=v.find(Vn=>Vn.idNumber===en);Cn&&nn.add(Cn.name)}),nn.forEach(en=>{if(ke[en]){mt.type==="flight"?ke[en].flightCount++:mt.type==="ftd"?ke[en].ftdCount++:mt.type==="cpt"?ke[en].cptCount++:mt.type==="ground"&&ke[en].groundCount++;const Cn=f.find(ls=>ls.id===mt.flightNumber),Vn=(Cn==null?void 0:Cn.preFlightTime)||0,xn=mt.startTime-Vn;if(!ke[en].startTime||xn<parseFloat(ke[en].startTime.replace(":","."))){const ls=Math.floor(xn),Es=Math.round(xn%1*60);ke[en].startTime=`${String(ls).padStart(2,"0")}${String(Es).padStart(2,"0")}`}}})}),ke},[D,ts,un,x,v,f]),Fn=(ke,mt,nn="Instructor",Yt=!1,an=!1)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:nn}),e.jsxs("select",{value:ke,onChange:en=>mt(en.target.value),disabled:Yt,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed appearance-none cursor-pointer z-10 ",children:[e.jsxs("option",{value:"",disabled:!0,children:["Select ",nn.toLowerCase()]}),Hn.sortedUnits.map(en=>e.jsx("optgroup",{label:`â”€â”€â”€ ${en} â”€â”€â”€`,children:Hn.grouped[en].map(Cn=>{const xn=`${(zn[Cn.name]||{rank:""}).rank} ${Cn.name}`;return e.jsx("option",{value:Cn.name,children:xn},Cn.name)})},en)),an&&e.jsx("optgroup",{label:"â”€â”€â”€ Other â”€â”€â”€",children:e.jsx("option",{value:"PAX",children:"PAX"})})]})]}),Rn=(ke,mt,nn=!1,Yt=!1)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Trainee"}),e.jsxs("select",{value:ke,onChange:an=>mt(an.target.value),disabled:nn,className:`mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm transition-all duration-200 disabled:bg-gray-700/50 disabled:cursor-not-allowed ${Yt?"ring-2 ring-red-500":""}`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a trainee"}),Jn.sortedCourses.map(an=>e.jsx("optgroup",{label:`â”€â”€â”€ ${an} â”€â”€â”€`,children:Jn.grouped[an].map(en=>{const Cn=v.find(ls=>ls.name===en.name||ls.fullName===en.name),xn=`${(zn[en.name]||{rank:""}).rank} ${(Cn==null?void 0:Cn.name)||en.name}`;return e.jsx("option",{value:en.name,children:xn},en.name)})},an))]})]});C.useEffect(()=>{var ke,mt;if(Q&&Fe&&be[0]){const nn=((ke=be[0])==null?void 0:ke.student)||((mt=be[0])==null?void 0:mt.pilot);if(nn&&W){const Yt=ot(Fe,nn);be[0].flightType!==Yt&&(Ze(an=>{const en=[...an];return en.length>0&&(en[0]={...en[0],flightType:Yt}),en}),console.log(`ðŸŽ¯ [Auto Dual/Solo] Set to ${Yt} from Individual LMP for ${nn}`))}}},[Q,Fe,W]),C.useEffect(()=>{var ke,mt,nn;if(((ke=be[0])==null?void 0:ke.flightType)==="Solo"){const Yt=((mt=be[0])==null?void 0:mt.student)||((nn=be[0])==null?void 0:nn.pilot);Yt&&be[0].pilot!==Yt&&Vt()}},[(Vr=be[0])==null?void 0:Vr.flightType,(li=be[0])==null?void 0:li.student,(Mi=be[0])==null?void 0:Mi.pilot]),C.useEffect(()=>{_e==="sct"?(Ze(ke=>ke.map(mt=>({...mt,flightType:"Solo"}))),ft||tt(1.2)):_e==="lmp_event"||_e==="lmp_currency"||_e==="staff_cat"?ft||tt(1.2):_e==="twr_di"&&(Ze(ke=>ke.map(mt=>({...mt,flightType:"Solo"}))),ft||tt(1.2),(Q||!n.startTime||n.startTime===0)&&Ct("08:00"))},[_e]),C.useEffect(()=>{if(Fe&&(_e==="lmp_event"||_e==="lmp_currency"||_e==="staff_cat"||_e==="twr_di")){const ke=f.find(mt=>mt.id===Fe);ke&&ke.flightType&&Ze(mt=>mt.map(nn=>({...nn,flightType:ke.flightType})))}},[Fe,_e,f]),C.useEffect(()=>{var ke,mt;if((Q||o&&(!n.id||n.id.startsWith("2d1b6a22")))&&(console.log(`ðŸ“ [Flight Number Change] isAddingTile: ${Q}, isEditingDefault: ${o}, event.id: ${n.id}, flightNumber: ${Fe}`),Fe&&be[0]&&W)){const nn=((ke=be[0])==null?void 0:ke.student)||((mt=be[0])==null?void 0:mt.pilot);if(nn){console.log(`ðŸ“ [Flight Number Change] Using selected trainee: ${nn}`);const Yt=ot(Fe,nn);be[0].flightType!==Yt&&(Ze(an=>{const en=[...an];return en.length>0&&(en[0]={...en[0],flightType:Yt}),en}),console.log(`ðŸŽ¯ [Auto Dual/Solo] Set to ${Yt} from Individual LMP for selected trainee ${nn}`))}else{console.log(`ðŸ“ [Flight Number Change] No pilot selected - searching for default from any trainee with LMP ${Fe}`);let Yt="Dual",an="";for(const[en,Cn]of W.entries()){const Vn=Cn.find(xn=>xn.id===Fe||xn.code===Fe);if(Vn&&Vn.sortieType){Yt=Vn.sortieType,an=en,console.log(`ðŸ“ [Flight Number Change] Found default ${Yt} from ${an}'s Individual LMP`);break}}be[0].flightType!==Yt&&(Ze(en=>{const Cn=[...en];return Cn.length>0&&(Cn[0]={...Cn[0],flightType:Yt}),Cn}),console.log(`ðŸŽ¯ [Auto Dual/Solo] Set to ${Yt} as default from ${an||"system"} for LMP ${Fe}`))}}},[Fe,W,Q,o,n.id]),C.useEffect(()=>{var ke,mt;if((Q||o&&(!n.id||n.id.startsWith("2d1b6a22")))&&Fe&&be[0]&&W){const nn=((ke=be[0])==null?void 0:ke.student)||((mt=be[0])==null?void 0:mt.pilot);if(nn){const Yt=ot(Fe,nn);be[0].flightType!==Yt&&(Ze(an=>{const en=[...an];return en.length>0&&(en[0]={...en[0],flightType:Yt}),en}),console.log(`ðŸŽ¯ [Trainee Change] Updated to ${Yt} from Individual LMP for selected trainee ${nn}`))}}},[(Qr=be[0])==null?void 0:Qr.student,(Fi=be[0])==null?void 0:Fi.pilot,Fe,W,Q,o,n.id]);const Qn=C.useMemo(()=>{if(Te&&Te.length>0&&Y){const ke=Te.filter(mt=>mt.location===Y);return ke.length>0?ke:null}return null},[Te,Y]),as=C.useMemo(()=>Qn?Qn.map(ke=>ke.code):m==="ESL"?["MERL","VANG"]:["COBR","HAWK"],[Qn,m]),cs=["A","B","C","D","E","F","G","H","S","T","U","V","W","X","Y","Z"],rs=C.useMemo(()=>Object.keys(y).sort(),[y]),Ms=C.useMemo(()=>rs.map(ke=>({name:ke,trainees:v.filter(mt=>mt.course===ke).sort((mt,nn)=>mt.name.localeCompare(nn.name))})),[rs,v]),hs=C.useMemo(()=>We==="flight"?"Flight Details":We==="ftd"?"FTD Session Details":"Ground Event Details",[We]);C.useEffect(()=>{Xe(n.flightNumber),o&&!n.flightNumber?tt(""):tt(n.duration),Ke(n.type),Ct(typeof n.startTime=="string"?n.startTime:Q0(n.startTime)),dn(n.area||"A"),st(n.aircraftNumber||"001"),Ge(1),Ze([{flightType:n.flightType,instructor:n.instructor||"",student:n.student||"",pilot:n.pilot||"",group:n.group||"",groupTraineeIds:n.groupTraineeIds||[]}]),J(o),ee(h),yn(n.locationType||"Local"),lt(n.origin||m),Bt(n.destination||m),Mt(n.formationType||as[0]),qt(n.isDeploy||!1),$e(n.deploymentStartDate||n.date),Dt(n.deploymentStartTime||""),hn(n.deploymentEndDate||n.date),At(n.deploymentEndTime||"")},[n,o,h,m]),C.useEffect(()=>{Pt==="Local"&&(lt(m),Bt(m))},[Pt,m]),C.useEffect(()=>{const ke=Fe==="SCT FORM",mt=ke?kt:1;if(be.length!==mt){const nn=Array.from({length:mt},(Yt,an)=>{const en=ke&&_e==="sct"?"Solo":"Dual";return be[an]||{flightType:en,instructor:"",student:"",pilot:"",group:"",groupTraineeIds:[]}});Ze(nn)}},[kt,Fe,be,_e]),C.useEffect(()=>{Ke(Dw(Fe,f))},[Fe,f]);const _n=()=>{const ke=[];if(["Program Schedule","DailyFlyingProgram","InstructorSchedule","TraineeSchedule"].includes(ae))Object.values(M).forEach(nn=>{const Yt=nn.filter(an=>an.type==="deployment");ke.push(...Yt)});else if(["NextDayBuild","Priorities","ProgramData","NextDayInstructorSchedule","NextDayTraineeSchedule"].includes(ae)){const nn=P.filter(Yt=>Yt.type==="deployment");ke.push(...nn)}return ke.filter(nn=>{var Yt,an,en,Cn;return We==="flight"?((Yt=nn.resourceId)==null?void 0:Yt.startsWith("PC-21"))||((an=nn.resourceId)==null?void 0:an.startsWith("Deployed")):We==="ftd"?(en=nn.resourceId)==null?void 0:en.startsWith("FTD"):We==="cpt"?(Cn=nn.resourceId)==null?void 0:Cn.startsWith("CPT"):!1})},rr=ke=>{const mt=Vn=>{const xn=Math.floor(Vn),ls=Math.round((Vn-xn)*60);return`${xn.toString().padStart(2,"0")}${ls.toString().padStart(2,"0")}`},nn=ke.date||"",Yt=ke.deploymentEndDate||nn,an=Vn=>{if(!Vn)return"";const xn=new Date(Vn),ls=xn.getDate().toString().padStart(2,"0"),Es=xn.toLocaleDateString("en-US",{month:"short"}),Zs=xn.getFullYear().toString().slice(-2);return`${ls}${Es}${Zs}`},en=mt(ke.startTime||0),Cn=mt((ke.startTime||0)+(ke.duration||0));return`${en}${an(nn)}â€“${Cn}${an(Yt)}`};C.useEffect(()=>{var nn,Yt;const ke=(nn=be[0])==null?void 0:nn.student,mt=(Yt=be[0])==null?void 0:Yt.instructor;if(ke){if(kn&&(ne!=null&&ne.availableTraineesAnalysis)){const an=ne.availableTraineesAnalysis.find(en=>en.trainee.fullName===ke);if(an&&an.nextSyllabusEvent){const en=an.nextSyllabusEvent.id;os([en]),Xe(en),tt(an.nextSyllabusEvent.duration);return}}os(u);return}if(kn&&mt){const an=V.filter(en=>en.name===mt);if(an.length>0){const en=an.map(Vn=>Vn.event);os(en),Xe(en[0]);const Cn=f.find(Vn=>Vn.id===en[0]);Cn&&tt(Cn.duration)}else os([]),Xe("");return}os(kn?[]:u),!n.flightNumber&&kn&&Xe("")},[be,kn,ne,V,u,f,n.flightNumber]),C.useEffect(()=>{const ke=mt=>{et.current&&!et.current.contains(mt.target)&&yt(null)};return document.addEventListener("mousedown",ke),()=>document.removeEventListener("mousedown",ke)},[]),C.useMemo(()=>[...l,...d].sort(),[l,d]);const Cs=(ke,mt,nn)=>{const Yt=[...be],an={...Yt[ke]};if(mt==="flightType"){const en=nn;an.flightType=en,en==="Solo"?(an.instructor="",an.student="",an.group="",an.groupTraineeIds=[]):an.pilot=""}else an[mt]=nn;Yt[ke]=an,Ze(Yt),ee(null)},js=(ke,mt)=>{const nn=be[ke],Yt=new Set(nn.groupTraineeIds||[]);Yt.has(mt)?Yt.delete(mt):Yt.add(mt);const an=Array.from(Yt),en=an.length>0?`${an.length} Trainees Selected`:"",Cn=[...be];Cn[ke]={...nn,groupTraineeIds:an,group:en},Ze(Cn)},Cr=(ke,mt)=>{const nn=be[ke],Yt=new Set(nn.groupTraineeIds||[]),an=mt.map(ls=>ls.idNumber);an.every(ls=>Yt.has(ls))?an.forEach(ls=>Yt.delete(ls)):an.forEach(ls=>Yt.add(ls));const Cn=Array.from(Yt),Vn=Cn.length>0?`${Cn.length} Trainees Selected`:"",xn=[...be];xn[ke]={...nn,groupTraineeIds:Cn,group:Vn},Ze(xn)},Fs=ke=>{const mt=ke.target.value;Xe(mt);const nn=f.find(Yt=>Yt.id===mt);nn&&tt(nn.duration),console.log("Flight number changed to:",mt),mt==="SCT FORM"&&!Kt&&Mt(as[0]),mt==="SCT FORM"&&_e==="sct"?(Ge(2),Ze(be.map(Yt=>({...Yt,flightType:"Solo"})))):mt!=="SCT FORM"&&Ge(1)},Ds=ke=>{if(!ke)return 0;if(ke.includes(":")){const[mt,nn]=ke.split(":").map(Number);return(mt||0)+(nn||0)/60}else{const mt=parseInt(ke.substring(0,2))||0,nn=parseInt(ke.substring(2,4))||0;return mt+nn/60}},Js=()=>{console.log("Visual Adjust clicked"),fe&&fe(n),vt(!0)},sa=()=>{vt(!1);const ke={...n,startTime:Ht,duration:we-Ht};ge&&ge(ke),Ct(Q0(Ht)),tt(we-Ht)},to=()=>{const ke=be.map((mt,nn)=>{let Yt=n.color;const an=mt.student||mt.pilot;if(an){const xn=v.find(ls=>ls.fullName===an);xn&&y[xn.course]&&(Yt=y[xn.course])}let en=n.resourceId;if(Mn){const xn=_n().find(ls=>ls.id===Mn);xn&&(en=xn.resourceId,console.log(`Assigning event to deployment: ${xn.id} (${en})`))}const Cn=Fe==="SCT FORM"&&be.length>1?`${n.id}-${nn}-${Date.now()}`:n.id;Fe==="SCT FORM"&&be.length>1&&(en="");const Vn={...n,id:Cn,type:We,flightNumber:Fe,startTime:typeof nt=="string"?_w(nt):nt,resourceId:en,duration:typeof ft=="number"?ft:0,area:We==="flight"?xt:void 0,aircraftNumber:We==="flight"?on:void 0,color:Yt,flightType:mt.flightType,instructor:mt.instructor,student:mt.student,pilot:mt.pilot,group:mt.group,groupTraineeIds:mt.groupTraineeIds,locationType:Pt,origin:Pt==="Local"?m:Tt,destination:Pt==="Local"?m:Et,formationType:Fe==="SCT FORM"?Kt:void 0,formationPosition:Fe==="SCT FORM"?nn+1:void 0,callsign:Fe==="SCT FORM"?`${Kt}${nn+1}`:void 0,formationId:void 0,isDeploy:We==="flight"&&Pt==="Land Away"?Ve:void 0,deploymentStartDate:We==="flight"&&Pt==="Land Away"&&Ve?je:void 0,deploymentStartTime:We==="flight"&&Pt==="Land Away"&&Ve?Ye:void 0,deploymentEndDate:We==="flight"&&Pt==="Land Away"&&Ve?St:void 0,deploymentEndTime:We==="flight"&&Pt==="Land Away"&&Ve?Ce:void 0,deploymentAircraftCount:We==="flight"&&Pt==="Land Away"&&Ve?B:void 0,eventCategory:_e};return _e==="sct"&&console.log("ðŸ’¾ Saving SCT event:",{id:Vn.id,flightType:Vn.flightType,pilot:Vn.pilot,student:Vn.student,instructor:Vn.instructor,eventCategory:Vn.eventCategory,crewData:mt,allCrew:be}),Vn});if(console.log("Deployment Check:",{eventType:We,locationType:Pt,isDeploy:Ve,deploymentStartDate:je,deploymentStartTime:Ye,deploymentEndDate:St,deploymentEndTime:Ce}),We==="flight"&&Pt==="Land Away"&&Ve&&je&&Ye&&St&&Ce){console.log("Creating deployment tile...");const mt=Ds(Ye),nn=Ds(Ce),Yt=new Date(je),an=new Date(St);let Cn=Math.floor((an.getTime()-Yt.getTime())/(1e3*60*60*24))*24+(nn-mt);Cn<=0&&(Cn=1),console.log(`Creating ${B} deployment tiles...`);for(let Vn=0;Vn<B;Vn++){const xn={id:`deployment-${n.id}-${Vn}-${Date.now()}`,date:je,type:"deployment",startTime:mt,duration:Cn,resourceId:"Deployed",color:"bg-gray-600/30",flightNumber:"DEPLOYMENT",flightType:"Dual",locationType:"Land Away",origin:"DEPLOY",destination:"DEPLOY",instructor:"",student:"",pilot:"",isDeploy:!0,deploymentStartDate:je,deploymentStartTime:Ye,deploymentEndDate:St,deploymentEndTime:Ce,deploymentAircraftCount:B};console.log(`Deployment tile ${Vn+1} created:`,xn),ke.push(xn)}}console.log("Events to save:",ke),s(ke)},Ti=C.useMemo(()=>{const ke=[];for(let mt=0;mt<24;mt++)for(let nn=0;nn<60;nn+=5){const Yt=mt+nn/60,an=`${String(mt).padStart(2,"0")}${String(nn).padStart(2,"0")}`;ke.push({label:an,value:Yt})}return ke},[]),vs=C.useMemo(()=>{const ke=n.flightType==="Dual"?n.student:n.pilot;return ke&&v.find(mt=>mt.fullName===ke)||null},[n.flightType,n.student,n.pilot,v]),ra=()=>{var ke,mt;kn&&!((ke=be[0])!=null&&ke.student)&&!((mt=be[0])!=null&&mt.instructor)&&(pn(!0),setTimeout(()=>pn(!1),2e3))},no=()=>{vs&&(T(vs),t())},xi=()=>{E(n.flightNumber),t()},Ta=()=>{vs&&(A(vs),t())},so=()=>{_(n)},Go=()=>{R(n)},ro=()=>{n.flightNumber.includes("MB")||n.flightNumber.includes(" MB")?Le(!0):(alert(vs?`Ground event "${n.flightNumber}" marked as complete for ${vs.rank} ${vs.name}`:`Ground event "${n.flightNumber}" marked as complete`),t())},Ba=ke=>{console.log("Mass Brief completed for trainees:",ke.map(Yt=>Yt.fullName));const mt=new Date().toISOString().split("T")[0],nn=n.instructor||"System";Ne?(ke.forEach(Yt=>{const an={id:`${Yt.idNumber}_${n.id}_${mt}`,traineeName:Yt.name,traineeFullName:Yt.fullName||`${Yt.rank} ${Yt.name}`,eventId:n.id,flightNumber:n.flightNumber,date:mt,instructorName:nn,dcoResult:"DCO",overallGrade:"No Grade",overallResult:null,overallComments:`Ground event completed via Mass Brief completion on ${mt}`,scores:[],isCompleted:!0,groundSchoolAssessment:{isAssessment:!1,result:0}};console.log("Saving PT051 assessment for:",Yt.fullName,an),Ne(an)}),console.log("PT051 assessments saved successfully")):console.warn("onSavePT051Assessment callback is not defined!"),He(ke),pe(!0)},Ao=(ke,mt)=>{var Vn;const nn=Fe==="SCT FORM";Fe.startsWith("SCT");const Yt=nn&&Kt?`${Kt}${mt+1}`:`Aircraft ${mt+1}`,an=_e==="lmp_currency"||_e==="sct"||_e==="staff_cat"||_e==="twr_di",en=_e==="lmp_event"||_e==="lmp_currency",Cn=(_e==="sct"||_e==="staff_cat"||_e==="twr_di")&&ke.flightType==="Dual";return e.jsxs("div",{className:`space-y-4 ${be.length>1?"p-3 bg-gray-700/50 rounded-lg":""}`,children:[be.length>1&&e.jsx("h4",{className:"text-sm font-bold text-sky-400",children:Yt}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Dual/Solo"}),e.jsxs("select",{value:ke.flightType,onChange:xn=>Cs(mt,"flightType",xn.target.value),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"Dual",children:"Dual"}),e.jsx("option",{value:"Solo",children:"Solo"})]})]}),ke.flightType==="Dual"?e.jsxs(e.Fragment,{children:[an?Fn(_e==="sct"?ke.pilot:ke.instructor,xn=>Cs(mt,_e==="sct"?"pilot":"instructor",xn),_e==="sct"||_e==="staff_cat"||_e==="twr_di"?"Pilot":"Instructor",Ve):Fn(ke.instructor,xn=>Cs(mt,"instructor",xn),"Instructor",Ve),en&&e.jsxs(e.Fragment,{children:[Rn(ke.student,xn=>Cs(mt,"student",xn),Ve,X==="student"),e.jsx("div",{className:"flex items-center justify-center my-3",children:e.jsx("span",{className:"text-base font-bold text-gray-500",children:"- OR -"})}),e.jsxs("div",{className:"p-4 border border-gray-600 rounded bg-gray-700/30 relative",ref:et,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300",children:"Group"}),((Vn=ke.groupTraineeIds)==null?void 0:Vn.length)>0&&e.jsxs("span",{className:"text-xs text-sky-400 font-mono bg-gray-800 px-2 py-0.5 rounded-full border border-gray-600",children:[ke.groupTraineeIds.length," Selected"]})]}),e.jsxs("button",{type:"button",onClick:()=>yt(rt===mt?null:mt),disabled:Ve,className:"w-full py-2 px-4 bg-gray-700 hover:bg-gray-600 border border-gray-500 text-white rounded-md text-sm font-medium transition-colors flex items-center justify-center shadow-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 text-sky-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z"})}),"Add Names"]}),rt===mt&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-gray-800 border border-gray-600 rounded-md shadow-xl max-h-60 overflow-y-auto left-0",children:Ms.map(xn=>{const ls=xn.trainees.map(ir=>ir.idNumber),Es=new Set(ke.groupTraineeIds||[]),Zs=ls.length>0&&ls.every(ir=>Es.has(ir));return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center px-3 py-2 bg-gray-900/80 font-bold text-gray-300 sticky top-0 z-10 border-b border-gray-700",children:[e.jsx("input",{type:"checkbox",checked:Zs,onChange:()=>Cr(mt,xn.trainees),className:"h-4 w-4 accent-sky-500 bg-gray-600 border-gray-500 rounded mr-2 cursor-pointer"}),e.jsx("span",{className:"uppercase text-xs",children:xn.name})]}),e.jsx("div",{className:"bg-gray-800",children:xn.trainees.map(ir=>{const Pi=Es.has(ir.idNumber);return e.jsxs("div",{className:"flex items-center px-3 py-2 pl-8 hover:bg-gray-700 cursor-pointer transition-colors border-b border-gray-700/50 last:border-0",onClick:()=>js(mt,ir.idNumber),children:[e.jsx("input",{type:"checkbox",checked:Pi,readOnly:!0,className:"h-4 w-4 accent-sky-500 bg-gray-600 border-gray-500 rounded mr-3 pointer-events-none"}),e.jsx("span",{className:"text-sm text-gray-300",children:ir.name})]},ir.idNumber)})})]},xn.name)})})]})]}),Cn&&Fn(ke.student,xn=>Cs(mt,"student",xn),"Crew",Ve,_e==="sct")]}):an?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Pilot"}),e.jsxs("select",{value:ke.pilot,onChange:xn=>Cs(mt,"pilot",xn.target.value),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed appearance-none cursor-pointer z-10",children:[e.jsx("option",{value:"",disabled:!0,children:"Select pilot"}),Hn.sortedUnits.map(xn=>e.jsx("optgroup",{label:`â”€â”€â”€ ${xn} â”€â”€â”€`,children:Hn.grouped[xn].filter(ls=>be.length>1?!be.filter((Zs,ir)=>ir!==mt).map(Zs=>Zs.pilot).filter(Zs=>Zs).includes(ls.name):!0).map(ls=>{const Zs=`${(zn[ls.name]||{rank:""}).rank} ${ls.name}`;return e.jsx("option",{value:ls.name,children:Zs},ls.name)})},xn))]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Pilot"}),e.jsxs("select",{value:ke.pilot,onChange:xn=>Cs(mt,"pilot",xn.target.value),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",disabled:!0,children:"Select pilot"}),un.filter(xn=>be.length>1?!be.filter((Es,Zs)=>Zs!==mt).map(Es=>Es.pilot).filter(Es=>Es).includes(xn):!0).map(xn=>e.jsx("option",{value:xn,children:xn},xn))]})]})]},mt)};return ht?e.jsx(kw,{event:n,startTime:Ht,endTime:we,onContinue:sa,onClose:()=>vt(!1)}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl border border-gray-700 transform transition-all animate-fade-in flex flex-col h-[90vh]",onClick:ke=>ke.stopPropagation(),children:[e.jsxs("div",{className:`p-4 border-b border-gray-700 flex justify-between items-center ${n.color} flex-shrink-0`,children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:hs}),e.jsxs("div",{className:"flex items-center space-x-4",children:[F&&We==="flight"&&e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer p-2 rounded-md hover:bg-black/20",children:[e.jsx("input",{type:"checkbox",checked:Ve,onChange:ke=>{const mt=ke.target.checked;qt(mt),mt&&yn("Land Away")},className:"h-5 w-5 accent-sky-500 bg-gray-600 rounded border-gray-500 focus:ring-sky-500"}),e.jsx("span",{className:"text-sm font-semibold text-white",children:"Add Deployment"})]}),e.jsx("button",{onClick:()=>ue(!0),className:"px-4 py-1 text-sm font-semibold rounded-md btn-red-brushed","aria-label":"Delete Event",children:"Delete"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-row overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-3",children:"Event Category"}),e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsx("button",{type:"button",onClick:()=>Z("lmp_event"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="lmp_event"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"LMP Event"}),e.jsx("button",{type:"button",onClick:()=>Z("lmp_currency"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="lmp_currency"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"LMP Currency"}),e.jsx("button",{type:"button",onClick:()=>Z("sct"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="sct"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"SCT"}),e.jsx("button",{type:"button",onClick:()=>Z("staff_cat"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="staff_cat"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Staff CAT"}),e.jsx("button",{type:"button",onClick:()=>Z("twr_di"),className:`px-4 py-3 rounded-lg font-semibold text-sm transition-all ${_e==="twr_di"?"bg-sky-600 text-white shadow-lg ring-2 ring-sky-400":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"TWR DI"}),"                                           "]})]}),e.jsxs("div",{className:`grid grid-cols-1 ${We==="flight"?"md:grid-cols-4":"md:grid-cols-3"} gap-4`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Syllabus Item"}),e.jsxs("select",{value:Fe,onChange:Fs,onFocus:ra,disabled:Ve||kn&&ss.length===0,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",disabled:!0,children:kn?"Select a crew member first":"Select an item"}),Q&&e.jsx("option",{value:"SCT FORM",children:"SCT FORM"}),ss.filter(ke=>ke!=="SCT FORM").map(ke=>e.jsx("option",{value:ke,children:ke},ke))]}),$t&&e.jsx("div",{className:"absolute -bottom-6 left-0 text-xs text-red-400 animate-fade-in",children:"Select a crew member first."})]}),We==="flight"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Area"}),e.jsx("select",{value:xt,onChange:ke=>dn(ke.target.value),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:cs.map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Aircraft Number"}),e.jsx("select",{value:on,onChange:ke=>st(ke.target.value),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:Array.from({length:49},(ke,mt)=>String(mt+1).padStart(3,"0")).map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Start Time"}),e.jsx("select",{value:nt,onChange:ke=>{Ct(parseFloat(ke.target.value)),ee(null)},disabled:Ve,className:`mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm transition-all duration-200 disabled:bg-gray-700/50 disabled:cursor-not-allowed ${X==="startTime"?"ring-2 ring-red-500":""}`,children:Ti.map(ke=>e.jsx("option",{value:ke.value,children:ke.label},ke.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Duration"}),e.jsx("input",{type:"number",step:"0.1",min:"0.1",value:ft,onChange:ke=>tt(ke.target.value===""?"":parseFloat(ke.target.value)),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed"})]})]}),We==="flight"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Location"}),e.jsxs("select",{value:Pt,onChange:ke=>yn(ke.target.value),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"Local",children:"Local"}),e.jsx("option",{value:"Land Away",children:"Land Away"})]})]}),We==="flight"&&Pt==="Land Away"&&!Ve&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Origin"}),e.jsx("input",{type:"text",value:Tt,onChange:ke=>lt(ke.target.value.toUpperCase()),maxLength:3,placeholder:"e.g. ESL",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Destination"}),e.jsx("input",{type:"text",value:Et,onChange:ke=>Bt(ke.target.value.toUpperCase()),maxLength:3,placeholder:"e.g. PEA",className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm"})]})]}),We==="flight"&&Pt==="Land Away"&&e.jsx(e.Fragment,{children:e.jsxs("fieldset",{className:"p-4 border border-gray-600 rounded-lg mb-4",children:[e.jsx("legend",{className:"px-2 text-sm font-semibold text-gray-300",children:"Deployment Period"}),e.jsxs("div",{className:"mt-2 grid grid-cols-4 gap-2 bg-gray-700/30 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Start Time"}),e.jsx("input",{type:"text",value:Ye,onChange:ke=>{const mt=ke.target.value.replace(/:/g,"").replace(/\D/g,"").slice(0,4);Dt(mt)},placeholder:"0800",className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Start Date"}),e.jsx("input",{type:"date",value:je,onChange:ke=>$e(ke.target.value),style:{colorScheme:"dark"},className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"End Time"}),e.jsx("input",{type:"text",value:Ce,onChange:ke=>{const mt=ke.target.value.replace(/:/g,"").replace(/\D/g,"").slice(0,4);At(mt)},placeholder:"1700",className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"End Date"}),e.jsx("input",{type:"date",value:St,onChange:ke=>hn(ke.target.value),style:{colorScheme:"dark"},className:"mt-1 w-full bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm"})]})]}),e.jsxs("div",{className:"mt-2 bg-gray-700/30 p-3 rounded-lg",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-400 mb-1",children:"Number of Aircraft"}),e.jsx("input",{type:"number",min:"1",max:"20",value:B,onChange:ke=>Ae(parseInt(ke.target.value)||1),className:"w-24 bg-gray-800 border-gray-600 rounded py-1 px-2 text-sm text-center"}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"aircraft deploying"})]})]})}),Fe==="SCT FORM"&&e.jsxs("div",{className:"p-3 bg-gray-900/50 rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-300",children:"Formation Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Formation Callsign"}),e.jsx("select",{value:Kt,onChange:ke=>Mt(ke.target.value),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:Qn?Qn.map(ke=>e.jsxs("option",{value:ke.code,children:[ke.name," (",ke.code,") - ",ke.unit]},ke.code)):as.map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Aircraft Count"}),e.jsx("select",{value:kt,onChange:ke=>Ge(parseInt(ke.target.value)),disabled:Ve,className:"mt-1 block w-full bg-gray-700 border border-gray-600 rounded-md shadow-sm py-2 px-3 text-white focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm disabled:bg-gray-700/50 disabled:cursor-not-allowed",children:Array.from({length:7},(ke,mt)=>mt+2).map(ke=>e.jsx("option",{value:ke,children:ke},ke))})]})]})]}),e.jsx("div",{className:"space-y-4",children:be.map(Ao)}),(We==="flight"||We==="ftd"||We==="cpt")&&e.jsxs("div",{className:"border-t border-gray-600 pt-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Add to Deployment"}),e.jsx("div",{className:"space-y-3",children:_n().length>0?_n().map(ke=>e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer hover:bg-gray-700 p-2 rounded",children:[e.jsx("input",{type:"checkbox",checked:Mn===ke.id,onChange:mt=>{mt.target.checked?jn(ke.id):jn("")},className:"h-4 w-4 text-sky-600 bg-gray-700 border-gray-600 rounded focus:ring-sky-500"}),e.jsx("span",{className:"text-sm text-gray-300",children:rr(ke)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",ke.resourceId,")"]})]},ke.id)):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No deployments available for this event type"})})]})]}):e.jsxs("div",{className:"text-gray-300 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Syllabus Item:"})," ",n.flightNumber]}),n.type==="flight"&&e.jsxs("p",{children:[e.jsx("strong",{children:"Route:"})," ",n.origin,"-",n.destination]}),n.type==="flight"&&n.area&&e.jsxs("p",{children:[e.jsx("strong",{children:"Area:"})," ",n.area]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dual/Solo:"})," ",e.jsx("span",{className:"font-semibold",children:n.flightType})]}),n.flightType==="Dual"?e.jsxs(e.Fragment,{children:[n.eventCategory==="sct"?e.jsxs("p",{children:[e.jsx("strong",{children:"Instructor:"})," ",n.instructor||n.pilot]}):e.jsxs("p",{children:[e.jsx("strong",{children:"Instructor:"})," ",n.instructor]}),n.type==="ground"&&n.attendees&&n.attendees.length>0?e.jsxs("div",{children:[e.jsx("p",{children:e.jsxs("strong",{children:["Attendees (",n.attendees.length,"):"]})}),e.jsx("div",{className:"mt-1 bg-gray-700/50 p-2 rounded-md max-h-32 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1",children:n.attendees.map(ke=>e.jsx("li",{className:"text-sm text-gray-300",children:ke.split(" â€“ ")[0]},ke))})})]}):n.eventCategory==="sct"?null:e.jsxs("p",{children:[e.jsx("strong",{children:"Student:"})," ",n.student||n.group]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"PIC:"})," ",n.pilot]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Second Position:"}),e.jsx("span",{className:"inline-block px-2 py-0.5 bg-yellow-500/20 border border-yellow-500/50 text-yellow-400 rounded text-sm font-semibold",children:"SOLO
