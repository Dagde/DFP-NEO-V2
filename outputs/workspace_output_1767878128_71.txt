  if (USE_API) {
    console.log('Initializing data from API...');
    
    try {
      // Try to fetch from API
      const [instructorsResult, traineesResult, scheduleResult, scoresResult] = await Promise.all([
        fetchInstructors(),
        fetchTrainees(),
        fetchSchedule(),
        fetchScores(),
      ]);

      // Ensure arrays
      instructors = Array.isArray(instructorsResult) ? instructorsResult : [];
      trainees = Array.isArray(traineesResult) ? traineesResult : [];
      events = Array.isArray(scheduleResult) ? scheduleResult : [];

      console.log('Data loaded from API:', {
        instructors: instructors.length,
        trainees: trainees.length,
        events: events.length,
        courses: courses.length,
        coursePriorities: coursePriorities.length,
        scores: scoresResult.size,
        scoresSample: Array.from(scoresResult.entries()).slice(0, 1),
        pt051Assessments: pt051Assessments.size,
        coursePercentages: coursePercentages.size,
        traineeLMPs: traineeLMPs.size,
      });
      
      console.log('âœ… Instructors sample:', instructors.slice(0, 3));
      console.log('âœ… Trainees sample:', trainees.slice(0, 3));
      
      // Log all unique course names from trainees
      const uniqueCourses = [...new Set(trainees.map(t => t.course).filter(c => c))];
      console.log('ðŸ“‹ Unique trainee courses:', uniqueCourses);
      
      // Log trainees with empty/missing courses
      const traineesWithoutCourse = trainees.filter(t => !t.course || t.course.trim() === '');
      console.log('âš ï¸ Trainees without course:', traineesWithoutCourse.length, traineesWithoutCourse.slice(0, 5));

      // Auto-generate courseColors based on trainee courses
      if (trainees.length > 0 && Object.keys(courseColors).length === 0) {
        const uniqueCourses = [...new Set(trainees.map(t => t.course).filter(c => c))];
        const predefinedColors = [
          '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', 
          '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9',
          '#F8B500', '#00CED1', '#FF69B4', '#32CD32',
          '#FF6347', '#40E0D0', '#9370DB', '#20B2AA'
        ];
        
        courseColors = {};
        uniqueCourses.forEach((course, index) => {
          courseColors[course] = predefinedColors[index % predefinedColors.length];
        });
        
        console.log('ðŸŽ¨ Auto-generated courseColors:', courseColors);
        try {
          saveToStorage(STORAGE_KEYS.COURSE_COLORS, courseColors);
        } catch (error) {
          console.warn('Failed to save courseColors to localStorage (continuing anyway):', error);
        }
      }

      // Auto-populate traineeLMPs with master syllabus for each trainee
      if (trainees.length > 0 && traineeLMPs.size === 0) {
        console.log('ðŸ“š Initializing traineeLMPs with master syllabus for', trainees.length, 'trainees');
        
        trainees.forEach(trainee => {
          traineeLMPs.set(trainee.fullName, INITIAL_SYLLABUS_DETAILS);
        });
        
        console.log('âœ… traineeLMPs initialized with', traineeLMPs.size, 'entries');
        // Don't save traineeLMPs to localStorage - too large, always fetch from API or use master syllabus
      }

      // Save to localStorage for faster next load (non-critical if it fails)
      try {
        saveToStorage(STORAGE_KEYS.INSTRUCTORS, instructors);
        saveToStorage(STORAGE_KEYS.TRAINEES, trainees);
        saveToStorage(STORAGE_KEYS.SCHEDULE, events);
        saveToStorage(STORAGE_KEYS.SCORES, Array.from(scoresResult.entries()));
      } catch (error) {
        console.warn('Failed to save some data to localStorage (continuing anyway):', error);
      }
      
      // Return data from API
      return {
        instructors,
        trainees,
        events,
        scores: scoresResult,
        pt051Assessments,
        courses,
        courseColors,
        archivedCourses,
        coursePriorities,
        coursePercentages,
        traineeLMPs,
      };
    } catch (error) {
      console.warn('API fetch failed, falling back to localStorage or mock data:', error);
      console.error('Full error details:', error);
      
      // Try localStorage first
      instructors = loadFromStorage(STORAGE_KEYS.INSTRUCTORS, []);
